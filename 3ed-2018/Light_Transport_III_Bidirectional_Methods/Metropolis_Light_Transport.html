
<!doctype html>
<html lang="en">
<head>

<!-- all praise to https://realfavicongenerator.net -->
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link href="https://fonts.googleapis.com/css?family=Domine|Roboto+Mono" rel="stylesheet">
  <link rel="stylesheet" href="../pbrstyle.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">

  <script async src="https://cse.google.com/cse.js?cx=003601324460585362024:4xwpwgaitgd"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.6.1/react.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.6.1/react-dom.min.js"></script>
  <script src="/jeri.min.js"></script>
  <link rel="preload" href="/exr.worker.js" as="script" crossorigin="anonymous">
        
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

  <title>Metropolis Light Transport</title>
</head>
        
<body>

<nav class="fixed-top-lg-navbar navbar navbar-expand bg-light navbar-light">
  <ul class="nav navbar-nav">
    <a class="navbar-brand" href="../contents.html"><img src="../pbr.jpg" width=25 height=25></a>
    <li class="nav-item"><a class="nav-link" href="../Light_Transport_III_Bidirectional_Methods.html">Light Transport III: Bidirectional Methods</a></li>
    <span class="navbar-text">/</span>
    <li class="nav-item"><a class="nav-link" href="#">Metropolis Light Transport</a></li>
    <span class="navbar-text">&nbsp;&nbsp;</span>
    <li class="nav-item"><a class="nav-link" href="../Light_Transport_III_Bidirectional_Methods/Bidirectional_Path_Tracing.html">(Previous: Bidirectional Path Tracing)</a></li>
  </ul>

  <ul class="nav navbar-nav ml-auto d-none d-md-block">
        <li class="nav-item"><div class="gcse-search"></div></li>
    </ul>
  <ul class="nav navbar-nav d-block d-md-none">
        <li class="nav-item"><div class="gcse-search"></div></li>
    </ul>
</nav>

<div class="maincontainer">
<div class="container-fluid">

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#"><i class="fas fa-link "></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:mlt"></span><h2>16.4 Metropolis Light Transport</h2><p>



</p>
<p>

</p>
<p>In 1997, Veach and Guibas proposed an unconventional rendering technique named
<em>Metropolis Light Transport</em> (MLT), which applies the Metropolis-Hastings
algorithm from Section&nbsp;<a href="../Monte_Carlo_Integration/Metropolis_Sampling.html#sec:metropolis-sampling">13.4</a> to the path space integral
in Equation (<a href="../Light_Transport_III_Bidirectional_Methods/The_Path-Space_Measurement_Equation.html#eq:meas-eqn">16.1</a>). Whereas all of the rendering techniques we
have discussed
until now have been based on the principles of Monte Carlo integration and
independent sample generation, MLT adopts a different set of tools that allows
samples to be <em>statistically correlated</em>.

</p>
<p>MLT generates a sequence of light-carrying paths through the scene, where each
path is found by mutating the previous path in some manner. These path
mutations are done in a way that ensures that the overall distribution of
sampled paths is proportional to the contribution the paths make to the image
being generated. Such a distribution of paths can in turn be used to generate
an image of the scene. Given the flexibility of the Metropolis sampling method,
there are relatively few restrictions on the types of admissible mutation
rules: highly specialized mutations can be used to sample otherwise
difficult-to-explore families of light-carrying paths in a way that would be
tricky or impossible to realize without introducing bias in a standard Monte
Carlo context.

</p>
<p>The correlated nature of MLT provides an important advantage over methods based
on independent sample generation, in that MLT is able to perform a <em>local
exploration</em> of path space: when a path that makes a large contribution to the
image is found, it&rsquo;s easy to find other similar paths by applying small
perturbations to it (a sampling process that generates states based on the
previous state value in this way is referred to as a <em>Markov chain</em>). The
resulting short-term memory is often beneficial:
when a function has a small value over most of
its domain and a large contribution in only a small subset, local exploration
amortizes the expense (in samples) of the search for the important region by
taking many samples from this part of the path space.  This property makes MLT
a good choice for rendering particularly challenging scenes: while it is
generally not able to match the performance of uncorrelated integrators for
relatively straightforward lighting problems, it distinguishes itself in more
difficult settings where most of the light transport happens along a small
fraction of all of the possible paths through the scene.

</p>
<p>The original MLT technique by Veach and Guibas builds on the path space
theory of light transport, which presents additional challenges compared to
the previous simple examples in Section&nbsp;<a href="../Monte_Carlo_Integration/Metropolis_Sampling.html#sec:metropolis-1d-examples">13.4.4</a>:
path space is generally not a Euclidean domain, as surface vertices are
constrained to lie on 2D subsets of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.06ex" height="2.676ex" style="vertical-align: -0.338ex;" viewBox="0 -1006.6 1317.4 1152.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper R cubed</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D411" d="M858 95c0 -16 -13 -106 -120 -106c-41 0 -103 4 -147 26c-70 34 -70 83 -70 149c0 73 0 92 -32 127c-31 34 -75 34 -89 34h-117v-278h108v-47c-36 3 -134 3 -176 3s-140 0 -176 -3v47h108v592h-108v47h380c188 0 298 -84 298 -185c0 -66 -51 -131 -167 -161 c43 -16 98 -47 112 -117c1 -5 9 -74 11 -85c5 -42 14 -113 74 -113c30 0 59 22 64 69c1 13 2 23 23 23c10 0 24 0 24 -22zM564 500c0 61 -2 139 -163 139h-118v-278h116c165 0 165 83 165 139Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-33" d="M457 171c0 -102 -91 -193 -213 -193c-109 0 -202 66 -202 157c0 44 32 58 56 58c29 0 56 -20 56 -56c0 -38 -31 -60 -66 -55c35 -59 110 -76 153 -76c44 0 113 29 113 165c0 98 -37 166 -119 166h-44c-17 0 -24 0 -24 11c0 10 7 11 15 12c7 0 31 2 39 3c25 1 59 4 89 52 c26 44 28 102 28 114c0 90 -55 112 -96 112c-36 0 -102 -13 -133 -62c15 0 62 0 62 -50c0 -29 -20 -51 -51 -51c-29 0 -51 19 -51 52c0 76 76 136 177 136c96 0 184 -56 184 -138c0 -79 -58 -149 -140 -176c104 -21 167 -99 167 -181Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D411" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-33" x="1221" y="585"></use>
</g>
</svg>. Whenever
specular reflection or refraction occurs, a sequence of three adjacent
vertices must satisfy a precise geometric relationship, which further
reduces the available degrees of freedom.

</p>
<p>MLT builds on a set of five mutation rules that each targets specific families
of light paths. Three of the mutations perform a localized exploration of
particularly challenging path classes such as caustics or paths containing
sequences of specular-diffuse-specular interactions, while two perform larger
steps with a corresponding lower overall acceptance rate. Implementing the full
set of MLT mutations is a significant undertaking: part of the challenge is
that none of the mutations is symmetric; hence an additional transition
density function must be implemented for each one. Mistakes in any part of the
system can cause subtle convergence artifacts that are notoriously difficult to
debug.

</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#PrimarySampleSpaceMLT"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span id="PrimarySampleSpaceMLT"></span><h3>16.4.1  Primary Sample Space MLT</h3><p>


</p>
<p>In 2002, Kelemen et al. presented a rendering technique that is also based on
the Metropolis-Hastings algorithm. We will refer to it as <em>Primary Sample
Space MLT</em> (PSSMLT) for reasons that will become clear shortly. Like MLT, the
PSSMLT method explores the space of light paths, searching for
those that carry a significant amount of energy from a light source to the
camera. The main difference is that PSSMLT does not use path space directly: it
explores light paths indirectly, piggybacking on an existing Monte Carlo
rendering algorithm such as uni- or bidirectional path tracing, which has both
advantages and disadvantages. The main advantage is that PSSMLT can use
symmetric transitions on a Euclidean domain, and for this reason it is much
simpler to implement. The downside is that PSSMLT lacks detailed information
about the structure of the constructed light paths, making it impossible to
recreate the kinds of sophisticated mutation strategies that are found in the
original MLT method.

</p>
<p>The details of this approach are easiest to motivate from an
implementation-centric viewpoint. Consider the case of rendering a scene
with the path integrator from Section <a href="../Light_Transport_I_Surface_Reflection/Path_Tracing.html#sec:path-implementation">14.5.4</a>, where
we generate (pseudo-)random samples in raster space to get a starting point
on the film, turn
them into rays, and invoke <a href="../Light_Transport_I_Surface_Reflection/Path_Tracing.html#PathIntegrator::Li"><tt>PathIntegrator::Li()</tt></a> to obtain
corresponding radiance estimates.
<a href="../Light_Transport_I_Surface_Reflection/Path_Tracing.html#PathIntegrator::Li"><tt>PathIntegrator::Li()</tt></a> will generally request a number of additional 1D
or 2D samples from the <a href="../Sampling_and_Reconstruction/Sampling_Interface.html#Sampler"><tt>Sampler</tt></a> to sample light sources and
material models, perform Russian roulette tests, and so on. Conceptually,
these samples could all be generated ahead of time and passed to
<a href="../Light_Transport_I_Surface_Reflection/Path_Tracing.html#PathIntegrator::Li"><tt>PathIntegrator::Li()</tt></a> using an additional argument, thus completely
removing any (pseudo-)randomness from an otherwise purely deterministic
function.

</p>
<p>Suppose that <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.583ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 681.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper L</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43F" d="M643 247c0 0 0 -3 -4 -14l-79 -216c-6 -17 -7 -17 -31 -17h-463c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 12 20 19 20l133 -3l148 3c5 0 16 0 16 -12 c0 -19 -8 -19 -38 -19c-94 0 -97 -11 -106 -47l-135 -540c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h94c173 0 217 114 251 206c7 16 8 21 17 21s12 -7 12 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
</g>
</svg> is the resulting deterministic function, which maps an
infinite-dimensional sample sequence <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.161ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 4374.6 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X 1 comma bold upper X 2 comma ellipsis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2026" d="M193 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53zM472 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53zM751 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="1229" y="-213"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1323" y="0"></use>
<g transform="translate(1768,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="1229" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="3091" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2026" x="3537" y="0"></use>
</g>
</svg> to a radiance
estimate <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="13.553ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 5835.1 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper L left-parenthesis bold upper X 1 comma bold upper X 2 comma ellipsis right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43F" d="M643 247c0 0 0 -3 -4 -14l-79 -216c-6 -17 -7 -17 -31 -17h-463c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 12 20 19 20l133 -3l148 3c5 0 16 0 16 -12 c0 -19 -8 -19 -38 -19c-94 0 -97 -11 -106 -47l-135 -540c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h94c173 0 217 114 251 206c7 16 8 21 17 21s12 -7 12 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2026" d="M193 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53zM472 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53zM751 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="681" y="0"></use>
<g transform="translate(1071,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="1229" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="2394" y="0"></use>
<g transform="translate(2839,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="1229" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="4162" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2026" x="4608" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="5445" y="0"></use>
</g>
</svg>. Here, <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.991ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 3871 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis bold upper X 1 comma bold upper X 2 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
<g transform="translate(389,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="1229" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1712" y="0"></use>
<g transform="translate(2158,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="1229" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="3481" y="0"></use>
</g>
</svg> denotes the raster
position, and the remaining arguments <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.161ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 4374.6 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X 3 comma bold upper X 4 comma ellipsis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-33" d="M457 171c0 -102 -91 -193 -213 -193c-109 0 -202 66 -202 157c0 44 32 58 56 58c29 0 56 -20 56 -56c0 -38 -31 -60 -66 -55c35 -59 110 -76 153 -76c44 0 113 29 113 165c0 98 -37 166 -119 166h-44c-17 0 -24 0 -24 11c0 10 7 11 15 12c7 0 31 2 39 3c25 1 59 4 89 52 c26 44 28 102 28 114c0 90 -55 112 -96 112c-36 0 -102 -13 -133 -62c15 0 62 0 62 -50c0 -29 -20 -51 -51 -51c-29 0 -51 19 -51 52c0 76 76 136 177 136c96 0 184 -56 184 -138c0 -79 -58 -149 -140 -176c104 -21 167 -99 167 -181Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-34" d="M471 165h-100v-87c0 -36 2 -47 76 -47h21v-31c-41 3 -94 3 -136 3s-94 0 -135 -3v31h21c74 0 76 11 76 47v87h-266v31l307 469c8 12 11 12 20 12c16 0 16 -6 16 -26v-455h100v-31zM300 196v373l-244 -373h244Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2026" d="M193 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53zM472 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53zM751 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-33" x="1229" y="-213"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1323" y="0"></use>
<g transform="translate(1768,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-34" x="1229" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="3091" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2026" x="3537" y="0"></use>
</g>
</svg> are the samples
consumed by <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.583ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 681.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper L</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43F" d="M643 247c0 0 0 -3 -4 -14l-79 -216c-6 -17 -7 -17 -31 -17h-463c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 12 20 19 20l133 -3l148 3c5 0 16 0 16 -12 c0 -19 -8 -19 -38 -19c-94 0 -97 -11 -106 -47l-135 -540c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h94c173 0 217 114 251 206c7 16 8 21 17 21s12 -7 12 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
</g>
</svg>.<button style="button" data-toggle="tooltip" data-placement="right" data-html="true" class="btn footnote-button" title="Although L is an infinite-dimensional function,
only a finite number of samples of X<sub>i</sub> will ever be needed due to path
termination with Russian roulette.">
      <sup>&dagger;</sup>
    </button>
		 By drawing many samples and averaging the
results of multiple evaluations of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.583ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 681.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper L</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43F" d="M643 247c0 0 0 -3 -4 -14l-79 -216c-6 -17 -7 -17 -31 -17h-463c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 12 20 19 20l133 -3l148 3c5 0 16 0 16 -12 c0 -19 -8 -19 -38 -19c-94 0 -97 -11 -106 -47l-135 -540c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h94c173 0 217 114 251 206c7 16 8 21 17 21s12 -7 12 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
</g>
</svg>, we essentially compute high-dimensional
integrals of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.583ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 681.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper L</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43F" d="M643 247c0 0 0 -3 -4 -14l-79 -216c-6 -17 -7 -17 -31 -17h-463c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 12 20 19 20l133 -3l148 3c5 0 16 0 16 -12 c0 -19 -8 -19 -38 -19c-94 0 -97 -11 -106 -47l-135 -540c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h94c173 0 217 114 251 206c7 16 8 21 17 21s12 -7 12 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
</g>
</svg> over a &ldquo;hypercube&rdquo; of (pseudo-)random numbers <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="11.194ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 4819.8 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X 1 comma bold upper X 2 comma ellipsis period</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2026" d="M193 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53zM472 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53zM751 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="1229" y="-213"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1323" y="0"></use>
<g transform="translate(1768,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="1229" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="3091" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2026" x="3537" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="4541" y="0"></use>
</g>
</svg>

</p>
<p>Given this interpretation of integrating a radiance estimate function over
a domain made of all possible sequences of input samples, we can apply the
Metropolis-Hastings algorithm to create a sampling process on the same
domain, with a distribution that is proportional to <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.583ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 681.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper L</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43F" d="M643 247c0 0 0 -3 -4 -14l-79 -216c-6 -17 -7 -17 -31 -17h-463c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 12 20 19 20l133 -3l148 3c5 0 16 0 16 -12 c0 -19 -8 -19 -38 -19c-94 0 -97 -11 -106 -47l-135 -540c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h94c173 0 217 114 251 206c7 16 8 21 17 21s12 -7 12 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
</g>
</svg>
(Figure&nbsp;<a href="#fig:pssmlt-overview">16.19</a>).  This distribution is intuitively
desirable: more sampling effort is naturally placed in parts of the
sampling space where more light transport occurs.  The state space
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.678ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 722.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal upper Omega</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-3A9" d="M677 162l-33 -162h-159c-23 0 -26 0 -26 21c0 69 32 159 47 201c29 82 56 158 56 233c0 156 -106 228 -202 228c-91 0 -201 -68 -201 -228c0 -75 28 -154 49 -212c23 -64 54 -152 54 -222c0 -21 -3 -21 -25 -21h-160l-33 162h25c5 -25 10 -51 18 -74c5 -15 8 -23 66 -23 h80c-13 56 -45 104 -89 170c-47 71 -88 140 -88 219c0 137 133 251 305 251c169 0 304 -112 304 -251c0 -79 -41 -148 -88 -219c-45 -66 -76 -114 -89 -170h80c58 0 61 8 66 24c9 24 13 47 18 73h25Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-3A9" x="0" y="0"></use>
</g>
</svg> for this problem consists of infinite dimensional sample
vectors <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="21.596ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 9298.3 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis bold upper X 1 comma bold upper X 2 comma ellipsis right-parenthesis element-of left-bracket 0 comma 1 right-parenthesis Superscript normal infinity</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2026" d="M193 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53zM472 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53zM751 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2208" d="M587 -23c0 -11 -9 -20 -20 -20h-193c-162 0 -293 131 -293 293s131 293 293 293h193c11 0 20 -9 20 -20s-9 -20 -20 -20h-193c-133 0 -242 -103 -252 -233h445c27 0 27 -40 0 -40h-445c10 -130 119 -233 252 -233h193c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-221E" d="M943 216c0 -118 -76 -227 -192 -227c-79 0 -138 42 -170 69c-22 19 -23 20 -90 101c-13 -22 -102 -170 -246 -170c-119 0 -189 115 -189 226c0 118 76 227 192 227c79 0 138 -42 170 -69c22 -19 23 -20 90 -101c13 22 102 170 246 170c119 0 189 -115 189 -226zM921 216 c0 90 -54 194 -160 194c-113 0 -189 -105 -227 -173c28 -34 73 -97 101 -128c45 -49 86 -72 132 -72c84 0 154 79 154 179zM465 194c-28 34 -73 97 -101 128c-45 49 -86 72 -132 72c-84 0 -154 -79 -154 -179c0 -90 54 -194 160 -194c113 0 189 105 227 173Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
<g transform="translate(389,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="1229" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1712" y="0"></use>
<g transform="translate(2158,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="1229" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="3481" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2026" x="3926" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="4764" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2208" x="5431" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="6376" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="6655" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="7155" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="7600" y="0"></use>
<g transform="translate(8101,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-221E" x="550" y="513"></use>
</g>
</g>
</svg> and is called
the <em>primary sample space</em>. For brevity in the equations below, we
will write the state vector as
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="17.735ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 7635.7 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X equals left-parenthesis bold upper X 1 comma bold upper X 2 comma ellipsis right-parenthesis period</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2026" d="M193 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53zM472 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53zM751 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="1147" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="2203" y="0"></use>
<g transform="translate(2593,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="1229" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="3916" y="0"></use>
<g transform="translate(4361,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="1229" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="5685" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2026" x="6130" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="6967" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="7357" y="0"></use>
</g>
</svg>
</div>
<p>

We use the convention that all components (including the raster
coordinates) are in the interval <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.91ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2114.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket 0 comma 1 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="779" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1224" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1724" y="0"></use>
</g>
</svg> and appropriately re-scaled
within <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.583ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 681.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper L</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43F" d="M643 247c0 0 0 -3 -4 -14l-79 -216c-6 -17 -7 -17 -31 -17h-463c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 12 20 19 20l133 -3l148 3c5 0 16 0 16 -12 c0 -19 -8 -19 -38 -19c-94 0 -97 -11 -106 -47l-135 -540c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h94c173 0 217 114 251 206c7 16 8 21 17 21s12 -7 12 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
</g>
</svg> when necessary.

</p>
<p></p>
<span class="anchor" id="fig:pssmlt-overview"></span><div class="card outerfigure"><div class="card-body figure"><p>



</p>
<div class="figure-row">
  <a href="pssmlt-idea.svg" title=""><img src="pssmlt-idea.svg" width=572 height=294 style="max-width: 100%;"></a>
</div>
<p>


</p>
<figcaption class="caption">Figure 16.19: Primary Sample Space MLT. <span class="legend">
PSSMLT performs mutations in an abstract space of infinite dimensional &ldquo;random
number vectors&rdquo; <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.019ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 869.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
</g>
</svg>. A deterministic mapping <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.583ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 681.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper L</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43F" d="M643 247c0 0 0 -3 -4 -14l-79 -216c-6 -17 -7 -17 -31 -17h-463c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 12 20 19 20l133 -3l148 3c5 0 16 0 16 -12 c0 -19 -8 -19 -38 -19c-94 0 -97 -11 -106 -47l-135 -540c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h94c173 0 217 114 251 206c7 16 8 21 17 21s12 -7 12 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
</g>
</svg> constructs
corresponding light paths on path space and estimates their radiance.</span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p>PSSMLT explores primary sample space using two different kinds of mutations.
The first (the &ldquo;large step&rdquo; mutation) replaces all components of the
vector <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.019ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 869.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
</g>
</svg> with new uniformly distributed samples, which corresponds to
invoking the underlying Monte Carlo rendering method as usual (i.e., without PSSMLT).

</p>
<p>Recall from Section&nbsp;<a href="../Monte_Carlo_Integration/Metropolis_Sampling.html#sec:choosing-mutations">13.4.2</a> that it is important that
there be greater than zero probability that any possible sample value be
proposed; this is taken care of by the large step mutation.  In general, the
large step mutation helps us explore the entire state space without getting
stuck on local &ldquo;islands.&rdquo;

</p>
<p>The second mutation (the &ldquo;small step&rdquo; mutation) makes a small perturbation to
each of the sample values <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.819ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 1213.8 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X Subscript i</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1229" y="-213"></use>
</g>
</svg>.  This mutation explores light-carrying paths close
to the current path, which is particularly important when a difficult
lighting configuration is encountered.

</p>
<p>Both of these are symmetric mutations, so their transition probabilities cancel
out when the acceptance probability is computed and thus don&rsquo;t need to be
computed, as was shown in Equation&nbsp;(<a href="../Monte_Carlo_Integration/Metropolis_Sampling.html#eq:accept-equal-ts">13.8</a>).

</p>
<p>The interface between the outer Metropolis-Hastings iteration and the inner
<tt>Integrator</tt> only involves the exchange of abstract sample vectors, making
this an extremely general approach: PSSMLT can theoretically enhance any kind
of rendering method that is based on Monte Carlo integration&mdash;in fact, it even
works for general Monte Carlo integration problems that are not related to
rendering at all.

</p>
<p>In practice, PSSMLT is often implemented on top of an existing bidirectional
path tracer. The resulting algorithm generates a new primary sample space state
in every iteration and passes it to BDPT, which invokes its set of connection
strategies and re-weights the result using MIS. In this setting, mutations
effectively jump from one group of path connections to another group rather
than dealing with individual connection strategies. However, this is not
without disadvantages: in many cases, only a small subset of the strategies is
truly effective, and MIS will consequently assign a large weight only to this
subset. This means that the algorithm still spends a considerable portion of
its time generating connections with strategies that have a low weight and thus
contribute very little to the rendered image. 

</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#MultiplexedMLT"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:multiplexed-mlt"></span><span id="MultiplexedMLT"></span><h3>16.4.2  Multiplexed MLT</h3><p>



</p>
<p>In 2014, Hachisuka et al. presented an extension to PSSMLT named
<em>Multiplexed Metropolis Light Transport</em> (MMLT) to address this problem.
MMLT leaves the &ldquo;outer&rdquo; Metropolis-Hastings iteration conceptually unchanged
and applies a small but effective modification to the &ldquo;inner&rdquo; BDPT
integrator.  Instead of always invoking all BDPT connection strategies, the
algorithm chooses a single strategy according to an extra state dimension and
returns its contribution scaled by the inverse discrete probability of the
choice. The additional dimension used for strategy selection can be mutated
using small or large steps in the same way as the other primary sample space
components of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.019ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 869.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
</g>
</svg>.

</p>
<p>To prevent unintentional large structural path mutations, Hachisuka et al. fix
the Markov chain so that it only explores paths of a fixed depth value; the
general light transport problem is then handled by running many
independent Markov chains.

</p>
<p>The practical consequence is that the Metropolis sampler will tend to spend
more computation on effective strategies that produce larger MIS-weighted
contributions to the image. Furthermore, the individual iterations are much
faster since they only involve a single connection strategy. The
combination of these two aspects improves the Monte Carlo efficiency of the
resulting estimator.

</p>
<p>
Figure&nbsp;<a href="#fig:mlt-vs-path-house">16.20</a> shows the contemporary house scene
rendered with bidirectional path tracing and MMLT, 
using roughly equal computation time
for each approach. 

</p>
<p></p>
<span class="anchor" id="fig:mlt-vs-path-house"></span><div class="card outerfigure"><div class="card-body figure"><p>







</p>

<div class="card-img-top" style="display:block; width: 100%; padding-top: 50.657%;  position:relative;">
<div id="Bidirectional_path_tracing71" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0;"></div></div>
<script>
Jeri.renderViewer(document.getElementById('Bidirectional_path_tracing71'), {
  title: 'Bidirectional_path_tracing71', children: [
 { title: 'Bidirectional path tracing', image: 'villa-bdpt.exr' },  { title: 'Multiplexed Metropolis light transport', image: 'villa-mlt.exr' }]});
</script>
<button data-toggle="tooltip" data-placement="left" class="btn yojeri" title="This image is interactive. Click and drag to pan and use the mouse-wheel to zoom. After clicking on the image to select it, type '?' to see a summary of keyboard controls."><i class="fa fa-snowflake fa-border"></i></button><p>

</p>
<figcaption class="caption">Figure 16.20: Comparison of Bidirectional Path Tracing and Multiplexed Metropolis
Light Transport. <span class="legend"> (1)&nbsp;Rendered with bidirectional path tracing with
128 samples per pixel. Even with many samples, the image is quite noisy.
(2)&nbsp;Rendered with Multiplexed Metropolis Light Transport with an average of
420 mutations per pixel (roughly equal running time). MLT generates a
substantially better image for the same amount of work.  BDPT does do
better in a few localized parts of the image: note the directly illuminated
surfaces outside the windows, for example. There, the ability to use
well-distributed sample points for the direct lighting calculation gives a
result with lower variance. <em>(Model courtesy of Florent Boyer.)</em></span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p>Figure&nbsp;<a href="#fig:mlt-vs-path-sanmiguel">16.21</a> compares path tracing, BDPT, and MMLT
with the San Miguel scene.  For both scenes, MMLT generates a better result, but
the difference is more pronounced with the house scene, which is 
particularly challenging for light transport algorithms in that there
is essentially no direct illumination inside the house; all light-carrying
paths must follow specular bounces through the glass windows.

</p>
<p>  </p>
<span class="anchor" id="fig:mlt-vs-path-sanmiguel"></span><div class="card outerfigure"><div class="card-body figure"><p>







</p>

<div class="card-img-top" style="display:block; width: 100%; padding-top: 68.354%;  position:relative;">
<div id="Path_tracing_200_samples_per_pixel72" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0;"></div></div>
<script>
Jeri.renderViewer(document.getElementById('Path_tracing_200_samples_per_pixel72'), {
  title: 'Path_tracing_(200_samples_per_pixel)72', children: [
 { title: 'Path tracing (200 samples per pixel)', image: 'sm-path.exr' },  { title: 'BDPT (128 samples per pixel)', image: 'sm-bdpt.exr' },  { title: 'Metropolis (950 mutations per pixel)', image: 'sm-mlt.exr' }]});
</script>
<button data-toggle="tooltip" data-placement="left" class="btn yojeri" title="This image is interactive. Click and drag to pan and use the mouse-wheel to zoom. After clicking on the image to select it, type '?' to see a summary of keyboard controls."><i class="fa fa-snowflake fa-border"></i></button><p>

</p>
<figcaption class="caption">Figure 16.21: Comparison of Path Tracing, BDPT, and Multiplexed Metropolis Light
Transport. <span class="legend"> (1)&nbsp;Path tracing with 200 samples per pixel.
(2)&nbsp;Bidirectional path tracing with 128 samples per pixel.  (3)&nbsp;Metropolis
Light Transport with an average of 950 mutations per pixel (roughly equal
running time).  BDPT is notably more effective than path tracing, and as
with Figure&nbsp;<a href="#fig:mlt-vs-path-house">16.20</a>, MLT is the most effective.
<em>(Model courtesy of Guillermo M. Leal Llaguno.)</em></span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p>Table&nbsp;<a href="#table:black-path-count">16.1</a> helps explain these efficiency
differences: for
both of these scenes, both path tracing and BDPT have a lot of trouble finding
paths that carry any radiance, while Metropolis is more effective at doing
so thanks to path reuse. 

</p>
<p> </p>
<span class="anchor" id="table:black-path-count"></span><div class="card outerfigure"><div class="card-body figure"><p>

</p>
<figcaption class="caption">Table 16.1: Percentage of Traced Paths That Carried Zero Radiance. <span class="legend">
With these two scenes, both path tracing and BDPT have trouble finding light-carrying
paths: the vast majority of the generated paths don&rsquo;t carry any
radiance at all.  Thanks to local exploration, Metropolis is better
able to find additional light-carrying paths after one has been found.
This is one of the reasons why it is more efficient than those approaches
here.
</span>
</figcaption><p>


<table class="table table-hover table-light table-sm"><thead><tr>
<th></th><th> Path tracing</th><th> BDPT</th><th> MMLT</th></tr>
</thead>
<tbody>
<tr>
<td> Modern House</td><td> 98.0%</td><td> 97.6%</td><td> 51.9%</td></tr>
<tr>
<td> San Miguel</td><td> 95.9%</td><td> 97.0%</td><td> 62.0%</td></tr>
</tbody></table>

</p>
</div></div><p>


</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#ApplicationtoRendering"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span id="ApplicationtoRendering"></span><h3>16.4.3  Application to Rendering</h3><p>


</p>
<p>Metropolis sampling generates samples from the distribution of a given scalar
function. To apply it to rendering, there are two issues that we must
address: first, we need to estimate a separate integral for each pixel to turn the
generated samples into an image, and, second, we need to handle the fact that
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.583ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 681.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper L</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43F" d="M643 247c0 0 0 -3 -4 -14l-79 -216c-6 -17 -7 -17 -31 -17h-463c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 12 20 19 20l133 -3l148 3c5 0 16 0 16 -12 c0 -19 -8 -19 -38 -19c-94 0 -97 -11 -106 -47l-135 -540c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h94c173 0 217 114 251 206c7 16 8 21 17 21s12 -7 12 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
</g>
</svg> is a spectrally valued function but Metropolis needs a scalar function
to compute the acceptance probability, Equation&nbsp;(<a href="../Monte_Carlo_Integration/Metropolis_Sampling.html#eq:accept">13.7</a>).

</p>
<p>We can apply the ideas from Section&nbsp;<a href="../Monte_Carlo_Integration/Metropolis_Sampling.html#sec:metro-integrate">13.4.5</a> to use Metropolis
samples to compute integrals.  First, we define the <em>image contribution
function</em> such that for an image with <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.987ex" height="2.509ex" style="vertical-align: -0.671ex; margin-left: -0.029ex;" viewBox="-12.5 -791.3 425 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">j</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D457" d="M397 625c0 -27 -27 -53 -54 -53c-23 0 -37 16 -37 36c0 30 30 53 53 53c24 0 38 -17 38 -36zM360 350c0 -3 0 -17 -5 -37l-92 -366c-25 -99 -118 -152 -188 -152c-48 0 -88 22 -88 62c0 36 29 57 54 57c27 0 38 -19 38 -35c0 -20 -15 -46 -45 -53c18 -9 33 -9 39 -9 c56 0 104 57 123 133l94 373c4 17 7 28 7 51c0 42 -18 46 -32 46c-55 0 -101 -61 -126 -122c-8 -19 -9 -20 -18 -20c0 0 -12 0 -12 10c0 9 57 154 159 154c50 0 92 -35 92 -92Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D457" x="0" y="0"></use>
</g>
</svg> pixels, each pixel <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.933ex" height="2.843ex" style="vertical-align: -1.005ex;" viewBox="0 -791.3 832.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper I Subscript j</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43C" d="M497 671c0 -19 -8 -19 -32 -19c-79 0 -82 -10 -91 -46l-134 -533c-2 -7 -4 -15 -4 -23c0 -11 4 -15 25 -17c20 -2 25 -2 43 -2c22 0 30 0 30 -12c0 -19 -12 -19 -20 -19l-134 3l-131 -3c-3 0 -15 0 -15 11c0 20 9 20 32 20c79 0 82 10 91 47l135 539c2 9 2 11 2 16 c0 19 -27 19 -69 19c-19 0 -28 0 -28 11c0 20 13 20 20 20l133 -3l132 3c4 0 15 0 15 -12Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D457" d="M397 625c0 -27 -27 -53 -54 -53c-23 0 -37 16 -37 36c0 30 30 53 53 53c24 0 38 -17 38 -36zM360 350c0 -3 0 -17 -5 -37l-92 -366c-25 -99 -118 -152 -188 -152c-48 0 -88 22 -88 62c0 36 29 57 54 57c27 0 38 -19 38 -35c0 -20 -15 -46 -45 -53c18 -9 33 -9 39 -9 c56 0 104 57 123 133l94 373c4 17 7 28 7 51c0 42 -18 46 -32 46c-55 0 -101 -61 -126 -122c-8 -19 -9 -20 -18 -20c0 0 -12 0 -12 10c0 9 57 154 159 154c50 0 92 -35 92 -92Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43C" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D457" x="622" y="-213"></use>
</g>
</svg> has a value
that is the integral of the product of the pixel&rsquo;s image reconstruction filter
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.249ex" height="2.843ex" style="vertical-align: -1.005ex;" viewBox="0 -791.3 968.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">h Subscript j</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-210E" d="M546 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 20 5 32 13 55c24 61 62 170 62 224c0 36 -11 70 -54 70s-74 -19 -96 -35c-34 -27 -65 -83 -68 -92c-1 -6 -9 -39 -11 -45c-5 -23 -11 -45 -17 -67l-22 -90l-19 -76c-5 -14 -21 -26 -37 -26c-9 0 -29 5 -29 28 c0 6 0 8 4 22l145 576l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-78 -318c37 46 85 77 148 77c75 0 115 -42 115 -107c0 -58 -45 -177 -61 -220c-9 -22 -18 -46 -18 -71c0 -23 7 -33 24 -33c55 0 87 71 102 124 c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D457" d="M397 625c0 -27 -27 -53 -54 -53c-23 0 -37 16 -37 36c0 30 30 53 53 53c24 0 38 -17 38 -36zM360 350c0 -3 0 -17 -5 -37l-92 -366c-25 -99 -118 -152 -188 -152c-48 0 -88 22 -88 62c0 36 29 57 54 57c27 0 38 -19 38 -35c0 -20 -15 -46 -45 -53c18 -9 33 -9 39 -9 c56 0 104 57 123 133l94 373c4 17 7 28 7 51c0 42 -18 46 -32 46c-55 0 -101 -61 -126 -122c-8 -19 -9 -20 -18 -20c0 0 -12 0 -12 10c0 9 57 154 159 154c50 0 92 -35 92 -92Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-210E" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D457" x="815" y="-213"></use>
</g>
</svg> and the radiance <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.583ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 681.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper L</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43F" d="M643 247c0 0 0 -3 -4 -14l-79 -216c-6 -17 -7 -17 -31 -17h-463c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 12 20 19 20l133 -3l148 3c5 0 16 0 16 -12 c0 -19 -8 -19 -38 -19c-94 0 -97 -11 -106 -47l-135 -540c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h94c173 0 217 114 251 206c7 16 8 21 17 21s12 -7 12 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
</g>
</svg> that contributes to the image:
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="24.052ex" height="5.676ex" style="vertical-align: -2.338ex;" viewBox="0 -1437.2 10355.8 2443.8" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper I Subscript j Baseline equals integral Underscript normal upper Omega Endscripts h Subscript j Baseline left-parenthesis bold upper X right-parenthesis upper L left-parenthesis bold upper X right-parenthesis normal d normal upper Omega period</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43C" d="M497 671c0 -19 -8 -19 -32 -19c-79 0 -82 -10 -91 -46l-134 -533c-2 -7 -4 -15 -4 -23c0 -11 4 -15 25 -17c20 -2 25 -2 43 -2c22 0 30 0 30 -12c0 -19 -12 -19 -20 -19l-134 3l-131 -3c-3 0 -15 0 -15 11c0 20 9 20 32 20c79 0 82 10 91 47l135 539c2 9 2 11 2 16 c0 19 -27 19 -69 19c-19 0 -28 0 -28 11c0 20 13 20 20 20l133 -3l132 3c4 0 15 0 15 -12Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D457" d="M397 625c0 -27 -27 -53 -54 -53c-23 0 -37 16 -37 36c0 30 30 53 53 53c24 0 38 -17 38 -36zM360 350c0 -3 0 -17 -5 -37l-92 -366c-25 -99 -118 -152 -188 -152c-48 0 -88 22 -88 62c0 36 29 57 54 57c27 0 38 -19 38 -35c0 -20 -15 -46 -45 -53c18 -9 33 -9 39 -9 c56 0 104 57 123 133l94 373c4 17 7 28 7 51c0 42 -18 46 -32 46c-55 0 -101 -61 -126 -122c-8 -19 -9 -20 -18 -20c0 0 -12 0 -12 10c0 9 57 154 159 154c50 0 92 -35 92 -92Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNSIZE1-222B" d="M943 1268c0 -35 -25 -50 -49 -50c-23 0 -48 16 -48 49c0 25 17 47 50 49c-4 4 -29 23 -60 23c-39 0 -73 -129 -85 -178c-34 -129 -71 -329 -108 -542c-54 -321 -119 -640 -196 -956c-71 -290 -128 -524 -280 -524c-61 0 -111 42 -111 93c0 35 25 50 49 50 c23 0 48 -16 48 -49c0 -25 -17 -47 -49 -49c0 0 25 -23 61 -23c81 0 127 188 145 261c33 139 62 306 88 459c110 654 246 1156 249 1167c55 204 111 313 187 313c55 0 109 -39 109 -93Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3A9" d="M677 162l-33 -162h-159c-23 0 -26 0 -26 21c0 69 32 159 47 201c29 82 56 158 56 233c0 156 -106 228 -202 228c-91 0 -201 -68 -201 -228c0 -75 28 -154 49 -212c23 -64 54 -152 54 -222c0 -21 -3 -21 -25 -21h-160l-33 162h25c5 -25 10 -51 18 -74c5 -15 8 -23 66 -23 h80c-13 56 -45 104 -89 170c-47 71 -88 140 -88 219c0 137 133 251 305 251c169 0 304 -112 304 -251c0 -79 -41 -148 -88 -219c-45 -66 -76 -114 -89 -170h80c58 0 61 8 66 24c9 24 13 47 18 73h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-210E" d="M546 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 20 5 32 13 55c24 61 62 170 62 224c0 36 -11 70 -54 70s-74 -19 -96 -35c-34 -27 -65 -83 -68 -92c-1 -6 -9 -39 -11 -45c-5 -23 -11 -45 -17 -67l-22 -90l-19 -76c-5 -14 -21 -26 -37 -26c-9 0 -29 5 -29 28 c0 6 0 8 4 22l145 576l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-78 -318c37 46 85 77 148 77c75 0 115 -42 115 -107c0 -58 -45 -177 -61 -220c-9 -22 -18 -46 -18 -71c0 -23 7 -33 24 -33c55 0 87 71 102 124 c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43F" d="M643 247c0 0 0 -3 -4 -14l-79 -216c-6 -17 -7 -17 -31 -17h-463c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 12 20 19 20l133 -3l148 3c5 0 16 0 16 -12 c0 -19 -8 -19 -38 -19c-94 0 -97 -11 -106 -47l-135 -540c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h94c173 0 217 114 251 206c7 16 8 21 17 21s12 -7 12 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-64" d="M527 0l-147 -11v66c-25 -32 -70 -66 -134 -66c-114 0 -212 99 -212 226c0 129 105 227 223 227c54 0 97 -26 126 -62v216c0 49 -8 56 -78 56v31l144 11v-607c0 -49 8 -56 78 -56v-31zM380 118v205c0 18 0 20 -11 37c-31 45 -73 60 -108 60c-54 0 -92 -33 -113 -64 c-29 -45 -31 -105 -31 -142c0 -41 3 -98 29 -139c24 -38 60 -64 105 -64c43 0 88 22 118 70c11 17 11 19 11 37Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43C" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D457" x="622" y="-213"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="1109" y="0"></use>
<g transform="translate(2166,0)">
 <use xlink:href="#E1-LATINMODERNSIZE1-222B" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-3A9" x="812" y="-1270"></use>
</g>
<g transform="translate(3518,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-210E" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D457" x="815" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="4486" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="4875" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="5745" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="6301" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="6983" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="7372" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="8242" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-64" x="8798" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3A9" x="9354" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="10077" y="0"></use>
</g>
</svg>
</div>
<p>

The filter function <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.249ex" height="2.843ex" style="vertical-align: -1.005ex;" viewBox="0 -791.3 968.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">h Subscript j</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-210E" d="M546 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 20 5 32 13 55c24 61 62 170 62 224c0 36 -11 70 -54 70s-74 -19 -96 -35c-34 -27 -65 -83 -68 -92c-1 -6 -9 -39 -11 -45c-5 -23 -11 -45 -17 -67l-22 -90l-19 -76c-5 -14 -21 -26 -37 -26c-9 0 -29 5 -29 28 c0 6 0 8 4 22l145 576l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-78 -318c37 46 85 77 148 77c75 0 115 -42 115 -107c0 -58 -45 -177 -61 -220c-9 -22 -18 -46 -18 -71c0 -23 7 -33 24 -33c55 0 87 71 102 124 c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D457" d="M397 625c0 -27 -27 -53 -54 -53c-23 0 -37 16 -37 36c0 30 30 53 53 53c24 0 38 -17 38 -36zM360 350c0 -3 0 -17 -5 -37l-92 -366c-25 -99 -118 -152 -188 -152c-48 0 -88 22 -88 62c0 36 29 57 54 57c27 0 38 -19 38 -35c0 -20 -15 -46 -45 -53c18 -9 33 -9 39 -9 c56 0 104 57 123 133l94 373c4 17 7 28 7 51c0 42 -18 46 -32 46c-55 0 -101 -61 -126 -122c-8 -19 -9 -20 -18 -20c0 0 -12 0 -12 10c0 9 57 154 159 154c50 0 92 -35 92 -92Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-210E" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D457" x="815" y="-213"></use>
</g>
</svg> only depends on the two components of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.019ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 869.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
</g>
</svg>
associated with the raster position.  The value of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.249ex" height="2.843ex" style="vertical-align: -1.005ex;" viewBox="0 -791.3 968.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">h Subscript j</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-210E" d="M546 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 20 5 32 13 55c24 61 62 170 62 224c0 36 -11 70 -54 70s-74 -19 -96 -35c-34 -27 -65 -83 -68 -92c-1 -6 -9 -39 -11 -45c-5 -23 -11 -45 -17 -67l-22 -90l-19 -76c-5 -14 -21 -26 -37 -26c-9 0 -29 5 -29 28 c0 6 0 8 4 22l145 576l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-78 -318c37 46 85 77 148 77c75 0 115 -42 115 -107c0 -58 -45 -177 -61 -220c-9 -22 -18 -46 -18 -71c0 -23 7 -33 24 -33c55 0 87 71 102 124 c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D457" d="M397 625c0 -27 -27 -53 -54 -53c-23 0 -37 16 -37 36c0 30 30 53 53 53c24 0 38 -17 38 -36zM360 350c0 -3 0 -17 -5 -37l-92 -366c-25 -99 -118 -152 -188 -152c-48 0 -88 22 -88 62c0 36 29 57 54 57c27 0 38 -19 38 -35c0 -20 -15 -46 -45 -53c18 -9 33 -9 39 -9 c56 0 104 57 123 133l94 373c4 17 7 28 7 51c0 42 -18 46 -32 46c-55 0 -101 -61 -126 -122c-8 -19 -9 -20 -18 -20c0 0 -12 0 -12 10c0 9 57 154 159 154c50 0 92 -35 92 -92Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-210E" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D457" x="815" y="-213"></use>
</g>
</svg> for any particular
pixel is usually&nbsp;0 for the vast majority of samples <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.019ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 869.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
</g>
</svg> due to the
filter&rsquo;s finite extent.

</p>
<p>

</p>
<p>If <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.047ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 881.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper N</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D441" d="M881 672c0 -19 -12 -20 -17 -20c-80 -3 -98 -34 -108 -74l-140 -557c-5 -18 -5 -21 -16 -21c-9 0 -12 2 -19 19l-249 589c-5 10 -5 12 -9 18l-132 -528c-3 -11 -4 -16 -4 -23c0 -20 8 -42 66 -44c11 0 20 -1 20 -11c0 -20 -13 -20 -18 -20c-33 0 -69 3 -103 3 c-33 0 -68 -3 -100 -3c-8 0 -13 4 -13 11c0 19 11 20 17 20c81 3 98 35 108 75l134 537c0 9 -63 9 -68 9c-19 0 -28 0 -28 11c0 20 9 20 29 20h134c23 0 24 -1 32 -19l221 -522l112 445c1 3 3 18 3 21c0 22 -11 43 -68 44c-8 0 -18 0 -18 11c0 20 12 20 18 20 c33 0 68 -3 102 -3c33 0 68 3 101 3c13 0 13 -11 13 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D441" x="0" y="0"></use>
</g>
</svg> samples <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.819ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 1213.8 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X Subscript i</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1229" y="-213"></use>
</g>
</svg> are generated from some distribution, <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.904ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 4694.9 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X Subscript i Baseline tilde p left-parenthesis bold upper X right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-223C" d="M717 354c-4 -116 -34 -183 -119 -211c-15 -4 -30 -7 -45 -7c-66 0 -130 46 -184 95c-44 39 -93 81 -146 81c-10 0 -21 -1 -31 -5c-70 -23 -109 -67 -112 -161c0 -7 -6 -12 -12 -12c-7 0 -12 5 -12 12c4 116 34 183 120 211c14 4 29 7 44 7c66 0 130 -46 184 -95 c44 -39 93 -81 146 -81c11 0 21 1 32 5c69 23 108 67 111 161c0 7 6 12 12 12c7 0 12 -5 12 -12Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45D" d="M490 282c0 -147 -125 -293 -241 -293c-51 0 -79 35 -92 64c-7 -25 -49 -188 -49 -200c0 -9 0 -16 50 -16c14 0 24 0 24 -11c0 -20 -13 -20 -18 -20c-32 0 -66 3 -99 3c-28 0 -57 -3 -84 -3c-8 0 -13 4 -13 12c0 19 11 19 23 19c44 0 46 7 54 41l112 445c4 17 7 28 7 51 c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c37 0 80 -21 90 -75c33 39 81 75 131 75c76 0 133 -66 133 -160zM418 326c0 59 -24 94 -64 94c-17 0 -46 -7 -81 -38c-18 -15 -45 -43 -52 -70 l-49 -196c-3 -12 -3 -16 -3 -16c0 -6 13 -89 79 -89c37 0 85 33 119 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1229" y="-213"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-223C" x="1491" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45D" x="2542" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="3046" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="3435" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="4305" y="0"></use>
</g>
</svg>, then the standard Monte Carlo estimate of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.933ex" height="2.843ex" style="vertical-align: -1.005ex;" viewBox="0 -791.3 832.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper I Subscript j</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43C" d="M497 671c0 -19 -8 -19 -32 -19c-79 0 -82 -10 -91 -46l-134 -533c-2 -7 -4 -15 -4 -23c0 -11 4 -15 25 -17c20 -2 25 -2 43 -2c22 0 30 0 30 -12c0 -19 -12 -19 -20 -19l-134 3l-131 -3c-3 0 -15 0 -15 11c0 20 9 20 32 20c79 0 82 10 91 47l135 539c2 9 2 11 2 16 c0 19 -27 19 -69 19c-19 0 -28 0 -28 11c0 20 13 20 20 20l133 -3l132 3c4 0 15 0 15 -12Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D457" d="M397 625c0 -27 -27 -53 -54 -53c-23 0 -37 16 -37 36c0 30 30 53 53 53c24 0 38 -17 38 -36zM360 350c0 -3 0 -17 -5 -37l-92 -366c-25 -99 -118 -152 -188 -152c-48 0 -88 22 -88 62c0 36 29 57 54 57c27 0 38 -19 38 -35c0 -20 -15 -46 -45 -53c18 -9 33 -9 39 -9 c56 0 104 57 123 133l94 373c4 17 7 28 7 51c0 42 -18 46 -32 46c-55 0 -101 -61 -126 -122c-8 -19 -9 -20 -18 -20c0 0 -12 0 -12 10c0 9 57 154 159 154c50 0 92 -35 92 -92Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43C" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D457" x="622" y="-213"></use>
</g>
</svg> is
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="26.991ex" height="7.343ex" style="vertical-align: -3.005ex;" viewBox="0 -1867.7 11621 3161.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper I Subscript j Baseline almost-equals StartFraction 1 Over upper N EndFraction sigma-summation Underscript i equals 1 Overscript upper N Endscripts StartFraction h Subscript j Baseline left-parenthesis bold upper X Subscript i Baseline right-parenthesis upper L left-parenthesis bold upper X Subscript i Baseline right-parenthesis Over p left-parenthesis bold upper X Subscript i Baseline right-parenthesis EndFraction period</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43C" d="M497 671c0 -19 -8 -19 -32 -19c-79 0 -82 -10 -91 -46l-134 -533c-2 -7 -4 -15 -4 -23c0 -11 4 -15 25 -17c20 -2 25 -2 43 -2c22 0 30 0 30 -12c0 -19 -12 -19 -20 -19l-134 3l-131 -3c-3 0 -15 0 -15 11c0 20 9 20 32 20c79 0 82 10 91 47l135 539c2 9 2 11 2 16 c0 19 -27 19 -69 19c-19 0 -28 0 -28 11c0 20 13 20 20 20l133 -3l132 3c4 0 15 0 15 -12Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D457" d="M397 625c0 -27 -27 -53 -54 -53c-23 0 -37 16 -37 36c0 30 30 53 53 53c24 0 38 -17 38 -36zM360 350c0 -3 0 -17 -5 -37l-92 -366c-25 -99 -118 -152 -188 -152c-48 0 -88 22 -88 62c0 36 29 57 54 57c27 0 38 -19 38 -35c0 -20 -15 -46 -45 -53c18 -9 33 -9 39 -9 c56 0 104 57 123 133l94 373c4 17 7 28 7 51c0 42 -18 46 -32 46c-55 0 -101 -61 -126 -122c-8 -19 -9 -20 -18 -20c0 0 -12 0 -12 10c0 9 57 154 159 154c50 0 92 -35 92 -92Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2248" d="M717 438v-2c-20 -93 -56 -149 -139 -169c-11 -3 -23 -4 -35 -4c-62 0 -120 37 -172 76c-43 32 -89 67 -138 67c-9 0 -17 -1 -26 -3c-67 -17 -111 -49 -127 -124c-1 -5 -6 -9 -12 -9c-7 0 -12 5 -12 12v2c20 93 56 149 139 169c12 3 24 4 35 4c62 0 120 -37 172 -76 c43 -32 89 -67 139 -67c8 0 16 1 25 3c67 17 111 49 127 124c2 5 6 9 12 9c7 0 12 -5 12 -12zM717 218v-2c-20 -93 -56 -149 -139 -169c-11 -3 -23 -4 -35 -4c-62 0 -120 37 -172 76c-43 32 -89 67 -138 67c-9 0 -17 -1 -26 -3c-67 -17 -111 -49 -127 -124 c-1 -5 -6 -9 -12 -9c-7 0 -12 5 -12 12v2c20 93 56 149 139 169c12 3 24 4 35 4c62 0 120 -37 172 -76c43 -32 89 -67 139 -67c8 0 16 1 25 3c67 17 111 49 127 124c2 5 6 9 12 9c7 0 12 -5 12 -12Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D441" d="M881 672c0 -19 -12 -20 -17 -20c-80 -3 -98 -34 -108 -74l-140 -557c-5 -18 -5 -21 -16 -21c-9 0 -12 2 -19 19l-249 589c-5 10 -5 12 -9 18l-132 -528c-3 -11 -4 -16 -4 -23c0 -20 8 -42 66 -44c11 0 20 -1 20 -11c0 -20 -13 -20 -18 -20c-33 0 -69 3 -103 3 c-33 0 -68 -3 -100 -3c-8 0 -13 4 -13 11c0 19 11 20 17 20c81 3 98 35 108 75l134 537c0 9 -63 9 -68 9c-19 0 -28 0 -28 11c0 20 9 20 29 20h134c23 0 24 -1 32 -19l221 -522l112 445c1 3 3 18 3 21c0 22 -11 43 -68 44c-8 0 -18 0 -18 11c0 20 12 20 18 20 c33 0 68 -3 102 -3c33 0 68 3 101 3c13 0 13 -11 13 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNSIZE1-2211" d="M1387 -130l-121 -320h-1182c-18 0 -27 0 -27 11c0 0 0 6 10 18l518 607l-529 724c0 11 0 30 1 33c3 6 4 7 27 7h1182l121 -281h-25c-34 81 -102 126 -127 142c-79 50 -166 67 -220 75c-9 2 -100 16 -234 16h-548l466 -637c7 -10 7 -15 7 -15c0 -5 -2 -8 -9 -16l-509 -597 h603c192 0 290 26 311 31c115 30 221 98 260 202h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-210E" d="M546 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 20 5 32 13 55c24 61 62 170 62 224c0 36 -11 70 -54 70s-74 -19 -96 -35c-34 -27 -65 -83 -68 -92c-1 -6 -9 -39 -11 -45c-5 -23 -11 -45 -17 -67l-22 -90l-19 -76c-5 -14 -21 -26 -37 -26c-9 0 -29 5 -29 28 c0 6 0 8 4 22l145 576l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-78 -318c37 46 85 77 148 77c75 0 115 -42 115 -107c0 -58 -45 -177 -61 -220c-9 -22 -18 -46 -18 -71c0 -23 7 -33 24 -33c55 0 87 71 102 124 c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43F" d="M643 247c0 0 0 -3 -4 -14l-79 -216c-6 -17 -7 -17 -31 -17h-463c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 12 20 19 20l133 -3l148 3c5 0 16 0 16 -12 c0 -19 -8 -19 -38 -19c-94 0 -97 -11 -106 -47l-135 -540c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h94c173 0 217 114 251 206c7 16 8 21 17 21s12 -7 12 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45D" d="M490 282c0 -147 -125 -293 -241 -293c-51 0 -79 35 -92 64c-7 -25 -49 -188 -49 -200c0 -9 0 -16 50 -16c14 0 24 0 24 -11c0 -20 -13 -20 -18 -20c-32 0 -66 3 -99 3c-28 0 -57 -3 -84 -3c-8 0 -13 4 -13 12c0 19 11 19 23 19c44 0 46 7 54 41l112 445c4 17 7 28 7 51 c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c37 0 80 -21 90 -75c33 39 81 75 131 75c76 0 133 -66 133 -160zM418 326c0 59 -24 94 -64 94c-17 0 -46 -7 -81 -38c-18 -15 -45 -43 -52 -70 l-49 -196c-3 -12 -3 -16 -3 -16c0 -6 13 -89 79 -89c37 0 85 33 119 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43C" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D457" x="622" y="-213"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2248" x="1109" y="0"></use>
<g transform="translate(1883,0)">
<g transform="translate(397,0)">
<rect stroke="none" width="1001" height="60" x="0" y="220"></rect>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="250" y="676"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D441" x="60" y="-704"></use>
</g>
</g>
<g transform="translate(3569,0)">
 <use xlink:href="#E1-LATINMODERNSIZE1-2211" x="0" y="0"></use>
<g transform="translate(147,-1090)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-3D" x="345" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="1124" y="0"></use>
</g>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D441" x="580" y="1627"></use>
</g>
<g transform="translate(5013,0)">
<g transform="translate(286,0)">
<rect stroke="none" width="5921" height="60" x="0" y="220"></rect>
<g transform="translate(60,815)">
 <use xlink:href="#E1-LATINMODERNNORMAL-210E" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D457" x="815" y="-213"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="968" y="0"></use>
<g transform="translate(1357,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1229" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2571" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="3127" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="3809" y="0"></use>
<g transform="translate(4198,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1229" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="5412" y="0"></use>
</g>
<g transform="translate(1712,-769)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45D" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="503" y="0"></use>
<g transform="translate(893,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1229" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2106" y="0"></use>
</g>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="11342" y="0"></use>
</g>
</svg>
</div>
<p>
 

</p>
<p>Recall that Metropolis sampling requires a scalar function that defines the
desired distribution of samples generated by the algorithm. Unfortunately, <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.583ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 681.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper L</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43F" d="M643 247c0 0 0 -3 -4 -14l-79 -216c-6 -17 -7 -17 -31 -17h-463c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 12 20 19 20l133 -3l148 3c5 0 16 0 16 -12 c0 -19 -8 -19 -38 -19c-94 0 -97 -11 -106 -47l-135 -540c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h94c173 0 217 114 251 206c7 16 8 21 17 21s12 -7 12 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
</g>
</svg>
is a spectrally valued function, and thus there is no unambiguous notion of
what it means to generate samples proportional to <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.583ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 681.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper L</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43F" d="M643 247c0 0 0 -3 -4 -14l-79 -216c-6 -17 -7 -17 -31 -17h-463c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 12 20 19 20l133 -3l148 3c5 0 16 0 16 -12 c0 -19 -8 -19 -38 -19c-94 0 -97 -11 -106 -47l-135 -540c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h94c173 0 217 114 251 206c7 16 8 21 17 21s12 -7 12 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
</g>
</svg>. To work around this
issue, we will define a <em>scalar contribution function</em> <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.984ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2146 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper I left-parenthesis bold upper X right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43C" d="M497 671c0 -19 -8 -19 -32 -19c-79 0 -82 -10 -91 -46l-134 -533c-2 -7 -4 -15 -4 -23c0 -11 4 -15 25 -17c20 -2 25 -2 43 -2c22 0 30 0 30 -12c0 -19 -12 -19 -20 -19l-134 3l-131 -3c-3 0 -15 0 -15 11c0 20 9 20 32 20c79 0 82 10 91 47l135 539c2 9 2 11 2 16 c0 19 -27 19 -69 19c-19 0 -28 0 -28 11c0 20 13 20 20 20l133 -3l132 3c4 0 15 0 15 -12Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43C" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="497" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="887" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1756" y="0"></use>
</g>
</svg> that
is used inside the Metropolis iteration. It is desirable that this function be
large when <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.583ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 681.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper L</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43F" d="M643 247c0 0 0 -3 -4 -14l-79 -216c-6 -17 -7 -17 -31 -17h-463c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 12 20 19 20l133 -3l148 3c5 0 16 0 16 -12 c0 -19 -8 -19 -38 -19c-94 0 -97 -11 -106 -47l-135 -540c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h94c173 0 217 114 251 206c7 16 8 21 17 21s12 -7 12 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
</g>
</svg> is large so that the distribution of samples has some
relationship to the important regions of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.583ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 681.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper L</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43F" d="M643 247c0 0 0 -3 -4 -14l-79 -216c-6 -17 -7 -17 -31 -17h-463c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 12 20 19 20l133 -3l148 3c5 0 16 0 16 -12 c0 -19 -8 -19 -38 -19c-94 0 -97 -11 -106 -47l-135 -540c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h94c173 0 217 114 251 206c7 16 8 21 17 21s12 -7 12 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
</g>
</svg>. As such, using the luminance of
the radiance value is a good choice for the scalar contribution function.  In
general, any function that is nonzero when <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.583ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 681.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper L</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43F" d="M643 247c0 0 0 -3 -4 -14l-79 -216c-6 -17 -7 -17 -31 -17h-463c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 12 20 19 20l133 -3l148 3c5 0 16 0 16 -12 c0 -19 -8 -19 -38 -19c-94 0 -97 -11 -106 -47l-135 -540c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h94c173 0 217 114 251 206c7 16 8 21 17 21s12 -7 12 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
</g>
</svg> is nonzero will generate correct
results, just possibly not as efficiently as a function that is more directly
proportional to <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.583ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 681.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper L</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43F" d="M643 247c0 0 0 -3 -4 -14l-79 -216c-6 -17 -7 -17 -31 -17h-463c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 12 20 19 20l133 -3l148 3c5 0 16 0 16 -12 c0 -19 -8 -19 -38 -19c-94 0 -97 -11 -106 -47l-135 -540c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h94c173 0 217 114 251 206c7 16 8 21 17 21s12 -7 12 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
</g>
</svg>.

</p>
<p>Given a suitable scalar contribution function, <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.984ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2146 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper I left-parenthesis bold upper X right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43C" d="M497 671c0 -19 -8 -19 -32 -19c-79 0 -82 -10 -91 -46l-134 -533c-2 -7 -4 -15 -4 -23c0 -11 4 -15 25 -17c20 -2 25 -2 43 -2c22 0 30 0 30 -12c0 -19 -12 -19 -20 -19l-134 3l-131 -3c-3 0 -15 0 -15 11c0 20 9 20 32 20c79 0 82 10 91 47l135 539c2 9 2 11 2 16 c0 19 -27 19 -69 19c-19 0 -28 0 -28 11c0 20 13 20 20 20l133 -3l132 3c4 0 15 0 15 -12Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43C" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="497" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="887" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1756" y="0"></use>
</g>
</svg>, Metropolis
generates a sequence of samples <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.819ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 1213.8 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X Subscript i</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1229" y="-213"></use>
</g>
</svg> from <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.155ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 497.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper I</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43C" d="M497 671c0 -19 -8 -19 -32 -19c-79 0 -82 -10 -91 -46l-134 -533c-2 -7 -4 -15 -4 -23c0 -11 4 -15 25 -17c20 -2 25 -2 43 -2c22 0 30 0 30 -12c0 -19 -12 -19 -20 -19l-134 3l-131 -3c-3 0 -15 0 -15 11c0 20 9 20 32 20c79 0 82 10 91 47l135 539c2 9 2 11 2 16 c0 19 -27 19 -69 19c-19 0 -28 0 -28 11c0 20 13 20 20 20l133 -3l132 3c4 0 15 0 15 -12Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43C" x="0" y="0"></use>
</g>
</svg>&rsquo;s distribution, the
normalized version of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.155ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 497.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper I</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43C" d="M497 671c0 -19 -8 -19 -32 -19c-79 0 -82 -10 -91 -46l-134 -533c-2 -7 -4 -15 -4 -23c0 -11 4 -15 25 -17c20 -2 25 -2 43 -2c22 0 30 0 30 -12c0 -19 -12 -19 -20 -19l-134 3l-131 -3c-3 0 -15 0 -15 11c0 20 9 20 32 20c79 0 82 10 91 47l135 539c2 9 2 11 2 16 c0 19 -27 19 -69 19c-19 0 -28 0 -28 11c0 20 13 20 20 20l133 -3l132 3c4 0 15 0 15 -12Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43C" x="0" y="0"></use>
</g>
</svg>:
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="21.346ex" height="6.843ex" style="vertical-align: -3.005ex; margin-left: -0.073ex;" viewBox="-31.5 -1652.5 9190.8 2946.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">p left-parenthesis bold upper X right-parenthesis equals StartFraction upper I left-parenthesis bold upper X right-parenthesis Over integral Underscript normal upper Omega Endscripts upper I left-parenthesis bold upper X right-parenthesis normal d normal upper Omega EndFraction comma</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45D" d="M490 282c0 -147 -125 -293 -241 -293c-51 0 -79 35 -92 64c-7 -25 -49 -188 -49 -200c0 -9 0 -16 50 -16c14 0 24 0 24 -11c0 -20 -13 -20 -18 -20c-32 0 -66 3 -99 3c-28 0 -57 -3 -84 -3c-8 0 -13 4 -13 12c0 19 11 19 23 19c44 0 46 7 54 41l112 445c4 17 7 28 7 51 c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c37 0 80 -21 90 -75c33 39 81 75 131 75c76 0 133 -66 133 -160zM418 326c0 59 -24 94 -64 94c-17 0 -46 -7 -81 -38c-18 -15 -45 -43 -52 -70 l-49 -196c-3 -12 -3 -16 -3 -16c0 -6 13 -89 79 -89c37 0 85 33 119 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43C" d="M497 671c0 -19 -8 -19 -32 -19c-79 0 -82 -10 -91 -46l-134 -533c-2 -7 -4 -15 -4 -23c0 -11 4 -15 25 -17c20 -2 25 -2 43 -2c22 0 30 0 30 -12c0 -19 -12 -19 -20 -19l-134 3l-131 -3c-3 0 -15 0 -15 11c0 20 9 20 32 20c79 0 82 10 91 47l135 539c2 9 2 11 2 16 c0 19 -27 19 -69 19c-19 0 -28 0 -28 11c0 20 13 20 20 20l133 -3l132 3c4 0 15 0 15 -12Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-222B" d="M609 722c0 -30 -22 -43 -42 -43c-19 0 -41 13 -41 42c0 14 8 37 37 41c-22 19 -53 21 -63 21c-45 0 -79 -25 -93 -209l-19 -249c-8 -111 -44 -402 -57 -454c-22 -90 -70 -177 -165 -177c-60 0 -110 35 -110 83c0 30 22 43 42 43c19 0 41 -13 41 -42c0 -14 -8 -37 -37 -41 c21 -18 51 -21 64 -21c57 0 93 45 106 209l19 249c9 121 45 403 57 458c17 76 56 173 151 173c60 0 110 -35 110 -83Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3A9" d="M677 162l-33 -162h-159c-23 0 -26 0 -26 21c0 69 32 159 47 201c29 82 56 158 56 233c0 156 -106 228 -202 228c-91 0 -201 -68 -201 -228c0 -75 28 -154 49 -212c23 -64 54 -152 54 -222c0 -21 -3 -21 -25 -21h-160l-33 162h25c5 -25 10 -51 18 -74c5 -15 8 -23 66 -23 h80c-13 56 -45 104 -89 170c-47 71 -88 140 -88 219c0 137 133 251 305 251c169 0 304 -112 304 -251c0 -79 -41 -148 -88 -219c-45 -66 -76 -114 -89 -170h80c58 0 61 8 66 24c9 24 13 47 18 73h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-64" d="M527 0l-147 -11v66c-25 -32 -70 -66 -134 -66c-114 0 -212 99 -212 226c0 129 105 227 223 227c54 0 97 -26 126 -62v216c0 49 -8 56 -78 56v31l144 11v-607c0 -49 8 -56 78 -56v-31zM380 118v205c0 18 0 20 -11 37c-31 45 -73 60 -108 60c-54 0 -92 -33 -113 -64 c-29 -45 -31 -105 -31 -142c0 -41 3 -98 29 -139c24 -38 60 -64 105 -64c43 0 88 22 118 70c11 17 11 19 11 37Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45D" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="503" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="893" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1762" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="2429" y="0"></use>
<g transform="translate(3208,0)">
<g transform="translate(397,0)">
<rect stroke="none" width="5154" height="60" x="0" y="220"></rect>
<g transform="translate(1504,768)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43C" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="497" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="887" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1756" y="0"></use>
</g>
<g transform="translate(60,-826)">
 <use xlink:href="#E1-LATINMODERNMAIN-222B" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-3A9" x="941" y="-484"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43C" x="1443" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1940" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="2330" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="3199" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-64" x="3755" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3A9" x="4312" y="0"></use>
</g>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="8880" y="0"></use>
</g>
</svg>
</div>
<p>

and the pixel values can thus be computed as
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="41.942ex" height="7.343ex" style="vertical-align: -3.005ex;" viewBox="0 -1867.7 18058.4 3161.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper I Subscript j Baseline almost-equals StartFraction 1 Over upper N EndFraction sigma-summation Underscript i equals 1 Overscript upper N Endscripts StartFraction h Subscript j Baseline left-parenthesis bold upper X Subscript i Baseline right-parenthesis upper L left-parenthesis bold upper X Subscript i Baseline right-parenthesis Over upper I left-parenthesis bold upper X Subscript i Baseline right-parenthesis EndFraction left-parenthesis integral Underscript normal upper Omega Endscripts upper I left-parenthesis bold upper X right-parenthesis normal d normal upper Omega right-parenthesis period</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43C" d="M497 671c0 -19 -8 -19 -32 -19c-79 0 -82 -10 -91 -46l-134 -533c-2 -7 -4 -15 -4 -23c0 -11 4 -15 25 -17c20 -2 25 -2 43 -2c22 0 30 0 30 -12c0 -19 -12 -19 -20 -19l-134 3l-131 -3c-3 0 -15 0 -15 11c0 20 9 20 32 20c79 0 82 10 91 47l135 539c2 9 2 11 2 16 c0 19 -27 19 -69 19c-19 0 -28 0 -28 11c0 20 13 20 20 20l133 -3l132 3c4 0 15 0 15 -12Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D457" d="M397 625c0 -27 -27 -53 -54 -53c-23 0 -37 16 -37 36c0 30 30 53 53 53c24 0 38 -17 38 -36zM360 350c0 -3 0 -17 -5 -37l-92 -366c-25 -99 -118 -152 -188 -152c-48 0 -88 22 -88 62c0 36 29 57 54 57c27 0 38 -19 38 -35c0 -20 -15 -46 -45 -53c18 -9 33 -9 39 -9 c56 0 104 57 123 133l94 373c4 17 7 28 7 51c0 42 -18 46 -32 46c-55 0 -101 -61 -126 -122c-8 -19 -9 -20 -18 -20c0 0 -12 0 -12 10c0 9 57 154 159 154c50 0 92 -35 92 -92Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2248" d="M717 438v-2c-20 -93 -56 -149 -139 -169c-11 -3 -23 -4 -35 -4c-62 0 -120 37 -172 76c-43 32 -89 67 -138 67c-9 0 -17 -1 -26 -3c-67 -17 -111 -49 -127 -124c-1 -5 -6 -9 -12 -9c-7 0 -12 5 -12 12v2c20 93 56 149 139 169c12 3 24 4 35 4c62 0 120 -37 172 -76 c43 -32 89 -67 139 -67c8 0 16 1 25 3c67 17 111 49 127 124c2 5 6 9 12 9c7 0 12 -5 12 -12zM717 218v-2c-20 -93 -56 -149 -139 -169c-11 -3 -23 -4 -35 -4c-62 0 -120 37 -172 76c-43 32 -89 67 -138 67c-9 0 -17 -1 -26 -3c-67 -17 -111 -49 -127 -124 c-1 -5 -6 -9 -12 -9c-7 0 -12 5 -12 12v2c20 93 56 149 139 169c12 3 24 4 35 4c62 0 120 -37 172 -76c43 -32 89 -67 139 -67c8 0 16 1 25 3c67 17 111 49 127 124c2 5 6 9 12 9c7 0 12 -5 12 -12Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D441" d="M881 672c0 -19 -12 -20 -17 -20c-80 -3 -98 -34 -108 -74l-140 -557c-5 -18 -5 -21 -16 -21c-9 0 -12 2 -19 19l-249 589c-5 10 -5 12 -9 18l-132 -528c-3 -11 -4 -16 -4 -23c0 -20 8 -42 66 -44c11 0 20 -1 20 -11c0 -20 -13 -20 -18 -20c-33 0 -69 3 -103 3 c-33 0 -68 -3 -100 -3c-8 0 -13 4 -13 11c0 19 11 20 17 20c81 3 98 35 108 75l134 537c0 9 -63 9 -68 9c-19 0 -28 0 -28 11c0 20 9 20 29 20h134c23 0 24 -1 32 -19l221 -522l112 445c1 3 3 18 3 21c0 22 -11 43 -68 44c-8 0 -18 0 -18 11c0 20 12 20 18 20 c33 0 68 -3 102 -3c33 0 68 3 101 3c13 0 13 -11 13 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNSIZE1-2211" d="M1387 -130l-121 -320h-1182c-18 0 -27 0 -27 11c0 0 0 6 10 18l518 607l-529 724c0 11 0 30 1 33c3 6 4 7 27 7h1182l121 -281h-25c-34 81 -102 126 -127 142c-79 50 -166 67 -220 75c-9 2 -100 16 -234 16h-548l466 -637c7 -10 7 -15 7 -15c0 -5 -2 -8 -9 -16l-509 -597 h603c192 0 290 26 311 31c115 30 221 98 260 202h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-210E" d="M546 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 20 5 32 13 55c24 61 62 170 62 224c0 36 -11 70 -54 70s-74 -19 -96 -35c-34 -27 -65 -83 -68 -92c-1 -6 -9 -39 -11 -45c-5 -23 -11 -45 -17 -67l-22 -90l-19 -76c-5 -14 -21 -26 -37 -26c-9 0 -29 5 -29 28 c0 6 0 8 4 22l145 576l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-78 -318c37 46 85 77 148 77c75 0 115 -42 115 -107c0 -58 -45 -177 -61 -220c-9 -22 -18 -46 -18 -71c0 -23 7 -33 24 -33c55 0 87 71 102 124 c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43F" d="M643 247c0 0 0 -3 -4 -14l-79 -216c-6 -17 -7 -17 -31 -17h-463c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 12 20 19 20l133 -3l148 3c5 0 16 0 16 -12 c0 -19 -8 -19 -38 -19c-94 0 -97 -11 -106 -47l-135 -540c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h94c173 0 217 114 251 206c7 16 8 21 17 21s12 -7 12 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNSIZE1-222B" d="M943 1268c0 -35 -25 -50 -49 -50c-23 0 -48 16 -48 49c0 25 17 47 50 49c-4 4 -29 23 -60 23c-39 0 -73 -129 -85 -178c-34 -129 -71 -329 -108 -542c-54 -321 -119 -640 -196 -956c-71 -290 -128 -524 -280 -524c-61 0 -111 42 -111 93c0 35 25 50 49 50 c23 0 48 -16 48 -49c0 -25 -17 -47 -49 -49c0 0 25 -23 61 -23c81 0 127 188 145 261c33 139 62 306 88 459c110 654 246 1156 249 1167c55 204 111 313 187 313c55 0 109 -39 109 -93Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3A9" d="M677 162l-33 -162h-159c-23 0 -26 0 -26 21c0 69 32 159 47 201c29 82 56 158 56 233c0 156 -106 228 -202 228c-91 0 -201 -68 -201 -228c0 -75 28 -154 49 -212c23 -64 54 -152 54 -222c0 -21 -3 -21 -25 -21h-160l-33 162h25c5 -25 10 -51 18 -74c5 -15 8 -23 66 -23 h80c-13 56 -45 104 -89 170c-47 71 -88 140 -88 219c0 137 133 251 305 251c169 0 304 -112 304 -251c0 -79 -41 -148 -88 -219c-45 -66 -76 -114 -89 -170h80c58 0 61 8 66 24c9 24 13 47 18 73h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-64" d="M527 0l-147 -11v66c-25 -32 -70 -66 -134 -66c-114 0 -212 99 -212 226c0 129 105 227 223 227c54 0 97 -26 126 -62v216c0 49 -8 56 -78 56v31l144 11v-607c0 -49 8 -56 78 -56v-31zM380 118v205c0 18 0 20 -11 37c-31 45 -73 60 -108 60c-54 0 -92 -33 -113 -64 c-29 -45 -31 -105 -31 -142c0 -41 3 -98 29 -139c24 -38 60 -64 105 -64c43 0 88 22 118 70c11 17 11 19 11 37Z"></path>
<path stroke-width="1" id="E1-LATINMODERNSIZE5-28" d="M608 -780c0 -9 -7 -16 -16 -16c-4 0 -7 1 -10 3c-199 150 -381 545 -381 893v300c0 348 182 743 381 893c3 2 6 3 10 3c9 0 16 -7 16 -16c0 -5 -3 -10 -6 -13c-190 -142 -323 -535 -323 -867v-300c0 -332 133 -725 323 -867c3 -3 6 -8 6 -13Z"></path>
<path stroke-width="1" id="E1-LATINMODERNSIZE5-29" d="M462 100c0 -348 -182 -743 -382 -893c-2 -2 -6 -3 -9 -3c-9 0 -16 7 -16 16c0 5 2 10 6 13c190 142 323 535 323 867v300c0 332 -133 725 -323 867c-4 3 -6 8 -6 13c0 9 7 16 16 16c3 0 7 -1 9 -3c200 -150 382 -545 382 -893v-300Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43C" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D457" x="622" y="-213"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2248" x="1109" y="0"></use>
<g transform="translate(1883,0)">
<g transform="translate(397,0)">
<rect stroke="none" width="1001" height="60" x="0" y="220"></rect>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="250" y="676"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D441" x="60" y="-704"></use>
</g>
</g>
<g transform="translate(3569,0)">
 <use xlink:href="#E1-LATINMODERNSIZE1-2211" x="0" y="0"></use>
<g transform="translate(147,-1090)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-3D" x="345" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="1124" y="0"></use>
</g>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D441" x="580" y="1627"></use>
</g>
<g transform="translate(5013,0)">
<g transform="translate(286,0)">
<rect stroke="none" width="5921" height="60" x="0" y="220"></rect>
<g transform="translate(60,815)">
 <use xlink:href="#E1-LATINMODERNNORMAL-210E" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D457" x="815" y="-213"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="968" y="0"></use>
<g transform="translate(1357,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1229" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2571" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="3127" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="3809" y="0"></use>
<g transform="translate(4198,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1229" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="5412" y="0"></use>
</g>
<g transform="translate(1715,-769)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43C" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="497" y="0"></use>
<g transform="translate(887,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1229" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2100" y="0"></use>
</g>
</g>
</g>
<g transform="translate(11342,0)">
 <use xlink:href="#E1-LATINMODERNSIZE5-28"></use>
<g transform="translate(663,0)">
 <use xlink:href="#E1-LATINMODERNSIZE1-222B" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-3A9" x="812" y="-1270"></use>
</g>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43C" x="2015" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="2513" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="2902" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="3772" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-64" x="4328" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3A9" x="4884" y="0"></use>
 <use xlink:href="#E1-LATINMODERNSIZE5-29" x="5607" y="0"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="17779" y="0"></use>
</g>
</svg>
</div>
<p>


</p>
<p>

</p>
<p>The integral of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.155ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 497.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper I</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43C" d="M497 671c0 -19 -8 -19 -32 -19c-79 0 -82 -10 -91 -46l-134 -533c-2 -7 -4 -15 -4 -23c0 -11 4 -15 25 -17c20 -2 25 -2 43 -2c22 0 30 0 30 -12c0 -19 -12 -19 -20 -19l-134 3l-131 -3c-3 0 -15 0 -15 11c0 20 9 20 32 20c79 0 82 10 91 47l135 539c2 9 2 11 2 16 c0 19 -27 19 -69 19c-19 0 -28 0 -28 11c0 20 13 20 20 20l133 -3l132 3c4 0 15 0 15 -12Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43C" x="0" y="0"></use>
</g>
</svg> over the entire domain
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.678ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 722.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal upper Omega</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-3A9" d="M677 162l-33 -162h-159c-23 0 -26 0 -26 21c0 69 32 159 47 201c29 82 56 158 56 233c0 156 -106 228 -202 228c-91 0 -201 -68 -201 -228c0 -75 28 -154 49 -212c23 -64 54 -152 54 -222c0 -21 -3 -21 -25 -21h-160l-33 162h25c5 -25 10 -51 18 -74c5 -15 8 -23 66 -23 h80c-13 56 -45 104 -89 170c-47 71 -88 140 -88 219c0 137 133 251 305 251c169 0 304 -112 304 -251c0 -79 -41 -148 -88 -219c-45 -66 -76 -114 -89 -170h80c58 0 61 8 66 24c9 24 13 47 18 73h25Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-3A9" x="0" y="0"></use>
</g>
</svg> can be computed using a traditional approach like
bidirectional path
tracing.  If this value is denoted by <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.998ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 429.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">b</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="0" y="0"></use>
</g>
</svg>, with <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="14.371ex" height="3.176ex" style="vertical-align: -1.005ex;" viewBox="0 -934.9 6187.4 1367.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">b equals integral upper I left-parenthesis bold upper X right-parenthesis normal d normal upper Omega</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-222B" d="M609 722c0 -30 -22 -43 -42 -43c-19 0 -41 13 -41 42c0 14 8 37 37 41c-22 19 -53 21 -63 21c-45 0 -79 -25 -93 -209l-19 -249c-8 -111 -44 -402 -57 -454c-22 -90 -70 -177 -165 -177c-60 0 -110 35 -110 83c0 30 22 43 42 43c19 0 41 -13 41 -42c0 -14 -8 -37 -37 -41 c21 -18 51 -21 64 -21c57 0 93 45 106 209l19 249c9 121 45 403 57 458c17 76 56 173 151 173c60 0 110 -35 110 -83Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43C" d="M497 671c0 -19 -8 -19 -32 -19c-79 0 -82 -10 -91 -46l-134 -533c-2 -7 -4 -15 -4 -23c0 -11 4 -15 25 -17c20 -2 25 -2 43 -2c22 0 30 0 30 -12c0 -19 -12 -19 -20 -19l-134 3l-131 -3c-3 0 -15 0 -15 11c0 20 9 20 32 20c79 0 82 10 91 47l135 539c2 9 2 11 2 16 c0 19 -27 19 -69 19c-19 0 -28 0 -28 11c0 20 13 20 20 20l133 -3l132 3c4 0 15 0 15 -12Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-64" d="M527 0l-147 -11v66c-25 -32 -70 -66 -134 -66c-114 0 -212 99 -212 226c0 129 105 227 223 227c54 0 97 -26 126 -62v216c0 49 -8 56 -78 56v31l144 11v-607c0 -49 8 -56 78 -56v-31zM380 118v205c0 18 0 20 -11 37c-31 45 -73 60 -108 60c-54 0 -92 -33 -113 -64 c-29 -45 -31 -105 -31 -142c0 -41 3 -98 29 -139c24 -38 60 -64 105 -64c43 0 88 22 118 70c11 17 11 19 11 37Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3A9" d="M677 162l-33 -162h-159c-23 0 -26 0 -26 21c0 69 32 159 47 201c29 82 56 158 56 233c0 156 -106 228 -202 228c-91 0 -201 -68 -201 -228c0 -75 28 -154 49 -212c23 -64 54 -152 54 -222c0 -21 -3 -21 -25 -21h-160l-33 162h25c5 -25 10 -51 18 -74c5 -15 8 -23 66 -23 h80c-13 56 -45 104 -89 170c-47 71 -88 140 -88 219c0 137 133 251 305 251c169 0 304 -112 304 -251c0 -79 -41 -148 -88 -219c-45 -66 -76 -114 -89 -170h80c58 0 61 8 66 24c9 24 13 47 18 73h25Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="707" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-222B" x="1763" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43C" x="2595" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="3093" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="3482" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="4352" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-64" x="4908" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3A9" x="5464" y="0"></use>
</g>
</svg>, then each pixel&rsquo;s value is given by
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="eq:mlt-pixel-splat"></span><div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="26.991ex" height="7.343ex" style="vertical-align: -3.005ex;" viewBox="0 -1867.7 11621 3161.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper I Subscript j Baseline almost-equals StartFraction b Over upper N EndFraction sigma-summation Underscript i equals 1 Overscript upper N Endscripts StartFraction h Subscript j Baseline left-parenthesis bold upper X Subscript i Baseline right-parenthesis upper L left-parenthesis bold upper X Subscript i Baseline right-parenthesis Over upper I left-parenthesis bold upper X Subscript i Baseline right-parenthesis EndFraction period</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43C" d="M497 671c0 -19 -8 -19 -32 -19c-79 0 -82 -10 -91 -46l-134 -533c-2 -7 -4 -15 -4 -23c0 -11 4 -15 25 -17c20 -2 25 -2 43 -2c22 0 30 0 30 -12c0 -19 -12 -19 -20 -19l-134 3l-131 -3c-3 0 -15 0 -15 11c0 20 9 20 32 20c79 0 82 10 91 47l135 539c2 9 2 11 2 16 c0 19 -27 19 -69 19c-19 0 -28 0 -28 11c0 20 13 20 20 20l133 -3l132 3c4 0 15 0 15 -12Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D457" d="M397 625c0 -27 -27 -53 -54 -53c-23 0 -37 16 -37 36c0 30 30 53 53 53c24 0 38 -17 38 -36zM360 350c0 -3 0 -17 -5 -37l-92 -366c-25 -99 -118 -152 -188 -152c-48 0 -88 22 -88 62c0 36 29 57 54 57c27 0 38 -19 38 -35c0 -20 -15 -46 -45 -53c18 -9 33 -9 39 -9 c56 0 104 57 123 133l94 373c4 17 7 28 7 51c0 42 -18 46 -32 46c-55 0 -101 -61 -126 -122c-8 -19 -9 -20 -18 -20c0 0 -12 0 -12 10c0 9 57 154 159 154c50 0 92 -35 92 -92Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2248" d="M717 438v-2c-20 -93 -56 -149 -139 -169c-11 -3 -23 -4 -35 -4c-62 0 -120 37 -172 76c-43 32 -89 67 -138 67c-9 0 -17 -1 -26 -3c-67 -17 -111 -49 -127 -124c-1 -5 -6 -9 -12 -9c-7 0 -12 5 -12 12v2c20 93 56 149 139 169c12 3 24 4 35 4c62 0 120 -37 172 -76 c43 -32 89 -67 139 -67c8 0 16 1 25 3c67 17 111 49 127 124c2 5 6 9 12 9c7 0 12 -5 12 -12zM717 218v-2c-20 -93 -56 -149 -139 -169c-11 -3 -23 -4 -35 -4c-62 0 -120 37 -172 76c-43 32 -89 67 -138 67c-9 0 -17 -1 -26 -3c-67 -17 -111 -49 -127 -124 c-1 -5 -6 -9 -12 -9c-7 0 -12 5 -12 12v2c20 93 56 149 139 169c12 3 24 4 35 4c62 0 120 -37 172 -76c43 -32 89 -67 139 -67c8 0 16 1 25 3c67 17 111 49 127 124c2 5 6 9 12 9c7 0 12 -5 12 -12Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D441" d="M881 672c0 -19 -12 -20 -17 -20c-80 -3 -98 -34 -108 -74l-140 -557c-5 -18 -5 -21 -16 -21c-9 0 -12 2 -19 19l-249 589c-5 10 -5 12 -9 18l-132 -528c-3 -11 -4 -16 -4 -23c0 -20 8 -42 66 -44c11 0 20 -1 20 -11c0 -20 -13 -20 -18 -20c-33 0 -69 3 -103 3 c-33 0 -68 -3 -100 -3c-8 0 -13 4 -13 11c0 19 11 20 17 20c81 3 98 35 108 75l134 537c0 9 -63 9 -68 9c-19 0 -28 0 -28 11c0 20 9 20 29 20h134c23 0 24 -1 32 -19l221 -522l112 445c1 3 3 18 3 21c0 22 -11 43 -68 44c-8 0 -18 0 -18 11c0 20 12 20 18 20 c33 0 68 -3 102 -3c33 0 68 3 101 3c13 0 13 -11 13 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNSIZE1-2211" d="M1387 -130l-121 -320h-1182c-18 0 -27 0 -27 11c0 0 0 6 10 18l518 607l-529 724c0 11 0 30 1 33c3 6 4 7 27 7h1182l121 -281h-25c-34 81 -102 126 -127 142c-79 50 -166 67 -220 75c-9 2 -100 16 -234 16h-548l466 -637c7 -10 7 -15 7 -15c0 -5 -2 -8 -9 -16l-509 -597 h603c192 0 290 26 311 31c115 30 221 98 260 202h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-210E" d="M546 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 20 5 32 13 55c24 61 62 170 62 224c0 36 -11 70 -54 70s-74 -19 -96 -35c-34 -27 -65 -83 -68 -92c-1 -6 -9 -39 -11 -45c-5 -23 -11 -45 -17 -67l-22 -90l-19 -76c-5 -14 -21 -26 -37 -26c-9 0 -29 5 -29 28 c0 6 0 8 4 22l145 576l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-78 -318c37 46 85 77 148 77c75 0 115 -42 115 -107c0 -58 -45 -177 -61 -220c-9 -22 -18 -46 -18 -71c0 -23 7 -33 24 -33c55 0 87 71 102 124 c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43F" d="M643 247c0 0 0 -3 -4 -14l-79 -216c-6 -17 -7 -17 -31 -17h-463c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 12 20 19 20l133 -3l148 3c5 0 16 0 16 -12 c0 -19 -8 -19 -38 -19c-94 0 -97 -11 -106 -47l-135 -540c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h94c173 0 217 114 251 206c7 16 8 21 17 21s12 -7 12 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43C" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D457" x="622" y="-213"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2248" x="1109" y="0"></use>
<g transform="translate(1883,0)">
<g transform="translate(397,0)">
<rect stroke="none" width="1001" height="60" x="0" y="220"></rect>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="286" y="676"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D441" x="60" y="-704"></use>
</g>
</g>
<g transform="translate(3569,0)">
 <use xlink:href="#E1-LATINMODERNSIZE1-2211" x="0" y="0"></use>
<g transform="translate(147,-1090)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-3D" x="345" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="1124" y="0"></use>
</g>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D441" x="580" y="1627"></use>
</g>
<g transform="translate(5013,0)">
<g transform="translate(286,0)">
<rect stroke="none" width="5921" height="60" x="0" y="220"></rect>
<g transform="translate(60,815)">
 <use xlink:href="#E1-LATINMODERNNORMAL-210E" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D457" x="815" y="-213"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="968" y="0"></use>
<g transform="translate(1357,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1229" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2571" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="3127" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="3809" y="0"></use>
<g transform="translate(4198,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1229" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="5412" y="0"></use>
</g>
<g transform="translate(1715,-769)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43C" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="497" y="0"></use>
<g transform="translate(887,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1229" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2100" y="0"></use>
</g>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="11342" y="0"></use>
</g>
</svg>
</div>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">
<div class="eqno">(<a href="#eq:mlt-pixel-splat">16.22</a>)</div>
</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<p>

In other words, we can use Metropolis sampling to generate samples <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.819ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 1213.8 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X Subscript i</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1229" y="-213"></use>
</g>
</svg>
from the distribution of the scalar contribution function <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.155ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 497.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper I</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43C" d="M497 671c0 -19 -8 -19 -32 -19c-79 0 -82 -10 -91 -46l-134 -533c-2 -7 -4 -15 -4 -23c0 -11 4 -15 25 -17c20 -2 25 -2 43 -2c22 0 30 0 30 -12c0 -19 -12 -19 -20 -19l-134 3l-131 -3c-3 0 -15 0 -15 11c0 20 9 20 32 20c79 0 82 10 91 47l135 539c2 9 2 11 2 16 c0 19 -27 19 -69 19c-19 0 -28 0 -28 11c0 20 13 20 20 20l133 -3l132 3c4 0 15 0 15 -12Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43C" x="0" y="0"></use>
</g>
</svg>.  For each sample, the
pixels it contributes to (based on the extent of the pixel filter function
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.339ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 576.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">h</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-210E" d="M546 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 20 5 32 13 55c24 61 62 170 62 224c0 36 -11 70 -54 70s-74 -19 -96 -35c-34 -27 -65 -83 -68 -92c-1 -6 -9 -39 -11 -45c-5 -23 -11 -45 -17 -67l-22 -90l-19 -76c-5 -14 -21 -26 -37 -26c-9 0 -29 5 -29 28 c0 6 0 8 4 22l145 576l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-78 -318c37 46 85 77 148 77c75 0 115 -42 115 -107c0 -58 -45 -177 -61 -220c-9 -22 -18 -46 -18 -71c0 -23 7 -33 24 -33c55 0 87 71 102 124 c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-210E" x="0" y="0"></use>
</g>
</svg>) have the value
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="17.582ex" height="6.509ex" style="vertical-align: -2.671ex;" viewBox="0 -1652.5 7570.1 2802.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">StartFraction b Over upper N EndFraction StartFraction h Subscript j Baseline left-parenthesis bold upper X Subscript i Baseline right-parenthesis upper L left-parenthesis bold upper X Subscript i Baseline right-parenthesis Over upper I left-parenthesis bold upper X Subscript i Baseline right-parenthesis EndFraction</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D441" d="M881 672c0 -19 -12 -20 -17 -20c-80 -3 -98 -34 -108 -74l-140 -557c-5 -18 -5 -21 -16 -21c-9 0 -12 2 -19 19l-249 589c-5 10 -5 12 -9 18l-132 -528c-3 -11 -4 -16 -4 -23c0 -20 8 -42 66 -44c11 0 20 -1 20 -11c0 -20 -13 -20 -18 -20c-33 0 -69 3 -103 3 c-33 0 -68 -3 -100 -3c-8 0 -13 4 -13 11c0 19 11 20 17 20c81 3 98 35 108 75l134 537c0 9 -63 9 -68 9c-19 0 -28 0 -28 11c0 20 9 20 29 20h134c23 0 24 -1 32 -19l221 -522l112 445c1 3 3 18 3 21c0 22 -11 43 -68 44c-8 0 -18 0 -18 11c0 20 12 20 18 20 c33 0 68 -3 102 -3c33 0 68 3 101 3c13 0 13 -11 13 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-210E" d="M546 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 20 5 32 13 55c24 61 62 170 62 224c0 36 -11 70 -54 70s-74 -19 -96 -35c-34 -27 -65 -83 -68 -92c-1 -6 -9 -39 -11 -45c-5 -23 -11 -45 -17 -67l-22 -90l-19 -76c-5 -14 -21 -26 -37 -26c-9 0 -29 5 -29 28 c0 6 0 8 4 22l145 576l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-78 -318c37 46 85 77 148 77c75 0 115 -42 115 -107c0 -58 -45 -177 -61 -220c-9 -22 -18 -46 -18 -71c0 -23 7 -33 24 -33c55 0 87 71 102 124 c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D457" d="M397 625c0 -27 -27 -53 -54 -53c-23 0 -37 16 -37 36c0 30 30 53 53 53c24 0 38 -17 38 -36zM360 350c0 -3 0 -17 -5 -37l-92 -366c-25 -99 -118 -152 -188 -152c-48 0 -88 22 -88 62c0 36 29 57 54 57c27 0 38 -19 38 -35c0 -20 -15 -46 -45 -53c18 -9 33 -9 39 -9 c56 0 104 57 123 133l94 373c4 17 7 28 7 51c0 42 -18 46 -32 46c-55 0 -101 -61 -126 -122c-8 -19 -9 -20 -18 -20c0 0 -12 0 -12 10c0 9 57 154 159 154c50 0 92 -35 92 -92Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43F" d="M643 247c0 0 0 -3 -4 -14l-79 -216c-6 -17 -7 -17 -31 -17h-463c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 12 20 19 20l133 -3l148 3c5 0 16 0 16 -12 c0 -19 -8 -19 -38 -19c-94 0 -97 -11 -106 -47l-135 -540c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h94c173 0 217 114 251 206c7 16 8 21 17 21s12 -7 12 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43C" d="M497 671c0 -19 -8 -19 -32 -19c-79 0 -82 -10 -91 -46l-134 -533c-2 -7 -4 -15 -4 -23c0 -11 4 -15 25 -17c20 -2 25 -2 43 -2c22 0 30 0 30 -12c0 -19 -12 -19 -20 -19l-134 3l-131 -3c-3 0 -15 0 -15 11c0 20 9 20 32 20c79 0 82 10 91 47l135 539c2 9 2 11 2 16 c0 19 -27 19 -69 19c-19 0 -28 0 -28 11c0 20 13 20 20 20l133 -3l132 3c4 0 15 0 15 -12Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
<g transform="translate(120,0)">
<rect stroke="none" width="1001" height="60" x="0" y="220"></rect>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="286" y="676"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D441" x="60" y="-704"></use>
</g>
<g transform="translate(1408,0)">
<g transform="translate(120,0)">
<rect stroke="none" width="5921" height="60" x="0" y="220"></rect>
<g transform="translate(60,815)">
 <use xlink:href="#E1-LATINMODERNNORMAL-210E" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D457" x="815" y="-213"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="968" y="0"></use>
<g transform="translate(1357,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1229" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2571" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="3127" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="3809" y="0"></use>
<g transform="translate(4198,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1229" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="5412" y="0"></use>
</g>
<g transform="translate(1715,-769)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43C" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="497" y="0"></use>
<g transform="translate(887,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1229" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2100" y="0"></use>
</g>
</g>
</g>
</g>
</svg>
</div>
<p>

added to them.  Thus, brighter pixels have larger values than dimmer pixels
due to more samples contributing to them (as long as the ratio
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="13.957ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 6009.4 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper L Subscript i Baseline left-parenthesis bold upper X Subscript i Baseline right-parenthesis slash upper I left-parenthesis bold upper X Subscript i Baseline right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43F" d="M643 247c0 0 0 -3 -4 -14l-79 -216c-6 -17 -7 -17 -31 -17h-463c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 12 20 19 20l133 -3l148 3c5 0 16 0 16 -12 c0 -19 -8 -19 -38 -19c-94 0 -97 -11 -106 -47l-135 -540c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h94c173 0 217 114 251 206c7 16 8 21 17 21s12 -7 12 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43C" d="M497 671c0 -19 -8 -19 -32 -19c-79 0 -82 -10 -91 -46l-134 -533c-2 -7 -4 -15 -4 -23c0 -11 4 -15 25 -17c20 -2 25 -2 43 -2c22 0 30 0 30 -12c0 -19 -12 -19 -20 -19l-134 3l-131 -3c-3 0 -15 0 -15 11c0 20 9 20 32 20c79 0 82 10 91 47l135 539c2 9 2 11 2 16 c0 19 -27 19 -69 19c-19 0 -28 0 -28 11c0 20 13 20 20 20l133 -3l132 3c4 0 15 0 15 -12Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="963" y="-213"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1025" y="0"></use>
<g transform="translate(1415,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1229" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2629" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="3018" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43C" x="3519" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="4016" y="0"></use>
<g transform="translate(4406,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1229" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="5619" y="0"></use>
</g>
</svg> is generally of the same magnitude).

</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#PrimarySampleSpaceSampler"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:mlt-sampler"></span><span id="PrimarySampleSpaceSampler"></span><h3>16.4.4  Primary Sample Space Sampler</h3><p>



</p>
<p>The <a href="#MLTIntegrator"><tt>MLTIntegrator</tt></a> applies Metropolis sampling and MMLT to render
images, using the bidirectional path tracer from
Section&nbsp;<a href="../Light_Transport_III_Bidirectional_Methods/Bidirectional_Path_Tracing.html#sec:bidir-path-tracing">16.3</a>.  Its implementation is contained in
the files <a href="https://github.com/mmp/pbrt-v3/tree/master/src/integrators/mlt.h"><tt>integrators/mlt.h</tt></a><span class="anchor" id="integratorsmlt.h"></span> and
<a href="https://github.com/mmp/pbrt-v3/tree/master/src/integrators/mlt.cpp"><tt>integrators/mlt.cpp</tt></a><span class="anchor" id="integratorsmlt.cpp"></span>. 
Figure&nbsp;<a href="#fig:volume-caustic">16.22</a> shows the effectiveness of this integrator
with a particularly tricky lighting situation.

</p>
<p></p>
<span class="anchor" id="fig:volume-caustic"></span><div class="card outerfigure"><div class="card-body figure"><p>



</p>

<div class="card-img-top" style="display:block; width: 100%; padding-top: 102.400%;  position:relative;">
<div id="Bidirectional_path_tracing73" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0;"></div></div>
<script>
Jeri.renderViewer(document.getElementById('Bidirectional_path_tracing73'), {
  title: 'Bidirectional_path_tracing73', children: [
 { title: 'Bidirectional path tracing', image: 'vol-caustic-bdpt.exr' },  { title: 'Metropolis', image: 'vol-caustic-mlt.exr' }]});
</script>
<button data-toggle="tooltip" data-placement="left" class="btn yojeri" title="This image is interactive. Click and drag to pan and use the mouse-wheel to zoom. After clicking on the image to select it, type '?' to see a summary of keyboard controls."><i class="fa fa-snowflake fa-border"></i></button><p>

</p>
<figcaption class="caption">Figure 16.22: A Volumetric Caustic. <span class="legend">
Light passing through the sphere is focused in the medium behind it,
creating a volumetric caustic. (a) Rendered with bidirectional path
tracing, (b) rendered with the <a href="#MLTIntegrator"><tt>MLTIntegrator</tt></a>, using a roughly equal
amount of time. Note that MMLT gives a lower variance result, thanks to
being able to efficiently explore the local path space once a
high-contribution path has been found.
</span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p>Before describing the <a href="#MLTIntegrator"><tt>MLTIntegrator</tt></a> implementation, we&rsquo;ll first introduce the <tt>MLTSampler</tt>,
which is responsible for managing primary sample space state vectors,
mutations, and acceptance and rejection steps.

</p>
<p></p>
<span class="anchor" id="fragment-MLTSamplerDeclarations-0"></span><div class="fragmentname">&lt;&lt;MLTSampler Declarations&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">class <span class="anchor" id="MLTSampler"></span>MLTSampler : public <a href="../Sampling_and_Reconstruction/Sampling_Interface.html#Sampler" class="code">Sampler</a> {
public:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-MLTSamplerPublicMethods-0">MLTSampler Public Methods</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1822" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1822"><i></i></a><div id="fragbit-1822" class="collapse"><div class="fragmentcode">       MLTSampler(int mutationsPerPixel, int <a href="../Utilities/Main_Include_File.html#RNG" class="code">rngSequenceIndex</a>,
                  Float <a href="#MLTSampler::sigma" class="code">sigma</a>, Float <a href="#MLTSampler::largeStepProbability" class="code">largeStepProbability</a>, int <a href="#MLTSampler::streamCount" class="code">streamCount</a>)
           : <a href="../Sampling_and_Reconstruction/Sampling_Interface.html#Sampler" class="code">Sampler</a>(mutationsPerPixel), <a href="#MLTSampler::rng" class="code">rng</a>(<a href="../Utilities/Main_Include_File.html#RNG" class="code">rngSequenceIndex</a>), <a href="#MLTSampler::sigma" class="code">sigma</a>(<a href="#MLTSampler::sigma" class="code">sigma</a>),
             <a href="#MLTSampler::largeStepProbability" class="code">largeStepProbability</a>(<a href="#MLTSampler::largeStepProbability" class="code">largeStepProbability</a>),
             <a href="#MLTSampler::streamCount" class="code">streamCount</a>(<a href="#MLTSampler::streamCount" class="code">streamCount</a>) { }
       Float Get1D();
       <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> Get2D();
       std::unique_ptr&lt;<a href="../Sampling_and_Reconstruction/Sampling_Interface.html#Sampler" class="code">Sampler</a>&gt; Clone(int seed);
       void StartIteration();
       void Accept();
       void Reject();
       void StartStream(int index);
       int GetNextIndex() {
          return <a href="#MLTSampler::streamIndex" class="code">streamIndex</a> + <a href="#MLTSampler::streamCount" class="code">streamCount</a> * sampleIndex++;
       }</div></div>
protected:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-MLTSamplerPrivateDeclarations-0">MLTSampler Private Declarations</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1823" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1823"><i></i></a><div id="fragbit-1823" class="collapse"><div class="fragmentcode">       struct PrimarySample {
           Float value = 0;
           &lt;&lt;<span class="fragmentname"><a href="#fragment-PrimarySamplePublicMethods-0">PrimarySample Public Methods</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1824" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1824"><i></i></a><div id="fragbit-1824" class="collapse"><div class="fragmentcode">              void Backup() {
                  <a href="#PrimarySample::valueBackup" class="code">valueBackup</a> = <a href="#PrimarySample::value" class="code">value</a>;
                  <a href="#PrimarySample::modifyBackup" class="code">modifyBackup</a> = <a href="#PrimarySample::lastModificationIteration" class="code">lastModificationIteration</a>;
              }
              void Restore() {
                  <a href="#PrimarySample::value" class="code">value</a> = <a href="#PrimarySample::valueBackup" class="code">valueBackup</a>;
                  <a href="#PrimarySample::lastModificationIteration" class="code">lastModificationIteration</a> = <a href="#PrimarySample::modifyBackup" class="code">modifyBackup</a>;
              }</div></div>
           &lt;&lt;<span class="fragmentname"><a href="#fragment-PrimarySamplePublicData-0">PrimarySample Public Data</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1825" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1825"><i></i></a><div id="fragbit-1825" class="collapse"><div class="fragmentcode">              int64_t lastModificationIteration = 0;
              Float valueBackup = 0;
              int64_t modifyBackup = 0;</div></div>
       };</div></div>
    &lt;&lt;<span class="fragmentname">MLTSampler Private Methods</span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1826" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1826"><i></i></a><div id="fragbit-1826" class="collapse"><div class="fragmentcode">       void EnsureReady(int index);</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-MLTSamplerPrivateData-0">MLTSampler Private Data</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1827" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1827"><i></i></a><div id="fragbit-1827" class="collapse"><div class="fragmentcode">       <a href="../Utilities/Main_Include_File.html#RNG" class="code">RNG</a> rng;
       const Float sigma, largeStepProbability;
       const int streamCount;
       std::vector&lt;PrimarySample&gt; X;
       int64_t currentIteration = 0;
       bool largeStep = true;
       int64_t lastLargeStepIteration = 0;
       int streamIndex, sampleIndex;</div></div>
};</div><p>


</p>
<p>The <a href="#MLTIntegrator"><tt>MLTIntegrator</tt></a> works best if the <tt>MLTSampler</tt> actually
maintains three separate sample vectors&mdash;one for the camera subpath, one
for the light subpath, and one for the connection step. We&rsquo;ll say that
these are three <em>sample streams</em>. The
<tt>streamCount</tt> parameter to the constructor
lets the caller request a particular number of
such sample streams.

</p>
<p>Later, during the initialization phase of <a href="#MLTIntegrator"><tt>MLTIntegrator</tt></a>, we will
create many separate <a href="#MLTSampler"><tt>MLTSampler</tt></a> instances that are used to select a
suitable set of starting states for the Metropolis sampler. Importantly,
this process requires that each <a href="#MLTSampler"><tt>MLTSampler</tt></a> produces a distinct
sequence of state vectors. The <a href="../Utilities/Main_Include_File.html#RNG"><tt>RNG</tt></a> pseudo-random number generator
used by <tt>pbrt</tt> has a handy feature that makes this easy to accomplish: the
<a href="../Utilities/Main_Include_File.html#RNG"><tt>RNG</tt></a> constructor accepts a <em>sequence index</em>, which selects between
one of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.039ex" height="2.676ex" style="vertical-align: -0.338ex;" viewBox="0 -1006.6 1308.3 1152.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">2 Superscript 63</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-36" d="M457 204c0 -132 -95 -226 -206 -226c-93 0 -209 71 -209 338c0 221 135 350 263 350c83 0 127 -48 127 -108c0 -39 -30 -48 -46 -48c-22 0 -46 15 -46 46c0 45 40 45 55 45c-22 34 -64 40 -88 40c-51 0 -175 -36 -175 -289v-24c20 48 57 99 125 99 c111 0 200 -96 200 -223zM367 205c0 49 0 100 -18 137c-31 62 -77 62 -93 62c-90 0 -122 -100 -122 -178c0 -18 0 -98 18 -145c6 -15 36 -75 99 -75c23 0 69 5 99 65c17 36 17 86 17 134Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-33" d="M457 171c0 -102 -91 -193 -213 -193c-109 0 -202 66 -202 157c0 44 32 58 56 58c29 0 56 -20 56 -56c0 -38 -31 -60 -66 -55c35 -59 110 -76 153 -76c44 0 113 29 113 165c0 98 -37 166 -119 166h-44c-17 0 -24 0 -24 11c0 10 7 11 15 12c7 0 31 2 39 3c25 1 59 4 89 52 c26 44 28 102 28 114c0 90 -55 112 -96 112c-36 0 -102 -13 -133 -62c15 0 62 0 62 -50c0 -29 -20 -51 -51 -51c-29 0 -51 19 -51 52c0 76 76 136 177 136c96 0 184 -56 184 -138c0 -79 -58 -149 -140 -176c104 -21 167 -99 167 -181Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
<g transform="translate(500,393)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-36"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-33" x="500" y="0"></use>
</g>
</g>
</svg> unique pseudo-random sequences. We thus add an
<tt>rngSequenceIndex</tt> parameter to the <tt>MLTSampler</tt> constructor that
is used to supply a unique stream index to the internal <a href="../Utilities/Main_Include_File.html#RNG"><tt>RNG</tt></a>.

</p>
<p></p>
<span class="anchor" id="fragment-MLTSamplerPublicMethods-0"></span><div class="fragmentname">&lt;&lt;MLTSampler Public Methods&gt;&gt;=&nbsp;<a href="#fragment-MLTSamplerPublicMethods-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">MLTSampler(int mutationsPerPixel, int <a href="../Utilities/Main_Include_File.html#RNG" class="code">rngSequenceIndex</a>,
           Float <a href="#MLTSampler::sigma" class="code">sigma</a>, Float <a href="#MLTSampler::largeStepProbability" class="code">largeStepProbability</a>, int <a href="#MLTSampler::streamCount" class="code">streamCount</a>)
    : <a href="../Sampling_and_Reconstruction/Sampling_Interface.html#Sampler" class="code">Sampler</a>(mutationsPerPixel), <a href="#MLTSampler::rng" class="code">rng</a>(<a href="../Utilities/Main_Include_File.html#RNG" class="code">rngSequenceIndex</a>), <a href="#MLTSampler::sigma" class="code">sigma</a>(<a href="#MLTSampler::sigma" class="code">sigma</a>),
      <a href="#MLTSampler::largeStepProbability" class="code">largeStepProbability</a>(<a href="#MLTSampler::largeStepProbability" class="code">largeStepProbability</a>),
      <a href="#MLTSampler::streamCount" class="code">streamCount</a>(<a href="#MLTSampler::streamCount" class="code">streamCount</a>) { }</div><p>


</p>
<p>The <tt>largeStepProbability</tt> parameter refers to the probability of taking a
&ldquo;large step&rdquo; mutation, and <tt>sigma</tt> controls the size of &ldquo;small step&rdquo;
mutations.

</p>
<p></p>
<span class="anchor" id="fragment-MLTSamplerPrivateData-0"></span><div class="fragmentname">&lt;&lt;MLTSampler Private Data&gt;&gt;=&nbsp;<a href="#fragment-MLTSamplerPrivateData-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode"><a href="../Utilities/Main_Include_File.html#RNG" class="code">RNG</a> <span class="anchor" id="MLTSampler::rng"></span>rng;
const Float <span class="anchor" id="MLTSampler::sigma"></span>sigma, <span class="anchor" id="MLTSampler::largeStepProbability"></span>largeStepProbability;
const int <span class="anchor" id="MLTSampler::streamCount"></span>streamCount;</div><p>


</p>
<p>The <a href="#MLTSampler::X"><tt>MLTSampler::X</tt></a> member variable stores the current sample vector
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.019ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 869.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
</g>
</svg>. Because we generally don&rsquo;t know ahead of time how many
dimensions of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.019ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 869.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
</g>
</svg> are actually needed during the sampler&rsquo;s lifetime,
we&rsquo;ll start with an empty vector and expand it on demand as calls to
<a href="#MLTSampler::Get1D"><tt>MLTSampler::Get1D()</tt></a> and <a href="#MLTSampler::Get2D"><tt>MLTSampler::Get2D()</tt></a> occur during
rendering.

</p>
<p></p>
<span class="anchor" id="fragment-MLTSamplerPrivateData-1"></span><div class="fragmentname">&lt;&lt;MLTSampler Private Data&gt;&gt;+=&nbsp;<a href="#fragment-MLTSamplerPrivateData-0"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MLTSamplerPrivateData-2"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">std::vector&lt;PrimarySample&gt; <span class="anchor" id="MLTSampler::X"></span>X;</div><p>


</p>
<p>The elements of this array have the type <a href="#PrimarySample"><tt>PrimarySample</tt></a>. The main task for
<tt>PrimarySample</tt> is to record the current value of a single component of
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.019ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 869.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
</g>
</svg> on the interval <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.91ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2114.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket 0 comma 1 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="779" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1224" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1724" y="0"></use>
</g>
</svg>.  In the following, we&rsquo;ll add some
additional functionality for representing proposed mutations and restoring
the original sample value if a proposed mutation is rejected. 

</p>
<p></p>
<span class="anchor" id="fragment-MLTSamplerPrivateDeclarations-0"></span><div class="fragmentname">&lt;&lt;MLTSampler Private Declarations&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">struct <span class="anchor" id="PrimarySample"></span>PrimarySample {
    Float <span class="anchor" id="PrimarySample::value"></span>value = 0;
    &lt;&lt;<span class="fragmentname"><a href="#fragment-PrimarySamplePublicMethods-0">PrimarySample Public Methods</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1828" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1828"><i></i></a><div id="fragbit-1828" class="collapse"><div class="fragmentcode">       void Backup() {
           <a href="#PrimarySample::valueBackup" class="code">valueBackup</a> = <a href="#PrimarySample::value" class="code">value</a>;
           <a href="#PrimarySample::modifyBackup" class="code">modifyBackup</a> = <a href="#PrimarySample::lastModificationIteration" class="code">lastModificationIteration</a>;
       }
       void Restore() {
           <a href="#PrimarySample::value" class="code">value</a> = <a href="#PrimarySample::valueBackup" class="code">valueBackup</a>;
           <a href="#PrimarySample::lastModificationIteration" class="code">lastModificationIteration</a> = <a href="#PrimarySample::modifyBackup" class="code">modifyBackup</a>;
       }</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-PrimarySamplePublicData-0">PrimarySample Public Data</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1829" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1829"><i></i></a><div id="fragbit-1829" class="collapse"><div class="fragmentcode">       int64_t lastModificationIteration = 0;
       Float valueBackup = 0;
       int64_t modifyBackup = 0;</div></div>
};</div><p>


</p>
<p>The <tt>Get1D()</tt> method returns the value of a single component of
<tt>MLTSampler::X</tt>, whose position is given by
<tt>GetNextIndex()</tt>&mdash;for now, we can think of this method as
returning the value of a running counter that increases with every call.
<tt>EnsureReady()</tt> expands <tt>MLTSampler::X</tt> as needed and
ensures that its contents are in a consistent state.  The details of these
methods will be clearer after a few more preliminaries, so we won&rsquo;t
introduce their implementations just yet.

</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-MLTSamplerMethodDefinitions-0"></span><div class="fragmentname">&lt;&lt;MLTSampler Method Definitions&gt;&gt;=&nbsp;<a href="#fragment-MLTSamplerMethodDefinitions-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">Float MLTSampler::<span class="anchor" id="MLTSampler::Get1D"></span>Get1D() {
    int index = <a href="#MLTSampler::GetNextIndex" class="code">GetNextIndex</a>();
    <a href="#MLTSampler::EnsureReady" class="code">EnsureReady</a>(index);
    return <a href="#MLTSampler::X" class="code">X</a>[index].<a href="#PrimarySample::value" class="code">value</a>;
}</div><p>


</p>
<p>The 2D analog simply performs two calls to <tt>Get1D()</tt>.

</p>
<p></p>
<span class="anchor" id="fragment-MLTSamplerMethodDefinitions-1"></span><div class="fragmentname">&lt;&lt;MLTSampler Method Definitions&gt;&gt;+=&nbsp;<a href="#fragment-MLTSamplerMethodDefinitions-0"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MLTSamplerMethodDefinitions-2"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode"><a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> MLTSampler::<span class="anchor" id="MLTSampler::Get2D"></span>Get2D() {
    return <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a>(<a href="#MLTSampler::Get1D" class="code">Get1D</a>(), <a href="#MLTSampler::Get1D" class="code">Get1D</a>());
}</div><p>


</p>
<p>

</p>
<p>Next, we will define several <a href="#MLTSampler"><tt>MLTSampler</tt></a> methods that
are not part of the official <a href="../Sampling_and_Reconstruction/Sampling_Interface.html#Sampler"><tt>Sampler</tt></a> interface. The first one,
<a href="#MLTSampler::StartIteration"><tt>MLTSampler::StartIteration()</tt></a>, is called at the beginning of each
Metropolis-Hastings iteration; it increases the <tt>currentIteration</tt>
counter and determines which type of mutation (small or large) should be
applied to the sample vector in the current iteration.

</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-MLTSamplerMethodDefinitions-2"></span><div class="fragmentname">&lt;&lt;MLTSampler Method Definitions&gt;&gt;+=&nbsp;<a href="#fragment-MLTSamplerMethodDefinitions-1"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MLTSamplerMethodDefinitions-3"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">void MLTSampler::<span class="anchor" id="MLTSampler::StartIteration"></span>StartIteration() {
    <a href="#MLTSampler::currentIteration" class="code">currentIteration</a>++;
    <a href="#MLTSampler::largeStep" class="code">largeStep</a> = <a href="#MLTSampler::rng" class="code">rng</a>.<a href="../Utilities/Main_Include_File.html#RNG::UniformFloat" class="code">UniformFloat</a>() &lt; <a href="#MLTSampler::largeStepProbability" class="code">largeStepProbability</a>;
}</div><p>


</p>
<p><tt>currentIteration</tt> is a running counter, which keeps track of the
current Metropolis-Hastings iteration index. Note that iterations with
rejected proposals will be excluded from this count.

</p>
<p></p>
<span class="anchor" id="fragment-MLTSamplerPrivateData-2"></span><div class="fragmentname">&lt;&lt;MLTSampler Private Data&gt;&gt;+=&nbsp;<a href="#fragment-MLTSamplerPrivateData-1"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MLTSamplerPrivateData-3"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">int64_t <span class="anchor" id="MLTSampler::currentIteration"></span>currentIteration = 0;
bool <span class="anchor" id="MLTSampler::largeStep"></span>largeStep = true;</div><p>


</p>
<p>

</p>
<p>The <a href="#MLTSampler::lastLargeStepIteration"><tt>MLTSampler::lastLargeStepIteration</tt></a> member variable records the
index of the last iteration where a successful large step took place. Our
implementation chooses the initial state <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.074ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 1323.4 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X 0</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-30" x="1229" y="-213"></use>
</g>
</svg> to be uniformly
distributed on primary sample space <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.786ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2921.6 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket 0 comma 1 right-parenthesis Superscript normal infinity</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-221E" d="M943 216c0 -118 -76 -227 -192 -227c-79 0 -138 42 -170 69c-22 19 -23 20 -90 101c-13 -22 -102 -170 -246 -170c-119 0 -189 115 -189 226c0 118 76 227 192 227c79 0 138 -42 170 -69c22 -19 23 -20 90 -101c13 22 102 170 246 170c119 0 189 -115 189 -226zM921 216 c0 90 -54 194 -160 194c-113 0 -189 -105 -227 -173c28 -34 73 -97 101 -128c45 -49 86 -72 132 -72c84 0 154 79 154 179zM465 194c-28 34 -73 97 -101 128c-45 49 -86 72 -132 72c-84 0 -154 -79 -154 -179c0 -90 54 -194 160 -194c113 0 189 105 227 173Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="779" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1224" y="0"></use>
<g transform="translate(1724,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-221E" x="550" y="513"></use>
</g>
</g>
</svg>; hence the first iteration&rsquo;s
state can be interpreted as the result of a large step in iteration 0.

</p>
<p></p>
<span class="anchor" id="fragment-MLTSamplerPrivateData-3"></span><div class="fragmentname">&lt;&lt;MLTSampler Private Data&gt;&gt;+=&nbsp;<a href="#fragment-MLTSamplerPrivateData-2"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MLTSamplerPrivateData-4"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">int64_t <span class="anchor" id="MLTSampler::lastLargeStepIteration"></span>lastLargeStepIteration = 0;</div><p>


</p>
<p>The <a href="#MLTSampler::Accept"><tt>MLTSampler::Accept()</tt></a> method is called whenever a proposal is
accepted.

</p>
<p></p>
<span class="anchor" id="fragment-MLTSamplerMethodDefinitions-3"></span><div class="fragmentname">&lt;&lt;MLTSampler Method Definitions&gt;&gt;+=&nbsp;<a href="#fragment-MLTSamplerMethodDefinitions-2"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MLTSamplerMethodDefinitions-4"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">void MLTSampler::<span class="anchor" id="MLTSampler::Accept"></span>Accept() {
    if (<a href="#MLTSampler::largeStep" class="code">largeStep</a>)
        <a href="#MLTSampler::lastLargeStepIteration" class="code">lastLargeStepIteration</a> = <a href="#MLTSampler::currentIteration" class="code">currentIteration</a>;
}</div><p>


</p>
<p>At this point, the main missing parts are <a href="#MLTSampler::EnsureReady"><tt>MLTSampler::EnsureReady()</tt></a> and
the logic that applies the actual mutations to <a href="#MLTSampler::X"><tt>MLTSampler::X</tt></a>.
Before filling in those gaps, let us take a brief step back.

</p>
<p>In theory, all entries in the <tt>X</tt> vector must be updated by small or
large mutations in every iteration of the Metropolis sampler. However, 
doing so would sometimes be rather inefficient: consider the case where most
iterations only query a small number of dimensions of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.019ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 869.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
</g>
</svg>, hence
<a href="#MLTSampler::X"><tt>MLTSampler::X</tt></a> has not grown to a large size yet. If a later iteration
makes many calls to <tt>Get1D()</tt> or <tt>Get2D()</tt>,
then the dynamic array <a href="#MLTSampler::X"><tt>MLTSampler::X</tt></a> must correspondingly expand, and
these extra entries increase the cost of every subsequent Metropolis
iteration (even if these components of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.019ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 869.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
</g>
</svg> are never referenced
again!).

</p>
<p>Instead, it&rsquo;s more efficient to update the <a href="#PrimarySample"><tt>PrimarySample</tt></a> entries on
demand&mdash;that is, when they are referenced by an actual <tt>Get1D()</tt> or
<tt>Get2D()</tt> call. Doing so avoids the aforementioned inefficiency,
though after some period of inactivity, we must carefully replay all
mutations that a given <tt>PrimarySample</tt> missed.  To keep track of this
information, an additional member variable recording the last iteration
where a <tt>PrimarySample</tt> was modified is useful.

</p>
<p></p>
<span class="anchor" id="fragment-PrimarySamplePublicData-0"></span><div class="fragmentname">&lt;&lt;PrimarySample Public Data&gt;&gt;=&nbsp;<a href="#fragment-PrimarySamplePublicData-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">int64_t <span class="anchor" id="PrimarySample::lastModificationIteration"></span>lastModificationIteration = 0;</div><p>


</p>
<p>We now have enough background to proceed to the implementation of the
<a href="#MLTSampler::EnsureReady"><tt>MLTSampler::EnsureReady()</tt></a> method, which updates individual sample values
when they are accessed.

</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-MLTSamplerMethodDefinitions-4"></span><div class="fragmentname">&lt;&lt;MLTSampler Method Definitions&gt;&gt;+=&nbsp;<a href="#fragment-MLTSamplerMethodDefinitions-3"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MLTSamplerMethodDefinitions-5"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">void MLTSampler::<span class="anchor" id="MLTSampler::EnsureReady"></span>EnsureReady(int index) {
    &lt;&lt;<span class="fragmentname"><a href="#fragment-EnlargemonoMLTSampler::XifnecessaryandgetcurrentVECX_i-0">Enlarge <tt>MLTSampler::X</tt> if necessary and get current <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.819ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 1213.8 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X Subscript i</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1229" y="-213"></use>
</g>
</svg></a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1830" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1830"><i></i></a><div id="fragbit-1830" class="collapse"><div class="fragmentcode">       if (index &gt;= <a href="#MLTSampler::X" class="code">X</a>.size())
           <a href="#MLTSampler::X" class="code">X</a>.resize(index + 1);
       PrimarySample &amp;Xi = <a href="#MLTSampler::X" class="code">X</a>[index];</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-ResetVECX_iifalargesteptookplaceinthemeantime-0">Reset <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.819ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 1213.8 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X Subscript i</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1229" y="-213"></use>
</g>
</svg> if a large step took place in the meantime</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1831" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1831"><i></i></a><div id="fragbit-1831" class="collapse"><div class="fragmentcode">       if (Xi.<a href="#PrimarySample::lastModificationIteration" class="code">lastModificationIteration</a> &lt; <a href="#MLTSampler::lastLargeStepIteration" class="code">lastLargeStepIteration</a>) {
           Xi.value = rng.<a href="../Utilities/Main_Include_File.html#RNG::UniformFloat" class="code">UniformFloat</a>();
           Xi.<a href="#PrimarySample::lastModificationIteration" class="code">lastModificationIteration</a> = <a href="#MLTSampler::lastLargeStepIteration" class="code">lastLargeStepIteration</a>;
       }</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Applyremainingsequenceofmutationstomonosample-0">Apply remaining sequence of mutations to <tt>sample</tt></a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1832" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1832"><i></i></a><div id="fragbit-1832" class="collapse"><div class="fragmentcode">       Xi.<a href="#PrimarySample::Backup" class="code">Backup</a>();
       if (<a href="#MLTSampler::largeStep" class="code">largeStep</a>) {
           Xi.<a href="#PrimarySample::value" class="code">value</a> = rng.<a href="../Utilities/Main_Include_File.html#RNG::UniformFloat" class="code">UniformFloat</a>();
       } else {
           int64_t nSmall = <a href="#MLTSampler::currentIteration" class="code">currentIteration</a> - Xi.<a href="#PrimarySample::lastModificationIteration" class="code">lastModificationIteration</a>;
           &lt;&lt;<span class="fragmentname"><a href="#fragment-ApplymononSmallsmallstepmutations-0">Apply <tt>nSmall</tt> small step mutations</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1833" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1833"><i></i></a><div id="fragbit-1833" class="collapse"><div class="fragmentcode">              &lt;&lt;<span class="fragmentname"><a href="#fragment-SamplethestandardnormaldistributionN01-0">Sample the standard normal distribution <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.216ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 3106.7 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper N left-parenthesis 0 comma 1 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D441" d="M881 672c0 -19 -12 -20 -17 -20c-80 -3 -98 -34 -108 -74l-140 -557c-5 -18 -5 -21 -16 -21c-9 0 -12 2 -19 19l-249 589c-5 10 -5 12 -9 18l-132 -528c-3 -11 -4 -16 -4 -23c0 -20 8 -42 66 -44c11 0 20 -1 20 -11c0 -20 -13 -20 -18 -20c-33 0 -69 3 -103 3 c-33 0 -68 -3 -100 -3c-8 0 -13 4 -13 11c0 19 11 20 17 20c81 3 98 35 108 75l134 537c0 9 -63 9 -68 9c-19 0 -28 0 -28 11c0 20 9 20 29 20h134c23 0 24 -1 32 -19l221 -522l112 445c1 3 3 18 3 21c0 22 -11 43 -68 44c-8 0 -18 0 -18 11c0 20 12 20 18 20 c33 0 68 -3 102 -3c33 0 68 3 101 3c13 0 13 -11 13 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D441" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="881" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="1271" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1771" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="2216" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2717" y="0"></use>
</g>
</svg></a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1834" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1834"><i></i></a><div id="fragbit-1834" class="collapse"><div class="fragmentcode">                 Float normalSample = <a href="../Utilities/Main_Include_File.html#Sqrt2" class="code">Sqrt2</a> * ErfInv(2 * <a href="../Utilities/Main_Include_File.html#RNG::UniformFloat" class="code">rng</a>.UniformFloat() - 1);</div></div>
              &lt;&lt;<span class="fragmentname"><a href="#fragment-ComputetheeffectivestandarddeviationandapplyperturbationtoVECX_i-0">Compute the effective standard deviation and apply perturbation to <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.819ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 1213.8 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X Subscript i</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1229" y="-213"></use>
</g>
</svg></a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1835" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1835"><i></i></a><div id="fragbit-1835" class="collapse"><div class="fragmentcode">                 Float effSigma = <a href="#MLTSampler::sigma" class="code">sigma</a> * std::sqrt((Float)nSmall);
                 Xi.<a href="#PrimarySample::value" class="code">value</a> += normalSample * effSigma;
                 Xi.<a href="#PrimarySample::value" class="code">value</a> -= std::floor(Xi.<a href="#PrimarySample::value" class="code">value</a>);</div></div></div></div>
       }
       Xi.<a href="#PrimarySample::lastModificationIteration" class="code">lastModificationIteration</a> = <a href="#MLTSampler::currentIteration" class="code">currentIteration</a>;</div></div>
}</div><p>


</p>
<p>

</p>
<p>First, any gaps are filled with zero-initialized <a href="#PrimarySample"><tt>PrimarySample</tt></a>s before
a reference to the requested entry is obtained.

</p>
<p></p>
<span class="anchor" id="fragment-EnlargemonoMLTSampler::XifnecessaryandgetcurrentVECX_i-0"></span><div class="fragmentname">&lt;&lt;Enlarge <tt>MLTSampler::X</tt> if necessary and get current <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.819ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 1213.8 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X Subscript i</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1229" y="-213"></use>
</g>
</svg>&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">if (index &gt;= <a href="#MLTSampler::X" class="code">X</a>.size())
    <a href="#MLTSampler::X" class="code">X</a>.resize(index + 1);
PrimarySample &amp;Xi = <a href="#MLTSampler::X" class="code">X</a>[index];</div><p>


</p>
<p>When the last modification of <tt>Xi</tt> precedes the last large step,
the current content of <tt>Xi.value</tt> is irrelevant, since it should
have been overwritten with a new uniform sample in iteration
<tt>lastLargeStepIteration</tt>. In this case, we simply replay this missed
mutation and update the last modification iteration index accordingly.

</p>
<p></p>
<span class="anchor" id="fragment-ResetVECX_iifalargesteptookplaceinthemeantime-0"></span><div class="fragmentname">&lt;&lt;Reset <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.819ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 1213.8 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X Subscript i</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1229" y="-213"></use>
</g>
</svg> if a large step took place in the meantime&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">if (Xi.<a href="#PrimarySample::lastModificationIteration" class="code">lastModificationIteration</a> &lt; <a href="#MLTSampler::lastLargeStepIteration" class="code">lastLargeStepIteration</a>) {
    Xi.value = rng.<a href="../Utilities/Main_Include_File.html#RNG::UniformFloat" class="code">UniformFloat</a>();
    Xi.<a href="#PrimarySample::lastModificationIteration" class="code">lastModificationIteration</a> = <a href="#MLTSampler::lastLargeStepIteration" class="code">lastLargeStepIteration</a>;
}</div><p>


</p>
<p>Next, a call to <tt>Backup()</tt> notifies the <tt>PrimarySample</tt> that a
mutation is going to be proposed; doing so allows it to make a copy of
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.819ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 1213.8 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X Subscript i</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1229" y="-213"></use>
</g>
</svg>&rsquo;s sample value in case the mutation is rejected.  All remaining
mutations between iterations <tt>lastLargeStepIteration</tt> and
<tt>currentIteration</tt> are then applied. Two different cases can occur:
when the current iteration is a large step, we simply initialize
<a href="#PrimarySample::value"><tt>PrimarySample::value</tt></a> with a uniform sample. Otherwise, all iterations
since the last large step are (by definition) small steps that we must
replay.

</p>
<p></p>
<span class="anchor" id="fragment-Applyremainingsequenceofmutationstomonosample-0"></span><div class="fragmentname">&lt;&lt;Apply remaining sequence of mutations to <tt>sample</tt>&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Xi.<a href="#PrimarySample::Backup" class="code">Backup</a>();
if (<a href="#MLTSampler::largeStep" class="code">largeStep</a>) {
    Xi.<a href="#PrimarySample::value" class="code">value</a> = rng.<a href="../Utilities/Main_Include_File.html#RNG::UniformFloat" class="code">UniformFloat</a>();
} else {
    int64_t nSmall = <a href="#MLTSampler::currentIteration" class="code">currentIteration</a> - Xi.<a href="#PrimarySample::lastModificationIteration" class="code">lastModificationIteration</a>;
    &lt;&lt;<span class="fragmentname"><a href="#fragment-ApplymononSmallsmallstepmutations-0">Apply <tt>nSmall</tt> small step mutations</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1836" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1836"><i></i></a><div id="fragbit-1836" class="collapse"><div class="fragmentcode">       &lt;&lt;<span class="fragmentname"><a href="#fragment-SamplethestandardnormaldistributionN01-0">Sample the standard normal distribution <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.216ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 3106.7 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper N left-parenthesis 0 comma 1 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D441" d="M881 672c0 -19 -12 -20 -17 -20c-80 -3 -98 -34 -108 -74l-140 -557c-5 -18 -5 -21 -16 -21c-9 0 -12 2 -19 19l-249 589c-5 10 -5 12 -9 18l-132 -528c-3 -11 -4 -16 -4 -23c0 -20 8 -42 66 -44c11 0 20 -1 20 -11c0 -20 -13 -20 -18 -20c-33 0 -69 3 -103 3 c-33 0 -68 -3 -100 -3c-8 0 -13 4 -13 11c0 19 11 20 17 20c81 3 98 35 108 75l134 537c0 9 -63 9 -68 9c-19 0 -28 0 -28 11c0 20 9 20 29 20h134c23 0 24 -1 32 -19l221 -522l112 445c1 3 3 18 3 21c0 22 -11 43 -68 44c-8 0 -18 0 -18 11c0 20 12 20 18 20 c33 0 68 -3 102 -3c33 0 68 3 101 3c13 0 13 -11 13 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D441" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="881" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="1271" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1771" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="2216" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2717" y="0"></use>
</g>
</svg></a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1837" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1837"><i></i></a><div id="fragbit-1837" class="collapse"><div class="fragmentcode">          Float normalSample = <a href="../Utilities/Main_Include_File.html#Sqrt2" class="code">Sqrt2</a> * ErfInv(2 * <a href="../Utilities/Main_Include_File.html#RNG::UniformFloat" class="code">rng</a>.UniformFloat() - 1);</div></div>
       &lt;&lt;<span class="fragmentname"><a href="#fragment-ComputetheeffectivestandarddeviationandapplyperturbationtoVECX_i-0">Compute the effective standard deviation and apply perturbation to <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.819ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 1213.8 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X Subscript i</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1229" y="-213"></use>
</g>
</svg></a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1838" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1838"><i></i></a><div id="fragbit-1838" class="collapse"><div class="fragmentcode">          Float effSigma = <a href="#MLTSampler::sigma" class="code">sigma</a> * std::sqrt((Float)nSmall);
          Xi.<a href="#PrimarySample::value" class="code">value</a> += normalSample * effSigma;
          Xi.<a href="#PrimarySample::value" class="code">value</a> -= std::floor(Xi.<a href="#PrimarySample::value" class="code">value</a>);</div></div></div></div>
}
Xi.<a href="#PrimarySample::lastModificationIteration" class="code">lastModificationIteration</a> = <a href="#MLTSampler::currentIteration" class="code">currentIteration</a>;</div><p>


</p>
<p>For small steps, we apply normally distributed perturbations to each
component:
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="16.746ex" height="3.176ex" style="vertical-align: -0.838ex;" viewBox="0 -1006.6 7210.1 1367.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X prime Subscript i Baseline tilde upper N left-parenthesis bold upper X Subscript i Baseline comma sigma squared right-parenthesis comma</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-223C" d="M717 354c-4 -116 -34 -183 -119 -211c-15 -4 -30 -7 -45 -7c-66 0 -130 46 -184 95c-44 39 -93 81 -146 81c-10 0 -21 -1 -31 -5c-70 -23 -109 -67 -112 -161c0 -7 -6 -12 -12 -12c-7 0 -12 5 -12 12c4 116 34 183 120 211c14 4 29 7 44 7c66 0 130 -46 184 -95 c44 -39 93 -81 146 -81c11 0 21 1 32 5c69 23 108 67 111 161c0 7 6 12 12 12c7 0 12 -5 12 -12Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D441" d="M881 672c0 -19 -12 -20 -17 -20c-80 -3 -98 -34 -108 -74l-140 -557c-5 -18 -5 -21 -16 -21c-9 0 -12 2 -19 19l-249 589c-5 10 -5 12 -9 18l-132 -528c-3 -11 -4 -16 -4 -23c0 -20 8 -42 66 -44c11 0 20 -1 20 -11c0 -20 -13 -20 -18 -20c-33 0 -69 3 -103 3 c-33 0 -68 -3 -100 -3c-8 0 -13 4 -13 11c0 19 11 20 17 20c81 3 98 35 108 75l134 537c0 9 -63 9 -68 9c-19 0 -28 0 -28 11c0 20 9 20 29 20h134c23 0 24 -1 32 -19l221 -522l112 445c1 3 3 18 3 21c0 22 -11 43 -68 44c-8 0 -18 0 -18 11c0 20 12 20 18 20 c33 0 68 -3 102 -3c33 0 68 3 101 3c13 0 13 -11 13 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D70E" d="M567 407c0 -34 -36 -34 -49 -34h-110c31 -44 31 -92 31 -109c0 -154 -133 -275 -251 -275c-91 0 -150 70 -150 158c0 119 111 284 262 284h228c18 0 39 0 39 -24zM375 276c0 31 -8 97 -92 97c-34 0 -94 -14 -136 -83c-35 -59 -47 -141 -47 -171c0 -72 40 -108 89 -108 c39 0 93 26 132 85c34 51 54 133 54 180Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="1229" y="585"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1229" y="-350"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-223C" x="1535" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D441" x="2586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="3468" y="0"></use>
<g transform="translate(3857,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1229" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="5071" y="0"></use>
<g transform="translate(5516,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D70E" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="808" y="583"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="6542" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="6931" y="0"></use>
</g>
</svg>
</div>
<p>

where <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.327ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 571.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">sigma</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D70E" d="M567 407c0 -34 -36 -34 -49 -34h-110c31 -44 31 -92 31 -109c0 -154 -133 -275 -251 -275c-91 0 -150 70 -150 158c0 119 111 284 262 284h228c18 0 39 0 39 -24zM375 276c0 31 -8 97 -92 97c-34 0 -94 -14 -136 -83c-35 -59 -47 -141 -47 -171c0 -72 40 -108 89 -108 c39 0 93 26 132 85c34 51 54 133 54 180Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D70E" x="0" y="0"></use>
</g>
</svg> is given by <a href="#MLTIntegrator::sigma"><tt>MLTIntegrator::sigma</tt></a>.
The advantage of sampling with a normal distribution like this is that it
naturally tries a variety of mutation sizes.  It preferentially makes small
mutations that remain close to the current state, which help locally explore
the path space in small areas of high contribution where large mutations would
tend to be rejected.  On the other hand, because it also can make larger
mutations, it also avoids spending too much time in a small part of the path
space in cases where larger mutations have a good likelihood of acceptance.

</p>
<p>Our implementation here merges the sequence of <tt>nSmall</tt>
perturbations into a single update and clamps the result to the unit interval,
wrapping around to the other end of the domain if necessary. Wrapping ensures
that the transition probabilities for all pairs of sample values are symmetric.

</p>
<p></p>
<span class="anchor" id="fragment-ApplymononSmallsmallstepmutations-0"></span><div class="fragmentname">&lt;&lt;Apply <tt>nSmall</tt> small step mutations&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">&lt;&lt;<span class="fragmentname"><a href="#fragment-SamplethestandardnormaldistributionN01-0">Sample the standard normal distribution <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.216ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 3106.7 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper N left-parenthesis 0 comma 1 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D441" d="M881 672c0 -19 -12 -20 -17 -20c-80 -3 -98 -34 -108 -74l-140 -557c-5 -18 -5 -21 -16 -21c-9 0 -12 2 -19 19l-249 589c-5 10 -5 12 -9 18l-132 -528c-3 -11 -4 -16 -4 -23c0 -20 8 -42 66 -44c11 0 20 -1 20 -11c0 -20 -13 -20 -18 -20c-33 0 -69 3 -103 3 c-33 0 -68 -3 -100 -3c-8 0 -13 4 -13 11c0 19 11 20 17 20c81 3 98 35 108 75l134 537c0 9 -63 9 -68 9c-19 0 -28 0 -28 11c0 20 9 20 29 20h134c23 0 24 -1 32 -19l221 -522l112 445c1 3 3 18 3 21c0 22 -11 43 -68 44c-8 0 -18 0 -18 11c0 20 12 20 18 20 c33 0 68 -3 102 -3c33 0 68 3 101 3c13 0 13 -11 13 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D441" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="881" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="1271" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1771" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="2216" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2717" y="0"></use>
</g>
</svg></a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1839" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1839"><i></i></a><div id="fragbit-1839" class="collapse"><div class="fragmentcode">   Float normalSample = <a href="../Utilities/Main_Include_File.html#Sqrt2" class="code">Sqrt2</a> * ErfInv(2 * <a href="../Utilities/Main_Include_File.html#RNG::UniformFloat" class="code">rng</a>.UniformFloat() - 1);</div></div>
&lt;&lt;<span class="fragmentname"><a href="#fragment-ComputetheeffectivestandarddeviationandapplyperturbationtoVECX_i-0">Compute the effective standard deviation and apply perturbation to <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.819ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 1213.8 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X Subscript i</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1229" y="-213"></use>
</g>
</svg></a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1840" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1840"><i></i></a><div id="fragbit-1840" class="collapse"><div class="fragmentcode">   Float effSigma = <a href="#MLTSampler::sigma" class="code">sigma</a> * std::sqrt((Float)nSmall);
   Xi.<a href="#PrimarySample::value" class="code">value</a> += normalSample * effSigma;
   Xi.<a href="#PrimarySample::value" class="code">value</a> -= std::floor(Xi.<a href="#PrimarySample::value" class="code">value</a>);</div></div></div><p>


</p>
<p>Recall the rule that when two samples from normal distributions <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.728ex" height="3.176ex" style="vertical-align: -1.005ex;" viewBox="0 -934.9 4188.5 1367.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper N left-parenthesis mu 1 comma sigma 1 squared right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D441" d="M881 672c0 -19 -12 -20 -17 -20c-80 -3 -98 -34 -108 -74l-140 -557c-5 -18 -5 -21 -16 -21c-9 0 -12 2 -19 19l-249 589c-5 10 -5 12 -9 18l-132 -528c-3 -11 -4 -16 -4 -23c0 -20 8 -42 66 -44c11 0 20 -1 20 -11c0 -20 -13 -20 -18 -20c-33 0 -69 3 -103 3 c-33 0 -68 -3 -100 -3c-8 0 -13 4 -13 11c0 19 11 20 17 20c81 3 98 35 108 75l134 537c0 9 -63 9 -68 9c-19 0 -28 0 -28 11c0 20 9 20 29 20h134c23 0 24 -1 32 -19l221 -522l112 445c1 3 3 18 3 21c0 22 -11 43 -68 44c-8 0 -18 0 -18 11c0 20 12 20 18 20 c33 0 68 -3 102 -3c33 0 68 3 101 3c13 0 13 -11 13 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D707" d="M572 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-44 0 -81 28 -90 73c-24 -28 -63 -73 -133 -73c-20 0 -65 4 -97 31c-38 -154 -51 -206 -55 -215c-2 -3 -14 -21 -35 -21c-17 0 -28 12 -28 27c0 0 0 4 3 16l144 579c9 35 37 36 40 36c17 0 29 -10 29 -27 c0 -5 -10 -43 -15 -64l-42 -168c-7 -28 -14 -56 -14 -85c0 -54 24 -87 74 -87c81 0 129 91 130 96l26 102l47 187c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104c0 -20 3 -46 30 -46 c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D70E" d="M567 407c0 -34 -36 -34 -49 -34h-110c31 -44 31 -92 31 -109c0 -154 -133 -275 -251 -275c-91 0 -150 70 -150 158c0 119 111 284 262 284h228c18 0 39 0 39 -24zM375 276c0 31 -8 97 -92 97c-34 0 -94 -14 -136 -83c-35 -59 -47 -141 -47 -171c0 -72 40 -108 89 -108 c39 0 93 26 132 85c34 51 54 133 54 180Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D441" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="881" y="0"></use>
<g transform="translate(1271,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D707" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="853" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="2328" y="0"></use>
<g transform="translate(2773,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D70E" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="808" y="488"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="808" y="-435"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="3798" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.728ex" height="3.176ex" style="vertical-align: -1.005ex;" viewBox="0 -934.9 4188.5 1367.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper N left-parenthesis mu 2 comma sigma 2 squared right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D441" d="M881 672c0 -19 -12 -20 -17 -20c-80 -3 -98 -34 -108 -74l-140 -557c-5 -18 -5 -21 -16 -21c-9 0 -12 2 -19 19l-249 589c-5 10 -5 12 -9 18l-132 -528c-3 -11 -4 -16 -4 -23c0 -20 8 -42 66 -44c11 0 20 -1 20 -11c0 -20 -13 -20 -18 -20c-33 0 -69 3 -103 3 c-33 0 -68 -3 -100 -3c-8 0 -13 4 -13 11c0 19 11 20 17 20c81 3 98 35 108 75l134 537c0 9 -63 9 -68 9c-19 0 -28 0 -28 11c0 20 9 20 29 20h134c23 0 24 -1 32 -19l221 -522l112 445c1 3 3 18 3 21c0 22 -11 43 -68 44c-8 0 -18 0 -18 11c0 20 12 20 18 20 c33 0 68 -3 102 -3c33 0 68 3 101 3c13 0 13 -11 13 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D707" d="M572 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-44 0 -81 28 -90 73c-24 -28 -63 -73 -133 -73c-20 0 -65 4 -97 31c-38 -154 -51 -206 -55 -215c-2 -3 -14 -21 -35 -21c-17 0 -28 12 -28 27c0 0 0 4 3 16l144 579c9 35 37 36 40 36c17 0 29 -10 29 -27 c0 -5 -10 -43 -15 -64l-42 -168c-7 -28 -14 -56 -14 -85c0 -54 24 -87 74 -87c81 0 129 91 130 96l26 102l47 187c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104c0 -20 3 -46 30 -46 c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D70E" d="M567 407c0 -34 -36 -34 -49 -34h-110c31 -44 31 -92 31 -109c0 -154 -133 -275 -251 -275c-91 0 -150 70 -150 158c0 119 111 284 262 284h228c18 0 39 0 39 -24zM375 276c0 31 -8 97 -92 97c-34 0 -94 -14 -136 -83c-35 -59 -47 -141 -47 -171c0 -72 40 -108 89 -108 c39 0 93 26 132 85c34 51 54 133 54 180Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D441" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="881" y="0"></use>
<g transform="translate(1271,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D707" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="853" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="2328" y="0"></use>
<g transform="translate(2773,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D70E" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="808" y="488"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="808" y="-435"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="3798" y="0"></use>
</g>
</svg> are added, the sum is also normally
distributed with parameters <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="20.246ex" height="3.176ex" style="vertical-align: -1.005ex;" viewBox="0 -934.9 8717.2 1367.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper N left-parenthesis mu 1 plus mu 2 comma sigma 1 squared plus sigma 2 squared right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D441" d="M881 672c0 -19 -12 -20 -17 -20c-80 -3 -98 -34 -108 -74l-140 -557c-5 -18 -5 -21 -16 -21c-9 0 -12 2 -19 19l-249 589c-5 10 -5 12 -9 18l-132 -528c-3 -11 -4 -16 -4 -23c0 -20 8 -42 66 -44c11 0 20 -1 20 -11c0 -20 -13 -20 -18 -20c-33 0 -69 3 -103 3 c-33 0 -68 -3 -100 -3c-8 0 -13 4 -13 11c0 19 11 20 17 20c81 3 98 35 108 75l134 537c0 9 -63 9 -68 9c-19 0 -28 0 -28 11c0 20 9 20 29 20h134c23 0 24 -1 32 -19l221 -522l112 445c1 3 3 18 3 21c0 22 -11 43 -68 44c-8 0 -18 0 -18 11c0 20 12 20 18 20 c33 0 68 -3 102 -3c33 0 68 3 101 3c13 0 13 -11 13 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D707" d="M572 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-44 0 -81 28 -90 73c-24 -28 -63 -73 -133 -73c-20 0 -65 4 -97 31c-38 -154 -51 -206 -55 -215c-2 -3 -14 -21 -35 -21c-17 0 -28 12 -28 27c0 0 0 4 3 16l144 579c9 35 37 36 40 36c17 0 29 -10 29 -27 c0 -5 -10 -43 -15 -64l-42 -168c-7 -28 -14 -56 -14 -85c0 -54 24 -87 74 -87c81 0 129 91 130 96l26 102l47 187c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104c0 -20 3 -46 30 -46 c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D70E" d="M567 407c0 -34 -36 -34 -49 -34h-110c31 -44 31 -92 31 -109c0 -154 -133 -275 -251 -275c-91 0 -150 70 -150 158c0 119 111 284 262 284h228c18 0 39 0 39 -24zM375 276c0 31 -8 97 -92 97c-34 0 -94 -14 -136 -83c-35 -59 -47 -141 -47 -171c0 -72 40 -108 89 -108 c39 0 93 26 132 85c34 51 54 133 54 180Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D441" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="881" y="0"></use>
<g transform="translate(1271,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D707" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="853" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="2550" y="0"></use>
<g transform="translate(3551,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D707" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="853" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="4608" y="0"></use>
<g transform="translate(5053,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D70E" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="808" y="488"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="808" y="-435"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="6301" y="0"></use>
<g transform="translate(7302,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D70E" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="808" y="488"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="808" y="-435"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="8327" y="0"></use>
</g>
</svg>. Thus, when
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.395ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 600.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">n</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45B" d="M571 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 11 1 23 10 46c16 43 65 171 65 233c0 33 -9 70 -54 70c-95 0 -148 -91 -163 -122l-13 -50c-5 -23 -11 -45 -17 -67l-22 -90c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43 l58 231c13 52 16 63 16 84c0 33 -11 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 4 14 63 30 97c10 18 29 57 75 57s87 -31 92 -87c17 23 66 87 156 87c72 0 115 -40 115 -107c0 -57 -42 -167 -61 -220c-9 -22 -18 -46 -18 -71 c0 -23 7 -33 24 -33c49 0 82 56 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="0" y="0"></use>
</g>
</svg> perturbations are to be applied to <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.819ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 1213.8 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X Subscript i</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1229" y="-213"></use>
</g>
</svg>, instead of performing <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.395ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 600.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">n</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45B" d="M571 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 11 1 23 10 46c16 43 65 171 65 233c0 33 -9 70 -54 70c-95 0 -148 -91 -163 -122l-13 -50c-5 -23 -11 -45 -17 -67l-22 -90c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43 l58 231c13 52 16 63 16 84c0 33 -11 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 4 14 63 30 97c10 18 29 57 75 57s87 -31 92 -87c17 23 66 87 156 87c72 0 115 -40 115 -107c0 -57 -42 -167 -61 -220c-9 -22 -18 -46 -18 -71 c0 -23 7 -33 24 -33c49 0 82 56 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="0" y="0"></use>
</g>
</svg>
perturbations in sequence, it is equivalent and more efficient to directly sample
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="eq:mlt-fast-update"></span><div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="18.141ex" height="3.176ex" style="vertical-align: -0.838ex;" viewBox="0 -1006.6 7810.6 1367.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X prime Subscript i Baseline tilde upper N left-parenthesis bold upper X Subscript i Baseline comma n sigma squared right-parenthesis comma</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-223C" d="M717 354c-4 -116 -34 -183 -119 -211c-15 -4 -30 -7 -45 -7c-66 0 -130 46 -184 95c-44 39 -93 81 -146 81c-10 0 -21 -1 -31 -5c-70 -23 -109 -67 -112 -161c0 -7 -6 -12 -12 -12c-7 0 -12 5 -12 12c4 116 34 183 120 211c14 4 29 7 44 7c66 0 130 -46 184 -95 c44 -39 93 -81 146 -81c11 0 21 1 32 5c69 23 108 67 111 161c0 7 6 12 12 12c7 0 12 -5 12 -12Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D441" d="M881 672c0 -19 -12 -20 -17 -20c-80 -3 -98 -34 -108 -74l-140 -557c-5 -18 -5 -21 -16 -21c-9 0 -12 2 -19 19l-249 589c-5 10 -5 12 -9 18l-132 -528c-3 -11 -4 -16 -4 -23c0 -20 8 -42 66 -44c11 0 20 -1 20 -11c0 -20 -13 -20 -18 -20c-33 0 -69 3 -103 3 c-33 0 -68 -3 -100 -3c-8 0 -13 4 -13 11c0 19 11 20 17 20c81 3 98 35 108 75l134 537c0 9 -63 9 -68 9c-19 0 -28 0 -28 11c0 20 9 20 29 20h134c23 0 24 -1 32 -19l221 -522l112 445c1 3 3 18 3 21c0 22 -11 43 -68 44c-8 0 -18 0 -18 11c0 20 12 20 18 20 c33 0 68 -3 102 -3c33 0 68 3 101 3c13 0 13 -11 13 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45B" d="M571 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 11 1 23 10 46c16 43 65 171 65 233c0 33 -9 70 -54 70c-95 0 -148 -91 -163 -122l-13 -50c-5 -23 -11 -45 -17 -67l-22 -90c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43 l58 231c13 52 16 63 16 84c0 33 -11 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 4 14 63 30 97c10 18 29 57 75 57s87 -31 92 -87c17 23 66 87 156 87c72 0 115 -40 115 -107c0 -57 -42 -167 -61 -220c-9 -22 -18 -46 -18 -71 c0 -23 7 -33 24 -33c49 0 82 56 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D70E" d="M567 407c0 -34 -36 -34 -49 -34h-110c31 -44 31 -92 31 -109c0 -154 -133 -275 -251 -275c-91 0 -150 70 -150 158c0 119 111 284 262 284h228c18 0 39 0 39 -24zM375 276c0 31 -8 97 -92 97c-34 0 -94 -14 -136 -83c-35 -59 -47 -141 -47 -171c0 -72 40 -108 89 -108 c39 0 93 26 132 85c34 51 54 133 54 180Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="1229" y="585"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1229" y="-350"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-223C" x="1535" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D441" x="2586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="3468" y="0"></use>
<g transform="translate(3857,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1229" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="5071" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="5516" y="0"></use>
<g transform="translate(6117,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D70E" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="808" y="583"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="7142" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="7532" y="0"></use>
</g>
</svg>
</div>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">
<div class="eqno">(<a href="#eq:mlt-fast-update">16.23</a>)</div>
</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<p>

which we do by importance sampling a standard normal distribution and scaling
the result by <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.658ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2005.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">StartRoot n EndRoot sigma</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45B" d="M571 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 11 1 23 10 46c16 43 65 171 65 233c0 33 -9 70 -54 70c-95 0 -148 -91 -163 -122l-13 -50c-5 -23 -11 -45 -17 -67l-22 -90c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43 l58 231c13 52 16 63 16 84c0 33 -11 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 4 14 63 30 97c10 18 29 57 75 57s87 -31 92 -87c17 23 66 87 156 87c72 0 115 -40 115 -107c0 -57 -42 -167 -61 -220c-9 -22 -18 -46 -18 -71 c0 -23 7 -33 24 -33c49 0 82 56 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-221A" d="M853 20c0 -5 -1 -6 -6 -17l-456 -944c-7 -15 -9 -19 -25 -19c-11 0 -13 1 -19 15l-198 435l-52 -39c-9 -8 -11 -8 -14 -8c-6 0 -10 4 -10 11c0 4 1 5 12 14l99 75c9 8 11 8 14 8c7 0 9 -6 13 -14l178 -392l423 876c6 12 9 19 21 19s20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D70E" d="M567 407c0 -34 -36 -34 -49 -34h-110c31 -44 31 -92 31 -109c0 -154 -133 -275 -251 -275c-91 0 -150 70 -150 158c0 119 111 284 262 284h228c18 0 39 0 39 -24zM375 276c0 31 -8 97 -92 97c-34 0 -94 -14 -136 -83c-35 -59 -47 -141 -47 -171c0 -72 40 -108 89 -108 c39 0 93 26 132 85c34 51 54 133 54 180Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-221A" x="0" y="681"></use>
<rect stroke="none" width="600" height="60" x="833" y="662"></rect>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="833" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D70E" x="1434" y="0"></use>
</g>
</svg>. Applying the inversion method to the PDF 
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="18.698ex" height="6.176ex" style="vertical-align: -2.838ex; margin-left: -0.073ex;" viewBox="-31.5 -1437.2 8050.7 2659.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">p left-parenthesis x right-parenthesis equals StartFraction 1 Over StartRoot 2 pi EndRoot EndFraction normal e Superscript minus x squared slash 2</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45D" d="M490 282c0 -147 -125 -293 -241 -293c-51 0 -79 35 -92 64c-7 -25 -49 -188 -49 -200c0 -9 0 -16 50 -16c14 0 24 0 24 -11c0 -20 -13 -20 -18 -20c-32 0 -66 3 -99 3c-28 0 -57 -3 -84 -3c-8 0 -13 4 -13 12c0 19 11 19 23 19c44 0 46 7 54 41l112 445c4 17 7 28 7 51 c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c37 0 80 -21 90 -75c33 39 81 75 131 75c76 0 133 -66 133 -160zM418 326c0 59 -24 94 -64 94c-17 0 -46 -7 -81 -38c-18 -15 -45 -43 -52 -70 l-49 -196c-3 -12 -3 -16 -3 -16c0 -6 13 -89 79 -89c37 0 85 33 119 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D70B" d="M567 407c0 -34 -36 -34 -49 -34h-114c-11 -52 -18 -106 -18 -159c0 -28 0 -93 29 -165c6 -14 6 -16 6 -22c0 -20 -21 -38 -41 -38c-15 0 -26 6 -36 50c-8 34 -8 61 -8 76c0 67 9 110 42 258h-113l-56 -221c-13 -50 -13 -52 -27 -98c-12 -37 -20 -65 -50 -65 c-13 0 -29 8 -29 27c0 7 0 9 8 24c42 91 96 212 128 333h-57c-20 0 -78 0 -127 -77c-6 -8 -8 -12 -16 -12c-12 0 -12 10 -12 10c0 5 26 51 61 90c44 47 82 47 104 47h335c19 0 40 0 40 -24Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-221A" d="M853 20c0 -5 -1 -6 -6 -17l-456 -944c-7 -15 -9 -19 -25 -19c-11 0 -13 1 -19 15l-198 435l-52 -39c-9 -8 -11 -8 -14 -8c-6 0 -10 4 -10 11c0 4 1 5 12 14l99 75c9 8 11 8 14 8c7 0 9 -6 13 -14l178 -392l423 876c6 12 9 19 21 19s20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-65" d="M415 119c0 -19 -45 -130 -167 -130c-115 0 -220 97 -220 231c0 125 92 228 208 228c125 0 179 -97 179 -196c0 -21 -3 -21 -25 -21h-279c0 -36 0 -102 30 -150c23 -37 63 -67 113 -67c10 0 100 0 135 103c2 8 4 14 13 14c5 0 13 -2 13 -12zM349 252 c0 39 -10 174 -113 174c-34 0 -118 -25 -124 -174h237Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45D" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="503" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="893" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1465" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="2132" y="0"></use>
<g transform="translate(2911,0)">
<g transform="translate(397,0)">
<rect stroke="none" width="2024" height="60" x="0" y="220"></rect>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="762" y="676"></use>
<g transform="translate(60,-915)">
 <use xlink:href="#E1-LATINMODERNMAIN-221A" x="0" y="793"></use>
<rect stroke="none" width="1071" height="60" x="833" y="774"></rect>
<g transform="translate(833,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D70B" x="500" y="0"></use>
</g>
</g>
</g>
</g>
<g transform="translate(5453,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-65" x="0" y="0"></use>
<g transform="translate(444,412)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2212" x="0" y="0"></use>
<g transform="translate(550,0)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.574)" xlink:href="#E1-LATINMODERNMAIN-32" x="705" y="446"></use>
</g>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2F" x="1857" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="2357" y="0"></use>
</g>
</g>
</g>
</svg>
</div>
<p>

gives the following sampling method for a uniform sample <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.788ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 3783.7 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">xi element-of left-bracket 0 comma 1 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D709" d="M446 592c0 -31 -64 -31 -89 -31c-23 0 -46 0 -64 22c-75 -37 -111 -114 -111 -170c0 -19 4 -52 30 -78c37 12 66 12 84 12c39 0 82 -2 82 -27c0 -31 -63 -31 -93 -31c-21 0 -51 0 -88 13c-84 -42 -123 -129 -123 -170c0 -42 30 -71 75 -89l60 -24c21 -7 41 -15 61 -23 l61 -23c11 -5 48 -23 48 -71c0 -49 -42 -107 -104 -107c-56 0 -109 36 -109 48c0 4 2 11 10 11c4 0 5 -1 11 -5c11 -8 44 -32 88 -32c31 0 49 30 49 53c0 29 -20 36 -35 43c-59 23 -61 23 -121 47c-75 28 -84 32 -116 65c-2 3 -29 31 -29 79c0 36 22 130 131 202l13 10 c-47 27 -65 69 -65 106c0 77 68 157 175 187c-1 4 -7 19 -7 39c0 3 0 49 18 49c7 0 12 -5 12 -13c0 0 -5 -23 -5 -37c0 -17 2 -24 5 -33c26 5 50 5 63 5c39 0 83 -1 83 -27zM420 591c-18 5 -22 6 -56 6c-11 0 -32 0 -48 -5c11 -9 23 -9 42 -9c44 0 54 5 62 8zM352 319 c-18 5 -22 6 -57 6c-12 0 -34 0 -57 -6c18 -8 27 -8 50 -8c46 0 56 4 64 8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2208" d="M587 -23c0 -11 -9 -20 -20 -20h-193c-162 0 -293 131 -293 293s131 293 293 293h193c11 0 20 -9 20 -20s-9 -20 -20 -20h-193c-133 0 -242 -103 -252 -233h445c27 0 27 -40 0 -40h-445c10 -130 119 -233 252 -233h193c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D709" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2208" x="724" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="1669" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="1948" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="2448" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="2893" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="3394" y="0"></use>
</g>
</svg>:
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="27.779ex" height="3.176ex" style="vertical-align: -0.838ex;" viewBox="0 -1006.6 11960.3 1367.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper P Superscript negative 1 Baseline left-parenthesis xi right-parenthesis equals StartRoot 2 EndRoot normal e normal r normal f Superscript negative 1 Baseline left-parenthesis 2 xi minus 1 right-parenthesis comma</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D443" d="M754 532c0 -112 -139 -216 -281 -216h-170l-62 -250c-1 -6 -3 -11 -3 -17c0 -18 28 -18 65 -18c19 0 28 0 28 -11c0 -20 -13 -20 -20 -20c-21 0 -43 2 -65 2l-64 1l-127 -3c-3 0 -15 0 -15 12c0 19 11 19 28 19c79 0 81 8 91 47l134 537c3 12 4 15 4 19 c0 11 -6 14 -22 16c-12 1 -30 2 -43 2c-20 0 -29 0 -29 12c0 19 11 19 30 19h324c131 0 197 -74 197 -151zM661 556c0 69 -53 96 -136 96h-96c-43 0 -45 -3 -54 -38l-68 -272h141c44 0 104 8 154 53c39 36 59 122 59 161Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D709" d="M446 592c0 -31 -64 -31 -89 -31c-23 0 -46 0 -64 22c-75 -37 -111 -114 -111 -170c0 -19 4 -52 30 -78c37 12 66 12 84 12c39 0 82 -2 82 -27c0 -31 -63 -31 -93 -31c-21 0 -51 0 -88 13c-84 -42 -123 -129 -123 -170c0 -42 30 -71 75 -89l60 -24c21 -7 41 -15 61 -23 l61 -23c11 -5 48 -23 48 -71c0 -49 -42 -107 -104 -107c-56 0 -109 36 -109 48c0 4 2 11 10 11c4 0 5 -1 11 -5c11 -8 44 -32 88 -32c31 0 49 30 49 53c0 29 -20 36 -35 43c-59 23 -61 23 -121 47c-75 28 -84 32 -116 65c-2 3 -29 31 -29 79c0 36 22 130 131 202l13 10 c-47 27 -65 69 -65 106c0 77 68 157 175 187c-1 4 -7 19 -7 39c0 3 0 49 18 49c7 0 12 -5 12 -13c0 0 -5 -23 -5 -37c0 -17 2 -24 5 -33c26 5 50 5 63 5c39 0 83 -1 83 -27zM420 591c-18 5 -22 6 -56 6c-11 0 -32 0 -48 -5c11 -9 23 -9 42 -9c44 0 54 5 62 8zM352 319 c-18 5 -22 6 -57 6c-12 0 -34 0 -57 -6c18 -8 27 -8 50 -8c46 0 56 4 64 8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-221A" d="M853 20c0 -5 -1 -6 -6 -17l-456 -944c-7 -15 -9 -19 -25 -19c-11 0 -13 1 -19 15l-198 435l-52 -39c-9 -8 -11 -8 -14 -8c-6 0 -10 4 -10 11c0 4 1 5 12 14l99 75c9 8 11 8 14 8c7 0 9 -6 13 -14l178 -392l423 876c6 12 9 19 21 19s20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-65" d="M415 119c0 -19 -45 -130 -167 -130c-115 0 -220 97 -220 231c0 125 92 228 208 228c125 0 179 -97 179 -196c0 -21 -3 -21 -25 -21h-279c0 -36 0 -102 30 -150c23 -37 63 -67 113 -67c10 0 100 0 135 103c2 8 4 14 13 14c5 0 13 -2 13 -12zM349 252 c0 39 -10 174 -113 174c-34 0 -118 -25 -124 -174h237Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-72" d="M364 381c0 -32 -25 -44 -43 -44c-22 0 -43 15 -43 43c0 26 20 38 23 39c-2 1 -4 1 -11 1c-76 0 -118 -89 -118 -188v-154c0 -36 2 -47 76 -47h21v-31c-40 3 -87 3 -127 3l-114 -3v31c67 0 78 0 78 45v268c0 49 -8 56 -78 56v31l139 11v-110c14 43 50 110 123 110 c43 0 74 -29 74 -61Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-66" d="M357 635c0 -24 -15 -44 -44 -44c-27 0 -43 20 -43 43c0 25 18 38 30 42c-15 7 -30 7 -33 7c-44 0 -92 -48 -92 -136v-116h117v-31h-114v-322c0 -36 2 -47 76 -47h21v-31c-40 3 -87 3 -127 3l-114 -3v31c67 0 78 0 78 45v324h-79v31h79v115c0 106 85 159 155 159 c53 0 90 -33 90 -70Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D443" x="0" y="0"></use>
<g transform="translate(788,412)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2212" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="778" y="0"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1792" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D709" x="2182" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2628" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="3295" y="0"></use>
<g transform="translate(4352,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-221A" x="0" y="769"></use>
<rect stroke="none" width="500" height="60" x="833" y="750"></rect>
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="833" y="0"></use>
</g>
<g transform="translate(6018,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-65" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-72" x="444" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-66" x="837" y="0"></use>
<g transform="translate(1209,432)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2212" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="778" y="0"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="8232" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="8621" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D709" x="9122" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="9791" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="10791" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="11292" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="11681" y="0"></use>
</g>
</svg>
</div>
<p>

where <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.774ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 1194.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal e normal r normal f</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-65" d="M415 119c0 -19 -45 -130 -167 -130c-115 0 -220 97 -220 231c0 125 92 228 208 228c125 0 179 -97 179 -196c0 -21 -3 -21 -25 -21h-279c0 -36 0 -102 30 -150c23 -37 63 -67 113 -67c10 0 100 0 135 103c2 8 4 14 13 14c5 0 13 -2 13 -12zM349 252 c0 39 -10 174 -113 174c-34 0 -118 -25 -124 -174h237Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-72" d="M364 381c0 -32 -25 -44 -43 -44c-22 0 -43 15 -43 43c0 26 20 38 23 39c-2 1 -4 1 -11 1c-76 0 -118 -89 -118 -188v-154c0 -36 2 -47 76 -47h21v-31c-40 3 -87 3 -127 3l-114 -3v31c67 0 78 0 78 45v268c0 49 -8 56 -78 56v31l139 11v-110c14 43 50 110 123 110 c43 0 74 -29 74 -61Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-66" d="M357 635c0 -24 -15 -44 -44 -44c-27 0 -43 20 -43 43c0 25 18 38 30 42c-15 7 -30 7 -33 7c-44 0 -92 -48 -92 -136v-116h117v-31h-114v-322c0 -36 2 -47 76 -47h21v-31c-40 3 -87 3 -127 3l-114 -3v31c67 0 78 0 78 45v324h-79v31h79v115c0 106 85 159 155 159 c53 0 90 -33 90 -70Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-65" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-72" x="444" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-66" x="837" y="0"></use>
</g>
</svg> is the error function, <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="26.472ex" height="3.509ex" style="vertical-align: -1.005ex;" viewBox="0 -1078.4 11397.6 1510.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal e normal r normal f left-parenthesis x right-parenthesis equals 2 slash StartRoot pi EndRoot integral Subscript 0 Superscript x Baseline normal e Superscript minus x Super Superscript prime 2 Baseline normal d x Superscript prime Baseline</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-65" d="M415 119c0 -19 -45 -130 -167 -130c-115 0 -220 97 -220 231c0 125 92 228 208 228c125 0 179 -97 179 -196c0 -21 -3 -21 -25 -21h-279c0 -36 0 -102 30 -150c23 -37 63 -67 113 -67c10 0 100 0 135 103c2 8 4 14 13 14c5 0 13 -2 13 -12zM349 252 c0 39 -10 174 -113 174c-34 0 -118 -25 -124 -174h237Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-72" d="M364 381c0 -32 -25 -44 -43 -44c-22 0 -43 15 -43 43c0 26 20 38 23 39c-2 1 -4 1 -11 1c-76 0 -118 -89 -118 -188v-154c0 -36 2 -47 76 -47h21v-31c-40 3 -87 3 -127 3l-114 -3v31c67 0 78 0 78 45v268c0 49 -8 56 -78 56v31l139 11v-110c14 43 50 110 123 110 c43 0 74 -29 74 -61Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-66" d="M357 635c0 -24 -15 -44 -44 -44c-27 0 -43 20 -43 43c0 25 18 38 30 42c-15 7 -30 7 -33 7c-44 0 -92 -48 -92 -136v-116h117v-31h-114v-322c0 -36 2 -47 76 -47h21v-31c-40 3 -87 3 -127 3l-114 -3v31c67 0 78 0 78 45v324h-79v31h79v115c0 106 85 159 155 159 c53 0 90 -33 90 -70Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D70B" d="M567 407c0 -34 -36 -34 -49 -34h-114c-11 -52 -18 -106 -18 -159c0 -28 0 -93 29 -165c6 -14 6 -16 6 -22c0 -20 -21 -38 -41 -38c-15 0 -26 6 -36 50c-8 34 -8 61 -8 76c0 67 9 110 42 258h-113l-56 -221c-13 -50 -13 -52 -27 -98c-12 -37 -20 -65 -50 -65 c-13 0 -29 8 -29 27c0 7 0 9 8 24c42 91 96 212 128 333h-57c-20 0 -78 0 -127 -77c-6 -8 -8 -12 -16 -12c-12 0 -12 10 -12 10c0 5 26 51 61 90c44 47 82 47 104 47h335c19 0 40 0 40 -24Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-221A" d="M853 20c0 -5 -1 -6 -6 -17l-456 -944c-7 -15 -9 -19 -25 -19c-11 0 -13 1 -19 15l-198 435l-52 -39c-9 -8 -11 -8 -14 -8c-6 0 -10 4 -10 11c0 4 1 5 12 14l99 75c9 8 11 8 14 8c7 0 9 -6 13 -14l178 -392l423 876c6 12 9 19 21 19s20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-222B" d="M609 722c0 -30 -22 -43 -42 -43c-19 0 -41 13 -41 42c0 14 8 37 37 41c-22 19 -53 21 -63 21c-45 0 -79 -25 -93 -209l-19 -249c-8 -111 -44 -402 -57 -454c-22 -90 -70 -177 -165 -177c-60 0 -110 35 -110 83c0 30 22 43 42 43c19 0 41 -13 41 -42c0 -14 -8 -37 -37 -41 c21 -18 51 -21 64 -21c57 0 93 45 106 209l19 249c9 121 45 403 57 458c17 76 56 173 151 173c60 0 110 -35 110 -83Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-64" d="M527 0l-147 -11v66c-25 -32 -70 -66 -134 -66c-114 0 -212 99 -212 226c0 129 105 227 223 227c54 0 97 -26 126 -62v216c0 49 -8 56 -78 56v31l144 11v-607c0 -49 8 -56 78 -56v-31zM380 118v205c0 18 0 20 -11 37c-31 45 -73 60 -108 60c-54 0 -92 -33 -113 -64 c-29 -45 -31 -105 -31 -142c0 -41 3 -98 29 -139c24 -38 60 -64 105 -64c43 0 88 22 118 70c11 17 11 19 11 37Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-65" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-72" x="444" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-66" x="837" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1194" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="1584" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2156" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="2823" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="3880" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="4380" y="0"></use>
<g transform="translate(4881,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-221A" x="0" y="676"></use>
<rect stroke="none" width="570" height="60" x="833" y="657"></rect>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D70B" x="833" y="0"></use>
</g>
<g transform="translate(6451,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-222B" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D465" x="941" y="754"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-30" x="941" y="-484"></use>
</g>
<g transform="translate(7788,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-65" x="0" y="0"></use>
<g transform="translate(444,362)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2212" x="0" y="0"></use>
<g transform="translate(550,0)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
<g transform="translate(404,256)">
 <use transform="scale(0.574)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="0" y="0"></use>
 <use transform="scale(0.574)" xlink:href="#E1-LATINMODERNMAIN-32" x="407" y="0"></use>
</g>
</g>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-64" x="9880" y="0"></use>
<g transform="translate(10436,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="809" y="513"></use>
</g>
</g>
</svg>, and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.143ex" height="2.676ex" style="vertical-align: -0.338ex;" viewBox="0 -1006.6 2214.2 1152.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal e normal r normal f Superscript negative 1</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-65" d="M415 119c0 -19 -45 -130 -167 -130c-115 0 -220 97 -220 231c0 125 92 228 208 228c125 0 179 -97 179 -196c0 -21 -3 -21 -25 -21h-279c0 -36 0 -102 30 -150c23 -37 63 -67 113 -67c10 0 100 0 135 103c2 8 4 14 13 14c5 0 13 -2 13 -12zM349 252 c0 39 -10 174 -113 174c-34 0 -118 -25 -124 -174h237Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-72" d="M364 381c0 -32 -25 -44 -43 -44c-22 0 -43 15 -43 43c0 26 20 38 23 39c-2 1 -4 1 -11 1c-76 0 -118 -89 -118 -188v-154c0 -36 2 -47 76 -47h21v-31c-40 3 -87 3 -127 3l-114 -3v31c67 0 78 0 78 45v268c0 49 -8 56 -78 56v31l139 11v-110c14 43 50 110 123 110 c43 0 74 -29 74 -61Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-66" d="M357 635c0 -24 -15 -44 -44 -44c-27 0 -43 20 -43 43c0 25 18 38 30 42c-15 7 -30 7 -33 7c-44 0 -92 -48 -92 -136v-116h117v-31h-114v-322c0 -36 2 -47 76 -47h21v-31c-40 3 -87 3 -127 3l-114 -3v31c67 0 78 0 78 45v324h-79v31h79v115c0 106 85 159 155 159 c53 0 90 -33 90 -70Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-65" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-72" x="444" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-66" x="837" y="0"></use>
<g transform="translate(1209,432)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2212" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="778" y="0"></use>
</g>
</g>
</svg> is its inverse.
The <tt>ErfInv()</tt> function, not included here, approximates
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.143ex" height="2.676ex" style="vertical-align: -0.338ex;" viewBox="0 -1006.6 2214.2 1152.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal e normal r normal f Superscript negative 1</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-65" d="M415 119c0 -19 -45 -130 -167 -130c-115 0 -220 97 -220 231c0 125 92 228 208 228c125 0 179 -97 179 -196c0 -21 -3 -21 -25 -21h-279c0 -36 0 -102 30 -150c23 -37 63 -67 113 -67c10 0 100 0 135 103c2 8 4 14 13 14c5 0 13 -2 13 -12zM349 252 c0 39 -10 174 -113 174c-34 0 -118 -25 -124 -174h237Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-72" d="M364 381c0 -32 -25 -44 -43 -44c-22 0 -43 15 -43 43c0 26 20 38 23 39c-2 1 -4 1 -11 1c-76 0 -118 -89 -118 -188v-154c0 -36 2 -47 76 -47h21v-31c-40 3 -87 3 -127 3l-114 -3v31c67 0 78 0 78 45v268c0 49 -8 56 -78 56v31l139 11v-110c14 43 50 110 123 110 c43 0 74 -29 74 -61Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-66" d="M357 635c0 -24 -15 -44 -44 -44c-27 0 -43 20 -43 43c0 25 18 38 30 42c-15 7 -30 7 -33 7c-44 0 -92 -48 -92 -136v-116h117v-31h-114v-322c0 -36 2 -47 76 -47h21v-31c-40 3 -87 3 -127 3l-114 -3v31c67 0 78 0 78 45v324h-79v31h79v115c0 106 85 159 155 159 c53 0 90 -33 90 -70Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-65" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-72" x="444" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-66" x="837" y="0"></use>
<g transform="translate(1209,432)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2212" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="778" y="0"></use>
</g>
</g>
</svg> with a polynomial.

</p>
<p></p>
<span class="anchor" id="fragment-SamplethestandardnormaldistributionN01-0"></span><div class="fragmentname">&lt;&lt;Sample the standard normal distribution <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.216ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 3106.7 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper N left-parenthesis 0 comma 1 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D441" d="M881 672c0 -19 -12 -20 -17 -20c-80 -3 -98 -34 -108 -74l-140 -557c-5 -18 -5 -21 -16 -21c-9 0 -12 2 -19 19l-249 589c-5 10 -5 12 -9 18l-132 -528c-3 -11 -4 -16 -4 -23c0 -20 8 -42 66 -44c11 0 20 -1 20 -11c0 -20 -13 -20 -18 -20c-33 0 -69 3 -103 3 c-33 0 -68 -3 -100 -3c-8 0 -13 4 -13 11c0 19 11 20 17 20c81 3 98 35 108 75l134 537c0 9 -63 9 -68 9c-19 0 -28 0 -28 11c0 20 9 20 29 20h134c23 0 24 -1 32 -19l221 -522l112 445c1 3 3 18 3 21c0 22 -11 43 -68 44c-8 0 -18 0 -18 11c0 20 12 20 18 20 c33 0 68 -3 102 -3c33 0 68 3 101 3c13 0 13 -11 13 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D441" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="881" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="1271" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1771" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="2216" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2717" y="0"></use>
</g>
</svg>&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Float normalSample = <a href="../Utilities/Main_Include_File.html#Sqrt2" class="code">Sqrt2</a> * ErfInv(2 * <a href="../Utilities/Main_Include_File.html#RNG::UniformFloat" class="code">rng</a>.UniformFloat() - 1);</div><p>


</p>
<p>We scale the resulting sample by the effective variance from
Equation&nbsp;(<a href="#eq:mlt-fast-update">16.23</a>) and use it to perturb the sample
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.819ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 1213.8 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X Subscript i</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1229" y="-213"></use>
</g>
</svg> before keeping only its fractional component, so that it
remains in <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.91ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2114.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket 0 comma 1 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="779" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1224" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1724" y="0"></use>
</g>
</svg>.

</p>
<p></p>
<span class="anchor" id="fragment-ComputetheeffectivestandarddeviationandapplyperturbationtoVECX_i-0"></span><div class="fragmentname">&lt;&lt;Compute the effective standard deviation and apply perturbation to <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.819ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 1213.8 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X Subscript i</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1229" y="-213"></use>
</g>
</svg>&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Float effSigma = <a href="#MLTSampler::sigma" class="code">sigma</a> * std::sqrt((Float)nSmall);
Xi.<a href="#PrimarySample::value" class="code">value</a> += normalSample * effSigma;
Xi.<a href="#PrimarySample::value" class="code">value</a> -= std::floor(Xi.<a href="#PrimarySample::value" class="code">value</a>);</div><p>


</p>
<p><a href="#MLTSampler::Reject"><tt>MLTSampler::Reject()</tt></a> must be called whenever a proposed mutation is
rejected. It restores all <a href="#PrimarySample"><tt>PrimarySample</tt></a>s modified in the current
iteration and reverts the iteration counter.

</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-MLTSamplerMethodDefinitions-5"></span><div class="fragmentname">&lt;&lt;MLTSampler Method Definitions&gt;&gt;+=&nbsp;<a href="#fragment-MLTSamplerMethodDefinitions-4"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MLTSamplerMethodDefinitions-6"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">void MLTSampler::<span class="anchor" id="MLTSampler::Reject"></span>Reject() {
    for (auto &amp;Xi : <a href="#MLTSampler::X" class="code">X</a>)
        if (Xi.<a href="#PrimarySample::lastModificationIteration" class="code">lastModificationIteration</a> == <a href="#MLTSampler::currentIteration" class="code">currentIteration</a>)
            Xi.<a href="#PrimarySample::Restore" class="code">Restore</a>();
    --<a href="#MLTSampler::currentIteration" class="code">currentIteration</a>;
}</div><p>


</p>
<p>The <tt>Backup()</tt> and <tt>Restore()</tt> methods make it possible to record
the value of a <a href="#PrimarySample"><tt>PrimarySample</tt></a> before a mutation and to restore it if
the mutation is rejected.

</p>
<p></p>
<span class="anchor" id="fragment-PrimarySamplePublicMethods-0"></span><div class="fragmentname">&lt;&lt;PrimarySample Public Methods&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">void <span class="anchor" id="PrimarySample::Backup"></span>Backup() {
    <a href="#PrimarySample::valueBackup" class="code">valueBackup</a> = <a href="#PrimarySample::value" class="code">value</a>;
    <a href="#PrimarySample::modifyBackup" class="code">modifyBackup</a> = <a href="#PrimarySample::lastModificationIteration" class="code">lastModificationIteration</a>;
}
void <span class="anchor" id="PrimarySample::Restore"></span>Restore() {
    <a href="#PrimarySample::value" class="code">value</a> = <a href="#PrimarySample::valueBackup" class="code">valueBackup</a>;
    <a href="#PrimarySample::lastModificationIteration" class="code">lastModificationIteration</a> = <a href="#PrimarySample::modifyBackup" class="code">modifyBackup</a>;
}</div><p>


</p>
<p></p>
<span class="anchor" id="fragment-PrimarySamplePublicData-1"></span><div class="fragmentname">&lt;&lt;PrimarySample Public Data&gt;&gt;+=&nbsp;<a href="#fragment-PrimarySamplePublicData-0"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">Float <span class="anchor" id="PrimarySample::valueBackup"></span>valueBackup = 0;
int64_t <span class="anchor" id="PrimarySample::modifyBackup"></span>modifyBackup = 0;</div><p>


</p>
<p>Before wrapping up <a href="#MLTSampler"><tt>MLTSampler</tt></a>, we must address a detail that would
otherwise cause issues when the sampler is used with BDPT. For each pixel
sample, the <a href="../Light_Transport_III_Bidirectional_Methods/Bidirectional_Path_Tracing.html#BDPTIntegrator"><tt>BDPTIntegrator</tt></a> implementation calls
<a href="../Light_Transport_III_Bidirectional_Methods/Bidirectional_Path_Tracing.html#GenerateCameraSubpath"><tt>GenerateCameraSubpath()</tt></a> and <a href="../Light_Transport_III_Bidirectional_Methods/Bidirectional_Path_Tracing.html#GenerateLightSubpath"><tt>GenerateLightSubpath()</tt></a> in sequence
to generate a pair of subpaths, each function requesting 1D and 2D samples
from a supplied <a href="../Sampling_and_Reconstruction/Sampling_Interface.html#Sampler"><tt>Sampler</tt></a> as needed.

</p>
<p>In the context of MLT, the resulting sequence of sample requests creates a
mapping between components of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.019ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 869.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
</g>
</svg> and vertices on the camera or light
subpath. With the process described above, the components <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.712ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 4612 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X 0 comma ellipsis comma bold upper X Subscript n Baseline</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2026" d="M193 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53zM472 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53zM751 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45B" d="M571 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 11 1 23 10 46c16 43 65 171 65 233c0 33 -9 70 -54 70c-95 0 -148 -91 -163 -122l-13 -50c-5 -23 -11 -45 -17 -67l-22 -90c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43 l58 231c13 52 16 63 16 84c0 33 -11 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 4 14 63 30 97c10 18 29 57 75 57s87 -31 92 -87c17 23 66 87 156 87c72 0 115 -40 115 -107c0 -57 -42 -167 -61 -220c-9 -22 -18 -46 -18 -71 c0 -23 7 -33 24 -33c49 0 82 56 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-30" x="1229" y="-213"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1323" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2026" x="1768" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="2772" y="0"></use>
<g transform="translate(3217,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="1229" y="-213"></use>
</g>
</g>
</svg> determine the camera subpath (for some
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.869ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 2527.1 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">n element-of bold upper Z Superscript</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45B" d="M571 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 11 1 23 10 46c16 43 65 171 65 233c0 33 -9 70 -54 70c-95 0 -148 -91 -163 -122l-13 -50c-5 -23 -11 -45 -17 -67l-22 -90c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43 l58 231c13 52 16 63 16 84c0 33 -11 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 4 14 63 30 97c10 18 29 57 75 57s87 -31 92 -87c17 23 66 87 156 87c72 0 115 -40 115 -107c0 -57 -42 -167 -61 -220c-9 -22 -18 -46 -18 -71 c0 -23 7 -33 24 -33c49 0 82 56 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2208" d="M587 -23c0 -11 -9 -20 -20 -20h-193c-162 0 -293 131 -293 293s131 293 293 293h193c11 0 20 -9 20 -20s-9 -20 -20 -20h-193c-133 0 -242 -103 -252 -233h445c27 0 27 -40 0 -40h-445c10 -130 119 -233 252 -233h193c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D419" d="M645 284l-18 -284h-531c-22 0 -32 0 -32 26c0 11 0 14 8 26l400 587h-130c-140 0 -207 -61 -215 -194h-47l12 241h514c21 0 32 0 32 -25c0 -11 0 -12 -8 -24l-399 -586h140c205 0 219 122 227 233h47Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2208" x="878" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D419" x="1823" y="0"></use>
</g>
</svg>), and the remaining values <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="13.433ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 5783.7 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X Subscript n plus 1 Baseline comma ellipsis comma bold upper X Subscript m Baseline</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45B" d="M571 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 11 1 23 10 46c16 43 65 171 65 233c0 33 -9 70 -54 70c-95 0 -148 -91 -163 -122l-13 -50c-5 -23 -11 -45 -17 -67l-22 -90c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43 l58 231c13 52 16 63 16 84c0 33 -11 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 4 14 63 30 97c10 18 29 57 75 57s87 -31 92 -87c17 23 66 87 156 87c72 0 115 -40 115 -107c0 -57 -42 -167 -61 -220c-9 -22 -18 -46 -18 -71 c0 -23 7 -33 24 -33c49 0 82 56 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2026" d="M193 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53zM472 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53zM751 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45A" d="M848 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 20 4 31 13 55c20 53 62 167 62 224c0 36 -11 70 -54 70c-109 0 -162 -120 -165 -133l-60 -241c-8 -32 -14 -57 -45 -57c-15 0 -29 9 -29 27c0 5 9 39 13 59c9 33 10 39 20 76l28 116c8 30 15 58 15 83 c0 33 -9 70 -54 70c-95 0 -148 -91 -163 -122l-13 -50c-5 -23 -11 -45 -17 -67l-22 -90c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43l58 231c13 52 16 63 16 84c0 38 -15 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23 c0 0 -12 0 -12 10c0 3 13 62 31 97c9 18 28 57 74 57c45 0 87 -30 92 -87c17 23 66 87 156 87c25 0 57 -5 82 -26c28 -24 31 -58 32 -71c37 53 88 97 163 97s115 -42 115 -107c0 -57 -42 -168 -61 -220c-9 -22 -18 -46 -18 -71c0 -23 7 -33 24 -33c55 0 87 71 102 124 c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
<g transform="translate(869,-150)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2B" x="600" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="1379" y="0"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="2298" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2026" x="2743" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="3747" y="0"></use>
<g transform="translate(4193,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45A" x="1229" y="-213"></use>
</g>
</g>
</svg> determine the light subpath. If the camera subpath requires a
different number of samples after a perturbation (e.g., because the random
walk produced fewer vertices), then there is a shift in the assignment of
primary sample space components to the light subpath. This leads to an
unintended large-scale modification to the light path.

</p>
<p>It is easy to avoid this problem with a more careful indexing scheme: the
<a href="#MLTSampler"><tt>MLTSampler</tt></a> partitions <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.019ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 869.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
</g>
</svg> into multiple interleaved streams
that cannot interfere with each other.
The <a href="#MLTSampler::StartStream"><tt>MLTSampler::StartStream()</tt></a> method indicates that subsequent
samples should come from the stream with the given index.  It also resets
<tt>sampleIndex</tt>, the index of the current sample in the stream.  (The
number of such streams, <a href="#MLTSampler::streamCount"><tt>MLTSampler::streamCount</tt></a>, is specified in the
<a href="#MLTSampler"><tt>MLTSampler</tt></a> constructor.)

</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-MLTSamplerMethodDefinitions-6"></span><div class="fragmentname">&lt;&lt;MLTSampler Method Definitions&gt;&gt;+=&nbsp;<a href="#fragment-MLTSamplerMethodDefinitions-5"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">void MLTSampler::<span class="anchor" id="MLTSampler::StartStream"></span>StartStream(int index) {
    <a href="#MLTSampler::streamIndex" class="code">streamIndex</a> = index;
    <a href="#MLTSampler::sampleIndex" class="code">sampleIndex</a> = 0;
}</div><p>


</p>
<p></p>
<span class="anchor" id="fragment-MLTSamplerPrivateData-4"></span><div class="fragmentname">&lt;&lt;MLTSampler Private Data&gt;&gt;+=&nbsp;<a href="#fragment-MLTSamplerPrivateData-3"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">int <span class="anchor" id="MLTSampler::streamIndex"></span>streamIndex, <span class="anchor" id="MLTSampler::sampleIndex"></span>sampleIndex;</div><p>


</p>
<p>After the stream is selected, the <a href="#MLTSampler::GetNextIndex"><tt>MLTSampler::GetNextIndex()</tt></a> method
performs corresponding steps through the primary sample vector components.
It interleaves the streams into the global sample vector&mdash;in other words,
the first <tt>streamCount</tt> dimensions in <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.019ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 869.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
</g>
</svg> are respectively used
for the first dimension of each of the streams, and so forth.

</p>
<p></p>
<span class="anchor" id="fragment-MLTSamplerPublicMethods-1"></span><div class="fragmentname">&lt;&lt;MLTSampler Public Methods&gt;&gt;+=&nbsp;<a href="#fragment-MLTSamplerPublicMethods-0"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">int <span class="anchor" id="MLTSampler::GetNextIndex"></span>GetNextIndex() {
   return <a href="#MLTSampler::streamIndex" class="code">streamIndex</a> + <a href="#MLTSampler::streamCount" class="code">streamCount</a> * sampleIndex++;
}</div><p>


</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#MLTIntegrator"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:mlt-integrator"></span><span id="MLTIntegrator"></span><h3>16.4.5  MLT Integrator</h3><p>



</p>
<p>Given all of this infrastructure&mdash;an explicit representation of an
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.395ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 600.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">n</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45B" d="M571 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 11 1 23 10 46c16 43 65 171 65 233c0 33 -9 70 -54 70c-95 0 -148 -91 -163 -122l-13 -50c-5 -23 -11 -45 -17 -67l-22 -90c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43 l58 231c13 52 16 63 16 84c0 33 -11 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 4 14 63 30 97c10 18 29 57 75 57s87 -31 92 -87c17 23 66 87 156 87c72 0 115 -40 115 -107c0 -57 -42 -167 -61 -220c-9 -22 -18 -46 -18 -71 c0 -23 7 -33 24 -33c49 0 82 56 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="0" y="0"></use>
</g>
</svg>-dimensional sample&nbsp;<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.019ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 869.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
</g>
</svg>, functions to apply mutations to it, and
BDPT&rsquo;s vertex abstraction layer for evaluating the radiance of a given sample
value&mdash;we can move forward to the heart of the implementation of the
<tt>MLTIntegrator</tt>.

</p>
<p></p>
<span class="anchor" id="fragment-MLTDeclarations-0"></span><div class="fragmentname">&lt;&lt;MLT Declarations&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">class <span class="anchor" id="MLTIntegrator"></span>MLTIntegrator : public <a href="../Introduction/pbrt_System_Overview.html#Integrator" class="code">Integrator</a> {
public:
    &lt;&lt;<span class="fragmentname">MLTIntegrator Public Methods</span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1841" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1841"><i></i></a><div id="fragbit-1841" class="collapse"><div class="fragmentcode">       MLTIntegrator(std::shared_ptr&lt;const <a href="../Camera_Models/Camera_Model.html#Camera" class="code">Camera</a>&gt; camera, int maxDepth,
           int nBootstrap, int nChains, int mutationsPerPixel, 
           Float sigma, Float largeStepProbability) : camera(camera), maxDepth(maxDepth),
           nBootstrap(nBootstrap), nChains(nChains), mutationsPerPixel(mutationsPerPixel), 
           sigma(sigma), largeStepProbability(largeStepProbability) { }
       void Render(const <a href="../Introduction/pbrt_System_Overview.html#Scene" class="code">Scene</a> &amp;scene);
       <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> L(const <a href="../Introduction/pbrt_System_Overview.html#Scene" class="code">Scene</a> &amp;scene, <a href="../Utilities/Memory_Management.html#MemoryArena" class="code">MemoryArena</a> &amp;arena,
                  const std::unique_ptr&lt;Distribution1D&gt; &amp;lightDistr,
                  MLTSampler &amp;sampler, int k, <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> *pRaster);</div></div>
private:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-MLTIntegratorPrivateData-0">MLTIntegrator Private Data</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1842" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1842"><i></i></a><div id="fragbit-1842" class="collapse"><div class="fragmentcode">       std::shared_ptr&lt;const <a href="../Camera_Models/Camera_Model.html#Camera" class="code">Camera</a>&gt; camera;
       const int maxDepth;
       const int nBootstrap;
       const int mutationsPerPixel;
       const Float sigma, largeStepProbability;
       const int nChains;</div></div>
};</div><p>


</p>
<p>The <tt>MLTIntegrator</tt> constructor, not shown here, just initializes 
various member variables from parameters provided to it.  These member
variables will be introduced in the following as they are used.

</p>
<p>

</p>
<p>We begin by defining the method <a href="#MLTIntegrator::L"><tt>MLTIntegrator::L()</tt></a>, which computes
the radiance <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.412ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2330 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper L left-parenthesis bold upper X right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43F" d="M643 247c0 0 0 -3 -4 -14l-79 -216c-6 -17 -7 -17 -31 -17h-463c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 12 20 19 20l133 -3l148 3c5 0 16 0 16 -12 c0 -19 -8 -19 -38 -19c-94 0 -97 -11 -106 -47l-135 -540c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h94c173 0 217 114 251 206c7 16 8 21 17 21s12 -7 12 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="681" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="1071" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1940" y="0"></use>
</g>
</svg> for a vector of sample values <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.019ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 869.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
</g>
</svg> provided
by an <a href="#MLTSampler"><tt>MLTSampler</tt></a>. Its parameter <tt>depth</tt> specifies a specific path
depth, and <tt>pRaster</tt> returns the raster position of the path, if the
path successfully carries light from a light source to the film plane. The
initial statement activates the first of three streams in the underlying
<tt>MLTSampler</tt>.

</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-MLTMethodDefinitions-0"></span><div class="fragmentname">&lt;&lt;MLT Method Definitions&gt;&gt;=&nbsp;<a href="#fragment-MLTMethodDefinitions-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode"><a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> MLTIntegrator::<span class="anchor" id="MLTIntegrator::L"></span>L(const <a href="../Introduction/pbrt_System_Overview.html#Scene" class="code">Scene</a> &amp;scene, <a href="../Utilities/Memory_Management.html#MemoryArena" class="code">MemoryArena</a> &amp;arena,
        const std::unique_ptr&lt;Distribution1D&gt; &amp;lightDistr,
        MLTSampler &amp;sampler, int depth, <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> *pRaster) {
    sampler.<a href="#MLTSampler::StartStream" class="code">StartStream</a>(<a href="#MLTIntegrator::cameraStreamIndex" class="code">cameraStreamIndex</a>);
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Determinethenumberofavailablestrategiesandpickaspecificone-0">Determine the number of available strategies and pick a specific one</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1843" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1843"><i></i></a><div id="fragbit-1843" class="collapse"><div class="fragmentcode">       int s, t, nStrategies;
       if (depth == 0) {
           nStrategies = 1;
           s = 0;
           t = 2;
       } else {
           nStrategies = depth + 2;
           s = std::min((int)(sampler.<a href="#MLTSampler::Get1D" class="code">Get1D</a>() * nStrategies), nStrategies - 1);
           t = nStrategies - s;
       }</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Generateacamerasubpathwithexactlymonotvertices-0">Generate a camera subpath with exactly <tt>t</tt> vertices</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1844" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1844"><i></i></a><div id="fragbit-1844" class="collapse"><div class="fragmentcode">       Vertex *cameraVertices = arena.<a href="../Utilities/Memory_Management.html#MemoryArena::Alloc" class="code">Alloc</a>&lt;Vertex&gt;(t);
       <a href="../Geometry_and_Transformations/Bounding_Boxes.html#Bounds2f" class="code">Bounds2f</a> sampleBounds = (<a href="../Geometry_and_Transformations/Bounding_Boxes.html#Bounds2f" class="code">Bounds2f</a>)<a href="#MLTIntegrator::camera" class="code">camera</a>-&gt;<a href="../Camera_Models/Camera_Model.html#Camera::film" class="code">film</a>-&gt;<a href="../Sampling_and_Reconstruction/Film_and_the_Imaging_Pipeline.html#Film::GetSampleBounds" class="code">GetSampleBounds</a>();
       *pRaster = sampleBounds.<a href="../Utilities/Mathematical_Routines.html#Lerp" class="code">Lerp</a>(sampler.<a href="../Sampling_and_Reconstruction/Sampling_Interface.html#Sampler::Get2D" class="code">Get2D</a>());
       if (<a href="../Light_Transport_III_Bidirectional_Methods/Bidirectional_Path_Tracing.html#GenerateCameraSubpath" class="code">GenerateCameraSubpath</a>(scene, sampler, arena, t, *<a href="#MLTIntegrator::camera" class="code">camera</a>,
                                 *pRaster, cameraVertices) != t)
           return <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a>(0.f);</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Generatealightsubpathwithexactlymonosvertices-0">Generate a light subpath with exactly <tt>s</tt> vertices</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1845" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1845"><i></i></a><div id="fragbit-1845" class="collapse"><div class="fragmentcode">       sampler.<a href="#MLTSampler::StartStream" class="code">StartStream</a>(<a href="#MLTIntegrator::lightStreamIndex" class="code">lightStreamIndex</a>);
       Vertex *lightVertices = arena.<a href="../Utilities/Memory_Management.html#MemoryArena::Alloc" class="code">Alloc</a>&lt;Vertex&gt;(s);
       if (<a href="../Light_Transport_III_Bidirectional_Methods/Bidirectional_Path_Tracing.html#GenerateLightSubpath" class="code">GenerateLightSubpath</a>(scene, sampler, arena, s, 
                                cameraVertices[0].<a href="../Light_Transport_III_Bidirectional_Methods/Bidirectional_Path_Tracing.html#Vertex::time" class="code">time</a>(),
                                *lightDistr, lightVertices) != s)
           return <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a>(0.f);</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Executeconnectionstrategyandreturntheradianceestimate-0">Execute connection strategy and return the radiance estimate</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1846" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1846"><i></i></a><div id="fragbit-1846" class="collapse"><div class="fragmentcode">       sampler.<a href="#MLTSampler::StartStream" class="code">StartStream</a>(<a href="#MLTIntegrator::connectionStreamIndex" class="code">connectionStreamIndex</a>);
       return <a href="../Light_Transport_III_Bidirectional_Methods/Bidirectional_Path_Tracing.html#ConnectBDPT" class="code">ConnectBDPT</a>(scene, lightVertices, cameraVertices, s, t,
                          *lightDistr, *camera, sampler, pRaster) * nStrategies;</div></div>
}</div><p>


</p>
<p>The implementation uses three sample streams from the <a href="#MLTSampler"><tt>MLTSampler</tt></a>: the
first two for the camera and light subpath and the third one for any
<a href="../Light_Transport_III_Bidirectional_Methods/The_Path-Space_Measurement_Equation.html#Camera::Sample_Wi"><tt>Camera::Sample_Wi()</tt></a> or <a href="../Light_Sources/Light_Interface.html#Light::Sample_Li"><tt>Light::Sample_Li()</tt></a> calls performed by
connection strategies in <a href="../Light_Transport_III_Bidirectional_Methods/Bidirectional_Path_Tracing.html#ConnectBDPT"><tt>ConnectBDPT()</tt></a> with <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.351ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 2304.1 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">s equals 1</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="747" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1803" y="0"></use>
</g>
</svg> or <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.101ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 2196.1 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">t equals 1</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="639" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1695" y="0"></use>
</g>
</svg> (refer to
Section&nbsp;<a href="../Light_Transport_III_Bidirectional_Methods/Bidirectional_Path_Tracing.html#sec:bdpt-connections">16.3.3</a> for details).

</p>
<p></p>
<span class="anchor" id="fragment-MLTSamplerConstants-0"></span><div class="fragmentname">&lt;&lt;MLTSampler Constants&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">static const int <span class="anchor" id="MLTIntegrator::cameraStreamIndex"></span>cameraStreamIndex = 0;
static const int <span class="anchor" id="MLTIntegrator::lightStreamIndex"></span>lightStreamIndex = 1;
static const int <span class="anchor" id="MLTIntegrator::connectionStreamIndex"></span>connectionStreamIndex = 2;
static const int <span class="anchor" id="MLTIntegrator::nSampleStreams"></span>nSampleStreams = 3;</div><p>


</p>
<p>The body of <a href="#MLTIntegrator::L"><tt>MLTIntegrator::L()</tt></a> first selects an individual BDPT
strategy for the provided <tt>depth</tt> value&mdash;this is the MMLT
modification to PSSMLT&mdash;and invokes the bidirectional path-tracing
machinery to compute a corresponding radiance estimate. For paths with zero
scattering events (i.e., directly observed light sources), the only viable
strategy provided by the underlying BDPT implementation entails
intersecting them with a ray traced from the camera.  For
longer paths, there are <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.105ex" height="2.676ex" style="vertical-align: -0.838ex;" viewBox="0 -791.3 4350.9 1152.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">monospace d monospace e monospace p monospace t monospace h plus 2</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D68D" d="M512 31c0 -31 -25 -31 -41 -31h-73c-40 0 -40 14 -40 50c-28 -29 -70 -56 -126 -56c-106 0 -196 97 -196 221c0 127 96 222 205 222c43 0 84 -16 117 -45v158h-45c-14 0 -40 0 -40 30c0 31 25 31 41 31h73c34 0 40 -10 40 -41v-509h45c14 0 40 0 40 -30zM358 194v71 c0 55 -49 111 -113 111c-70 0 -140 -65 -140 -161c0 -89 60 -160 131 -160c77 0 122 83 122 139Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D68E" d="M464 109c0 -25 -47 -115 -179 -115c-129 0 -230 101 -230 223c0 123 96 223 215 223c130 0 194 -98 194 -212c0 -37 -19 -37 -40 -37h-298c16 -86 91 -136 166 -136c28 0 82 9 104 60c7 19 15 22 33 22c6 0 35 0 35 -28zM393 251c-9 103 -71 128 -123 128 c-70 0 -129 -55 -143 -128h266Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D699" d="M488 216c0 -127 -97 -222 -206 -222c-32 0 -75 9 -116 51v-206h44c16 0 41 0 41 -31c0 -30 -26 -30 -40 -30h-159c-14 0 -40 0 -40 30c0 31 25 31 41 31h44v531h-45c-14 0 -40 0 -40 30c0 31 25 31 41 31h73c38 0 40 -14 40 -43c34 31 79 49 127 49 c106 0 195 -98 195 -221zM419 216c0 87 -58 160 -132 160c-63 0 -121 -53 -121 -112v-73c0 -48 35 -136 113 -136c70 0 140 65 140 161Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D69D" d="M449 126c0 -89 -81 -132 -155 -132c-73 0 -141 36 -141 132v244h-88c-15 0 -40 0 -40 30c0 31 25 31 41 31h87v82c0 20 0 41 35 41c34 0 34 -22 34 -41v-82h164c16 0 40 0 40 -31c0 -30 -25 -30 -40 -30h-164v-238c0 -25 0 -77 77 -77c23 0 80 10 81 72c0 17 1 38 34 38 c35 0 35 -21 35 -39Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D691" d="M512 30c0 -30 -26 -30 -40 -30h-153c-14 0 -41 0 -41 30c0 31 25 31 41 31h39v227c0 60 -14 88 -67 88c-51 0 -125 -38 -125 -138v-177h44c16 0 41 0 41 -31c0 -30 -26 -30 -40 -30h-159c-14 0 -40 0 -40 30c0 31 25 31 41 31h44v489h-45c-14 0 -40 0 -40 30 c0 31 25 31 41 31h73c34 0 40 -10 40 -41v-186c19 19 64 53 131 53c79 0 130 -43 130 -144v-232h44c16 0 41 0 41 -31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D68D" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D68E" x="525" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D699" x="1051" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D69D" x="1576" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D691" x="2102" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="2849" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="3850" y="0"></use>
</g>
</svg> possible strategies. The fragment
below uniformly maps the first primary sample space dimension onto this
set of strategies. The variables <tt>s</tt> and <tt>t</tt> denote the number of
light and camera subpath sampling steps following the convention of the
<a href="../Light_Transport_III_Bidirectional_Methods/Bidirectional_Path_Tracing.html#BDPTIntegrator"><tt>BDPTIntegrator</tt></a>.

</p>
<p></p>
<span class="anchor" id="fragment-Determinethenumberofavailablestrategiesandpickaspecificone-0"></span><div class="fragmentname">&lt;&lt;Determine the number of available strategies and pick a specific one&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">int s, t, nStrategies;
if (depth == 0) {
    nStrategies = 1;
    s = 0;
    t = 2;
} else {
    nStrategies = depth + 2;
    s = std::min((int)(sampler.<a href="#MLTSampler::Get1D" class="code">Get1D</a>() * nStrategies), nStrategies - 1);
    t = nStrategies - s;
}</div><p>


</p>
<p>The next three fragments compute the radiance estimate.  They strongly
resemble BDPT with some MMLT-specific modifications: the first one samples
a film position in <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.965ex" height="3.009ex" style="vertical-align: -0.838ex;" viewBox="0 -934.9 2568.1 1295.7" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket 0 comma 1 right-parenthesis squared</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="779" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1224" y="0"></use>
<g transform="translate(1724,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="550" y="513"></use>
</g>
</g>
</svg>, maps it to raster coordinates, and tries to
generate a corresponding camera subpath with <em>exactly</em> <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.84ex" height="2.009ex" style="vertical-align: -0.338ex;" viewBox="0 -719.6 361.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">t</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
</g>
</svg> vertices,
failing with a 0-valued estimate for <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.583ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 681.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper L</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43F" d="M643 247c0 0 0 -3 -4 -14l-79 -216c-6 -17 -7 -17 -31 -17h-463c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 12 20 19 20l133 -3l148 3c5 0 16 0 16 -12 c0 -19 -8 -19 -38 -19c-94 0 -97 -11 -106 -47l-135 -540c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h94c173 0 217 114 251 206c7 16 8 21 17 21s12 -7 12 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
</g>
</svg> when this was not possible.

</p>
<p></p>
<span class="anchor" id="fragment-Generateacamerasubpathwithexactlymonotvertices-0"></span><div class="fragmentname">&lt;&lt;Generate a camera subpath with exactly <tt>t</tt> vertices&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Vertex *cameraVertices = arena.<a href="../Utilities/Memory_Management.html#MemoryArena::Alloc" class="code">Alloc</a>&lt;Vertex&gt;(t);
<a href="../Geometry_and_Transformations/Bounding_Boxes.html#Bounds2f" class="code">Bounds2f</a> sampleBounds = (<a href="../Geometry_and_Transformations/Bounding_Boxes.html#Bounds2f" class="code">Bounds2f</a>)<a href="#MLTIntegrator::camera" class="code">camera</a>-&gt;<a href="../Camera_Models/Camera_Model.html#Camera::film" class="code">film</a>-&gt;<a href="../Sampling_and_Reconstruction/Film_and_the_Imaging_Pipeline.html#Film::GetSampleBounds" class="code">GetSampleBounds</a>();
*pRaster = sampleBounds.<a href="../Utilities/Mathematical_Routines.html#Lerp" class="code">Lerp</a>(sampler.<a href="../Sampling_and_Reconstruction/Sampling_Interface.html#Sampler::Get2D" class="code">Get2D</a>());
if (<a href="../Light_Transport_III_Bidirectional_Methods/Bidirectional_Path_Tracing.html#GenerateCameraSubpath" class="code">GenerateCameraSubpath</a>(scene, sampler, arena, t, *<a href="#MLTIntegrator::camera" class="code">camera</a>,
                          *pRaster, cameraVertices) != t)
    return <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a>(0.f);</div><p>


</p>
<p>The <tt>camera</tt> member variable holds the <a href="../Camera_Models/Camera_Model.html#Camera"><tt>Camera</tt></a> specified in the
scene description file.

</p>
<p></p>
<span class="anchor" id="fragment-MLTIntegratorPrivateData-0"></span><div class="fragmentname">&lt;&lt;MLTIntegrator Private Data&gt;&gt;=&nbsp;<a href="#fragment-MLTIntegratorPrivateData-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">std::shared_ptr&lt;const <a href="../Camera_Models/Camera_Model.html#Camera" class="code">Camera</a>&gt; <span class="anchor" id="MLTIntegrator::camera"></span>camera;</div><p>


</p>
<p>The next fragment implements an analogous operation for the light
subpath. Note the call to <a href="#MLTSampler::StartStream"><tt>MLTSampler::StartStream()</tt></a>, which switches
to the second stream of samples.

</p>
<p></p>
<span class="anchor" id="fragment-Generatealightsubpathwithexactlymonosvertices-0"></span><div class="fragmentname">&lt;&lt;Generate a light subpath with exactly <tt>s</tt> vertices&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">sampler.<a href="#MLTSampler::StartStream" class="code">StartStream</a>(<a href="#MLTIntegrator::lightStreamIndex" class="code">lightStreamIndex</a>);
Vertex *lightVertices = arena.<a href="../Utilities/Memory_Management.html#MemoryArena::Alloc" class="code">Alloc</a>&lt;Vertex&gt;(s);
if (<a href="../Light_Transport_III_Bidirectional_Methods/Bidirectional_Path_Tracing.html#GenerateLightSubpath" class="code">GenerateLightSubpath</a>(scene, sampler, arena, s, 
                         cameraVertices[0].<a href="../Light_Transport_III_Bidirectional_Methods/Bidirectional_Path_Tracing.html#Vertex::time" class="code">time</a>(),
                         *lightDistr, lightVertices) != s)
    return <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a>(0.f);</div><p>


</p>
<p>Finally, we switch to the last sample stream and invoke the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.773ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2055.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1665" y="0"></use>
</g>
</svg> strategy
via a call to <a href="../Light_Transport_III_Bidirectional_Methods/Bidirectional_Path_Tracing.html#ConnectBDPT"><tt>ConnectBDPT()</tt></a>. The final radiance estimate is multiplied by the
inverse probability of choosing the current strategy <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.773ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2055.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1665" y="0"></use>
</g>
</svg>, which is
equal to <tt>nStrategies</tt>.

</p>
<p></p>
<span class="anchor" id="fragment-Executeconnectionstrategyandreturntheradianceestimate-0"></span><div class="fragmentname">&lt;&lt;Execute connection strategy and return the radiance estimate&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">sampler.<a href="#MLTSampler::StartStream" class="code">StartStream</a>(<a href="#MLTIntegrator::connectionStreamIndex" class="code">connectionStreamIndex</a>);
return <a href="../Light_Transport_III_Bidirectional_Methods/Bidirectional_Path_Tracing.html#ConnectBDPT" class="code">ConnectBDPT</a>(scene, lightVertices, cameraVertices, s, t,
                   *lightDistr, *camera, sampler, pRaster) * nStrategies;</div><p>


</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#x5-MainRenderingLoop"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span id="x5-MainRenderingLoop"></span><h4>Main Rendering Loop</h4><p>


</p>
<p>There are two phases to the rendering process implemented in
<a href="#MLTIntegrator::Render"><tt>MLTIntegrator::Render()</tt></a>. The first phase generates a set of bootstrap
samples that are candidates for initial states of Markov chains and
computes the normalization constant <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="14.371ex" height="3.176ex" style="vertical-align: -1.005ex;" viewBox="0 -934.9 6187.4 1367.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">b equals integral upper I left-parenthesis bold upper X right-parenthesis normal d normal upper Omega</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-222B" d="M609 722c0 -30 -22 -43 -42 -43c-19 0 -41 13 -41 42c0 14 8 37 37 41c-22 19 -53 21 -63 21c-45 0 -79 -25 -93 -209l-19 -249c-8 -111 -44 -402 -57 -454c-22 -90 -70 -177 -165 -177c-60 0 -110 35 -110 83c0 30 22 43 42 43c19 0 41 -13 41 -42c0 -14 -8 -37 -37 -41 c21 -18 51 -21 64 -21c57 0 93 45 106 209l19 249c9 121 45 403 57 458c17 76 56 173 151 173c60 0 110 -35 110 -83Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43C" d="M497 671c0 -19 -8 -19 -32 -19c-79 0 -82 -10 -91 -46l-134 -533c-2 -7 -4 -15 -4 -23c0 -11 4 -15 25 -17c20 -2 25 -2 43 -2c22 0 30 0 30 -12c0 -19 -12 -19 -20 -19l-134 3l-131 -3c-3 0 -15 0 -15 11c0 20 9 20 32 20c79 0 82 10 91 47l135 539c2 9 2 11 2 16 c0 19 -27 19 -69 19c-19 0 -28 0 -28 11c0 20 13 20 20 20l133 -3l132 3c4 0 15 0 15 -12Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-64" d="M527 0l-147 -11v66c-25 -32 -70 -66 -134 -66c-114 0 -212 99 -212 226c0 129 105 227 223 227c54 0 97 -26 126 -62v216c0 49 -8 56 -78 56v31l144 11v-607c0 -49 8 -56 78 -56v-31zM380 118v205c0 18 0 20 -11 37c-31 45 -73 60 -108 60c-54 0 -92 -33 -113 -64 c-29 -45 -31 -105 -31 -142c0 -41 3 -98 29 -139c24 -38 60 -64 105 -64c43 0 88 22 118 70c11 17 11 19 11 37Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3A9" d="M677 162l-33 -162h-159c-23 0 -26 0 -26 21c0 69 32 159 47 201c29 82 56 158 56 233c0 156 -106 228 -202 228c-91 0 -201 -68 -201 -228c0 -75 28 -154 49 -212c23 -64 54 -152 54 -222c0 -21 -3 -21 -25 -21h-160l-33 162h25c5 -25 10 -51 18 -74c5 -15 8 -23 66 -23 h80c-13 56 -45 104 -89 170c-47 71 -88 140 -88 219c0 137 133 251 305 251c169 0 304 -112 304 -251c0 -79 -41 -148 -88 -219c-45 -66 -76 -114 -89 -170h80c58 0 61 8 66 24c9 24 13 47 18 73h25Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="707" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-222B" x="1763" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43C" x="2595" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="3093" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="3482" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="4352" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-64" x="4908" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3A9" x="5464" y="0"></use>
</g>
</svg>,
from Equation&nbsp;(<a href="#eq:mlt-pixel-splat">16.22</a>).  The second phase runs a series
of Markov chains, where each chain chooses one of the bootstrap samples for
its initial sample vector and then applies Metropolis sampling.

</p>
<p></p>
<span class="anchor" id="fragment-MLTMethodDefinitions-1"></span><div class="fragmentname">&lt;&lt;MLT Method Definitions&gt;&gt;+=&nbsp;<a href="#fragment-MLTMethodDefinitions-0"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">void <span class="anchor" id="MLTIntegrator::Render"></span>MLTIntegrator::Render(const <a href="../Introduction/pbrt_System_Overview.html#Scene" class="code">Scene</a> &amp;scene) {
    std::unique_ptr&lt;Distribution1D&gt; lightDistr =
        <a href="../Light_Transport_III_Bidirectional_Methods/Stochastic_Progressive_Photon_Mapping.html#ComputeLightPowerDistribution" class="code">ComputeLightPowerDistribution</a>(scene);
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Generatebootstrapsamplesandcomputenormalizationconstantb-0">Generate bootstrap samples and compute normalization constant <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.998ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 429.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">b</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="0" y="0"></use>
</g>
</svg></a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1847" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1847"><i></i></a><div id="fragbit-1847" class="collapse"><div class="fragmentcode">       int nBootstrapSamples = <a href="#MLTIntegrator::nBootstrap" class="code">nBootstrap</a> * (<a href="#MLTIntegrator::maxDepth" class="code">maxDepth</a> + 1);
       std::vector&lt;Float&gt; <a href="../Monte_Carlo_Integration/Sampling_Random_Variables.html#Distribution1D" class="code">bootstrapWeights</a>(nBootstrapSamples, 0);
       std::vector&lt;<a href="../Utilities/Memory_Management.html#MemoryArena" class="code">MemoryArena</a>&gt; bootstrapThreadArenas(<a href="../Utilities/Parallelism.html#MaxThreadIndex" class="code">MaxThreadIndex</a>());
       <a href="../Utilities/Parallelism.html#ParallelFor" class="code">ParallelFor</a>(
           [&amp;](int i) {
               &lt;&lt;<span class="fragmentname"><a href="#fragment-Generatemonoithbootstrapsample-0">Generate <tt>i</tt>th bootstrap sample</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1848" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1848"><i></i></a><div id="fragbit-1848" class="collapse"><div class="fragmentcode">                  <a href="../Utilities/Memory_Management.html#MemoryArena" class="code">MemoryArena</a> &amp;arena = bootstrapThreadArenas[<a href="../Utilities/Parallelism.html#ThreadIndex" class="code">ThreadIndex</a>];
                  for (int depth = 0; depth &lt;= <a href="#MLTIntegrator::maxDepth" class="code">maxDepth</a>; ++depth) {
                      int rngIndex = i * (<a href="#MLTIntegrator::maxDepth" class="code">maxDepth</a> + 1) + depth;
                      MLTSampler sampler(mutationsPerPixel, rngIndex, sigma,
                                         largeStepProbability, nSampleStreams);
                      <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> pRaster;
                      bootstrapWeights[rngIndex] =
                          <a href="#MLTIntegrator::L" class="code">L</a>(scene, arena, lightDistr, sampler, depth, &amp;pRaster).<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#Spectrum::y" class="code">y</a>();
                      arena.<a href="../Utilities/Memory_Management.html#MemoryArena::Reset" class="code">Reset</a>();
                  }
                  </div></div>
           }, <a href="#MLTIntegrator::nBootstrap" class="code">nBootstrap</a>, 4096);
       Distribution1D bootstrap(&amp;<a href="../Monte_Carlo_Integration/Sampling_Random_Variables.html#Distribution1D" class="code">bootstrapWeights</a>[0], nBootstrapSamples);
       Float b = bootstrap.<a href="../Monte_Carlo_Integration/Sampling_Random_Variables.html#Distribution1D::funcInt" class="code">funcInt</a> * (<a href="#MLTIntegrator::maxDepth" class="code">maxDepth</a> + 1);</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-RunmononChainsMarkovchainsinparallel-0">Run <tt>nChains</tt> Markov chains in parallel</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1849" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1849"><i></i></a><div id="fragbit-1849" class="collapse"><div class="fragmentcode">       <a href="../Sampling_and_Reconstruction/Film_and_the_Imaging_Pipeline.html#Film" class="code">Film</a> &amp;film = *camera-&gt;film;
       int64_t nTotalMutations = (int64_t)<a href="#MLTIntegrator::mutationsPerPixel" class="code">mutationsPerPixel</a> * 
           (int64_t)film.<a href="../Sampling_and_Reconstruction/Film_and_the_Imaging_Pipeline.html#Film::GetSampleBounds" class="code">GetSampleBounds</a>().Area();
       <a href="../Utilities/Parallelism.html#ParallelFor" class="code">ParallelFor</a>(
           [&amp;](int i) {
               int64_t nChainMutations =
                   std::min((i + 1) * nTotalMutations / <a href="#MLTIntegrator::nChains" class="code">nChains</a>,
                            nTotalMutations) - i * nTotalMutations / <a href="#MLTIntegrator::nChains" class="code">nChains</a>;
               &lt;&lt;<span class="fragmentname"><a href="#fragment-FollowithMarkovchainformononChainMutations-0">Follow ith Markov chain for <tt>nChainMutations</tt></a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1850" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1850"><i></i></a><div id="fragbit-1850" class="collapse"><div class="fragmentcode">                  <a href="../Utilities/Memory_Management.html#MemoryArena" class="code">MemoryArena</a> arena;
                  &lt;&lt;<span class="fragmentname"><a href="#fragment-Selectinitialstatefromthesetofbootstrapsamples-0">Select initial state from the set of bootstrap samples</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1851" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1851"><i></i></a><div id="fragbit-1851" class="collapse"><div class="fragmentcode">                     <a href="../Utilities/Main_Include_File.html#RNG" class="code">RNG</a> rng(i);
                     int bootstrapIndex = bootstrap.<a href="../Monte_Carlo_Integration/Sampling_Random_Variables.html#Distribution1D::SampleDiscrete" class="code">SampleDiscrete</a>(rng.<a href="../Utilities/Main_Include_File.html#RNG::UniformFloat" class="code">UniformFloat</a>());
                     int depth = bootstrapIndex % (<a href="#MLTIntegrator::maxDepth" class="code">maxDepth</a> + 1);</div></div>
                  &lt;&lt;<span class="fragmentname"><a href="#fragment-Initializelocalvariablesforselectedstate-0">Initialize local variables for selected state</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1852" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1852"><i></i></a><div id="fragbit-1852" class="collapse"><div class="fragmentcode">                     MLTSampler sampler(<a href="#MLTIntegrator::mutationsPerPixel" class="code">mutationsPerPixel</a>, bootstrapIndex, <a href="#MLTIntegrator::sigma" class="code">sigma</a>,
                                        <a href="#MLTIntegrator::largeStepProbability" class="code">largeStepProbability</a>, <a href="#MLTIntegrator::nSampleStreams" class="code">nSampleStreams</a>);
                     <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> pCurrent;
                     <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> LCurrent =
                         <a href="#MLTIntegrator::L" class="code">L</a>(scene, arena, lightDistr, sampler, depth, &amp;pCurrent);</div></div>
                  &lt;&lt;<span class="fragmentname"><a href="#fragment-RuntheMarkovchainformononChainMutationssteps-0">Run the Markov chain for <tt>nChainMutations</tt> steps</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1853" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1853"><i></i></a><div id="fragbit-1853" class="collapse"><div class="fragmentcode">                     for (int64_t j = 0; j &lt; nChainMutations; ++j) {
                         sampler.<a href="#MLTSampler::StartIteration" class="code">StartIteration</a>();
                         <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> pProposed;
                         <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> LProposed =
                             <a href="#MLTIntegrator::L" class="code">L</a>(scene, arena, lightDistr, sampler, depth, &amp;pProposed);
                         &lt;&lt;<span class="fragmentname"><a href="#fragment-Computeacceptanceprobabilityforproposedsample-0">Compute acceptance probability for proposed sample</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1854" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1854"><i></i></a><div id="fragbit-1854" class="collapse"><div class="fragmentcode">                            Float accept = std::min((Float)1, LProposed.<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#Spectrum::y" class="code">y</a>() / LCurrent.<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#Spectrum::y" class="code">y</a>());</div></div>
                         &lt;&lt;<span class="fragmentname"><a href="#fragment-Splatbothcurrentandproposedsamplestomonofilm-0">Splat both current and proposed samples to <tt>film</tt></a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1855" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1855"><i></i></a><div id="fragbit-1855" class="collapse"><div class="fragmentcode">                            if (accept &gt; 0)
                                film.<a href="../Sampling_and_Reconstruction/Film_and_the_Imaging_Pipeline.html#Film::AddSplat" class="code">AddSplat</a>(pProposed, LProposed * accept / LProposed.<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#Spectrum::y" class="code">y</a>());
                            film.<a href="../Sampling_and_Reconstruction/Film_and_the_Imaging_Pipeline.html#Film::AddSplat" class="code">AddSplat</a>(pCurrent, LCurrent * (1 - accept) / LCurrent.<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#Spectrum::y" class="code">y</a>());</div></div>
                         &lt;&lt;<span class="fragmentname"><a href="#fragment-Acceptorrejecttheproposal-0">Accept or reject the proposal</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1856" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1856"><i></i></a><div id="fragbit-1856" class="collapse"><div class="fragmentcode">                            if (rng.<a href="../Utilities/Main_Include_File.html#RNG::UniformFloat" class="code">UniformFloat</a>() &lt; accept) {
                                pCurrent = pProposed;
                                LCurrent = LProposed;
                                sampler.<a href="#MLTSampler::Accept" class="code">Accept</a>();
                            } else
                                sampler.<a href="#MLTSampler::Reject" class="code">Reject</a>();</div></div>
                     }</div></div></div></div>
           }, <a href="#MLTIntegrator::nChains" class="code">nChains</a>);
       </div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-StorefinalimagecomputedwithMLT-0">Store final image computed with MLT</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1857" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1857"><i></i></a><div id="fragbit-1857" class="collapse"><div class="fragmentcode">       <a href="#MLTIntegrator::camera" class="code">camera</a>-&gt;<a href="../Camera_Models/Camera_Model.html#Camera::film" class="code">film</a>-&gt;<a href="../Sampling_and_Reconstruction/Film_and_the_Imaging_Pipeline.html#Film::WriteImage" class="code">WriteImage</a>(b / <a href="#MLTIntegrator::mutationsPerPixel" class="code">mutationsPerPixel</a>);</div></div>
}</div><p>


</p>
<p>Following the approach described in Section&nbsp;<a href="../Monte_Carlo_Integration/Metropolis_Sampling.html#sec:startup-bias">13.4.3</a>, we avoid
issues with start-up bias by computing a set of bootstrap samples with a
standard Monte Carlo estimator and using them to create a distribution that
supplies the initial states of the Markov chains. This process builds on the
sample generation and evaluation routines implemented previously.

</p>
<p>Each bootstrap sample is technically a sequence of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="13.442ex" height="3.343ex" style="vertical-align: -1.171ex; margin-left: -0.008ex;" viewBox="-3.5 -934.9 5787.4 1439.2" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">monospace m monospace a monospace x monospace upper D monospace e monospace p monospace t monospace h monospace plus monospace 1</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D696" d="M516 30c0 -30 -26 -30 -41 -30h-75c-14 0 -41 0 -41 30c0 31 25 31 44 31v233c0 65 -14 82 -37 82c-41 0 -82 -47 -82 -136v-179c36 0 57 0 57 -31c0 -30 -26 -30 -41 -30h-75c-14 0 -41 0 -41 30c0 31 25 31 44 31v233c0 65 -14 82 -37 82c-41 0 -82 -47 -82 -136v-179 c36 0 57 0 57 -31c0 -30 -26 -30 -41 -30h-88c-14 0 -41 0 -41 30c0 31 21 31 57 31v309c-36 0 -57 0 -57 31c0 30 26 30 41 30h32c18 0 38 0 40 -30c24 22 54 36 86 36c33 0 61 -18 76 -52c28 39 69 52 99 52c89 0 89 -114 89 -134v-242c36 0 57 0 57 -31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D68A" d="M519 31c0 -31 -22 -31 -50 -31c-38 0 -86 1 -108 32c-47 -31 -109 -38 -146 -38c-102 0 -165 65 -165 134c0 96 123 146 300 149c0 71 -52 102 -128 102c-9 0 -22 0 -36 -1c-20 -2 -21 -3 -21 -11c-1 -37 -29 -46 -44 -46c-24 0 -45 16 -45 46c0 73 102 73 145 73 c144 0 198 -84 198 -155v-216c8 -3 18 -8 60 -8c15 0 40 0 40 -30zM350 134v84c-145 -4 -231 -41 -231 -90c0 -39 41 -73 103 -73c8 0 53 0 89 17c39 18 39 39 39 62Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D6A1" d="M496 30c0 -30 -27 -30 -41 -30h-117c-15 0 -40 0 -40 30c0 31 22 31 50 31l-89 123l-86 -123c31 0 52 0 52 -31c0 -30 -25 -30 -40 -30h-117c-14 0 -41 0 -41 30c0 31 26 31 41 31h40l124 161l-118 148h-40c-14 0 -41 0 -41 30c0 31 26 31 41 31h117c15 0 40 0 40 -30 c0 -31 -22 -31 -48 -31l76 -101l74 101c-27 0 -49 0 -49 31c0 30 25 30 40 30h117c15 0 41 0 41 -31c0 -30 -27 -30 -41 -30h-40l-114 -148l128 -161h40c15 0 41 0 41 -31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D673" d="M485 301c0 -161 -88 -301 -219 -301h-206c-15 0 -41 0 -41 30c0 31 25 31 41 31h22v489h-22c-15 0 -41 0 -41 30c0 31 25 31 41 31h206c133 0 219 -150 219 -310zM416 301c0 116 -56 249 -169 249h-96v-489h96c111 0 169 123 169 240Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D68E" d="M464 109c0 -25 -47 -115 -179 -115c-129 0 -230 101 -230 223c0 123 96 223 215 223c130 0 194 -98 194 -212c0 -37 -19 -37 -40 -37h-298c16 -86 91 -136 166 -136c28 0 82 9 104 60c7 19 15 22 33 22c6 0 35 0 35 -28zM393 251c-9 103 -71 128 -123 128 c-70 0 -129 -55 -143 -128h266Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D699" d="M488 216c0 -127 -97 -222 -206 -222c-32 0 -75 9 -116 51v-206h44c16 0 41 0 41 -31c0 -30 -26 -30 -40 -30h-159c-14 0 -40 0 -40 30c0 31 25 31 41 31h44v531h-45c-14 0 -40 0 -40 30c0 31 25 31 41 31h73c38 0 40 -14 40 -43c34 31 79 49 127 49 c106 0 195 -98 195 -221zM419 216c0 87 -58 160 -132 160c-63 0 -121 -53 -121 -112v-73c0 -48 35 -136 113 -136c70 0 140 65 140 161Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D69D" d="M449 126c0 -89 -81 -132 -155 -132c-73 0 -141 36 -141 132v244h-88c-15 0 -40 0 -40 30c0 31 25 31 41 31h87v82c0 20 0 41 35 41c34 0 34 -22 34 -41v-82h164c16 0 40 0 40 -31c0 -30 -25 -30 -40 -30h-164v-238c0 -25 0 -77 77 -77c23 0 80 10 81 72c0 17 1 38 34 38 c35 0 35 -21 35 -39Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D691" d="M512 30c0 -30 -26 -30 -40 -30h-153c-14 0 -41 0 -41 30c0 31 25 31 41 31h39v227c0 60 -14 88 -67 88c-51 0 -125 -38 -125 -138v-177h44c16 0 41 0 41 -31c0 -30 -26 -30 -40 -30h-159c-14 0 -40 0 -40 30c0 31 25 31 41 31h44v489h-45c-14 0 -40 0 -40 30 c0 31 25 31 41 31h73c34 0 40 -10 40 -41v-186c19 19 64 53 131 53c79 0 130 -43 130 -144v-232h44c16 0 41 0 41 -31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D7F7" d="M442 30c0 -30 -25 -30 -40 -30h-251c-15 0 -40 0 -40 30c0 31 24 31 40 31h91v422c-44 -38 -85 -44 -104 -44c-15 0 -33 5 -33 30c0 28 21 30 37 31c19 2 71 13 109 98c5 12 11 24 30 24c30 0 30 -25 30 -41v-520h91c16 0 40 0 40 -31Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D696" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D68A" x="525" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D6A1" x="1051" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D673" x="1576" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D68E" x="2102" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D699" x="2627" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D69D" x="3153" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D691" x="3678" y="0"></use>
<g transform="translate(4426,0)">
<text font-family="monospace" stroke="none" transform="scale(71.759) matrix(1 0 0 -1 0 0)">+</text>
</g>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D7F7" x="5258" y="0"></use>
</g>
</svg>
samples with different path depths; the following fragment initializes the
array <tt>bootstrapWeights</tt> with their corresponding luminance values. At
the end, we create a <tt>Distribution1D</tt> instance to sample bootstrap
paths proportional to their luminances and set the constant <tt>b</tt> to the
sum of average luminances for each depth. Because we&rsquo;ve kept the
contributions of different path sample depths distinct, we can
preferentially sample path lengths that make the largest contribution to
the image.  It is straightforward to compute the bootstrap samples in
parallel, as all loop iterations are independent from one another.

</p>
<p></p>
<span class="anchor" id="fragment-Generatebootstrapsamplesandcomputenormalizationconstantb-0"></span><div class="fragmentname">&lt;&lt;Generate bootstrap samples and compute normalization constant <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.998ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 429.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">b</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="0" y="0"></use>
</g>
</svg>&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">int nBootstrapSamples = <a href="#MLTIntegrator::nBootstrap" class="code">nBootstrap</a> * (<a href="#MLTIntegrator::maxDepth" class="code">maxDepth</a> + 1);
std::vector&lt;Float&gt; <a href="../Monte_Carlo_Integration/Sampling_Random_Variables.html#Distribution1D" class="code">bootstrapWeights</a>(nBootstrapSamples, 0);
std::vector&lt;<a href="../Utilities/Memory_Management.html#MemoryArena" class="code">MemoryArena</a>&gt; bootstrapThreadArenas(<a href="../Utilities/Parallelism.html#MaxThreadIndex" class="code">MaxThreadIndex</a>());
<a href="../Utilities/Parallelism.html#ParallelFor" class="code">ParallelFor</a>(
    [&amp;](int i) {
        &lt;&lt;<span class="fragmentname"><a href="#fragment-Generatemonoithbootstrapsample-0">Generate <tt>i</tt>th bootstrap sample</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1858" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1858"><i></i></a><div id="fragbit-1858" class="collapse"><div class="fragmentcode">           <a href="../Utilities/Memory_Management.html#MemoryArena" class="code">MemoryArena</a> &amp;arena = bootstrapThreadArenas[<a href="../Utilities/Parallelism.html#ThreadIndex" class="code">ThreadIndex</a>];
           for (int depth = 0; depth &lt;= <a href="#MLTIntegrator::maxDepth" class="code">maxDepth</a>; ++depth) {
               int rngIndex = i * (<a href="#MLTIntegrator::maxDepth" class="code">maxDepth</a> + 1) + depth;
               MLTSampler sampler(mutationsPerPixel, rngIndex, sigma,
                                  largeStepProbability, nSampleStreams);
               <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> pRaster;
               bootstrapWeights[rngIndex] =
                   <a href="#MLTIntegrator::L" class="code">L</a>(scene, arena, lightDistr, sampler, depth, &amp;pRaster).<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#Spectrum::y" class="code">y</a>();
               arena.<a href="../Utilities/Memory_Management.html#MemoryArena::Reset" class="code">Reset</a>();
           }
           </div></div>
    }, <a href="#MLTIntegrator::nBootstrap" class="code">nBootstrap</a>, 4096);
Distribution1D bootstrap(&amp;<a href="../Monte_Carlo_Integration/Sampling_Random_Variables.html#Distribution1D" class="code">bootstrapWeights</a>[0], nBootstrapSamples);
Float b = bootstrap.<a href="../Monte_Carlo_Integration/Sampling_Random_Variables.html#Distribution1D::funcInt" class="code">funcInt</a> * (<a href="#MLTIntegrator::maxDepth" class="code">maxDepth</a> + 1);</div><p>


</p>
<p>As usual, <tt>maxDepth</tt> denotes the maximum number of interreflections that
should be considered.  <tt>nBootstrap</tt> sets the number of
bootstrapping samples to use to seed the iterations and compute the integral
of the scalar contribution function, Equation&nbsp;(<a href="#eq:mlt-pixel-splat">16.22</a>).

</p>
<p></p>
<span class="anchor" id="fragment-MLTIntegratorPrivateData-1"></span><div class="fragmentname">&lt;&lt;MLTIntegrator Private Data&gt;&gt;+=&nbsp;<a href="#fragment-MLTIntegratorPrivateData-0"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MLTIntegratorPrivateData-2"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">const int <span class="anchor" id="MLTIntegrator::maxDepth"></span>maxDepth;
const int <span class="anchor" id="MLTIntegrator::nBootstrap"></span>nBootstrap;</div><p>


</p>
<p>In each iteration, we instantiate a dedicated <a href="#MLTSampler"><tt>MLTSampler</tt></a> with index
<tt>rngIndex</tt> providing a unique sample vector that is
uniformly distributed in the primary sample space. Next, we evaluate <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.583ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 681.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper L</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43F" d="M643 247c0 0 0 -3 -4 -14l-79 -216c-6 -17 -7 -17 -31 -17h-463c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 12 20 19 20l133 -3l148 3c5 0 16 0 16 -12 c0 -19 -8 -19 -38 -19c-94 0 -97 -11 -106 -47l-135 -540c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h94c173 0 217 114 251 206c7 16 8 21 17 21s12 -7 12 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
</g>
</svg> to
obtain a corresponding radiance estimate for the current path depth
<tt>depth</tt> and write its luminance into <tt>bootstrapWeights</tt>. The
raster-space position <tt>pRaster</tt> is not needed in the preprocessing
phase, so it is ignored.

</p>
<p></p>
<span class="anchor" id="fragment-Generatemonoithbootstrapsample-0"></span><div class="fragmentname">&lt;&lt;Generate <tt>i</tt>th bootstrap sample&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Utilities/Memory_Management.html#MemoryArena" class="code">MemoryArena</a> &amp;arena = bootstrapThreadArenas[<a href="../Utilities/Parallelism.html#ThreadIndex" class="code">ThreadIndex</a>];
for (int depth = 0; depth &lt;= <a href="#MLTIntegrator::maxDepth" class="code">maxDepth</a>; ++depth) {
    int rngIndex = i * (<a href="#MLTIntegrator::maxDepth" class="code">maxDepth</a> + 1) + depth;
    MLTSampler sampler(mutationsPerPixel, rngIndex, sigma,
                       largeStepProbability, nSampleStreams);
    <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> pRaster;
    bootstrapWeights[rngIndex] =
        <a href="#MLTIntegrator::L" class="code">L</a>(scene, arena, lightDistr, sampler, depth, &amp;pRaster).<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#Spectrum::y" class="code">y</a>();
    arena.<a href="../Utilities/Memory_Management.html#MemoryArena::Reset" class="code">Reset</a>();
}
</div><p>


</p>
<p>The <tt>mutationsPerPixel</tt> parameter is analogous to
<a href="../Sampling_and_Reconstruction/Sampling_Interface.html#Sampler::samplesPerPixel"><tt>Sampler::samplesPerPixel</tt></a> and denotes the number of iterations that MLT
(on average!) spends in each pixel. Individual pixels will receive an actual
number of samples related to their brightness, due to Metropolis&rsquo;s property of
taking more samples in regions where the function&rsquo;s value is high. The total
number of Metropolis samples taken is the product of the number of pixels
and <tt>mutationsPerPixel</tt>.

</p>
<p>The <tt>sigma</tt> and <tt>largeStepProbability</tt> member variables give the
corresponding configuration parameters of the <a href="#MLTSampler"><tt>MLTSampler</tt></a>.

</p>
<p></p>
<span class="anchor" id="fragment-MLTIntegratorPrivateData-2"></span><div class="fragmentname">&lt;&lt;MLTIntegrator Private Data&gt;&gt;+=&nbsp;<a href="#fragment-MLTIntegratorPrivateData-1"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MLTIntegratorPrivateData-3"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">const int <span class="anchor" id="MLTIntegrator::mutationsPerPixel"></span>mutationsPerPixel;
const Float <span class="anchor" id="MLTIntegrator::sigma"></span>sigma, <span class="anchor" id="MLTIntegrator::largeStepProbability"></span>largeStepProbability;</div><p>


</p>
<p>We now move on to the main rendering task, which performs a total of
<tt>nTotalMutations</tt> mutation steps spread out over <tt>nChains</tt> parallel
Markov chains.

</p>
<p>We must be careful that the actual number of mutation steps indeed
comes out to be equal to <tt>nTotalMutations</tt>, particularly when <tt>nTotalMutations</tt>
is not divisible by the number of parallel chains. The solution is simple: we
potentially stop the last Markov chain a few iterations short; the corrected
number of per-chain iterations is given by <tt>nChainMutations</tt>.

</p>
<p></p>
<span class="anchor" id="fragment-RunmononChainsMarkovchainsinparallel-0"></span><div class="fragmentname">&lt;&lt;Run <tt>nChains</tt> Markov chains in parallel&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Sampling_and_Reconstruction/Film_and_the_Imaging_Pipeline.html#Film" class="code">Film</a> &amp;film = *camera-&gt;film;
int64_t nTotalMutations = (int64_t)<a href="#MLTIntegrator::mutationsPerPixel" class="code">mutationsPerPixel</a> * 
    (int64_t)film.<a href="../Sampling_and_Reconstruction/Film_and_the_Imaging_Pipeline.html#Film::GetSampleBounds" class="code">GetSampleBounds</a>().Area();
<a href="../Utilities/Parallelism.html#ParallelFor" class="code">ParallelFor</a>(
    [&amp;](int i) {
        int64_t nChainMutations =
            std::min((i + 1) * nTotalMutations / <a href="#MLTIntegrator::nChains" class="code">nChains</a>,
                     nTotalMutations) - i * nTotalMutations / <a href="#MLTIntegrator::nChains" class="code">nChains</a>;
        &lt;&lt;<span class="fragmentname"><a href="#fragment-FollowithMarkovchainformononChainMutations-0">Follow ith Markov chain for <tt>nChainMutations</tt></a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1859" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1859"><i></i></a><div id="fragbit-1859" class="collapse"><div class="fragmentcode">           <a href="../Utilities/Memory_Management.html#MemoryArena" class="code">MemoryArena</a> arena;
           &lt;&lt;<span class="fragmentname"><a href="#fragment-Selectinitialstatefromthesetofbootstrapsamples-0">Select initial state from the set of bootstrap samples</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1860" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1860"><i></i></a><div id="fragbit-1860" class="collapse"><div class="fragmentcode">              <a href="../Utilities/Main_Include_File.html#RNG" class="code">RNG</a> rng(i);
              int bootstrapIndex = bootstrap.<a href="../Monte_Carlo_Integration/Sampling_Random_Variables.html#Distribution1D::SampleDiscrete" class="code">SampleDiscrete</a>(rng.<a href="../Utilities/Main_Include_File.html#RNG::UniformFloat" class="code">UniformFloat</a>());
              int depth = bootstrapIndex % (<a href="#MLTIntegrator::maxDepth" class="code">maxDepth</a> + 1);</div></div>
           &lt;&lt;<span class="fragmentname"><a href="#fragment-Initializelocalvariablesforselectedstate-0">Initialize local variables for selected state</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1861" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1861"><i></i></a><div id="fragbit-1861" class="collapse"><div class="fragmentcode">              MLTSampler sampler(<a href="#MLTIntegrator::mutationsPerPixel" class="code">mutationsPerPixel</a>, bootstrapIndex, <a href="#MLTIntegrator::sigma" class="code">sigma</a>,
                                 <a href="#MLTIntegrator::largeStepProbability" class="code">largeStepProbability</a>, <a href="#MLTIntegrator::nSampleStreams" class="code">nSampleStreams</a>);
              <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> pCurrent;
              <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> LCurrent =
                  <a href="#MLTIntegrator::L" class="code">L</a>(scene, arena, lightDistr, sampler, depth, &amp;pCurrent);</div></div>
           &lt;&lt;<span class="fragmentname"><a href="#fragment-RuntheMarkovchainformononChainMutationssteps-0">Run the Markov chain for <tt>nChainMutations</tt> steps</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1862" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1862"><i></i></a><div id="fragbit-1862" class="collapse"><div class="fragmentcode">              for (int64_t j = 0; j &lt; nChainMutations; ++j) {
                  sampler.<a href="#MLTSampler::StartIteration" class="code">StartIteration</a>();
                  <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> pProposed;
                  <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> LProposed =
                      <a href="#MLTIntegrator::L" class="code">L</a>(scene, arena, lightDistr, sampler, depth, &amp;pProposed);
                  &lt;&lt;<span class="fragmentname"><a href="#fragment-Computeacceptanceprobabilityforproposedsample-0">Compute acceptance probability for proposed sample</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1863" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1863"><i></i></a><div id="fragbit-1863" class="collapse"><div class="fragmentcode">                     Float accept = std::min((Float)1, LProposed.<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#Spectrum::y" class="code">y</a>() / LCurrent.<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#Spectrum::y" class="code">y</a>());</div></div>
                  &lt;&lt;<span class="fragmentname"><a href="#fragment-Splatbothcurrentandproposedsamplestomonofilm-0">Splat both current and proposed samples to <tt>film</tt></a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1864" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1864"><i></i></a><div id="fragbit-1864" class="collapse"><div class="fragmentcode">                     if (accept &gt; 0)
                         film.<a href="../Sampling_and_Reconstruction/Film_and_the_Imaging_Pipeline.html#Film::AddSplat" class="code">AddSplat</a>(pProposed, LProposed * accept / LProposed.<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#Spectrum::y" class="code">y</a>());
                     film.<a href="../Sampling_and_Reconstruction/Film_and_the_Imaging_Pipeline.html#Film::AddSplat" class="code">AddSplat</a>(pCurrent, LCurrent * (1 - accept) / LCurrent.<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#Spectrum::y" class="code">y</a>());</div></div>
                  &lt;&lt;<span class="fragmentname"><a href="#fragment-Acceptorrejecttheproposal-0">Accept or reject the proposal</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1865" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1865"><i></i></a><div id="fragbit-1865" class="collapse"><div class="fragmentcode">                     if (rng.<a href="../Utilities/Main_Include_File.html#RNG::UniformFloat" class="code">UniformFloat</a>() &lt; accept) {
                         pCurrent = pProposed;
                         LCurrent = LProposed;
                         sampler.<a href="#MLTSampler::Accept" class="code">Accept</a>();
                     } else
                         sampler.<a href="#MLTSampler::Reject" class="code">Reject</a>();</div></div>
              }</div></div></div></div>
    }, <a href="#MLTIntegrator::nChains" class="code">nChains</a>);
</div><p>


</p>
<p><tt>nChains</tt> specifies the number of Markov chains that should be executed
independently of each other. Its default value of 100 is a trade-off between
providing sufficient parallelism and running each chain for a long time.

</p>
<p></p>
<span class="anchor" id="fragment-MLTIntegratorPrivateData-3"></span><div class="fragmentname">&lt;&lt;MLTIntegrator Private Data&gt;&gt;+=&nbsp;<a href="#fragment-MLTIntegratorPrivateData-2"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">const int <span class="anchor" id="MLTIntegrator::nChains"></span>nChains;</div><p>


</p>
<p>The MLT integrator only splats contributions to arbitrary pixels in the
film; it doesn&rsquo;t fill in well-defined tiles of the image plane. Therefore,
a <a href="../Sampling_and_Reconstruction/Film_and_the_Imaging_Pipeline.html#FilmTile"><tt>FilmTile</tt></a> isn&rsquo;t necessary, and calls to <a href="../Sampling_and_Reconstruction/Film_and_the_Imaging_Pipeline.html#Film::AddSplat"><tt>Film::AddSplat()</tt></a>
suffice to update the image.

</p>
<p></p>
<span class="anchor" id="fragment-FollowithMarkovchainformononChainMutations-0"></span><div class="fragmentname">&lt;&lt;Follow ith Markov chain for <tt>nChainMutations</tt>&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Utilities/Memory_Management.html#MemoryArena" class="code">MemoryArena</a> arena;
&lt;&lt;<span class="fragmentname"><a href="#fragment-Selectinitialstatefromthesetofbootstrapsamples-0">Select initial state from the set of bootstrap samples</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1866" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1866"><i></i></a><div id="fragbit-1866" class="collapse"><div class="fragmentcode">   <a href="../Utilities/Main_Include_File.html#RNG" class="code">RNG</a> rng(i);
   int bootstrapIndex = bootstrap.<a href="../Monte_Carlo_Integration/Sampling_Random_Variables.html#Distribution1D::SampleDiscrete" class="code">SampleDiscrete</a>(rng.<a href="../Utilities/Main_Include_File.html#RNG::UniformFloat" class="code">UniformFloat</a>());
   int depth = bootstrapIndex % (<a href="#MLTIntegrator::maxDepth" class="code">maxDepth</a> + 1);</div></div>
&lt;&lt;<span class="fragmentname"><a href="#fragment-Initializelocalvariablesforselectedstate-0">Initialize local variables for selected state</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1867" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1867"><i></i></a><div id="fragbit-1867" class="collapse"><div class="fragmentcode">   MLTSampler sampler(<a href="#MLTIntegrator::mutationsPerPixel" class="code">mutationsPerPixel</a>, bootstrapIndex, <a href="#MLTIntegrator::sigma" class="code">sigma</a>,
                      <a href="#MLTIntegrator::largeStepProbability" class="code">largeStepProbability</a>, <a href="#MLTIntegrator::nSampleStreams" class="code">nSampleStreams</a>);
   <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> pCurrent;
   <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> LCurrent =
       <a href="#MLTIntegrator::L" class="code">L</a>(scene, arena, lightDistr, sampler, depth, &amp;pCurrent);</div></div>
&lt;&lt;<span class="fragmentname"><a href="#fragment-RuntheMarkovchainformononChainMutationssteps-0">Run the Markov chain for <tt>nChainMutations</tt> steps</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1868" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1868"><i></i></a><div id="fragbit-1868" class="collapse"><div class="fragmentcode">   for (int64_t j = 0; j &lt; nChainMutations; ++j) {
       sampler.<a href="#MLTSampler::StartIteration" class="code">StartIteration</a>();
       <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> pProposed;
       <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> LProposed =
           <a href="#MLTIntegrator::L" class="code">L</a>(scene, arena, lightDistr, sampler, depth, &amp;pProposed);
       &lt;&lt;<span class="fragmentname"><a href="#fragment-Computeacceptanceprobabilityforproposedsample-0">Compute acceptance probability for proposed sample</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1869" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1869"><i></i></a><div id="fragbit-1869" class="collapse"><div class="fragmentcode">          Float accept = std::min((Float)1, LProposed.<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#Spectrum::y" class="code">y</a>() / LCurrent.<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#Spectrum::y" class="code">y</a>());</div></div>
       &lt;&lt;<span class="fragmentname"><a href="#fragment-Splatbothcurrentandproposedsamplestomonofilm-0">Splat both current and proposed samples to <tt>film</tt></a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1870" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1870"><i></i></a><div id="fragbit-1870" class="collapse"><div class="fragmentcode">          if (accept &gt; 0)
              film.<a href="../Sampling_and_Reconstruction/Film_and_the_Imaging_Pipeline.html#Film::AddSplat" class="code">AddSplat</a>(pProposed, LProposed * accept / LProposed.<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#Spectrum::y" class="code">y</a>());
          film.<a href="../Sampling_and_Reconstruction/Film_and_the_Imaging_Pipeline.html#Film::AddSplat" class="code">AddSplat</a>(pCurrent, LCurrent * (1 - accept) / LCurrent.<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#Spectrum::y" class="code">y</a>());</div></div>
       &lt;&lt;<span class="fragmentname"><a href="#fragment-Acceptorrejecttheproposal-0">Accept or reject the proposal</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1871" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1871"><i></i></a><div id="fragbit-1871" class="collapse"><div class="fragmentcode">          if (rng.<a href="../Utilities/Main_Include_File.html#RNG::UniformFloat" class="code">UniformFloat</a>() &lt; accept) {
              pCurrent = pProposed;
              LCurrent = LProposed;
              sampler.<a href="#MLTSampler::Accept" class="code">Accept</a>();
          } else
              sampler.<a href="#MLTSampler::Reject" class="code">Reject</a>();</div></div>
   }</div></div></div><p>


</p>
<p>Every Markov chain instantiates its own pseudo-random number generator
following a unique stream. Note that this <tt>RNG</tt> instance is separate from
the one in <a href="#MLTSampler"><tt>MLTSampler</tt></a>: it is used to pick the initial state and to
accept or reject Metropolis proposals later on. Due to the ordering used
earlier when initializing the
entries of <tt>bootstrap</tt> array, we can immediately deduce the path depth of the
sampled index <tt>bootstrapIndex</tt>.
An important consequence of the method used to generate the <tt>bootstrap</tt>
distribution is that the expected number of sampled initial states with a given
depth value is proportional to their contribution to the image.

</p>
<p></p>
<span class="anchor" id="fragment-Selectinitialstatefromthesetofbootstrapsamples-0"></span><div class="fragmentname">&lt;&lt;Select initial state from the set of bootstrap samples&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Utilities/Main_Include_File.html#RNG" class="code">RNG</a> rng(i);
int bootstrapIndex = bootstrap.<a href="../Monte_Carlo_Integration/Sampling_Random_Variables.html#Distribution1D::SampleDiscrete" class="code">SampleDiscrete</a>(rng.<a href="../Utilities/Main_Include_File.html#RNG::UniformFloat" class="code">UniformFloat</a>());
int depth = bootstrapIndex % (<a href="#MLTIntegrator::maxDepth" class="code">maxDepth</a> + 1);</div><p>


</p>
<p>Having chosen the bootstrap sample, we must now obtain the corresponding
primary sample space vector <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.019ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 869.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper X</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="0" y="0"></use>
</g>
</svg>. One way to accomplish this would
have been to store all <tt>MLTSampler</tt> instances in the preprocessing
phase. A more efficient approach builds on the property that the
initialization in the <tt>MLTSampler</tt> constructor is completely
deterministic and just depends on the <tt>rngSequenceIndex</tt>
parameter. Thus, here we can create an <tt>MLTSampler</tt> with index
<tt>bootstrapIndex</tt>, which recreates the same sampler that
originally produced the sampled entry of the <tt>bootstrap</tt> distribution.

</p>
<p>With the sampler in hand, we can compute the current value of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.583ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 681.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper L</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43F" d="M643 247c0 0 0 -3 -4 -14l-79 -216c-6 -17 -7 -17 -31 -17h-463c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 12 20 19 20l133 -3l148 3c5 0 16 0 16 -12 c0 -19 -8 -19 -38 -19c-94 0 -97 -11 -106 -47l-135 -540c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h94c173 0 217 114 251 206c7 16 8 21 17 21s12 -7 12 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
</g>
</svg> and its
position on the film.

</p>
<p></p>
<span class="anchor" id="fragment-Initializelocalvariablesforselectedstate-0"></span><div class="fragmentname">&lt;&lt;Initialize local variables for selected state&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">MLTSampler sampler(<a href="#MLTIntegrator::mutationsPerPixel" class="code">mutationsPerPixel</a>, bootstrapIndex, <a href="#MLTIntegrator::sigma" class="code">sigma</a>,
                   <a href="#MLTIntegrator::largeStepProbability" class="code">largeStepProbability</a>, <a href="#MLTIntegrator::nSampleStreams" class="code">nSampleStreams</a>);
<a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> pCurrent;
<a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> LCurrent =
    <a href="#MLTIntegrator::L" class="code">L</a>(scene, arena, lightDistr, sampler, depth, &amp;pCurrent);</div><p>


</p>
<p>The implementation of the Metropolis sampling routine in the following
fragments follows the expected values technique from
Section&nbsp;<a href="../Monte_Carlo_Integration/Metropolis_Sampling.html#sec:metro-basic">13.4.1</a>: a mutation is proposed, the value of the
function for the mutated sample and the acceptance probability are
computed, and the weighted contributions of both the new and old samples
are recorded. The proposed mutation is then randomly accepted based on its
acceptance probability.

</p>
<p>One of the unique characteristics of MMLT
(Section&nbsp;<a href="#sec:multiplexed-mlt">16.4.2</a>) compared to
other Metropolis-type methods is that each Markov chain is restricted to paths
of a fixed <tt>depth</tt> value. The first sample dimension selects among
various different strategies, but only those producing equal path depths are
considered, which improves performance of the method by making proposals more
local. The contribution of all path depths is accounted for by starting many
Markov chains with different initial states.

</p>
<p></p>
<span class="anchor" id="fragment-RuntheMarkovchainformononChainMutationssteps-0"></span><div class="fragmentname">&lt;&lt;Run the Markov chain for <tt>nChainMutations</tt> steps&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">for (int64_t j = 0; j &lt; nChainMutations; ++j) {
    sampler.<a href="#MLTSampler::StartIteration" class="code">StartIteration</a>();
    <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> pProposed;
    <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> LProposed =
        <a href="#MLTIntegrator::L" class="code">L</a>(scene, arena, lightDistr, sampler, depth, &amp;pProposed);
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Computeacceptanceprobabilityforproposedsample-0">Compute acceptance probability for proposed sample</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1872" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1872"><i></i></a><div id="fragbit-1872" class="collapse"><div class="fragmentcode">       Float accept = std::min((Float)1, LProposed.<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#Spectrum::y" class="code">y</a>() / LCurrent.<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#Spectrum::y" class="code">y</a>());</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Splatbothcurrentandproposedsamplestomonofilm-0">Splat both current and proposed samples to <tt>film</tt></a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1873" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1873"><i></i></a><div id="fragbit-1873" class="collapse"><div class="fragmentcode">       if (accept &gt; 0)
           film.<a href="../Sampling_and_Reconstruction/Film_and_the_Imaging_Pipeline.html#Film::AddSplat" class="code">AddSplat</a>(pProposed, LProposed * accept / LProposed.<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#Spectrum::y" class="code">y</a>());
       film.<a href="../Sampling_and_Reconstruction/Film_and_the_Imaging_Pipeline.html#Film::AddSplat" class="code">AddSplat</a>(pCurrent, LCurrent * (1 - accept) / LCurrent.<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#Spectrum::y" class="code">y</a>());</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Acceptorrejecttheproposal-0">Accept or reject the proposal</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1874" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1874"><i></i></a><div id="fragbit-1874" class="collapse"><div class="fragmentcode">       if (rng.<a href="../Utilities/Main_Include_File.html#RNG::UniformFloat" class="code">UniformFloat</a>() &lt; accept) {
           pCurrent = pProposed;
           LCurrent = LProposed;
           sampler.<a href="#MLTSampler::Accept" class="code">Accept</a>();
       } else
           sampler.<a href="#MLTSampler::Reject" class="code">Reject</a>();</div></div>
}</div><p>


</p>
<p>Given the scalar contribution function&rsquo;s value, the acceptance probability
is then given by the simplified expression from
Equation&nbsp;(<a href="../Monte_Carlo_Integration/Metropolis_Sampling.html#eq:accept-equal-ts">13.8</a>) thanks to the symmetry of our mutations
on primary sample space.

</p>
<p>As described at the start of the section, the spectral radiance value
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.412ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2330 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper L left-parenthesis bold upper X right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43F" d="M643 247c0 0 0 -3 -4 -14l-79 -216c-6 -17 -7 -17 -31 -17h-463c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 12 20 19 20l133 -3l148 3c5 0 16 0 16 -12 c0 -19 -8 -19 -38 -19c-94 0 -97 -11 -106 -47l-135 -540c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h94c173 0 217 114 251 206c7 16 8 21 17 21s12 -7 12 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D417" d="M835 0c-35 3 -122 3 -162 3c-45 0 -140 0 -181 -3v47h83l-174 241l-165 -219c-2 -3 -7 -9 -8 -11c35 -11 74 -11 92 -11v-47c-36 3 -113 3 -152 3c-43 0 -92 0 -134 -3v47h29c20 0 41 1 61 3c32 3 34 5 43 17l202 265l-222 307h-98v47c35 -3 122 -3 162 -3 c45 0 140 0 181 3v-47h-83l143 -197l132 175c2 3 7 9 8 11c-35 11 -74 11 -92 11v47c36 -3 113 -3 152 -3c43 0 92 0 134 3v-47h-29c-28 0 -34 0 -58 -3c-35 -3 -36 -4 -47 -18l-168 -221l253 -350h98v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="681" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D417" x="1071" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1940" y="0"></use>
</g>
</svg> must be converted to a value given by the scalar contribution
function so that the acceptance probability can be computed for the
Metropolis sampling algorithm. Here, we compute the path&rsquo;s
luminance, which is a reasonable choice.

</p>
<p></p>
<span class="anchor" id="fragment-Computeacceptanceprobabilityforproposedsample-0"></span><div class="fragmentname">&lt;&lt;Compute acceptance probability for proposed sample&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Float accept = std::min((Float)1, LProposed.<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#Spectrum::y" class="code">y</a>() / LCurrent.<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#Spectrum::y" class="code">y</a>());</div><p>


</p>
<p>Both samples can now be added to the image.  Here, they are scaled with
weights based on the expected values optimization introduced in
Section&nbsp;<a href="../Monte_Carlo_Integration/Metropolis_Sampling.html#sec:metro-basic">13.4.1</a>.<button style="button" data-toggle="tooltip" data-placement="right" data-html="true" class="btn footnote-button" title="Kelemen et al. (2002) suggested a
slightly more efficient implementation of this logic where only the sample
that is rejected is splatted to the film, and the contribution of the
accepted sample is accumulated in a local variable here until it is
eventually rejected.  This approach would halve the number of
<tt>Film::AddSplat()</tt> calls while still computing the same result.">
      <sup>&dagger;</sup>
    </button>
		

</p>
<p></p>
<span class="anchor" id="fragment-Splatbothcurrentandproposedsamplestomonofilm-0"></span><div class="fragmentname">&lt;&lt;Splat both current and proposed samples to <tt>film</tt>&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">if (accept &gt; 0)
    film.<a href="../Sampling_and_Reconstruction/Film_and_the_Imaging_Pipeline.html#Film::AddSplat" class="code">AddSplat</a>(pProposed, LProposed * accept / LProposed.<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#Spectrum::y" class="code">y</a>());
film.<a href="../Sampling_and_Reconstruction/Film_and_the_Imaging_Pipeline.html#Film::AddSplat" class="code">AddSplat</a>(pCurrent, LCurrent * (1 - accept) / LCurrent.<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#Spectrum::y" class="code">y</a>());</div><p>


</p>
<p>Finally, the proposed mutation is either accepted or rejected, based on the
computed acceptance probability <tt>accept</tt>. If the mutation is accepted,
then the values <tt>pProposed</tt> and <tt>LProposed</tt> become properties of
the current state. In either case, the <a href="#MLTSampler"><tt>MLTSampler</tt></a> must be informed of the
outcome so that it can update the <a href="#PrimarySample"><tt>PrimarySample</tt></a> accordingly.

</p>
<p></p>
<span class="anchor" id="fragment-Acceptorrejecttheproposal-0"></span><div class="fragmentname">&lt;&lt;Accept or reject the proposal&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">if (rng.<a href="../Utilities/Main_Include_File.html#RNG::UniformFloat" class="code">UniformFloat</a>() &lt; accept) {
    pCurrent = pProposed;
    LCurrent = LProposed;
    sampler.<a href="#MLTSampler::Accept" class="code">Accept</a>();
} else
    sampler.<a href="#MLTSampler::Reject" class="code">Reject</a>();</div><p>


</p>
<p>Metropolis sampling only considers the <em>relative</em> frequency of samples
and cannot create an image that is correctly scaled in <em>absolute</em>
terms; hence the value <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.998ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 429.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">b</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="0" y="0"></use>
</g>
</svg> is crucial: it contains an estimate of the
average luminance of the <tt>Film</tt> that we use to remove this
ambiguity. Each Metropolis iteration within &lt;&lt;<span class="fragmentname"><a href="#fragment-RunmononChainsMarkovchainsinparallel-0">Run <tt>nChains</tt>
Markov chains in parallel</a></span>&gt;&gt; has splatted contributions with weighted unit luminance
to the <a href="../Sampling_and_Reconstruction/Film_and_the_Imaging_Pipeline.html#Film"><tt>Film</tt></a> so that the final average film luminance before
<a href="../Sampling_and_Reconstruction/Film_and_the_Imaging_Pipeline.html#Film::WriteImage"><tt>Film::WriteImage()</tt></a> is exactly equal to <tt>mutationsPerPixel</tt>. We
thus must cancel this factor out and multiply by <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.998ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 429.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">b</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="0" y="0"></use>
</g>
</svg> when writing the image
to convert to actual incident radiance on the film.

</p>
<p></p>
<span class="anchor" id="fragment-StorefinalimagecomputedwithMLT-0"></span><div class="fragmentname">&lt;&lt;Store final image computed with MLT&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="#MLTIntegrator::camera" class="code">camera</a>-&gt;<a href="../Camera_Models/Camera_Model.html#Camera::film" class="code">film</a>-&gt;<a href="../Sampling_and_Reconstruction/Film_and_the_Imaging_Pipeline.html#Film::WriteImage" class="code">WriteImage</a>(b / <a href="#MLTIntegrator::mutationsPerPixel" class="code">mutationsPerPixel</a>);</div><p>


</p>
<p>

</p>
<p>

</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

</div>  <!-- container-fluid -->
</div>  <!-- maincontainer -->

<nav class="navbar navbar-expand-md bg-light navbar-light">
  <div class="container-fluid-nav">
    <!--  <ul class="nav navbar-nav navbar-center"> -->
      <span class="navbar-text" style="text-align: center;">
        Thanks to Farhan Wali and 43 others for generously supporting <i>Physically
        Based Rendering</i> online
        through <a href="https://patreon.com/pbrbook">Patreon</a>.
    </span>
  </div>
</nav>

<nav class="navbar navbar-expand-md bg-light navbar-light">
  <span class="navbar-text"><i>Physically Based Rendering: From Theory To Implementation</i>, &copy; 2004-2021 Matt Pharr, Wenzel Jakob, and Greg Humphreys under the <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/">CC BY-NC-ND 4.0</a> license. (<a href="https://github.com/mmp/pbr-book-website/">github</a>)</span>
  <div class="container">
    <ul class="nav navbar-nav ml-auto">
      <li class="nav-item">Next: <a href="../Light_Transport_III_Bidirectional_Methods/Further_Reading.html">Light Transport III: Bidirectional Methods / Further Reading</a></li>
    </ul>
  </div>

</nav>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script>
  $(function () {
    $('[data-toggle="popover"]').popover()
    $('[data-toggle="tooltip"]').tooltip()
   })
</script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

<script>
// https://stackoverflow.com/a/17535094
// The function actually applying the offset
function offsetAnchor() {
  if (location.hash.length !== 0) {
    window.scrollTo(window.scrollX, window.scrollY - window.innerHeight / 8);
  }
}

// Captures click events of all <a> elements with href starting with #
$(document).on('click', 'a[href^="#"]', function(event) {
  // Click events are captured before hashchanges. Timeout
  // causes offsetAnchor to be called after the page jump.
  window.setTimeout(function() {
    offsetAnchor();
  }, 500);
});

// Set the offset when entering page with hash present in the url
window.setTimeout(offsetAnchor, 1500);
</script>

</body>
</html>
