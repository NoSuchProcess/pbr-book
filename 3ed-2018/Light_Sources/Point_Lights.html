
<!doctype html>
<html lang="en">
<head>

<!-- all praise to https://realfavicongenerator.net -->
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="/fonts.css">
  <link rel="stylesheet" href="../pbrstyle.css">
  <link rel="stylesheet" href="/fontawesome-free-5.15.3-web/css/all.css">

  <script async src="https://cse.google.com/cse.js?cx=003601324460585362024:4xwpwgaitgd"></script>
  <script src="/react.min.js"></script>
  <script src="/react-dom.min.js"></script>
  <script src="/jeri.min.js"></script>
  <link rel="preload" href="/exr.worker.js" as="script" crossorigin="anonymous">
        
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="/bootstrap.min.css">

  <title>Point Lights</title>
</head>
        
<body>

<nav class="fixed-top-lg-navbar navbar navbar-expand bg-light navbar-light">
  <ul class="nav navbar-nav">
    <a class="navbar-brand" href="../contents.html"><img src="../pbr.jpg" width=25 height=25></a>
    <li class="nav-item"><a class="nav-link" href="../Light_Sources.html">Light Sources</a></li>
    <span class="navbar-text">/</span>
    <li class="nav-item"><a class="nav-link" href="#">Point Lights</a></li>
    <span class="navbar-text">&nbsp;&nbsp;</span>
    <li class="nav-item"><a class="nav-link" href="../Light_Sources/Light_Interface.html">(Previous: Light Interface)</a></li>
  </ul>

  <ul class="nav navbar-nav ml-auto d-none d-md-block">
        <li class="nav-item"><div class="gcse-search"></div></li>
    </ul>
  <ul class="nav navbar-nav d-block d-md-none">
        <li class="nav-item"><div class="gcse-search"></div></li>
    </ul>
</nav>

<div class="maincontainer">
<div class="container-fluid">

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#"><i class="fas fa-link "></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:point-lights"></span><h2>12.3 Point Lights</h2><p>



</p>
<p>

</p>
<p>A number of interesting lights can be described in terms of emission from a
single point in space with some possibly angularly varying distribution of
outgoing light.  This section describes the implementation of a number of
them, starting with <a href="#PointLight"><tt>PointLight</tt></a>, which represents an isotropic
point light source that emits the same amount of light in all directions.
It is defined in <a href="https://github.com/mmp/pbrt-v3/tree/master/src/lights/point.h"><tt>lights/point.h</tt></a><span class="anchor" id="lightspoint.h"></span> and
<a href="https://github.com/mmp/pbrt-v3/tree/master/src/lights/point.cpp"><tt>lights/point.cpp</tt></a><span class="anchor" id="lightspoint.cpp"></span>.
Figure&nbsp;<a href="#fig:light-pointlight">12.6</a> shows a scene rendered with a point light
source.  Building on this base,
 a number of more complex lights based on
point sources will be introduced, including spotlights and a light that
projects an image into the scene.

</p>
<p>
</p>
<span class="anchor" id="fig:light-pointlight"></span><div class="card outerfigure"><div class="card-body figure"><p>


</p>
<div class="figure-row">
<img src="dragon-point.png" style="max-width: 100%; height: auto;" width=900 height=900>
</div>
<p>

</p>
<figcaption class="caption">Figure 12.6: Scene Rendered with a Point Light
Source. <span class="legend">  Notice the hard shadow boundaries from this type of light.</span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p></p>
<span class="anchor" id="fragment-PointLightDeclarations-0"></span><div class="fragmentname">&lt;&lt;PointLight Declarations&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">class <span class="anchor" id="PointLight"></span>PointLight : public <a href="../Light_Sources/Light_Interface.html#Light" class="code">Light</a> {
public:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-PointLightPublicMethods-0">PointLight Public Methods</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1160" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1160"><i></i></a><div id="fragbit-1160" class="collapse"><div class="fragmentcode">       PointLight(const <a href="../Geometry_and_Transformations/Transformations.html#Transform" class="code">Transform</a> &amp;LightToWorld,
                  const MediumInterface &amp;mediumInterface, const <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> &amp;<a href="#PointLight::I" class="code">I</a>)
           : <a href="../Light_Sources/Light_Interface.html#Light" class="code">Light</a>((int)<a href="../Light_Sources/Light_Interface.html#LightFlags" class="code">LightFlags</a>::DeltaPosition, LightToWorld,
                   mediumInterface),
             <a href="#PointLight::pLight" class="code">pLight</a>(LightToWorld(<a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a>(0, 0, 0))), <a href="#PointLight::I" class="code">I</a>(<a href="#PointLight::I" class="code">I</a>) { }
       <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> Sample_Li(const <a href="../Geometry_and_Transformations/Interactions.html#Interaction" class="code">Interaction</a> &amp;ref, const <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> &amp;u, <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> *wi, Float *pdf, <a href="../Light_Sources/Light_Interface.html#VisibilityTester" class="code">VisibilityTester</a> *vis) const;
       <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> Power() const;
       Float Pdf_Li(const <a href="../Geometry_and_Transformations/Interactions.html#Interaction" class="code">Interaction</a> &amp;, const <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> &amp;) const;
       <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> Sample_Le(const <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> &amp;u1, const <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> &amp;u2,
           Float time, <a href="../Geometry_and_Transformations/Rays.html#Ray" class="code">Ray</a> *ray, <a href="../Geometry_and_Transformations/Normals.html#Normal3f" class="code">Normal3f</a> *nLight, Float *pdfPos, Float *pdfDir) const;
       void Pdf_Le(const <a href="../Geometry_and_Transformations/Rays.html#Ray" class="code">Ray</a> &amp;, const <a href="../Geometry_and_Transformations/Normals.html#Normal3f" class="code">Normal3f</a> &amp;, Float *pdfPos, Float *pdfDir) const;</div></div>
private:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-PointLightPrivateData-0">PointLight Private Data</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1161" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1161"><i></i></a><div id="fragbit-1161" class="collapse"><div class="fragmentcode">       const <a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a> pLight;
       const <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> I;</div></div>
};</div><p>


</p>
<p><a href="#PointLight"><tt>PointLight</tt></a>s are positioned at the origin in light space. To place
them elsewhere, the light-to-world transformation should be set
appropriately.  Using this transformation, the world space position of the
light is precomputed and cached in the constructor by transforming
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.365ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 3170.8 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis 0 comma 0 comma 0 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="890" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="1335" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1835" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="2280" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2781" y="0"></use>
</g>
</svg> from light space to world space.

</p>
<p>The constructor also stores the intensity for the light source, which is
the amount of power per unit solid angle.  Because the light source is
isotropic, this is a constant.  Finally, since point lights represent
singularities that only emit light from a single position, the
<a href="../Light_Sources/Light_Interface.html#Light::flags"><tt>Light::flags</tt></a> field is initialized to <a href="../Light_Sources/Light_Interface.html#LightFlags::DeltaPosition"><tt>LightFlags::DeltaPosition</tt></a>.

</p>
<p></p>
<span class="anchor" id="fragment-PointLightPublicMethods-0"></span><div class="fragmentname">&lt;&lt;PointLight Public Methods&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">PointLight(const <a href="../Geometry_and_Transformations/Transformations.html#Transform" class="code">Transform</a> &amp;LightToWorld,
           const MediumInterface &amp;mediumInterface, const <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> &amp;<a href="#PointLight::I" class="code">I</a>)
    : <a href="../Light_Sources/Light_Interface.html#Light" class="code">Light</a>((int)<a href="../Light_Sources/Light_Interface.html#LightFlags" class="code">LightFlags</a>::DeltaPosition, LightToWorld,
            mediumInterface),
      <a href="#PointLight::pLight" class="code">pLight</a>(LightToWorld(<a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a>(0, 0, 0))), <a href="#PointLight::I" class="code">I</a>(<a href="#PointLight::I" class="code">I</a>) { }</div><p>


</p>
<p></p>
<span class="anchor" id="fragment-PointLightPrivateData-0"></span><div class="fragmentname">&lt;&lt;PointLight Private Data&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">const <a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a> <span class="anchor" id="PointLight::pLight"></span>pLight;
const <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> <span class="anchor" id="PointLight::I"></span>I;</div><p>


</p>
<p>

</p>
<p>Strictly speaking, it is incorrect to describe the light arriving at a
point due to a point light source using units of radiance.  Radiant
intensity is instead the proper unit for describing emission from a point
light source, as explained in Section&nbsp;<a href="../Color_and_Radiometry/Radiometry.html#sec:radiometry">5.4</a>.  In the light
source interfaces here, however, we will abuse terminology
and use <tt>Sample_Li()</tt> methods to report the illumination arriving at a
point for all types of light sources, dividing radiant intensity by the
squared distance to the point&nbsp;p to convert units.  Section&nbsp;<a href="../Light_Transport_I_Surface_Reflection/Sampling_Light_Sources.html#sec:sampling-lights">14.2</a>
revisits the details of this issue in its discussion of how delta
distributions affect evaluation of the integral in the scattering equation.
In the end, the correctness of the computation does not suffer from this
fudge, and it makes the implementation of light transport algorithms
more straightforward by not requiring them to use different interfaces for
different types of lights.

</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-PointLightMethodDefinitions-0"></span><div class="fragmentname">&lt;&lt;PointLight Method Definitions&gt;&gt;=&nbsp;<a href="#fragment-PointLightMethodDefinitions-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode"><a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> PointLight::<span class="anchor" id="PointLight::Sample_Li"></span>Sample_Li(const <a href="../Geometry_and_Transformations/Interactions.html#Interaction" class="code">Interaction</a> &amp;ref,
        const <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> &amp;u, <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> *wi, Float *pdf,
        <a href="../Light_Sources/Light_Interface.html#VisibilityTester" class="code">VisibilityTester</a> *vis) const {
    *wi = <a href="../Geometry_and_Transformations/Vectors.html#Vector3::Normalize" class="code">Normalize</a>(<a href="#PointLight::pLight" class="code">pLight</a> - ref.<a href="../Geometry_and_Transformations/Interactions.html#Interaction::p" class="code">p</a>);
    *pdf = 1.f;
    *vis = <a href="../Light_Sources/Light_Interface.html#VisibilityTester" class="code">VisibilityTester</a>(ref, <a href="../Geometry_and_Transformations/Interactions.html#Interaction" class="code">Interaction</a>(<a href="#PointLight::pLight" class="code">pLight</a>, ref.<a href="../Geometry_and_Transformations/Interactions.html#Interaction::time" class="code">time</a>,
                                             <a href="../Light_Sources/Light_Interface.html#Light::mediumInterface" class="code">mediumInterface</a>));
    return <a href="#PointLight::I" class="code">I</a> / <a href="../Geometry_and_Transformations/Points.html#DistanceSquared" class="code">DistanceSquared</a>(<a href="#PointLight::pLight" class="code">pLight</a>, ref.<a href="../Geometry_and_Transformations/Interactions.html#Interaction::p" class="code">p</a>);
}</div><p>


</p>
<p>The total power emitted by the light source can be found by integrating the
intensity over the entire sphere of directions:
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="31.224ex" height="5.676ex" style="vertical-align: -2.338ex;" viewBox="0 -1437.2 13443.4 2443.8" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal upper Phi equals integral Underscript script upper S squared Endscripts upper I normal d omega Subscript Baseline equals upper I integral Underscript script upper S squared Endscripts normal d omega Subscript Baseline equals 4 pi upper I period</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-3A6" d="M665 341c0 -101 -111 -194 -266 -206v-56c0 -35 0 -48 95 -48h33v-31c-36 3 -129 3 -170 3s-133 0 -169 -3v31h33c95 0 95 14 95 48v56c-149 15 -260 104 -260 207c0 99 107 191 260 206v56c0 35 0 48 -95 48h-33v31c36 -3 129 -3 170 -3s133 0 169 3v-31h-33 c-95 0 -95 -14 -95 -48v-56c152 -12 266 -103 266 -207zM316 158v367c-150 -20 -160 -132 -160 -184c0 -62 18 -164 160 -183zM565 342c0 76 -28 168 -166 184v-369c151 18 166 125 166 185Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNSIZE1-222B" d="M943 1268c0 -35 -25 -50 -49 -50c-23 0 -48 16 -48 49c0 25 17 47 50 49c-4 4 -29 23 -60 23c-39 0 -73 -129 -85 -178c-34 -129 -71 -329 -108 -542c-54 -321 -119 -640 -196 -956c-71 -290 -128 -524 -280 -524c-61 0 -111 42 -111 93c0 35 25 50 49 50 c23 0 48 -16 48 -49c0 -25 -17 -47 -49 -49c0 0 25 -23 61 -23c81 0 127 188 145 261c33 139 62 306 88 459c110 654 246 1156 249 1167c55 204 111 313 187 313c55 0 109 -39 109 -93Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-53" d="M499 186c0 -110 -80 -208 -197 -208c-89 0 -153 36 -184 70c-33 -53 -36 -57 -36 -57c-7 -11 -8 -13 -15 -13c-11 0 -11 7 -11 24v200c0 18 0 25 13 25c3 0 11 0 12 -10c1 -36 4 -100 62 -154c53 -49 129 -54 158 -54c84 0 134 72 134 143c0 33 -10 66 -31 92 c-28 37 -58 44 -85 51c-70 17 -121 29 -132 33c-78 27 -131 100 -131 183c0 106 84 194 195 194c89 0 130 -41 160 -70l35 57c7 12 8 13 15 13c11 0 11 -7 11 -24v-201c0 -19 0 -24 -13 -24c-11 0 -11 6 -12 12c-6 45 -28 209 -195 209c-78 0 -132 -61 -132 -131 c0 -58 39 -112 101 -127l128 -31c84 -20 150 -102 150 -202Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43C" d="M497 671c0 -19 -8 -19 -32 -19c-79 0 -82 -10 -91 -46l-134 -533c-2 -7 -4 -15 -4 -23c0 -11 4 -15 25 -17c20 -2 25 -2 43 -2c22 0 30 0 30 -12c0 -19 -12 -19 -20 -19l-134 3l-131 -3c-3 0 -15 0 -15 11c0 20 9 20 32 20c79 0 82 10 91 47l135 539c2 9 2 11 2 16 c0 19 -27 19 -69 19c-19 0 -28 0 -28 11c0 20 13 20 20 20l133 -3l132 3c4 0 15 0 15 -12Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-64" d="M527 0l-147 -11v66c-25 -32 -70 -66 -134 -66c-114 0 -212 99 -212 226c0 129 105 227 223 227c54 0 97 -26 126 -62v216c0 49 -8 56 -78 56v31l144 11v-607c0 -49 8 -56 78 -56v-31zM380 118v205c0 18 0 20 -11 37c-31 45 -73 60 -108 60c-54 0 -92 -33 -113 -64 c-29 -45 -31 -105 -31 -142c0 -41 3 -98 29 -139c24 -38 60 -64 105 -64c43 0 88 22 118 70c11 17 11 19 11 37Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D714" d="M604 372c0 -40 -12 -90 -23 -133c-30 -121 -93 -250 -197 -250c-67 0 -102 44 -113 106c-38 -62 -90 -106 -153 -106c-76 0 -105 62 -105 143c0 35 5 74 15 112c16 63 41 127 82 184c5 6 12 9 18 9c3 0 6 0 9 -2c5 -3 9 -8 9 -14c0 -4 -2 -9 -5 -13 c-38 -53 -74 -109 -89 -169c-5 -22 -8 -45 -8 -65c0 -63 26 -113 87 -113c55 0 103 39 136 93c1 29 5 59 13 90c5 22 15 47 34 47c14 0 19 -11 19 -26c0 -8 -2 -17 -4 -26c-7 -30 -17 -60 -30 -88c9 -52 42 -90 98 -90c79 0 137 92 160 183c3 12 4 25 4 37 c0 35 -13 66 -38 88c-7 7 -11 15 -11 25c0 11 5 22 14 32c10 10 23 16 35 16c9 0 17 -3 23 -9c15 -13 20 -35 20 -61Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-34" d="M471 165h-100v-87c0 -36 2 -47 76 -47h21v-31c-41 3 -94 3 -136 3s-94 0 -135 -3v31h21c74 0 76 11 76 47v87h-266v31l307 469c8 12 11 12 20 12c16 0 16 -6 16 -26v-455h100v-31zM300 196v373l-244 -373h244Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D70B" d="M567 407c0 -34 -36 -34 -49 -34h-114c-11 -52 -18 -106 -18 -159c0 -28 0 -93 29 -165c6 -14 6 -16 6 -22c0 -20 -21 -38 -41 -38c-15 0 -26 6 -36 50c-8 34 -8 61 -8 76c0 67 9 110 42 258h-113l-56 -221c-13 -50 -13 -52 -27 -98c-12 -37 -20 -65 -50 -65 c-13 0 -29 8 -29 27c0 7 0 9 8 24c42 91 96 212 128 333h-57c-20 0 -78 0 -127 -77c-6 -8 -8 -12 -16 -12c-12 0 -12 10 -12 10c0 5 26 51 61 90c44 47 82 47 104 47h335c19 0 40 0 40 -24Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-3A6" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="1000" y="0"></use>
<g transform="translate(2056,0)">
 <use xlink:href="#E1-LATINMODERNSIZE1-222B" x="0" y="0"></use>
<g transform="translate(574,-898)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-53" x="0" y="0"></use>
 <use transform="scale(0.574)" xlink:href="#E1-LATINMODERNMAIN-32" x="685" y="483"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43C" x="3649" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-64" x="4313" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D714" x="4869" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="5770" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43C" x="6826" y="0"></use>
<g transform="translate(7490,0)">
 <use xlink:href="#E1-LATINMODERNSIZE1-222B" x="0" y="0"></use>
<g transform="translate(574,-898)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-53" x="0" y="0"></use>
 <use transform="scale(0.574)" xlink:href="#E1-LATINMODERNMAIN-32" x="685" y="483"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-64" x="9083" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D714" x="9639" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="10540" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-34" x="11596" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D70B" x="12096" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43C" x="12667" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="13164" y="0"></use>
</g>
</svg>
</div>
<p>


</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-PointLightMethodDefinitions-1"></span><div class="fragmentname">&lt;&lt;PointLight Method Definitions&gt;&gt;+=&nbsp;<a href="#fragment-PointLightMethodDefinitions-0"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="../Light_Transport_I_Surface_Reflection/Sampling_Light_Sources.html#fragment-PointLightMethodDefinitions-2"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode"><a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> <span class="anchor" id="PointLight::Power"></span>PointLight::Power() const {
    return 4 * <a href="../Utilities/Main_Include_File.html#Pi" class="code">Pi</a> * <a href="#PointLight::I" class="code">I</a>;
}</div><p>


</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#Spotlights"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:spotlight"></span><span id="Spotlights"></span><h3>12.3.1  Spotlights</h3><p>



</p>
<p>

</p>
<p>
Spotlights are a handy variation on point lights; rather than shining
illumination in all directions, they emit light in a cone of directions
from their position.  For simplicity, we will define the spotlight in the
light coordinate system to always be at position <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.365ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 3170.8 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis 0 comma 0 comma 0 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="890" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="1335" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1835" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="2280" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2781" y="0"></use>
</g>
</svg> and pointing
down the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.894ex" height="2.176ex" style="vertical-align: -0.505ex;" viewBox="0 -719.6 1246 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">plus z</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D467" d="M467 432c0 -4 -22 -52 -117 -145c-36 -36 -98 -90 -98 -90c-36 -31 -65 -56 -119 -114c9 3 27 3 27 3c21 0 36 -4 70 -17c21 -7 39 -13 59 -13c33 0 97 19 120 84c3 7 5 13 14 13c8 0 12 -5 12 -10c0 -27 -58 -154 -157 -154c-29 0 -47 16 -64 37c-25 29 -35 38 -58 38 c-32 0 -62 -27 -85 -62c-6 -11 -8 -13 -16 -13c0 0 -12 0 -12 10c0 7 35 64 103 131l90 84c19 16 103 88 139 131c-26 0 -37 0 -77 15c-23 8 -42 15 -63 15c-8 0 -66 -1 -85 -47c-2 -6 -4 -11 -13 -11s-12 6 -12 11c0 21 46 114 121 114c33 0 50 -20 69 -43 c15 -17 27 -32 51 -32s45 16 75 64c5 9 8 11 15 11c0 0 11 0 11 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D467" x="778" y="0"></use>
</g>
</svg> axis.  To place or orient it elsewhere in the scene, the
<a href="../Light_Sources/Light_Interface.html#Light::WorldToLight"><tt>Light::WorldToLight</tt></a> transformation should be set accordingly.
Figure&nbsp;<a href="#fig:light-spotlight">12.7</a> shows a rendering of the same scene as
Figure&nbsp;<a href="#fig:light-pointlight">12.6</a>, only illuminated with a spotlight
instead of a point light.  The <a href="#SpotLight"><tt>SpotLight</tt></a> class is defined in
<a href="https://github.com/mmp/pbrt-v3/tree/master/src/lights/spot.h"><tt>lights/spot.h</tt></a><span class="anchor" id="lightsspot.h"></span> and
<a href="https://github.com/mmp/pbrt-v3/tree/master/src/lights/spot.cpp"><tt>lights/spot.cpp</tt></a><span class="anchor" id="lightsspot.cpp"></span>.

</p>
<p>
 </p>
<span class="anchor" id="fig:light-spotlight"></span><div class="card outerfigure"><div class="card-body figure"><p>


</p>
<div class="figure-row">
<img src="dragon-spot.png" style="max-width: 100%; height: auto;" width=900 height=900>
</div>
<p>

</p>
<figcaption class="caption">Figure 12.7: Scene Rendered with a Spotlight. <span class="legend">  The
spotlight cone smoothly cuts off illumination past a user-specified angle
from the light&rsquo;s central axis.</span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p></p>
<span class="anchor" id="fragment-SpotLightDeclarations-0"></span><div class="fragmentname">&lt;&lt;SpotLight Declarations&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">class <span class="anchor" id="SpotLight"></span>SpotLight : public <a href="../Light_Sources/Light_Interface.html#Light" class="code">Light</a> {
public:
    &lt;&lt;<span class="fragmentname">SpotLight Public Methods</span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1162" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1162"><i></i></a><div id="fragbit-1162" class="collapse"><div class="fragmentcode">       SpotLight(const <a href="../Geometry_and_Transformations/Transformations.html#Transform" class="code">Transform</a> &amp;LightToWorld, const MediumInterface &amp;m, const <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> &amp;I,
                 Float totalWidth, Float falloffStart);
       <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> Sample_Li(const <a href="../Geometry_and_Transformations/Interactions.html#Interaction" class="code">Interaction</a> &amp;ref, const <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> &amp;u,
           <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> *wi, Float *pdf, <a href="../Light_Sources/Light_Interface.html#VisibilityTester" class="code">VisibilityTester</a> *vis) const;
       Float Falloff(const <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> &amp;w) const;
       <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> Power() const;
       Float Pdf_Li(const <a href="../Geometry_and_Transformations/Interactions.html#Interaction" class="code">Interaction</a> &amp;, const <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> &amp;) const;
       <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> Sample_Le(const <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> &amp;u1, const <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> &amp;u2,
                          Float time, <a href="../Geometry_and_Transformations/Rays.html#Ray" class="code">Ray</a> *ray, <a href="../Geometry_and_Transformations/Normals.html#Normal3f" class="code">Normal3f</a> *nLight, Float *pdfPos,
                          Float *pdfDir) const;
       void Pdf_Le(const <a href="../Geometry_and_Transformations/Rays.html#Ray" class="code">Ray</a> &amp;, const <a href="../Geometry_and_Transformations/Normals.html#Normal3f" class="code">Normal3f</a> &amp;, Float *pdfPos, Float *pdfDir) const;</div></div>
private:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-SpotLightPrivateData-0">SpotLight Private Data</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1163" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1163"><i></i></a><div id="fragbit-1163" class="collapse"><div class="fragmentcode">       const <a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a> pLight;
       const <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> I;
       const Float cosTotalWidth, cosFalloffStart;</div></div>
};</div><p>


</p>
<p>Two angles are passed to the constructor to set the extent of the
<a href="#SpotLight"><tt>SpotLight</tt></a>&rsquo;s cone: the overall angular width of the cone and the
angle at which falloff starts (Figure&nbsp;<a href="#fig:spotlight">12.8</a>).  The
constructor precomputes
and stores the cosines of these angles for use in the <tt>SpotLight</tt>&rsquo;s
methods.

</p>
<p> </p>
<span class="anchor" id="fig:spotlight"></span><div class="card outerfigure"><div class="card-body figure"><p>



</p>
<div class="figure-row">
  <a href="Spotlight%20angles.svg" title=""><img src="Spotlight%20angles.svg" width=305 height=222 style="max-width: 100%;"></a>
</div>
<p>


</p>
<figcaption class="caption">Figure 12.8: <span class="legend"> Spotlights are defined by two angles,
<em>falloffStart</em> and <em>totalWidth</em>.  Objects inside the inner cone
of angles, up to <em>falloffStart</em>, are fully illuminated by the light.
The directions between <em>falloffStart</em> and <em>totalWidth</em> are a
transition zone that ramps down from full illumination to no illumination,
such that points outside the <em>totalWidth</em> cone aren&rsquo;t illuminated at
all.  The cosine of the angle between the vector to a point&nbsp;p and the
spotlight axis, <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 469.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">theta</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D703" d="M455 500c0 -224 -152 -511 -293 -511c-91 0 -120 111 -120 205c0 229 154 511 293 511c102 0 120 -139 120 -205zM389 562c0 57 -6 121 -55 121c-45 0 -82 -56 -109 -105c-40 -71 -60 -151 -77 -215h209c24 99 32 150 32 199zM348 331h-208c-26 -98 -32 -156 -32 -198 c0 -93 21 -122 54 -122c43 0 81 49 116 117c38 72 59 157 70 203Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D703" x="0" y="0"></use>
</g>
</svg>, can easily be computed with a dot product.</span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-SpotLightMethodDefinitions-0"></span><div class="fragmentname">&lt;&lt;SpotLight Method Definitions&gt;&gt;=&nbsp;<a href="#fragment-SpotLightMethodDefinitions-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">SpotLight::SpotLight(const <a href="../Geometry_and_Transformations/Transformations.html#Transform" class="code">Transform</a> &amp;<a href="../Light_Sources/Light_Interface.html#Light::LightToWorld" class="code">LightToWorld</a>,
        const MediumInterface &amp;mediumInterface, const <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> &amp;<a href="#SpotLight::I" class="code">I</a>,
        Float totalWidth, Float falloffStart)
    : <a href="../Light_Sources/Light_Interface.html#Light" class="code">Light</a>((int)<a href="../Light_Sources/Light_Interface.html#LightFlags" class="code">LightFlags</a>::DeltaPosition, <a href="../Light_Sources/Light_Interface.html#Light::LightToWorld" class="code">LightToWorld</a>,
            mediumInterface),
      <a href="#SpotLight::pLight" class="code">pLight</a>(<a href="../Light_Sources/Light_Interface.html#Light::LightToWorld" class="code">LightToWorld</a>(<a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a>(0, 0, 0))), <a href="#SpotLight::I" class="code">I</a>(<a href="#SpotLight::I" class="code">I</a>),
      <a href="#SpotLight::cosTotalWidth" class="code">cosTotalWidth</a>(std::cos(<a href="../Utilities/Main_Include_File.html#Radians" class="code">Radians</a>(totalWidth))),
      <a href="#SpotLight::cosFalloffStart" class="code">cosFalloffStart</a>(std::cos(<a href="../Utilities/Main_Include_File.html#Radians" class="code">Radians</a>(falloffStart))) { }</div><p>


</p>
<p></p>
<span class="anchor" id="fragment-SpotLightPrivateData-0"></span><div class="fragmentname">&lt;&lt;SpotLight Private Data&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">const <a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a> <span class="anchor" id="SpotLight::pLight"></span>pLight;
const <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> <span class="anchor" id="SpotLight::I"></span>I;
const Float <span class="anchor" id="SpotLight::cosTotalWidth"></span>cosTotalWidth, <span class="anchor" id="SpotLight::cosFalloffStart"></span>cosFalloffStart;</div><p>


</p>
<p>The <a href="#SpotLight::Sample_Li"><tt>SpotLight::Sample_Li()</tt></a> method is almost identical to
<a href="#PointLight::Sample_Li"><tt>PointLight::Sample_Li()</tt></a>, except that it also calls the
<tt>Falloff()</tt> method, which computes the distribution of light
accounting for the spotlight cone.  This computation is encapsulated in a
separate method since other <tt>SpotLight</tt> methods will need to perform
it as well.

</p>
<p></p>
<span class="anchor" id="fragment-SpotLightMethodDefinitions-1"></span><div class="fragmentname">&lt;&lt;SpotLight Method Definitions&gt;&gt;+=&nbsp;<a href="#fragment-SpotLightMethodDefinitions-0"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-SpotLightMethodDefinitions-2"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode"><a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> SpotLight::<span class="anchor" id="SpotLight::Sample_Li"></span>Sample_Li(const <a href="../Geometry_and_Transformations/Interactions.html#Interaction" class="code">Interaction</a> &amp;ref,
        const <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> &amp;u, <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> *wi, Float *pdf,
        <a href="../Light_Sources/Light_Interface.html#VisibilityTester" class="code">VisibilityTester</a> *vis) const {
    *wi = <a href="../Geometry_and_Transformations/Vectors.html#Vector3::Normalize" class="code">Normalize</a>(<a href="#SpotLight::pLight" class="code">pLight</a> - ref.<a href="../Geometry_and_Transformations/Interactions.html#Interaction::p" class="code">p</a>);
    *pdf = 1.f;
    *vis = <a href="../Light_Sources/Light_Interface.html#VisibilityTester" class="code">VisibilityTester</a>(ref, <a href="../Geometry_and_Transformations/Interactions.html#Interaction" class="code">Interaction</a>(<a href="#SpotLight::pLight" class="code">pLight</a>, ref.<a href="../Geometry_and_Transformations/Interactions.html#Interaction::time" class="code">time</a>,
                                             <a href="../Light_Sources/Light_Interface.html#Light::mediumInterface" class="code">mediumInterface</a>));
    return <a href="#SpotLight::I" class="code">I</a> * <a href="#SpotLight::Falloff" class="code">Falloff</a>(-*wi) / <a href="../Geometry_and_Transformations/Points.html#DistanceSquared" class="code">DistanceSquared</a>(<a href="#SpotLight::pLight" class="code">pLight</a>, ref.<a href="../Geometry_and_Transformations/Interactions.html#Interaction::p" class="code">p</a>);
}</div><p>


</p>
<p>To compute the spotlight&rsquo;s strength for a receiving point <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.293ex" height="2.009ex" style="vertical-align: -0.671ex;" viewBox="0 -576.1 556.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal p Subscript</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="0" y="0"></use>
</g>
</svg>, this first
step is to compute the cosine of the angle between the vector from the
spotlight origin to <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.293ex" height="2.009ex" style="vertical-align: -0.671ex;" viewBox="0 -576.1 556.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal p Subscript</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="0" y="0"></use>
</g>
</svg> and the vector along the center of the spotlight&rsquo;s
cone.  To compute the cosine of the offset angle to a point&nbsp;p, we have,
as illustrated in Figure&nbsp;<a href="#fig:spotlight">12.8</a>,
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="31.336ex" height="6.843ex" style="vertical-align: -2.838ex;" viewBox="0 -1724.2 13491.9 2946.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">StartLayout 1st Row 1st Column cosine theta 2nd Column equals left-parenthesis normal p Subscript Baseline minus left-parenthesis 0 comma 0 comma 0 right-parenthesis right-parenthesis dot left-parenthesis 0 comma 0 comma 1 right-parenthesis 2nd Row 1st Column Blank 2nd Column equals normal p Subscript Baseline Subscript z Baseline slash double-vertical-bar bold p double-vertical-bar period EndLayout</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E2-LATINMODERNMAIN-63" d="M415 119c0 -10 -32 -130 -166 -130c-116 0 -215 99 -215 227c0 124 92 232 217 232c77 0 153 -39 153 -107c0 -30 -20 -47 -46 -47c-28 0 -46 20 -46 46c0 13 6 43 47 46c-35 36 -98 37 -107 37c-53 0 -135 -42 -135 -205c0 -161 88 -204 141 -204c37 0 102 12 131 105 c2 6 4 10 13 10c3 0 13 0 13 -10Z"></path>
<path stroke-width="1" id="E2-LATINMODERNMAIN-6F" d="M471 214c0 -127 -101 -225 -222 -225c-117 0 -221 96 -221 225c0 125 97 234 222 234c121 0 221 -106 221 -234zM388 222c0 38 0 96 -26 139s-69 65 -113 65c-40 0 -87 -21 -114 -67c-24 -44 -24 -98 -24 -137c0 -36 0 -97 25 -141c27 -46 71 -67 114 -67 c50 0 94 29 116 74c22 44 22 98 22 134Z"></path>
<path stroke-width="1" id="E2-LATINMODERNMAIN-73" d="M360 128c0 -72 -46 -139 -161 -139c-21 0 -66 1 -110 43c-18 -19 -18 -21 -20 -23c-19 -19 -20 -20 -25 -20c-11 0 -11 7 -11 24v132c0 18 0 25 13 25c10 0 11 -4 14 -17c19 -85 55 -142 139 -142c78 0 113 40 113 91c0 72 -82 88 -104 92c-72 14 -100 20 -132 46 c-27 22 -43 50 -43 85c0 56 38 123 160 123c15 0 56 0 94 -28c4 3 14 12 17 16c13 12 15 12 20 12c11 0 11 -7 11 -24v-101c0 -19 0 -24 -13 -24c0 0 -11 0 -12 9c-2 31 -7 121 -117 121c-86 0 -112 -41 -112 -76c0 -58 67 -71 123 -82c42 -8 81 -16 114 -48 c12 -12 42 -42 42 -95Z"></path>
<path stroke-width="1" id="E2-LATINMODERNNORMAL-1D703" d="M455 500c0 -224 -152 -511 -293 -511c-91 0 -120 111 -120 205c0 229 154 511 293 511c102 0 120 -139 120 -205zM389 562c0 57 -6 121 -55 121c-45 0 -82 -56 -109 -105c-40 -71 -60 -151 -77 -215h209c24 99 32 150 32 199zM348 331h-208c-26 -98 -32 -156 -32 -198 c0 -93 21 -122 54 -122c43 0 81 49 116 117c38 72 59 157 70 203Z"></path>
<path stroke-width="1" id="E2-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E2-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E2-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
<path stroke-width="1" id="E2-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E2-LATINMODERNMAIN-302" d="M-82 607l-12 -20c-58 25 -115 54 -170 85c-55 -31 -112 -60 -170 -85l-12 20c56 49 117 91 182 127c65 -36 126 -78 182 -127Z"></path>
<path stroke-width="1" id="E2-LATINMODERNSIZE5-302" d="M1320 598l-6 -28l-654 114l-654 -114l-6 28c219 56 439 106 660 150c221 -44 441 -94 660 -150Z"></path>
<path stroke-width="1" id="E2-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E2-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E2-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E2-LATINMODERNSIZE2-28" d="M395 -336c0 -6 -5 -11 -11 -11c-3 0 -5 1 -7 2c-127 96 -246 330 -246 531v128c0 201 119 435 246 531c2 1 4 2 7 2c6 0 11 -5 11 -11c0 -4 -2 -7 -4 -9c-120 -90 -202 -324 -202 -513v-128c0 -189 82 -423 202 -513c2 -2 4 -5 4 -9Z"></path>
<path stroke-width="1" id="E2-LATINMODERNSIZE2-29" d="M327 186c0 -201 -119 -435 -246 -531c-2 -1 -4 -2 -7 -2c-6 0 -11 5 -11 11c0 4 2 7 4 9c120 90 202 324 202 513v128c0 189 -82 423 -202 513c-2 2 -4 5 -4 9c0 6 5 11 11 11c3 0 5 -1 7 -2c127 -96 246 -330 246 -531v-128Z"></path>
<path stroke-width="1" id="E2-LATINMODERNMAIN-22C5" d="M192 250c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
<path stroke-width="1" id="E2-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E2-LATINMODERNNORMAL-1D467" d="M467 432c0 -4 -22 -52 -117 -145c-36 -36 -98 -90 -98 -90c-36 -31 -65 -56 -119 -114c9 3 27 3 27 3c21 0 36 -4 70 -17c21 -7 39 -13 59 -13c33 0 97 19 120 84c3 7 5 13 14 13c8 0 12 -5 12 -10c0 -27 -58 -154 -157 -154c-29 0 -47 16 -64 37c-25 29 -35 38 -58 38 c-32 0 -62 -27 -85 -62c-6 -11 -8 -13 -16 -13c0 0 -12 0 -12 10c0 7 35 64 103 131l90 84c19 16 103 88 139 131c-26 0 -37 0 -77 15c-23 8 -42 15 -63 15c-8 0 -66 -1 -85 -47c-2 -6 -4 -11 -13 -11s-12 6 -12 11c0 21 46 114 121 114c33 0 50 -20 69 -43 c15 -17 27 -32 51 -32s45 16 75 64c5 9 8 11 15 11c0 0 11 0 11 -10Z"></path>
<path stroke-width="1" id="E2-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E2-LATINMODERNMAIN-2016" d="M151 -230c0 -11 -9 -20 -20 -20s-20 9 -20 20v960c0 11 9 20 20 20s20 -9 20 -20v-960zM287 -230c0 -11 -9 -20 -20 -20s-20 9 -20 20v960c0 11 9 20 20 20s20 -9 20 -20v-960Z"></path>
<path stroke-width="1" id="E2-LATINMODERNNORMAL-1D429" d="M600 223c0 -139 -102 -229 -252 -229c-41 0 -85 10 -128 45v-186h69v-47l-126 3l-126 -3v47h69v504c0 38 -7 38 -69 38v47l177 8v-49c23 18 76 49 151 49c144 0 235 -94 235 -227zM472 223c0 126 -56 187 -123 187c-22 0 -74 -6 -114 -47c-14 -14 -15 -15 -15 -34v-212 c0 -19 0 -20 11 -33c45 -54 92 -54 106 -54c65 0 135 52 135 193Z"></path>
<path stroke-width="1" id="E2-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
<g transform="translate(167,0)">
<g transform="translate(-11,0)">
<g transform="translate(0,763)">
 <use xlink:href="#E2-LATINMODERNMAIN-63"></use>
 <use xlink:href="#E2-LATINMODERNMAIN-6F" x="444" y="0"></use>
 <use xlink:href="#E2-LATINMODERNMAIN-73" x="945" y="0"></use>
 <use xlink:href="#E2-LATINMODERNNORMAL-1D703" x="1506" y="0"></use>
</g>
</g>
<g transform="translate(2242,0)">
<g transform="translate(0,763)">
 <use xlink:href="#E2-LATINMODERNMAIN-3D" x="0" y="0"></use>
<g transform="translate(1056,0)">
 <use xlink:href="#E2-LATINMODERNSIZE2-28"></use>
 <use xlink:href="#E2-LATINMODERNMAIN-70" x="458" y="0"></use>
<g transform="translate(1015,0)">
<g transform="translate(104,0)">
 <use xlink:href="#E2-LATINMODERNMAIN-2212" x="166" y="0"></use>
</g>
 <use xlink:href="#E2-LATINMODERNSIZE5-302" x="0" y="122"></use>
</g>
 <use xlink:href="#E2-LATINMODERNMAIN-28" x="2335" y="0"></use>
 <use xlink:href="#E2-LATINMODERNMAIN-30" x="2725" y="0"></use>
 <use xlink:href="#E2-LATINMODERNMAIN-2C" x="3225" y="0"></use>
 <use xlink:href="#E2-LATINMODERNMAIN-30" x="3670" y="0"></use>
 <use xlink:href="#E2-LATINMODERNMAIN-2C" x="4171" y="0"></use>
 <use xlink:href="#E2-LATINMODERNMAIN-30" x="4616" y="0"></use>
 <use xlink:href="#E2-LATINMODERNMAIN-29" x="5116" y="0"></use>
 <use xlink:href="#E2-LATINMODERNSIZE2-29" x="5506" y="0"></use>
</g>
 <use xlink:href="#E2-LATINMODERNMAIN-22C5" x="7243" y="0"></use>
 <use xlink:href="#E2-LATINMODERNMAIN-28" x="7744" y="0"></use>
 <use xlink:href="#E2-LATINMODERNMAIN-30" x="8133" y="0"></use>
 <use xlink:href="#E2-LATINMODERNMAIN-2C" x="8634" y="0"></use>
 <use xlink:href="#E2-LATINMODERNMAIN-30" x="9079" y="0"></use>
 <use xlink:href="#E2-LATINMODERNMAIN-2C" x="9579" y="0"></use>
 <use xlink:href="#E2-LATINMODERNMAIN-31" x="10024" y="0"></use>
 <use xlink:href="#E2-LATINMODERNMAIN-29" x="10525" y="0"></use>
</g>
<g transform="translate(0,-885)">
 <use xlink:href="#E2-LATINMODERNMAIN-3D" x="0" y="0"></use>
<g transform="translate(1056,0)">
 <use xlink:href="#E2-LATINMODERNMAIN-70" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E2-LATINMODERNNORMAL-1D467" x="787" y="-326"></use>
</g>
 <use xlink:href="#E2-LATINMODERNMAIN-2F" x="2043" y="0"></use>
 <use xlink:href="#E2-LATINMODERNMAIN-2016" x="2543" y="0"></use>
 <use xlink:href="#E2-LATINMODERNNORMAL-1D429" x="2942" y="0"></use>
 <use xlink:href="#E2-LATINMODERNMAIN-2016" x="3581" y="0"></use>
 <use xlink:href="#E2-LATINMODERNMAIN-2E" x="3980" y="0"></use>
</g>
</g>
</g>
</g>
</svg>
</div>
<p>

This value is then compared to the cosines of the falloff and overall width
angles to see where the point lies with respect to the spotlight cone.  We
can trivially determine that points with a cosine greater than the cosine of
the falloff angle are inside the cone receiving full illumination, and
points with cosine less than the width angle&rsquo;s cosine are completely
outside the cone.  (Note that the computation is slightly tricky since for
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.746ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 3765.7 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">theta element-of left-bracket 0 comma pi right-bracket</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D703" d="M455 500c0 -224 -152 -511 -293 -511c-91 0 -120 111 -120 205c0 229 154 511 293 511c102 0 120 -139 120 -205zM389 562c0 57 -6 121 -55 121c-45 0 -82 -56 -109 -105c-40 -71 -60 -151 -77 -215h209c24 99 32 150 32 199zM348 331h-208c-26 -98 -32 -156 -32 -198 c0 -93 21 -122 54 -122c43 0 81 49 116 117c38 72 59 157 70 203Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2208" d="M587 -23c0 -11 -9 -20 -20 -20h-193c-162 0 -293 131 -293 293s131 293 293 293h193c11 0 20 -9 20 -20s-9 -20 -20 -20h-193c-133 0 -242 -103 -252 -233h445c27 0 27 -40 0 -40h-445c10 -130 119 -233 252 -233h193c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D70B" d="M567 407c0 -34 -36 -34 -49 -34h-114c-11 -52 -18 -106 -18 -159c0 -28 0 -93 29 -165c6 -14 6 -16 6 -22c0 -20 -21 -38 -41 -38c-15 0 -26 6 -36 50c-8 34 -8 61 -8 76c0 67 9 110 42 258h-113l-56 -221c-13 -50 -13 -52 -27 -98c-12 -37 -20 -65 -50 -65 c-13 0 -29 8 -29 27c0 7 0 9 8 24c42 91 96 212 128 333h-57c-20 0 -78 0 -127 -77c-6 -8 -8 -12 -16 -12c-12 0 -12 10 -12 10c0 5 26 51 61 90c44 47 82 47 104 47h335c19 0 40 0 40 -24Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D703" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2208" x="747" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="1692" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="1971" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="2471" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D70B" x="2916" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="3487" y="0"></use>
</g>
</svg>, if <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.181ex" height="2.343ex" style="vertical-align: -0.338ex;" viewBox="0 -863.1 2661.2 1008.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">theta greater-than theta prime</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D703" d="M455 500c0 -224 -152 -511 -293 -511c-91 0 -120 111 -120 205c0 229 154 511 293 511c102 0 120 -139 120 -205zM389 562c0 57 -6 121 -55 121c-45 0 -82 -56 -109 -105c-40 -71 -60 -151 -77 -215h209c24 99 32 150 32 199zM348 331h-208c-26 -98 -32 -156 -32 -198 c0 -93 21 -122 54 -122c43 0 81 49 116 117c38 72 59 157 70 203Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3E" d="M688 230l-581 -275c-25 -11 -42 25 -18 36l548 259l-548 259c-24 11 -7 47 18 36l581 -275c17 -8 17 -32 0 -40Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D703" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3E" x="747" y="0"></use>
<g transform="translate(1803,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D703" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="663" y="513"></use>
</g>
</g>
</svg>, then <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="13.177ex" height="2.343ex" style="vertical-align: -0.338ex;" viewBox="0 -863.1 5673.5 1008.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">cosine theta less-than cosine theta prime</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-63" d="M415 119c0 -10 -32 -130 -166 -130c-116 0 -215 99 -215 227c0 124 92 232 217 232c77 0 153 -39 153 -107c0 -30 -20 -47 -46 -47c-28 0 -46 20 -46 46c0 13 6 43 47 46c-35 36 -98 37 -107 37c-53 0 -135 -42 -135 -205c0 -161 88 -204 141 -204c37 0 102 12 131 105 c2 6 4 10 13 10c3 0 13 0 13 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6F" d="M471 214c0 -127 -101 -225 -222 -225c-117 0 -221 96 -221 225c0 125 97 234 222 234c121 0 221 -106 221 -234zM388 222c0 38 0 96 -26 139s-69 65 -113 65c-40 0 -87 -21 -114 -67c-24 -44 -24 -98 -24 -137c0 -36 0 -97 25 -141c27 -46 71 -67 114 -67 c50 0 94 29 116 74c22 44 22 98 22 134Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-73" d="M360 128c0 -72 -46 -139 -161 -139c-21 0 -66 1 -110 43c-18 -19 -18 -21 -20 -23c-19 -19 -20 -20 -25 -20c-11 0 -11 7 -11 24v132c0 18 0 25 13 25c10 0 11 -4 14 -17c19 -85 55 -142 139 -142c78 0 113 40 113 91c0 72 -82 88 -104 92c-72 14 -100 20 -132 46 c-27 22 -43 50 -43 85c0 56 38 123 160 123c15 0 56 0 94 -28c4 3 14 12 17 16c13 12 15 12 20 12c11 0 11 -7 11 -24v-101c0 -19 0 -24 -13 -24c0 0 -11 0 -12 9c-2 31 -7 121 -117 121c-86 0 -112 -41 -112 -76c0 -58 67 -71 123 -82c42 -8 81 -16 114 -48 c12 -12 42 -42 42 -95Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D703" d="M455 500c0 -224 -152 -511 -293 -511c-91 0 -120 111 -120 205c0 229 154 511 293 511c102 0 120 -139 120 -205zM389 562c0 57 -6 121 -55 121c-45 0 -82 -56 -109 -105c-40 -71 -60 -151 -77 -215h209c24 99 32 150 32 199zM348 331h-208c-26 -98 -32 -156 -32 -198 c0 -93 21 -122 54 -122c43 0 81 49 116 117c38 72 59 157 70 203Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3C" d="M689 -9c24 -11 7 -47 -18 -36l-581 275c-17 8 -17 32 0 40l581 275c25 11 42 -25 18 -36l-548 -259Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-63"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6F" x="444" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-73" x="945" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D703" x="1506" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3C" x="2253" y="0"></use>
<g transform="translate(3309,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-63"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6F" x="444" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-73" x="945" y="0"></use>
</g>
<g transform="translate(4815,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D703" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="663" y="513"></use>
</g>
</g>
</svg>.)

</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-SpotLightMethodDefinitions-2"></span><div class="fragmentname">&lt;&lt;SpotLight Method Definitions&gt;&gt;+=&nbsp;<a href="#fragment-SpotLightMethodDefinitions-1"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-SpotLightMethodDefinitions-3"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">Float SpotLight::<span class="anchor" id="SpotLight::Falloff"></span>Falloff(const <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> &amp;w) const {
    <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wl = <a href="../Geometry_and_Transformations/Vectors.html#Vector3::Normalize" class="code">Normalize</a>(<a href="../Light_Sources/Light_Interface.html#Light::WorldToLight" class="code">WorldToLight</a>(w));
    Float cosTheta = wl.z;
    if (cosTheta &lt; <a href="#SpotLight::cosTotalWidth" class="code">cosTotalWidth</a>)     return 0;
    if (cosTheta &gt; <a href="#SpotLight::cosFalloffStart" class="code">cosFalloffStart</a>)   return 1;
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Computefalloffinsidespotlightcone-0">Compute falloff inside spotlight cone</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1164" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1164"><i></i></a><div id="fragbit-1164" class="collapse"><div class="fragmentcode">       Float delta = (cosTheta - <a href="#SpotLight::cosTotalWidth" class="code">cosTotalWidth</a>) /
                     (<a href="#SpotLight::cosFalloffStart" class="code">cosFalloffStart</a> - <a href="#SpotLight::cosTotalWidth" class="code">cosTotalWidth</a>);
       return (delta * delta) * (delta * delta);</div></div>
}</div><p>


</p>
<p>For points inside the transition range from fully illuminated to outside of
the cone, the intensity is scaled to smoothly fall off from full
illumination to darkness:<button style="button" data-toggle="tooltip" data-placement="right" data-html="true" class="btn footnote-button" title="Note the parentheses in the expression
that takes <tt>delta</tt> to the fourth power: this allows the
compiler to generate two multiply instructions rather than three
instructions, as would be needed if the parentheses were removed. Consider
the discussion of IEEE floating point in Section&nbsp;3.9.1 to see
why the parentheses are necessary for this.">
      <sup>&dagger;</sup>
    </button>
		

</p>
<p></p>
<span class="anchor" id="fragment-Computefalloffinsidespotlightcone-0"></span><div class="fragmentname">&lt;&lt;Compute falloff inside spotlight cone&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Float delta = (cosTheta - <a href="#SpotLight::cosTotalWidth" class="code">cosTotalWidth</a>) /
              (<a href="#SpotLight::cosFalloffStart" class="code">cosFalloffStart</a> - <a href="#SpotLight::cosTotalWidth" class="code">cosTotalWidth</a>);
return (delta * delta) * (delta * delta);</div><p>


</p>
<p>The solid angle subtended by a cone with spread angle <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 469.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">theta</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D703" d="M455 500c0 -224 -152 -511 -293 -511c-91 0 -120 111 -120 205c0 229 154 511 293 511c102 0 120 -139 120 -205zM389 562c0 57 -6 121 -55 121c-45 0 -82 -56 -109 -105c-40 -71 -60 -151 -77 -215h209c24 99 32 150 32 199zM348 331h-208c-26 -98 -32 -156 -32 -198 c0 -93 21 -122 54 -122c43 0 81 49 116 117c38 72 59 157 70 203Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D703" x="0" y="0"></use>
</g>
</svg> is
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="12.888ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 5549.1 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">2 pi left-parenthesis 1 minus cosine theta right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D70B" d="M567 407c0 -34 -36 -34 -49 -34h-114c-11 -52 -18 -106 -18 -159c0 -28 0 -93 29 -165c6 -14 6 -16 6 -22c0 -20 -21 -38 -41 -38c-15 0 -26 6 -36 50c-8 34 -8 61 -8 76c0 67 9 110 42 258h-113l-56 -221c-13 -50 -13 -52 -27 -98c-12 -37 -20 -65 -50 -65 c-13 0 -29 8 -29 27c0 7 0 9 8 24c42 91 96 212 128 333h-57c-20 0 -78 0 -127 -77c-6 -8 -8 -12 -16 -12c-12 0 -12 10 -12 10c0 5 26 51 61 90c44 47 82 47 104 47h335c19 0 40 0 40 -24Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-63" d="M415 119c0 -10 -32 -130 -166 -130c-116 0 -215 99 -215 227c0 124 92 232 217 232c77 0 153 -39 153 -107c0 -30 -20 -47 -46 -47c-28 0 -46 20 -46 46c0 13 6 43 47 46c-35 36 -98 37 -107 37c-53 0 -135 -42 -135 -205c0 -161 88 -204 141 -204c37 0 102 12 131 105 c2 6 4 10 13 10c3 0 13 0 13 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6F" d="M471 214c0 -127 -101 -225 -222 -225c-117 0 -221 96 -221 225c0 125 97 234 222 234c121 0 221 -106 221 -234zM388 222c0 38 0 96 -26 139s-69 65 -113 65c-40 0 -87 -21 -114 -67c-24 -44 -24 -98 -24 -137c0 -36 0 -97 25 -141c27 -46 71 -67 114 -67 c50 0 94 29 116 74c22 44 22 98 22 134Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-73" d="M360 128c0 -72 -46 -139 -161 -139c-21 0 -66 1 -110 43c-18 -19 -18 -21 -20 -23c-19 -19 -20 -20 -25 -20c-11 0 -11 7 -11 24v132c0 18 0 25 13 25c10 0 11 -4 14 -17c19 -85 55 -142 139 -142c78 0 113 40 113 91c0 72 -82 88 -104 92c-72 14 -100 20 -132 46 c-27 22 -43 50 -43 85c0 56 38 123 160 123c15 0 56 0 94 -28c4 3 14 12 17 16c13 12 15 12 20 12c11 0 11 -7 11 -24v-101c0 -19 0 -24 -13 -24c0 0 -11 0 -12 9c-2 31 -7 121 -117 121c-86 0 -112 -41 -112 -76c0 -58 67 -71 123 -82c42 -8 81 -16 114 -48 c12 -12 42 -42 42 -95Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D703" d="M455 500c0 -224 -152 -511 -293 -511c-91 0 -120 111 -120 205c0 229 154 511 293 511c102 0 120 -139 120 -205zM389 562c0 57 -6 121 -55 121c-45 0 -82 -56 -109 -105c-40 -71 -60 -151 -77 -215h209c24 99 32 150 32 199zM348 331h-208c-26 -98 -32 -156 -32 -198 c0 -93 21 -122 54 -122c43 0 81 49 116 117c38 72 59 157 70 203Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D70B" x="500" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1071" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1460" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="2183" y="0"></use>
<g transform="translate(3183,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-63"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6F" x="444" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-73" x="945" y="0"></use>
</g>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D703" x="4690" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="5159" y="0"></use>
</g>
</svg>.  Therefore, the integral over directions on the
sphere that gives power from radiant intensity can be solved to compute the total power of a light that only emits
illumination in a cone.  For the spotlight, we can reasonably 
approximate the power of the light by computing the solid angle of
directions that is covered by the cone with a spread angle cosine halfway between
<tt>falloffWidth</tt> and <tt>falloffStart</tt>.

</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-SpotLightMethodDefinitions-3"></span><div class="fragmentname">&lt;&lt;SpotLight Method Definitions&gt;&gt;+=&nbsp;<a href="#fragment-SpotLightMethodDefinitions-2"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="../Light_Transport_III_Bidirectional_Methods/The_Path-Space_Measurement_Equation.html#fragment-SpotLightMethodDefinitions-4"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode"><a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> <span class="anchor" id="SpotLight::Power"></span>SpotLight::Power() const {
    return <a href="#SpotLight::I" class="code">I</a> * 2 * <a href="../Utilities/Main_Include_File.html#Pi" class="code">Pi</a> * (1 - .5f * (<a href="#SpotLight::cosFalloffStart" class="code">cosFalloffStart</a> + <a href="#SpotLight::cosTotalWidth" class="code">cosTotalWidth</a>));
}</div><p>


</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#TextureProjectionLights"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:projection-lights"></span><span id="TextureProjectionLights"></span><h3>12.3.2  Texture Projection Lights</h3><p>



</p>
<p>

</p>
<p>Another useful light source acts like a slide projector; it takes an image
map and projects its image out into the scene.  The <a href="#ProjectionLight"><tt>ProjectionLight</tt></a>
class uses a projective transformation to project points in the scene onto
the light&rsquo;s projection plane based on the field of view angle given to the
constructor (Figure&nbsp;<a href="#fig:projlight">12.9</a>).  Its implementation is in
<a href="https://github.com/mmp/pbrt-v3/tree/master/src/lights/projection.h"><tt>lights/projection.h</tt></a><span class="anchor" id="lightsprojection.h"></span> and
<a href="https://github.com/mmp/pbrt-v3/tree/master/src/lights/projection.cpp"><tt>lights/projection.cpp</tt></a><span class="anchor" id="lightsprojection.cpp"></span>. 

</p>
<p> </p>
<span class="anchor" id="fig:projlight"></span><div class="card outerfigure"><div class="card-body figure"><p>



</p>
<div class="figure-row">
  <a href="Projection%20light%20setting.svg" title=""><img src="Projection%20light%20setting.svg" width=338 height=245 style="max-width: 100%;"></a>
</div>
<p>


</p>
<figcaption class="caption">Figure 12.9: The Basic Setting for Projection Light
Sources. <span class="legend">  A point <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.293ex" height="2.009ex" style="vertical-align: -0.671ex;" viewBox="0 -576.1 556.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal p Subscript</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="0" y="0"></use>
</g>
</svg> in the light&rsquo;s coordinate system is
projected onto the plane of the image using the light&rsquo;s projection
matrix.</span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p>The use
of this light in the lighting example scene is shown in
Figure&nbsp;<a href="#fig:light-projection">12.10</a>.

</p>
<p> </p>
<span class="anchor" id="fig:light-projection"></span><div class="card outerfigure"><div class="card-body figure"><p>


</p>
<div class="figure-row">
<img src="dragon-projection.png" style="max-width: 100%; height: auto;" width=900 height=900>
</div>
<p>

</p>
<figcaption class="caption">Figure 12.10: Scene Rendered with a Projection Light
Using a Grid Texture Map. <span class="legend">  The projection light acts like a slide projector,
projecting an image onto objects in the scene.</span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p></p>
<span class="anchor" id="fragment-ProjectionLightDeclarations-0"></span><div class="fragmentname">&lt;&lt;ProjectionLight Declarations&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">class <span class="anchor" id="ProjectionLight"></span>ProjectionLight : public <a href="../Light_Sources/Light_Interface.html#Light" class="code">Light</a> {
public:
    &lt;&lt;<span class="fragmentname">ProjectionLight Public Methods</span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1165" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1165"><i></i></a><div id="fragbit-1165" class="collapse"><div class="fragmentcode">       ProjectionLight(const <a href="../Geometry_and_Transformations/Transformations.html#Transform" class="code">Transform</a> &amp;LightToWorld, const MediumInterface &amp;medium,
           const <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> &amp;I, const std::string &amp;texname, Float fov);
       <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> Sample_Li(const <a href="../Geometry_and_Transformations/Interactions.html#Interaction" class="code">Interaction</a> &amp;ref, const <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> &amp;u,
           <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> *wi, Float *pdf, <a href="../Light_Sources/Light_Interface.html#VisibilityTester" class="code">VisibilityTester</a> *vis) const;
       <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> Projection(const <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> &amp;w) const;
       <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> Power() const;
       Float Pdf_Li(const <a href="../Geometry_and_Transformations/Interactions.html#Interaction" class="code">Interaction</a> &amp;, const <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> &amp;) const;
       <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> Sample_Le(const <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> &amp;u1, const <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> &amp;u2,
                         Float time, <a href="../Geometry_and_Transformations/Rays.html#Ray" class="code">Ray</a> *ray, <a href="../Geometry_and_Transformations/Normals.html#Normal3f" class="code">Normal3f</a> *nLight, Float *pdfPos, Float *pdfDir) const;
       void Pdf_Le(const <a href="../Geometry_and_Transformations/Rays.html#Ray" class="code">Ray</a> &amp;, const <a href="../Geometry_and_Transformations/Normals.html#Normal3f" class="code">Normal3f</a> &amp;, Float *pdfPos, Float *pdfDir) const;</div></div>
private:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-ProjectionLightPrivateData-0">ProjectionLight Private Data</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1166" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1166"><i></i></a><div id="fragbit-1166" class="collapse"><div class="fragmentcode">       std::unique_ptr&lt;<a href="../Texture/Image_Texture.html#MIPMap" class="code">MIPMap</a>&lt;RGBSpectrum&gt;&gt; projectionMap;
       const <a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a> pLight;
       const <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> I;
       <a href="../Geometry_and_Transformations/Transformations.html#Transform" class="code">Transform</a> lightProjection;
       Float near, far;
       <a href="../Geometry_and_Transformations/Bounding_Boxes.html#Bounds2f" class="code">Bounds2f</a> screenBounds;
       Float cosTotalWidth;</div></div>
};</div><p>


</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-ProjectionLightMethodDefinitions-0"></span><div class="fragmentname">&lt;&lt;ProjectionLight Method Definitions&gt;&gt;=&nbsp;<a href="#fragment-ProjectionLightMethodDefinitions-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">ProjectionLight::ProjectionLight(const <a href="../Geometry_and_Transformations/Transformations.html#Transform" class="code">Transform</a> &amp;<a href="../Light_Sources/Light_Interface.html#Light::LightToWorld" class="code">LightToWorld</a>,
        const MediumInterface &amp;mediumInterface, const <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> &amp;<a href="#ProjectionLight::I" class="code">I</a>,
        const std::string &amp;texname, Float fov)
    : <a href="../Light_Sources/Light_Interface.html#Light" class="code">Light</a>((int)<a href="../Light_Sources/Light_Interface.html#LightFlags" class="code">LightFlags</a>::DeltaPosition, <a href="../Light_Sources/Light_Interface.html#Light::LightToWorld" class="code">LightToWorld</a>,
            mediumInterface),
      <a href="#ProjectionLight::pLight" class="code">pLight</a>(<a href="../Light_Sources/Light_Interface.html#Light::LightToWorld" class="code">LightToWorld</a>(<a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a>(0, 0, 0))), <a href="#ProjectionLight::I" class="code">I</a>(<a href="#ProjectionLight::I" class="code">I</a>) {
    &lt;&lt;<span class="fragmentname"><a href="#fragment-CreateProjectionLightMIPmap-0">Create ProjectionLight MIP map</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1167" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1167"><i></i></a><div id="fragbit-1167" class="collapse"><div class="fragmentcode">       <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> resolution;
       std::unique_ptr&lt;RGBSpectrum[]&gt; texels = <a href="../Utilities/Image_File_Input_and_Output.html#ReadImage" class="code">ReadImage</a>(texname, &amp;resolution);
       if (texels)
           <a href="#ProjectionLight::projectionMap" class="code">projectionMap</a>.reset(new <a href="../Texture/Image_Texture.html#MIPMap" class="code">MIPMap</a>&lt;RGBSpectrum&gt;(resolution,
                                                       texels.get()));</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-InitializeProjectionLightprojectionmatrix-0">Initialize ProjectionLight projection matrix</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1168" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1168"><i></i></a><div id="fragbit-1168" class="collapse"><div class="fragmentcode">       Float aspect = projectionMap ?
           (Float(resolution.x) / Float(resolution.y)) : 1;
       if (aspect &gt; 1)
           <a href="#ProjectionLight::screenBounds" class="code">screenBounds</a> = <a href="../Geometry_and_Transformations/Bounding_Boxes.html#Bounds2f" class="code">Bounds2f</a>(<a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a>(-aspect, -1), <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a>(aspect, 1));
       else
           <a href="#ProjectionLight::screenBounds" class="code">screenBounds</a> = <a href="../Geometry_and_Transformations/Bounding_Boxes.html#Bounds2f" class="code">Bounds2f</a>(<a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a>(-1, -1/aspect), <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a>(1, 1/aspect));
       <a href="#ProjectionLight::near" class="code">near</a> = 1e-3f;
       <a href="#ProjectionLight::far" class="code">far</a> = 1e30f;
       <a href="#ProjectionLight::lightProjection" class="code">lightProjection</a> = <a href="../Camera_Models/Projective_Camera_Models.html#Perspective" class="code">Perspective</a>(fov, <a href="#ProjectionLight::near" class="code">near</a>, <a href="#ProjectionLight::far" class="code">far</a>);</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Computecosineofconesurroundingprojectiondirections-0">Compute cosine of cone surrounding projection directions</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1169" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1169"><i></i></a><div id="fragbit-1169" class="collapse"><div class="fragmentcode">       Float opposite = std::tan(<a href="../Utilities/Main_Include_File.html#Radians" class="code">Radians</a>(fov) / 2.f);
       Float tanDiag = opposite * std::sqrt(1 + 1 / (aspect * aspect));
       <a href="#ProjectionLight::cosTotalWidth" class="code">cosTotalWidth</a> = std::cos(std::atan(tanDiag));</div></div>
}</div><p>


</p>
<p>This light could use a <a href="../Texture/Texture_Interface_and_Basic_Textures.html#Texture"><tt>Texture</tt></a> to represent the light projection
distribution so that procedural projection patterns could be used.
However, having a precise representation of the projection function, as is
available by using an image in a <a href="../Texture/Image_Texture.html#MIPMap"><tt>MIPMap</tt></a>, is useful for being able to
sample the projection distribution using Monte Carlo techniques, so we will
use that representation in the implementation here.  

</p>
<p>Note that the projected image is explicitly stored as an <a href="../Color_and_Radiometry/RGBSpectrum_Implementation.html#RGBSpectrum"><tt>RGBSpectrum</tt></a>,
even if full spectral rendering is being performed.  Unless the image map
being used has full spectral data, storing full <a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#SampledSpectrum"><tt>SampledSpectrum</tt></a>
values in this case only wastes memory; whether an RGB color is converted
to a <tt>SampledSpectrum</tt> before the <a href="../Texture/Image_Texture.html#MIPMap"><tt>MIPMap</tt></a> is created or after the
<tt>MIPMap</tt> returns a value from its <tt>Lookup()</tt> routine gives the
same result in either case.

</p>
<p></p>
<span class="anchor" id="fragment-CreateProjectionLightMIPmap-0"></span><div class="fragmentname">&lt;&lt;Create ProjectionLight MIP map&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> resolution;
std::unique_ptr&lt;RGBSpectrum[]&gt; texels = <a href="../Utilities/Image_File_Input_and_Output.html#ReadImage" class="code">ReadImage</a>(texname, &amp;resolution);
if (texels)
    <a href="#ProjectionLight::projectionMap" class="code">projectionMap</a>.reset(new <a href="../Texture/Image_Texture.html#MIPMap" class="code">MIPMap</a>&lt;RGBSpectrum&gt;(resolution,
                                                texels.get()));</div><p>


</p>
<p></p>
<span class="anchor" id="fragment-ProjectionLightPrivateData-0"></span><div class="fragmentname">&lt;&lt;ProjectionLight Private Data&gt;&gt;=&nbsp;<a href="#fragment-ProjectionLightPrivateData-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">std::unique_ptr&lt;<a href="../Texture/Image_Texture.html#MIPMap" class="code">MIPMap</a>&lt;RGBSpectrum&gt;&gt; <span class="anchor" id="ProjectionLight::projectionMap"></span>projectionMap;
const <a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a> <span class="anchor" id="ProjectionLight::pLight"></span>pLight;
const <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> <span class="anchor" id="ProjectionLight::I"></span>I;</div><p>


</p>
<p>Similar to the <a href="../Camera_Models/Projective_Camera_Models.html#PerspectiveCamera"><tt>PerspectiveCamera</tt></a>, the <a href="#ProjectionLight"><tt>ProjectionLight</tt></a>
constructor computes a projection matrix and the screen space extent of the
projection.
 
</p>
<span class="anchor" id="fragment-InitializeProjectionLightprojectionmatrix-0"></span><div class="fragmentname">&lt;&lt;Initialize ProjectionLight projection matrix&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Float aspect = projectionMap ?
    (Float(resolution.x) / Float(resolution.y)) : 1;
if (aspect &gt; 1)
    <a href="#ProjectionLight::screenBounds" class="code">screenBounds</a> = <a href="../Geometry_and_Transformations/Bounding_Boxes.html#Bounds2f" class="code">Bounds2f</a>(<a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a>(-aspect, -1), <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a>(aspect, 1));
else
    <a href="#ProjectionLight::screenBounds" class="code">screenBounds</a> = <a href="../Geometry_and_Transformations/Bounding_Boxes.html#Bounds2f" class="code">Bounds2f</a>(<a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a>(-1, -1/aspect), <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a>(1, 1/aspect));
<a href="#ProjectionLight::near" class="code">near</a> = 1e-3f;
<a href="#ProjectionLight::far" class="code">far</a> = 1e30f;
<a href="#ProjectionLight::lightProjection" class="code">lightProjection</a> = <a href="../Camera_Models/Projective_Camera_Models.html#Perspective" class="code">Perspective</a>(fov, <a href="#ProjectionLight::near" class="code">near</a>, <a href="#ProjectionLight::far" class="code">far</a>);</div><p>


</p>
<p></p>
<span class="anchor" id="fragment-ProjectionLightPrivateData-1"></span><div class="fragmentname">&lt;&lt;ProjectionLight Private Data&gt;&gt;+=&nbsp;<a href="#fragment-ProjectionLightPrivateData-0"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-ProjectionLightPrivateData-2"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode"><a href="../Geometry_and_Transformations/Transformations.html#Transform" class="code">Transform</a> <span class="anchor" id="ProjectionLight::lightProjection"></span>lightProjection;
Float <span class="anchor" id="ProjectionLight::near"></span>near, <span class="anchor" id="ProjectionLight::far"></span>far;
<a href="../Geometry_and_Transformations/Bounding_Boxes.html#Bounds2f" class="code">Bounds2f</a> <span class="anchor" id="ProjectionLight::screenBounds"></span>screenBounds;</div><p>


</p>
<p>Finally, the constructor finds the cosine of the angle between 
the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.894ex" height="2.176ex" style="vertical-align: -0.505ex;" viewBox="0 -719.6 1246 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">plus z</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D467" d="M467 432c0 -4 -22 -52 -117 -145c-36 -36 -98 -90 -98 -90c-36 -31 -65 -56 -119 -114c9 3 27 3 27 3c21 0 36 -4 70 -17c21 -7 39 -13 59 -13c33 0 97 19 120 84c3 7 5 13 14 13c8 0 12 -5 12 -10c0 -27 -58 -154 -157 -154c-29 0 -47 16 -64 37c-25 29 -35 38 -58 38 c-32 0 -62 -27 -85 -62c-6 -11 -8 -13 -16 -13c0 0 -12 0 -12 10c0 7 35 64 103 131l90 84c19 16 103 88 139 131c-26 0 -37 0 -77 15c-23 8 -42 15 -63 15c-8 0 -66 -1 -85 -47c-2 -6 -4 -11 -13 -11s-12 6 -12 11c0 21 46 114 121 114c33 0 50 -20 69 -43 c15 -17 27 -32 51 -32s45 16 75 64c5 9 8 11 15 11c0 0 11 0 11 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D467" x="778" y="0"></use>
</g>
</svg> axis and the vector to a corner of the screen window.  This
value is used elsewhere to define the minimal cone of directions that
encompasses the set of directions in which light is projected.  This cone
 is useful for algorithms like photon mapping that need to randomly
sample rays leaving the light source (explained in
Chapter&nbsp;<a href="../Light_Transport_III_Bidirectional_Methods.html#chap:bidir-methods">16</a>).  We won&rsquo;t derive this computation here; it
is based on straightforward trigonometry.

</p>
<p></p>
<span class="anchor" id="fragment-Computecosineofconesurroundingprojectiondirections-0"></span><div class="fragmentname">&lt;&lt;Compute cosine of cone surrounding projection directions&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Float opposite = std::tan(<a href="../Utilities/Main_Include_File.html#Radians" class="code">Radians</a>(fov) / 2.f);
Float tanDiag = opposite * std::sqrt(1 + 1 / (aspect * aspect));
<a href="#ProjectionLight::cosTotalWidth" class="code">cosTotalWidth</a> = std::cos(std::atan(tanDiag));</div><p>


</p>
<p></p>
<span class="anchor" id="fragment-ProjectionLightPrivateData-2"></span><div class="fragmentname">&lt;&lt;ProjectionLight Private Data&gt;&gt;+=&nbsp;<a href="#fragment-ProjectionLightPrivateData-1"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">Float <span class="anchor" id="ProjectionLight::cosTotalWidth"></span>cosTotalWidth;</div><p>


</p>
<p>Similar to the spotlight&rsquo;s version,
<tt>ProjectionLight::Sample_Li()</tt><span class="anchor" id="ProjectionLight::Sample_Li"></span>
calls a utility
method, <a href="#ProjectionLight::Projection"><tt>ProjectionLight::Projection()</tt></a>, to determine how much light is
projected in the given direction.  Therefore, we won&rsquo;t include the
implementation of <tt>Sample_Li()</tt> here.

</p>
<p>

</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-ProjectionLightMethodDefinitions-1"></span><div class="fragmentname">&lt;&lt;ProjectionLight Method Definitions&gt;&gt;+=&nbsp;<a href="#fragment-ProjectionLightMethodDefinitions-0"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-ProjectionLightMethodDefinitions-2"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode"><a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> ProjectionLight::<span class="anchor" id="ProjectionLight::Projection"></span>Projection(const <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> &amp;w) const {
    <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wl = <a href="../Light_Sources/Light_Interface.html#Light::WorldToLight" class="code">WorldToLight</a>(w);
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Discarddirectionsbehindprojectionlight-0">Discard directions behind projection light</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1170" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1170"><i></i></a><div id="fragbit-1170" class="collapse"><div class="fragmentcode">       if (wl.z &lt; <a href="#ProjectionLight::near" class="code">near</a>) return 0;</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Projectpointontoprojectionplaneandcomputelight-0">Project point onto projection plane and compute light</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1171" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1171"><i></i></a><div id="fragbit-1171" class="collapse"><div class="fragmentcode">       <a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a> p = <a href="#ProjectionLight::lightProjection" class="code">lightProjection</a>(<a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a>(wl.x, wl.y, wl.z));
       if (!<a href="../Geometry_and_Transformations/Bounding_Boxes.html#Bounds2::Inside" class="code">Inside</a>(<a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a>(p.x, p.y), <a href="#ProjectionLight::screenBounds" class="code">screenBounds</a>)) return 0.f;
       if (!<a href="#ProjectionLight::projectionMap" class="code">projectionMap</a>) return 1;
       <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> st = <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a>(<a href="#ProjectionLight::screenBounds" class="code">screenBounds</a>.<a href="../Geometry_and_Transformations/Bounding_Boxes.html#Bounds2::Offset" class="code">Offset</a>(<a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a>(p.x, p.y)));
       return <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a>(<a href="#ProjectionLight::projectionMap" class="code">projectionMap</a>-&gt;<a href="../Texture/Image_Texture.html#MIPMap::Lookup" class="code">Lookup</a>(st), <a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#SpectrumType::Illuminant" class="code">SpectrumType</a>::Illuminant);</div></div>
}</div><p>


</p>
<p>Because the projective transformation has the property that it
projects points behind the center of projection to points in front of it,
it is important to discard points with a negative <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.086ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 467.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">z</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D467" d="M467 432c0 -4 -22 -52 -117 -145c-36 -36 -98 -90 -98 -90c-36 -31 -65 -56 -119 -114c9 3 27 3 27 3c21 0 36 -4 70 -17c21 -7 39 -13 59 -13c33 0 97 19 120 84c3 7 5 13 14 13c8 0 12 -5 12 -10c0 -27 -58 -154 -157 -154c-29 0 -47 16 -64 37c-25 29 -35 38 -58 38 c-32 0 -62 -27 -85 -62c-6 -11 -8 -13 -16 -13c0 0 -12 0 -12 10c0 7 35 64 103 131l90 84c19 16 103 88 139 131c-26 0 -37 0 -77 15c-23 8 -42 15 -63 15c-8 0 -66 -1 -85 -47c-2 -6 -4 -11 -13 -11s-12 6 -12 11c0 21 46 114 121 114c33 0 50 -20 69 -43 c15 -17 27 -32 51 -32s45 16 75 64c5 9 8 11 15 11c0 0 11 0 11 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D467" x="0" y="0"></use>
</g>
</svg> value.  Therefore, the
projection code immediately returns no illumination for projection points that are behind the
near plane for the projection.  If this check were not done, then 
 it wouldn&rsquo;t be possible to know if a projected point was originally
behind the light (and therefore not illuminated) or in front of it.

</p>
<p></p>
<span class="anchor" id="fragment-Discarddirectionsbehindprojectionlight-0"></span><div class="fragmentname">&lt;&lt;Discard directions behind projection light&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">if (wl.z &lt; <a href="#ProjectionLight::near" class="code">near</a>) return 0;</div><p>


</p>
<p>After being projected to the projection plane, points with coordinate
values outside the screen window are discarded.  Points that pass this test
are transformed to get <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.773ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2055.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1665" y="0"></use>
</g>
</svg> texture coordinates inside <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.707ex" height="3.009ex" style="vertical-align: -0.838ex;" viewBox="0 -934.9 2457.1 1295.7" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket 0 comma 1 right-bracket squared</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="779" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1224" y="0"></use>
<g transform="translate(1724,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="393" y="513"></use>
</g>
</g>
</svg> for the
lookup in the image map.  Note it is explicitly specified that the
<a href="../Color_and_Radiometry/RGBSpectrum_Implementation.html#RGBSpectrum"><tt>RGBSpectrum</tt></a> value passed to the <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum"><tt>Spectrum</tt></a> constructor represents
an illuminant&rsquo;s SPD and not that of a reflectance.  (Recall from
Section&nbsp;<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#sec:rgb-to-spd">5.2.2</a> that different matching functions are used for
converting from RGB to SPDs for illuminants versus reflectances.)

</p>
<p></p>
<span class="anchor" id="fragment-Projectpointontoprojectionplaneandcomputelight-0"></span><div class="fragmentname">&lt;&lt;Project point onto projection plane and compute light&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a> p = <a href="#ProjectionLight::lightProjection" class="code">lightProjection</a>(<a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a>(wl.x, wl.y, wl.z));
if (!<a href="../Geometry_and_Transformations/Bounding_Boxes.html#Bounds2::Inside" class="code">Inside</a>(<a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a>(p.x, p.y), <a href="#ProjectionLight::screenBounds" class="code">screenBounds</a>)) return 0.f;
if (!<a href="#ProjectionLight::projectionMap" class="code">projectionMap</a>) return 1;
<a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> st = <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a>(<a href="#ProjectionLight::screenBounds" class="code">screenBounds</a>.<a href="../Geometry_and_Transformations/Bounding_Boxes.html#Bounds2::Offset" class="code">Offset</a>(<a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a>(p.x, p.y)));
return <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a>(<a href="#ProjectionLight::projectionMap" class="code">projectionMap</a>-&gt;<a href="../Texture/Image_Texture.html#MIPMap::Lookup" class="code">Lookup</a>(st), <a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#SpectrumType::Illuminant" class="code">SpectrumType</a>::Illuminant);</div><p>


</p>
<p>The total power of this light is approximated as a spotlight that subtends
the same angle as the diagonal of the projected image, scaled by the
average intensity in the image map.  This approximation becomes
increasingly inaccurate as the projected image&rsquo;s aspect ratio becomes less
square, for example, and it doesn&rsquo;t account for the fact that texels toward
the edges of the image map subtend a larger solid angle than texels in the middle
when projected with a perspective projection.  Nevertheless, it&rsquo;s a
reasonable first-order approximation.

</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-ProjectionLightMethodDefinitions-2"></span><div class="fragmentname">&lt;&lt;ProjectionLight Method Definitions&gt;&gt;+=&nbsp;<a href="#fragment-ProjectionLightMethodDefinitions-1"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode"><a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> <span class="anchor" id="ProjectionLight::Power"></span>ProjectionLight::Power() const {
    return (<a href="#ProjectionLight::projectionMap" class="code">projectionMap</a> ?
            <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a>(<a href="#ProjectionLight::projectionMap" class="code">projectionMap</a>-&gt;<a href="../Texture/Image_Texture.html#MIPMap::Lookup" class="code">Lookup</a>(<a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a>(.5f, .5f), .5f),
                     <a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#SpectrumType::Illuminant" class="code">SpectrumType</a>::Illuminant) : <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a>(1.f)) *
        <a href="#ProjectionLight::I" class="code">I</a> * 2 * <a href="../Utilities/Main_Include_File.html#Pi" class="code">Pi</a> * (1.f - <a href="#ProjectionLight::cosTotalWidth" class="code">cosTotalWidth</a>);
}</div><p>


</p>
<p>

</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#GoniophotometricDiagramLights"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:gonio-lights"></span><span id="GoniophotometricDiagramLights"></span><h3>12.3.3  Goniophotometric Diagram Lights</h3><p>



</p>
<p>

</p>
<p>A <em>goniophotometric diagram</em> describes the angular distribution of
luminance from a point light source; it is widely used in illumination
engineering to characterize lights.
Figure&nbsp;<a href="#fig:goniophotometric-diagram">12.11</a> shows an example of a
goniophotometric diagram in two
dimensions.  In this section, we&rsquo;ll implement a light source that uses
goniophotometric diagrams encoded in 2D image maps to describe the emission
distribution of the light.  The implementation is very similar to the point
light sources defined previously in this section; it scales the intensity
based on the outgoing direction according to the goniophotometric diagram&rsquo;s
values.  

</p>
<p>

 </p>
<span class="anchor" id="fig:goniophotometric-diagram"></span><div class="card outerfigure"><div class="card-body figure"><p>



</p>
<div class="figure-row">
  <a href="Gonio%20plot.svg" title=""><img src="Gonio%20plot.svg" width=166 height=192 style="max-width: 100%;"></a>
</div>
<p>


</p>
<figcaption class="caption">Figure 12.11: An Example of a Goniophotometric Diagram
Specifying an Outgoing Light Distribution from a Point Light Source in
2D. <span class="legend">  The emitted intensity is defined in a fixed set of directions on the
unit sphere, and the intensity for a given outgoing direction <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.446ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 622.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">omega Subscript</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D714" d="M604 372c0 -40 -12 -90 -23 -133c-30 -121 -93 -250 -197 -250c-67 0 -102 44 -113 106c-38 -62 -90 -106 -153 -106c-76 0 -105 62 -105 143c0 35 5 74 15 112c16 63 41 127 82 184c5 6 12 9 18 9c3 0 6 0 9 -2c5 -3 9 -8 9 -14c0 -4 -2 -9 -5 -13 c-38 -53 -74 -109 -89 -169c-5 -22 -8 -45 -8 -65c0 -63 26 -113 87 -113c55 0 103 39 136 93c1 29 5 59 13 90c5 22 15 47 34 47c14 0 19 -11 19 -26c0 -8 -2 -17 -4 -26c-7 -30 -17 -60 -30 -88c9 -52 42 -90 98 -90c79 0 137 92 160 183c3 12 4 25 4 37 c0 35 -13 66 -38 88c-7 7 -11 15 -11 25c0 11 5 22 14 32c10 10 23 16 35 16c9 0 17 -3 23 -9c15 -13 20 -35 20 -61Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D714" x="0" y="0"></use>
</g>
</svg> is found by
interpolating the intensities of the adjacent samples.</span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p>Figure&nbsp;<a href="#fig:gonio-images">12.12</a> shows a few 
goniophotometric diagrams encoded as image maps.

</p>
<p>
 
</p>
<span class="anchor" id="fig:gonio-images"></span><div class="card outerfigure"><div class="card-body figure"><p>






</p>

<div class="card-img-top" style="display:block; width: 100%; padding-top: 55.333%;  position:relative;">
<div id="Upward_illumination50" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0;"></div></div>
<script>
Jeri.renderViewer(document.getElementById('Upward_illumination50'), {
  title: 'Upward_illumination50', children: [
 { title: 'Upward illumination', image: 'gonio-up.png' },  { title: 'Downward illumination', image: 'gonio-down.png' },  { title: 'Upward and Downward illumination', image: 'gonio-both.png' }]});
</script>
<button data-toggle="tooltip" data-placement="left" class="btn yojeri" title="This image is interactive. Click and drag to pan and use the mouse-wheel to zoom. After clicking on the image to select it, type '?' to see a summary of keyboard controls."><i class="fa fa-snowflake fa-border"></i></button><p>

</p>
<figcaption class="caption">Figure 12.12: Goniophotometric Diagrams for Real-World
Light Sources, Encoded as Image Maps with a Parameterization Based on
Spherical Coordinates. <span class="legend">  (1)&nbsp;A light that mostly illuminates in
its up direction, with only a small amount of illumination in the down
direction. (2)&nbsp;A light that mostly illuminates in the
down direction. (3)&nbsp;A light that casts illumination
both above and below.</span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p>Figure&nbsp;<a href="#fig:light-gonio-renderings">12.13</a> shows a scene rendered with a light
source that uses one of these images to modulate its directional
distribution of illumination. 

</p>
<p>
 </p>
<span class="anchor" id="fig:light-gonio-renderings"></span><div class="card outerfigure"><div class="card-body figure"><p>


</p>
<div class="figure-row">
<img src="dragon-gonio.png" style="max-width: 100%; height: auto;" width=900 height=900>
</div>
<p>

</p>
<figcaption class="caption">Figure 12.13: Scene Rendered Using a Goniophotometric Diagram from
Figure&nbsp;<a href="#fig:gonio-images">12.12</a>. <span class="legend"> Even though a point light source is the basis of this light, including the
directional variation of a realistic light improves the visual realism of
the rendered image.</span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p></p>
<span class="anchor" id="fragment-GonioPhotometricLightDeclarations-0"></span><div class="fragmentname">&lt;&lt;GonioPhotometricLight Declarations&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">class <span class="anchor" id="GonioPhotometricLight"></span>GonioPhotometricLight : public <a href="../Light_Sources/Light_Interface.html#Light" class="code">Light</a> {
public:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-GonioPhotometricLightPublicMethods-0">GonioPhotometricLight Public Methods</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1172" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1172"><i></i></a><div id="fragbit-1172" class="collapse"><div class="fragmentcode">       <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> Sample_Li(const <a href="../Geometry_and_Transformations/Interactions.html#Interaction" class="code">Interaction</a> &amp;ref, const <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> &amp;u,
           <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> *wi, Float *pdf, <a href="../Light_Sources/Light_Interface.html#VisibilityTester" class="code">VisibilityTester</a> *vis) const;
       GonioPhotometricLight(const <a href="../Geometry_and_Transformations/Transformations.html#Transform" class="code">Transform</a> &amp;<a href="../Light_Sources/Light_Interface.html#Light::LightToWorld" class="code">LightToWorld</a>,
               const MediumInterface &amp;mediumInterface, const <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> &amp;<a href="#GonioPhotometricLight::I" class="code">I</a>,
               const std::string &amp;texname)
           : <a href="../Light_Sources/Light_Interface.html#Light" class="code">Light</a>((int)<a href="../Light_Sources/Light_Interface.html#LightFlags" class="code">LightFlags</a>::DeltaPosition, <a href="../Light_Sources/Light_Interface.html#Light::LightToWorld" class="code">LightToWorld</a>,
                   mediumInterface),
             <a href="#GonioPhotometricLight::pLight" class="code">pLight</a>(<a href="../Light_Sources/Light_Interface.html#Light::LightToWorld" class="code">LightToWorld</a>(<a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a>(0, 0, 0))), <a href="#GonioPhotometricLight::I" class="code">I</a>(<a href="#GonioPhotometricLight::I" class="code">I</a>) {
           &lt;&lt;<span class="fragmentname"><a href="#fragment-CreatemonomipmapformonoGonioPhotometricLight-0">Create <tt>mipmap</tt> for <tt>GonioPhotometricLight</tt></a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1173" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1173"><i></i></a><div id="fragbit-1173" class="collapse"><div class="fragmentcode">              <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> resolution;
              std::unique_ptr&lt;RGBSpectrum[]&gt; texels = <a href="../Utilities/Image_File_Input_and_Output.html#ReadImage" class="code">ReadImage</a>(texname, &amp;resolution);
              if (texels)
                  <a href="#GonioPhotometricLight::mipmap" class="code">mipmap</a>.reset(new <a href="../Texture/Image_Texture.html#MIPMap" class="code">MIPMap</a>&lt;RGBSpectrum&gt;(resolution, texels.get()));</div></div>
       }
       <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> Scale(const <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> &amp;w) const {
           <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wp = <a href="../Geometry_and_Transformations/Vectors.html#Vector3::Normalize" class="code">Normalize</a>(<a href="../Light_Sources/Light_Interface.html#Light::WorldToLight" class="code">WorldToLight</a>(w));
           std::swap(wp.y, wp.z);
           Float theta = <a href="../Color_and_Radiometry/Working_with_Radiometric_Integrals.html#SphericalTheta" class="code">SphericalTheta</a>(wp);
           Float phi   = <a href="../Color_and_Radiometry/Working_with_Radiometric_Integrals.html#SphericalPhi" class="code">SphericalPhi</a>(wp);
           <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> st(phi * <a href="../Utilities/Main_Include_File.html#Inv2Pi" class="code">Inv2Pi</a>, theta * <a href="../Utilities/Main_Include_File.html#InvPi" class="code">InvPi</a>);
           return !<a href="#GonioPhotometricLight::mipmap" class="code">mipmap</a> ? RGBSpectrum(1.f) :
                  <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a>(<a href="#GonioPhotometricLight::mipmap" class="code">mipmap</a>-&gt;<a href="../Texture/Image_Texture.html#MIPMap::Lookup" class="code">Lookup</a>(st), <a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#SpectrumType::Illuminant" class="code">SpectrumType</a>::Illuminant);
       }
       <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> Power() const;
       Float Pdf_Li(const <a href="../Geometry_and_Transformations/Interactions.html#Interaction" class="code">Interaction</a> &amp;, const <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> &amp;) const;
       <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> Sample_Le(const <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> &amp;u1, const <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> &amp;u2,
                         Float time, <a href="../Geometry_and_Transformations/Rays.html#Ray" class="code">Ray</a> *ray, <a href="../Geometry_and_Transformations/Normals.html#Normal3f" class="code">Normal3f</a> *nLight, Float *pdfPos, Float *pdfDir) const;
       void Pdf_Le(const <a href="../Geometry_and_Transformations/Rays.html#Ray" class="code">Ray</a> &amp;, const <a href="../Geometry_and_Transformations/Normals.html#Normal3f" class="code">Normal3f</a> &amp;, Float *pdfPos, Float *pdfDir) const;</div></div>
private:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-GonioPhotometricLightPrivateData-0">GonioPhotometricLight Private Data</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1174" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1174"><i></i></a><div id="fragbit-1174" class="collapse"><div class="fragmentcode">       const <a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a> pLight;
       const <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> I;
       std::unique_ptr&lt;<a href="../Texture/Image_Texture.html#MIPMap" class="code">MIPMap</a>&lt;RGBSpectrum&gt;&gt; mipmap;</div></div>
};</div><p>


</p>
<p>

</p>
<p>The <a href="#GonioPhotometricLight"><tt>GonioPhotometricLight</tt></a> constructor takes a base intensity and an
image map that scales the intensity based on the angular distribution of
light.

</p>
<p></p>
<span class="anchor" id="fragment-GonioPhotometricLightPublicMethods-0"></span><div class="fragmentname">&lt;&lt;GonioPhotometricLight Public Methods&gt;&gt;=&nbsp;<a href="#fragment-GonioPhotometricLightPublicMethods-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">GonioPhotometricLight(const <a href="../Geometry_and_Transformations/Transformations.html#Transform" class="code">Transform</a> &amp;<a href="../Light_Sources/Light_Interface.html#Light::LightToWorld" class="code">LightToWorld</a>,
        const MediumInterface &amp;mediumInterface, const <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> &amp;<a href="#GonioPhotometricLight::I" class="code">I</a>,
        const std::string &amp;texname)
    : <a href="../Light_Sources/Light_Interface.html#Light" class="code">Light</a>((int)<a href="../Light_Sources/Light_Interface.html#LightFlags" class="code">LightFlags</a>::DeltaPosition, <a href="../Light_Sources/Light_Interface.html#Light::LightToWorld" class="code">LightToWorld</a>,
            mediumInterface),
      <a href="#GonioPhotometricLight::pLight" class="code">pLight</a>(<a href="../Light_Sources/Light_Interface.html#Light::LightToWorld" class="code">LightToWorld</a>(<a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a>(0, 0, 0))), <a href="#GonioPhotometricLight::I" class="code">I</a>(<a href="#GonioPhotometricLight::I" class="code">I</a>) {
    &lt;&lt;<span class="fragmentname"><a href="#fragment-CreatemonomipmapformonoGonioPhotometricLight-0">Create <tt>mipmap</tt> for <tt>GonioPhotometricLight</tt></a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1175" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1175"><i></i></a><div id="fragbit-1175" class="collapse"><div class="fragmentcode">       <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> resolution;
       std::unique_ptr&lt;RGBSpectrum[]&gt; texels = <a href="../Utilities/Image_File_Input_and_Output.html#ReadImage" class="code">ReadImage</a>(texname, &amp;resolution);
       if (texels)
           <a href="#GonioPhotometricLight::mipmap" class="code">mipmap</a>.reset(new <a href="../Texture/Image_Texture.html#MIPMap" class="code">MIPMap</a>&lt;RGBSpectrum&gt;(resolution, texels.get()));</div></div>
}</div><p>


</p>
<p></p>
<span class="anchor" id="fragment-GonioPhotometricLightPrivateData-0"></span><div class="fragmentname">&lt;&lt;GonioPhotometricLight Private Data&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">const <a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a> <span class="anchor" id="GonioPhotometricLight::pLight"></span>pLight;
const <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> <span class="anchor" id="GonioPhotometricLight::I"></span>I;
std::unique_ptr&lt;<a href="../Texture/Image_Texture.html#MIPMap" class="code">MIPMap</a>&lt;RGBSpectrum&gt;&gt; <span class="anchor" id="GonioPhotometricLight::mipmap"></span>mipmap;</div><p>


</p>
<p>Like <a href="#ProjectionLight"><tt>ProjectionLight</tt></a>, <a href="#GonioPhotometricLight"><tt>GonioPhotometricLight</tt></a> constructs a
<a href="../Texture/Image_Texture.html#MIPMap"><tt>MIPMap</tt></a> of the distribution&rsquo;s image map, also always using
<a href="../Color_and_Radiometry/RGBSpectrum_Implementation.html#RGBSpectrum"><tt>RGBSpectrum</tt></a> values.

</p>
<p></p>
<span class="anchor" id="fragment-CreatemonomipmapformonoGonioPhotometricLight-0"></span><div class="fragmentname">&lt;&lt;Create <tt>mipmap</tt> for <tt>GonioPhotometricLight</tt>&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> resolution;
std::unique_ptr&lt;RGBSpectrum[]&gt; texels = <a href="../Utilities/Image_File_Input_and_Output.html#ReadImage" class="code">ReadImage</a>(texname, &amp;resolution);
if (texels)
    <a href="#GonioPhotometricLight::mipmap" class="code">mipmap</a>.reset(new <a href="../Texture/Image_Texture.html#MIPMap" class="code">MIPMap</a>&lt;RGBSpectrum&gt;(resolution, texels.get()));</div><p>


</p>
<p>The <tt>GonioPhotometricLight::Sample_Li()</tt> method is not shown here.
It is essentially identical to the <a href="#SpotLight::Sample_Li"><tt>SpotLight::Sample_Li()</tt></a> and
<a href="#ProjectionLight::Sample_Li"><tt>ProjectionLight::Sample_Li()</tt></a> methods that use a helper function to
scale the amount of radiance.  It assumes that the scale texture is
encoded using spherical coordinates, so that the given direction needs
to be converted to <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 469.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">theta</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D703" d="M455 500c0 -224 -152 -511 -293 -511c-91 0 -120 111 -120 205c0 229 154 511 293 511c102 0 120 -139 120 -205zM389 562c0 57 -6 121 -55 121c-45 0 -82 -56 -109 -105c-40 -71 -60 -151 -77 -215h209c24 99 32 150 32 199zM348 331h-208c-26 -98 -32 -156 -32 -198 c0 -93 21 -122 54 -122c43 0 81 49 116 117c38 72 59 157 70 203Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D703" x="0" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.385ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 596.5 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">phi</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D719" d="M573 262c0 -134 -145 -269 -306 -274l-38 -149c-3 -14 -9 -38 -11 -40c-3 -3 -5 -4 -10 -4s-12 1 -12 11c0 3 10 41 22 88l23 94c-122 7 -192 86 -192 181c0 136 147 269 306 274l58 231c4 17 5 20 15 20c12 0 12 -10 12 -10l-3 -14l-56 -227c139 -10 192 -102 192 -181z M349 421c-149 -13 -235 -153 -235 -273c0 -100 72 -135 132 -138zM508 283c0 88 -57 134 -133 138l-103 -411c150 12 236 155 236 273Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D719" x="0" y="0"></use>
</g>
</svg> values and scaled to <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.653ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2003.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket 0 comma 1 right-bracket</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="779" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1224" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="1724" y="0"></use>
</g>
</svg> before
being used to index into the
texture.  Goniophotometric diagrams are usually defined in a coordinate
space where the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.139ex" height="2.009ex" style="vertical-align: -0.671ex;" viewBox="0 -576.1 490.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">y</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="0" y="0"></use>
</g>
</svg> axis is up, whereas the spherical coordinate utility
routines in <tt>pbrt</tt> assume that <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.086ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 467.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">z</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D467" d="M467 432c0 -4 -22 -52 -117 -145c-36 -36 -98 -90 -98 -90c-36 -31 -65 -56 -119 -114c9 3 27 3 27 3c21 0 36 -4 70 -17c21 -7 39 -13 59 -13c33 0 97 19 120 84c3 7 5 13 14 13c8 0 12 -5 12 -10c0 -27 -58 -154 -157 -154c-29 0 -47 16 -64 37c-25 29 -35 38 -58 38 c-32 0 -62 -27 -85 -62c-6 -11 -8 -13 -16 -13c0 0 -12 0 -12 10c0 7 35 64 103 131l90 84c19 16 103 88 139 131c-26 0 -37 0 -77 15c-23 8 -42 15 -63 15c-8 0 -66 -1 -85 -47c-2 -6 -4 -11 -13 -11s-12 6 -12 11c0 21 46 114 121 114c33 0 50 -20 69 -43 c15 -17 27 -32 51 -32s45 16 75 64c5 9 8 11 15 11c0 0 11 0 11 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D467" x="0" y="0"></use>
</g>
</svg> is up, so&nbsp;<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.139ex" height="2.009ex" style="vertical-align: -0.671ex;" viewBox="0 -576.1 490.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">y</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="0" y="0"></use>
</g>
</svg> and&nbsp;<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.086ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 467.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">z</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D467" d="M467 432c0 -4 -22 -52 -117 -145c-36 -36 -98 -90 -98 -90c-36 -31 -65 -56 -119 -114c9 3 27 3 27 3c21 0 36 -4 70 -17c21 -7 39 -13 59 -13c33 0 97 19 120 84c3 7 5 13 14 13c8 0 12 -5 12 -10c0 -27 -58 -154 -157 -154c-29 0 -47 16 -64 37c-25 29 -35 38 -58 38 c-32 0 -62 -27 -85 -62c-6 -11 -8 -13 -16 -13c0 0 -12 0 -12 10c0 7 35 64 103 131l90 84c19 16 103 88 139 131c-26 0 -37 0 -77 15c-23 8 -42 15 -63 15c-8 0 -66 -1 -85 -47c-2 -6 -4 -11 -13 -11s-12 6 -12 11c0 21 46 114 121 114c33 0 50 -20 69 -43 c15 -17 27 -32 51 -32s45 16 75 64c5 9 8 11 15 11c0 0 11 0 11 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D467" x="0" y="0"></use>
</g>
</svg> are swapped before
doing the conversion.

</p>
<p></p>
<span class="anchor" id="fragment-GonioPhotometricLightPublicMethods-1"></span><div class="fragmentname">&lt;&lt;GonioPhotometricLight Public Methods&gt;&gt;+=&nbsp;<a href="#fragment-GonioPhotometricLightPublicMethods-0"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode"><a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> Scale(const <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> &amp;w) const {
    <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wp = <a href="../Geometry_and_Transformations/Vectors.html#Vector3::Normalize" class="code">Normalize</a>(<a href="../Light_Sources/Light_Interface.html#Light::WorldToLight" class="code">WorldToLight</a>(w));
    std::swap(wp.y, wp.z);
    Float theta = <a href="../Color_and_Radiometry/Working_with_Radiometric_Integrals.html#SphericalTheta" class="code">SphericalTheta</a>(wp);
    Float phi   = <a href="../Color_and_Radiometry/Working_with_Radiometric_Integrals.html#SphericalPhi" class="code">SphericalPhi</a>(wp);
    <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> st(phi * <a href="../Utilities/Main_Include_File.html#Inv2Pi" class="code">Inv2Pi</a>, theta * <a href="../Utilities/Main_Include_File.html#InvPi" class="code">InvPi</a>);
    return !<a href="#GonioPhotometricLight::mipmap" class="code">mipmap</a> ? RGBSpectrum(1.f) :
           <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a>(<a href="#GonioPhotometricLight::mipmap" class="code">mipmap</a>-&gt;<a href="../Texture/Image_Texture.html#MIPMap::Lookup" class="code">Lookup</a>(st), <a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#SpectrumType::Illuminant" class="code">SpectrumType</a>::Illuminant);
}</div><p>


</p>
<p>The <tt>Power()</tt> method uses the average intensity over the image to
compute power.  This computation is inaccurate because the spherical
coordinate parameterization of directions has various distortions,
particularly near the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.894ex" height="2.176ex" style="vertical-align: -0.505ex;" viewBox="0 -719.6 1246 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">plus z</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D467" d="M467 432c0 -4 -22 -52 -117 -145c-36 -36 -98 -90 -98 -90c-36 -31 -65 -56 -119 -114c9 3 27 3 27 3c21 0 36 -4 70 -17c21 -7 39 -13 59 -13c33 0 97 19 120 84c3 7 5 13 14 13c8 0 12 -5 12 -10c0 -27 -58 -154 -157 -154c-29 0 -47 16 -64 37c-25 29 -35 38 -58 38 c-32 0 -62 -27 -85 -62c-6 -11 -8 -13 -16 -13c0 0 -12 0 -12 10c0 7 35 64 103 131l90 84c19 16 103 88 139 131c-26 0 -37 0 -77 15c-23 8 -42 15 -63 15c-8 0 -66 -1 -85 -47c-2 -6 -4 -11 -13 -11s-12 6 -12 11c0 21 46 114 121 114c33 0 50 -20 69 -43 c15 -17 27 -32 51 -32s45 16 75 64c5 9 8 11 15 11c0 0 11 0 11 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D467" x="778" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.894ex" height="2.176ex" style="vertical-align: -0.505ex;" viewBox="0 -719.6 1246 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">negative z</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D467" d="M467 432c0 -4 -22 -52 -117 -145c-36 -36 -98 -90 -98 -90c-36 -31 -65 -56 -119 -114c9 3 27 3 27 3c21 0 36 -4 70 -17c21 -7 39 -13 59 -13c33 0 97 19 120 84c3 7 5 13 14 13c8 0 12 -5 12 -10c0 -27 -58 -154 -157 -154c-29 0 -47 16 -64 37c-25 29 -35 38 -58 38 c-32 0 -62 -27 -85 -62c-6 -11 -8 -13 -16 -13c0 0 -12 0 -12 10c0 7 35 64 103 131l90 84c19 16 103 88 139 131c-26 0 -37 0 -77 15c-23 8 -42 15 -63 15c-8 0 -66 -1 -85 -47c-2 -6 -4 -11 -13 -11s-12 6 -12 11c0 21 46 114 121 114c33 0 50 -20 69 -43 c15 -17 27 -32 51 -32s45 16 75 64c5 9 8 11 15 11c0 0 11 0 11 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D467" x="778" y="0"></use>
</g>
</svg> directions.  Again, this error is
acceptable for the uses of this method in <tt>pbrt</tt>.

</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-GonioPhotometricLightMethodDefinitions-0"></span><div class="fragmentname">&lt;&lt;GonioPhotometricLight Method Definitions&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> <span class="anchor" id="GonioPhotometricLight::Power"></span>GonioPhotometricLight::Power() const {
    return 4 * <a href="../Utilities/Main_Include_File.html#Pi" class="code">Pi</a> * <a href="#GonioPhotometricLight::I" class="code">I</a> *
        <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a>(<a href="#GonioPhotometricLight::mipmap" class="code">mipmap</a> ? <a href="#GonioPhotometricLight::mipmap" class="code">mipmap</a>-&gt;<a href="../Texture/Image_Texture.html#MIPMap::Lookup" class="code">Lookup</a>(<a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a>(.5f, .5f), .5f) :
                 <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a>(1.f), <a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#SpectrumType::Illuminant" class="code">SpectrumType</a>::Illuminant);
}</div><p>


</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

</div>  <!-- container-fluid -->
</div>  <!-- maincontainer -->

<nav class="navbar navbar-expand-md bg-light navbar-light">
  <div class="container-fluid-nav">
    <!--  <ul class="nav navbar-nav navbar-center"> -->
      <span class="navbar-text" style="text-align: center;">
        Thanks to Joakim Dahl and 36 others for generously supporting <i>Physically
        Based Rendering</i> online
        through <a href="https://patreon.com/pbrbook">Patreon</a>.
    </span>
  </div>
</nav>

<nav class="navbar navbar-expand-md bg-light navbar-light">
  <span class="navbar-text"><i>Physically Based Rendering: From Theory To Implementation</i>, &copy; 2004-2021 Matt Pharr, Wenzel Jakob, and Greg Humphreys under the <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/">CC BY-NC-ND 4.0</a> license. (<a href="https://github.com/mmp/pbr-book-website/">github</a>)</span>
  <div class="container">
    <ul class="nav navbar-nav ml-auto">
      <li class="nav-item">Next: <a href="../Light_Sources/Distant_Lights.html">Light Sources / Distant Lights</a></li>
    </ul>
  </div>

</nav>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script>
  $(function () {
    $('[data-toggle="popover"]').popover()
    $('[data-toggle="tooltip"]').tooltip()
   })
</script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

<script>
// https://stackoverflow.com/a/17535094
// The function actually applying the offset
function offsetAnchor() {
  if (location.hash.length !== 0) {
    window.scrollTo(window.scrollX, window.scrollY - window.innerHeight / 8);
  }
}

// Captures click events of all <a> elements with href starting with #
$(document).on('click', 'a[href^="#"]', function(event) {
  // Click events are captured before hashchanges. Timeout
  // causes offsetAnchor to be called after the page jump.
  window.setTimeout(function() {
    offsetAnchor();
  }, 500);
});

// Set the offset when entering page with hash present in the url
window.setTimeout(offsetAnchor, 1500);
</script>

</body>
</html>
