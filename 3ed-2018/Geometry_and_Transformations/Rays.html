
<!doctype html>
<html lang="en">
<head>

<!-- all praise to https://realfavicongenerator.net -->
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="/fonts.css">
  <link rel="stylesheet" href="../pbrstyle.css">
  <link rel="stylesheet" href="/fontawesome-free-5.15.3-web/css/all.css">

  <script async src="https://cse.google.com/cse.js?cx=003601324460585362024:4xwpwgaitgd"></script>
  <script src="/react.min.js"></script>
  <script src="/react-dom.min.js"></script>
  <script src="/jeri.min.js"></script>
  <link rel="preload" href="/exr.worker.js" as="script" crossorigin="anonymous">
        
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="/bootstrap.min.css">

  <title>Rays</title>
</head>
        
<body>

<nav class="fixed-top-lg-navbar navbar navbar-expand bg-light navbar-light">
  <ul class="nav navbar-nav">
    <a class="navbar-brand" href="../contents.html"><img src="../pbr.jpg" width=25 height=25></a>
    <li class="nav-item"><a class="nav-link" href="../Geometry_and_Transformations.html">Geometry and Transformations</a></li>
    <span class="navbar-text">/</span>
    <li class="nav-item"><a class="nav-link" href="#">Rays</a></li>
    <span class="navbar-text">&nbsp;&nbsp;</span>
    <li class="nav-item"><a class="nav-link" href="../Geometry_and_Transformations/Normals.html">(Previous: Normals)</a></li>
  </ul>

  <ul class="nav navbar-nav ml-auto d-none d-md-block">
        <li class="nav-item"><div class="gcse-search"></div></li>
    </ul>
  <ul class="nav navbar-nav d-block d-md-none">
        <li class="nav-item"><div class="gcse-search"></div></li>
    </ul>
</nav>

<div class="maincontainer">
<div class="container-fluid">

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#"><i class="fas fa-link "></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:rays"></span><h2>2.5 Rays</h2><p>



</p>
<p>A <em>ray</em> is a semi-infinite line specified by its origin and direction.
<tt>pbrt</tt> represents a <a href="#Ray"><tt>Ray</tt></a> with a <a href="../Geometry_and_Transformations/Points.html#Point3f"><tt>Point3f</tt></a> for the origin and a
<a href="../Geometry_and_Transformations/Vectors.html#Vector3f"><tt>Vector3f</tt></a> for the direction.  
We only need rays with floating-point origins and directions, so <tt>Ray</tt>
isn&rsquo;t a template class parameterized by an arbitrary type, as points,
vectors, and normals were.
A ray is denoted by&nbsp;<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.912ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 392.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal r</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-72" d="M364 381c0 -32 -25 -44 -43 -44c-22 0 -43 15 -43 43c0 26 20 38 23 39c-2 1 -4 1 -11 1c-76 0 -118 -89 -118 -188v-154c0 -36 2 -47 76 -47h21v-31c-40 3 -87 3 -127 3l-114 -3v31c67 0 78 0 78 45v268c0 49 -8 56 -78 56v31l139 11v-110c14 43 50 110 123 110 c43 0 74 -29 74 -61Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-72" x="0" y="0"></use>
</g>
</svg>; it has origin
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.162ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 500.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal o</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-6F" d="M471 214c0 -127 -101 -225 -222 -225c-117 0 -221 96 -221 225c0 125 97 234 222 234c121 0 221 -106 221 -234zM388 222c0 38 0 96 -26 139s-69 65 -113 65c-40 0 -87 -21 -114 -67c-24 -44 -24 -98 -24 -137c0 -36 0 -97 25 -141c27 -46 71 -67 114 -67 c50 0 94 29 116 74c22 44 22 98 22 134Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-6F" x="0" y="0"></use>
</g>
</svg> and direction <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.485ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 639.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold d</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D41D" d="M601 0l-183 -6v49c-31 -25 -79 -49 -140 -49c-148 0 -240 95 -240 227c0 141 105 229 251 229c33 0 85 -6 135 -45v195c0 39 -7 39 -69 39v47l177 8v-608c0 -39 7 -39 69 -39v-47zM418 103v250c-22 29 -62 61 -119 61c-31 0 -78 -10 -107 -52c-26 -39 -26 -93 -26 -141 c0 -70 0 -191 122 -191c76 0 117 55 130 73Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D41D" x="0" y="0"></use>
</g>
</svg>, as shown in
Figure&nbsp;<a href="#fig:rayexample">2.7</a>.  

</p>
<p></p>
<span class="anchor" id="fig:rayexample"></span><div class="card outerfigure"><div class="card-body figure"><p>



</p>
<div class="figure-row">
  <a href="Ray%20point%20vector.svg" title=""><img src="Ray%20point%20vector.svg" width=300 height=62 style="max-width: 100%;"></a>
</div>
<p>


</p>
<figcaption class="caption">Figure 2.7: <span class="legend"> A ray is a semi-infinite line defined by its origin <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.162ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 500.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal o</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-6F" d="M471 214c0 -127 -101 -225 -222 -225c-117 0 -221 96 -221 225c0 125 97 234 222 234c121 0 221 -106 221 -234zM388 222c0 38 0 96 -26 139s-69 65 -113 65c-40 0 -87 -21 -114 -67c-24 -44 -24 -98 -24 -137c0 -36 0 -97 25 -141c27 -46 71 -67 114 -67 c50 0 94 29 116 74c22 44 22 98 22 134Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-6F" x="0" y="0"></use>
</g>
</svg> and
its direction vector <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.485ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 639.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold d</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D41D" d="M601 0l-183 -6v49c-31 -25 -79 -49 -140 -49c-148 0 -240 95 -240 227c0 141 105 229 251 229c33 0 85 -6 135 -45v195c0 39 -7 39 -69 39v47l177 8v-608c0 -39 7 -39 69 -39v-47zM418 103v250c-22 29 -62 61 -119 61c-31 0 -78 -10 -107 -52c-26 -39 -26 -93 -26 -141 c0 -70 0 -191 122 -191c76 0 117 55 130 73Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D41D" x="0" y="0"></use>
</g>
</svg>.</span>
</figcaption><p>
 

</p>
</div></div><p>


</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-RayDeclarations-0"></span><div class="fragmentname">&lt;&lt;Ray Declarations&gt;&gt;=&nbsp;<a href="#fragment-RayDeclarations-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">class <span class="anchor" id="Ray"></span>Ray {
public:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-RayPublicMethods-0">Ray Public Methods</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-104" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-104"><i></i></a><div id="fragbit-104" class="collapse"><div class="fragmentcode">       <a href="#Ray" class="code">Ray</a>() : tMax(<a href="../Shapes/Managing_Rounding_Error.html#Infinity" class="code">Infinity</a>), time(0.f), medium(nullptr) { }
       <a href="#Ray" class="code">Ray</a>(const <a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a> &amp;<a href="#Ray::o" class="code">o</a>, const <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> &amp;<a href="#Ray::d" class="code">d</a>, Float tMax = <a href="../Shapes/Managing_Rounding_Error.html#Infinity" class="code">Infinity</a>,
           Float time = 0.f, const <a href="../Volume_Scattering/Media.html#Medium" class="code">Medium</a> *medium = nullptr)
           : <a href="#Ray::o" class="code">o</a>(<a href="#Ray::o" class="code">o</a>), <a href="#Ray::d" class="code">d</a>(<a href="#Ray::d" class="code">d</a>), tMax(tMax), time(time), medium(medium) { }
       <a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a> operator()(Float t) const { return <a href="#Ray::o" class="code">o</a> + <a href="#Ray::d" class="code">d</a> * t; }
       bool HasNaNs() const {
           return (<a href="#Ray::o" class="code">o</a>.HasNaNs() || <a href="#Ray::d" class="code">d</a>.HasNaNs() || std::isnan(tMax));
       }
       friend std::ostream&amp; operator&lt;&lt;(std::ostream&amp; os, const <a href="#Ray" class="code">Ray</a> &amp;r) {
           os &lt;&lt; "[<a href="#Ray::o" class="code">o</a>=" &lt;&lt; r.<a href="#Ray::o" class="code">o</a> &lt;&lt; ", <a href="#Ray::d" class="code">d</a>=" &lt;&lt; r.<a href="#Ray::d" class="code">d</a> &lt;&lt; ", tMax="
              &lt;&lt; r.tMax &lt;&lt; ", time=" &lt;&lt; r.time &lt;&lt; "]";
           return os;
       }</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-RayPublicData-0">Ray Public Data</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-105" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-105"><i></i></a><div id="fragbit-105" class="collapse"><div class="fragmentcode">       <a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a> o;
       <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> d;
       mutable Float tMax;
       Float time;
       const <a href="../Volume_Scattering/Media.html#Medium" class="code">Medium</a> *medium;</div></div>
};</div><p>


</p>
<p>Because we will be referring to these
variables often throughout the code, the origin and direction members of a
<a href="#Ray"><tt>Ray</tt></a> are succinctly named&nbsp;<tt>o</tt> and&nbsp;<tt>d</tt>. Note that we again
make the data publicly available for convenience.

</p>
<p>
</p>
<span class="anchor" id="fragment-RayPublicData-0"></span><div class="fragmentname">&lt;&lt;Ray Public Data&gt;&gt;=&nbsp;<a href="#fragment-RayPublicData-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode"><a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a> <span class="anchor" id="Ray::o"></span>o;
<a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> <span class="anchor" id="Ray::d"></span>d;</div><p>


</p>
<p>The <em>parametric form</em> of a ray expresses it as a function of a scalar
value <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.84ex" height="2.009ex" style="vertical-align: -0.338ex;" viewBox="0 -719.6 361.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">t</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
</g>
</svg>, giving the set of points that the ray passes through:
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="eq:ray"></span><div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="26.479ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 11400.6 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal r left-parenthesis t right-parenthesis equals normal o plus t bold d Baseline 0 less-than-or-equal-to t less-than normal infinity period</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-72" d="M364 381c0 -32 -25 -44 -43 -44c-22 0 -43 15 -43 43c0 26 20 38 23 39c-2 1 -4 1 -11 1c-76 0 -118 -89 -118 -188v-154c0 -36 2 -47 76 -47h21v-31c-40 3 -87 3 -127 3l-114 -3v31c67 0 78 0 78 45v268c0 49 -8 56 -78 56v31l139 11v-110c14 43 50 110 123 110 c43 0 74 -29 74 -61Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6F" d="M471 214c0 -127 -101 -225 -222 -225c-117 0 -221 96 -221 225c0 125 97 234 222 234c121 0 221 -106 221 -234zM388 222c0 38 0 96 -26 139s-69 65 -113 65c-40 0 -87 -21 -114 -67c-24 -44 -24 -98 -24 -137c0 -36 0 -97 25 -141c27 -46 71 -67 114 -67 c50 0 94 29 116 74c22 44 22 98 22 134Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D41D" d="M601 0l-183 -6v49c-31 -25 -79 -49 -140 -49c-148 0 -240 95 -240 227c0 141 105 229 251 229c33 0 85 -6 135 -45v195c0 39 -7 39 -69 39v47l177 8v-608c0 -39 7 -39 69 -39v-47zM418 103v250c-22 29 -62 61 -119 61c-31 0 -78 -10 -107 -52c-26 -39 -26 -93 -26 -141 c0 -70 0 -191 122 -191c76 0 117 55 130 73Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2264" d="M691 75c24 -11 7 -47 -18 -36l-581 275c-17 8 -17 32 0 40l581 275c25 11 42 -25 18 -36l-548 -259zM702 -99c0 -11 -9 -20 -20 -20h-586c-11 0 -20 9 -20 20s9 20 20 20h586c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3C" d="M689 -9c24 -11 7 -47 -18 -36l-581 275c-17 8 -17 32 0 40l581 275c25 11 42 -25 18 -36l-548 -259Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-221E" d="M943 216c0 -118 -76 -227 -192 -227c-79 0 -138 42 -170 69c-22 19 -23 20 -90 101c-13 -22 -102 -170 -246 -170c-119 0 -189 115 -189 226c0 118 76 227 192 227c79 0 138 -42 170 -69c22 -19 23 -20 90 -101c13 22 102 170 246 170c119 0 189 -115 189 -226zM921 216 c0 90 -54 194 -160 194c-113 0 -189 -105 -227 -173c28 -34 73 -97 101 -128c45 -49 86 -72 132 -72c84 0 154 79 154 179zM465 194c-28 34 -73 97 -101 128c-45 49 -86 72 -132 72c-84 0 -154 -79 -154 -179c0 -90 54 -194 160 -194c113 0 189 105 227 173Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-72" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="392" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="782" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1143" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="1810" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6F" x="2867" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="3589" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="4590" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D41D" x="4952" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="6591" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2264" x="7369" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="8426" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3C" x="9065" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-221E" x="10121" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="11122" y="0"></use>
</g>
</svg>
</div>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">
<div class="eqno">(<a href="#eq:ray">2.3</a>)</div>
</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<p>


</p>
<p>The <tt>Ray</tt> also includes a member variable that limits the ray to a segment
along its infinite extent.  This field, <tt>tMax</tt>, allows
us to restrict the ray to a segment of points
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.599ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 4563.7 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket normal o comma normal r left-parenthesis t Subscript normal m normal a normal x Baseline right-parenthesis right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6F" d="M471 214c0 -127 -101 -225 -222 -225c-117 0 -221 96 -221 225c0 125 97 234 222 234c121 0 221 -106 221 -234zM388 222c0 38 0 96 -26 139s-69 65 -113 65c-40 0 -87 -21 -114 -67c-24 -44 -24 -98 -24 -137c0 -36 0 -97 25 -141c27 -46 71 -67 114 -67 c50 0 94 29 116 74c22 44 22 98 22 134Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-72" d="M364 381c0 -32 -25 -44 -43 -44c-22 0 -43 15 -43 43c0 26 20 38 23 39c-2 1 -4 1 -11 1c-76 0 -118 -89 -118 -188v-154c0 -36 2 -47 76 -47h21v-31c-40 3 -87 3 -127 3l-114 -3v31c67 0 78 0 78 45v268c0 49 -8 56 -78 56v31l139 11v-110c14 43 50 110 123 110 c43 0 74 -29 74 -61Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6D" d="M813 0l-112 3l-113 -3v31c67 0 78 0 78 45v233c0 57 -11 111 -74 111c-64 0 -135 -56 -135 -160v-184c0 -45 11 -45 78 -45v-31l-112 3l-113 -3v31c67 0 78 0 78 45v233c0 57 -11 111 -74 111c-64 0 -135 -56 -135 -160v-184c0 -45 11 -45 78 -45v-31l-112 3l-113 -3v31 c67 0 78 0 78 45v268c0 49 -8 56 -78 56v31l141 11v-105c28 62 75 105 148 105c45 0 119 -11 133 -98c17 38 61 98 145 98c58 0 91 -20 105 -37c31 -36 31 -67 31 -153v-191c1 -30 26 -30 78 -30v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-61" d="M483 89c0 -81 -61 -95 -82 -95c-47 0 -74 42 -78 82c-19 -47 -65 -87 -131 -87c-63 0 -160 25 -160 106c0 44 25 96 100 130c63 30 133 33 184 36v37c0 89 -57 128 -106 128c-32 0 -81 -11 -108 -46c46 -1 51 -34 51 -46c0 -26 -18 -46 -46 -46c-26 0 -46 17 -46 47 c0 66 69 113 151 113c48 0 98 -16 137 -55c36 -37 36 -76 36 -118v-200c0 -5 4 -50 37 -50c11 0 36 6 36 64v56h25v-56zM316 140v100c-165 -6 -207 -89 -207 -144c0 -50 41 -85 90 -85c45 0 117 34 117 129Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-78" d="M516 0c-30 2 -69 3 -96 3l-108 -3v31c27 1 36 16 36 25c0 6 -13 22 -21 33l-76 100c-61 -72 -90 -105 -90 -127c0 -15 7 -28 29 -31v-31l-95 3c-26 0 -57 -1 -83 -3v31c21 0 80 2 128 60c47 57 47 59 94 119l-99 129c-47 60 -48 61 -118 61v31c27 -2 74 -3 95 -3l108 3 v-31c-20 -1 -35 -10 -35 -25c0 -6 0 -8 9 -18l78 -101l62 78c5 6 15 19 15 35s-8 29 -29 31v31c13 -1 66 -3 96 -3c26 0 56 1 82 3v-31c-47 -1 -88 -16 -119 -52c-24 -26 -62 -75 -92 -113l134 -173c23 -29 41 -31 95 -31v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6F" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="779" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-72" x="1224" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1616" y="0"></use>
<g transform="translate(2006,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
<g transform="translate(361,-150)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6D" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-61" x="833" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-78" x="1334" y="0"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="3784" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="4174" y="0"></use>
</g>
</svg>.

</p>
<p>Notice that this field is declared as <tt>mutable</tt>, meaning that it can
be changed even if the <a href="#Ray"><tt>Ray</tt></a> that contains it is
<tt>const</tt>&mdash;thus, when a ray is passed to a method that takes a
<tt>const Ray &amp;</tt>, that method is not allowed to modify its origin or
direction but can modify its extent.  This convention fits one of the most
common uses of rays in the system, as parameters to ray&ndash;object
intersection testing routines, which will record the offsets to the closest
intersection in <tt>tMax</tt>.

</p>
<p></p>
<span class="anchor" id="fragment-RayPublicData-1"></span><div class="fragmentname">&lt;&lt;Ray Public Data&gt;&gt;+=&nbsp;<a href="#fragment-RayPublicData-0"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-RayPublicData-2"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">mutable Float <span class="anchor" id="Ray::tMax"></span>tMax;</div><p>


</p>
<p>Each ray has a time value associated with it. In scenes with animated
objects, the rendering system constructs a representation of the scene at
the appropriate time for each ray.

</p>
<p></p>
<span class="anchor" id="fragment-RayPublicData-2"></span><div class="fragmentname">&lt;&lt;Ray Public Data&gt;&gt;+=&nbsp;<a href="#fragment-RayPublicData-1"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-RayPublicData-3"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">Float <span class="anchor" id="Ray::time"></span>time;</div><p>


</p>
<p>Finally, each ray records the medium containing its origin.  The <a href="../Volume_Scattering/Media.html#Medium"><tt>Medium</tt></a>
class, introduced in Section&nbsp;<a href="../Volume_Scattering/Media.html#sec:media">11.3</a>, encapsulates the (potentially
spatially varying) properties of media such as a foggy atmosphere, smoke, or
scattering liquids like milk or shampoo. Associating this information with rays
makes it possible for other parts of the system to account correctly for the
effect of rays passing from one medium to another.

</p>
<p></p>
<span class="anchor" id="fragment-RayPublicData-3"></span><div class="fragmentname">&lt;&lt;Ray Public Data&gt;&gt;+=&nbsp;<a href="#fragment-RayPublicData-2"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">const <a href="../Volume_Scattering/Media.html#Medium" class="code">Medium</a> *<span class="anchor" id="Ray::medium"></span>medium;</div><p>


</p>
<p>Constructing <a href="#Ray"><tt>Ray</tt></a>s is straightforward.  The default constructor relies
on the <a href="../Geometry_and_Transformations/Points.html#Point3f"><tt>Point3f</tt></a> and <a href="../Geometry_and_Transformations/Vectors.html#Vector3f"><tt>Vector3f</tt></a> constructors to set the origin and
direction to <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.365ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 3170.8 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis 0 comma 0 comma 0 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="890" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="1335" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1835" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="2280" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2781" y="0"></use>
</g>
</svg>.  Alternately, a particular point and direction can
be provided.  If an origin and direction are provided, the constructor
allows a value to be given for <tt>tMax</tt>, the ray&rsquo;s time and
medium.

</p>
<p></p>
<span class="anchor" id="fragment-RayPublicMethods-0"></span><div class="fragmentname">&lt;&lt;Ray Public Methods&gt;&gt;=&nbsp;<a href="#fragment-RayPublicMethods-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode"><a href="#Ray" class="code">Ray</a>() : tMax(<a href="../Shapes/Managing_Rounding_Error.html#Infinity" class="code">Infinity</a>), time(0.f), medium(nullptr) { }
<a href="#Ray" class="code">Ray</a>(const <a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a> &amp;o, const <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> &amp;d, Float tMax = <a href="../Shapes/Managing_Rounding_Error.html#Infinity" class="code">Infinity</a>,
    Float time = 0.f, const <a href="../Volume_Scattering/Media.html#Medium" class="code">Medium</a> *medium = nullptr)
    : o(o), d(d), tMax(tMax), time(time), medium(medium) { }</div><p>


</p>
<p>Because position along a ray can be thought of as a function of a
single parameter <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.84ex" height="2.009ex" style="vertical-align: -0.338ex;" viewBox="0 -719.6 361.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">t</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
</g>
</svg>, the <tt>Ray</tt> class overloads the function
application operator for rays.  This way, when we need to find the point at
a particular position along a ray, we can write code like:

</p>
<p></p>
<div class="fragmentcode">    Ray r(Point3f(0, 0, 0), Vector3f(1, 2, 3));
    Point3f p = r(1.7);</div><p>


</p>
<p></p>
<span class="anchor" id="fragment-RayPublicMethods-1"></span><div class="fragmentname">&lt;&lt;Ray Public Methods&gt;&gt;+=&nbsp;<a href="#fragment-RayPublicMethods-0"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode"><a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a> <span class="anchor" id="Ray::operator"></span>operator()(Float t) const { return <a href="#Ray::o" class="code">o</a> + <a href="#Ray::d" class="code">d</a> * t; }</div><p>


</p>
<p>

</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#RayDifferentials"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:ray-differentials"></span><span id="RayDifferentials"></span><h3>2.5.1  Ray Differentials</h3><p>



</p>
<p> In order to be able to perform better antialiasing with the
texture functions defined in Chapter&nbsp;<a href="../Texture.html#chap:texture">10</a>, <tt>pbrt</tt> can keep track
of some additional information with rays.  In
Section&nbsp;<a href="../Texture/Sampling_and_Antialiasing.html#sec:texture-anti-aliasing">10.1</a>, this information will be used to
compute values that are used by the <a href="../Texture/Texture_Interface_and_Basic_Textures.html#Texture"><tt>Texture</tt></a> class to estimate the
projected area on the image plane of a small part of the scene.  From this,
the <a href="../Texture/Texture_Interface_and_Basic_Textures.html#Texture"><tt>Texture</tt></a> can compute the texture&rsquo;s average value over that area,
leading to a higher-quality final image.

</p>
<p><a href="#RayDifferential"><tt>RayDifferential</tt></a> is a subclass of <a href="#Ray"><tt>Ray</tt></a> that contains
additional information about two auxiliary rays.  These extra rays
represent camera rays offset by one sample in the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 572.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">x</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.139ex" height="2.009ex" style="vertical-align: -0.671ex;" viewBox="0 -576.1 490.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">y</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="0" y="0"></use>
</g>
</svg> direction from
the main ray on the film plane.  By determining
the area that these three rays project to on
an object being shaded, the <a href="../Texture/Texture_Interface_and_Basic_Textures.html#Texture"><tt>Texture</tt></a> can estimate an area to average
over for proper antialiasing.

</p>
<p>Because the <a href="#RayDifferential"><tt>RayDifferential</tt></a> class inherits from <a href="#Ray"><tt>Ray</tt></a>, geometric
interfaces in the system can be written to take <tt>const Ray &amp;</tt>
parameters, so that either a <tt>Ray</tt> or <tt>RayDifferential</tt> can be
passed to them.  Only the routines that need to account for antialiasing and texturing
require <tt>RayDifferential</tt> parameters.

</p>
<p></p>
<span class="anchor" id="fragment-RayDeclarations-1"></span><div class="fragmentname">&lt;&lt;Ray Declarations&gt;&gt;+=&nbsp;<a href="#fragment-RayDeclarations-0"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">class <span class="anchor" id="RayDifferential"></span>RayDifferential : public <a href="#Ray" class="code">Ray</a> {
public:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-RayDifferentialPublicMethods-0">RayDifferential Public Methods</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-106" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-106"><i></i></a><div id="fragbit-106" class="collapse"><div class="fragmentcode">       RayDifferential() { <a href="#RayDifferential::hasDifferentials" class="code">hasDifferentials</a> = false; }
       RayDifferential(const <a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a> &amp;<a href="#Ray::o" class="code">o</a>, const <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> &amp;<a href="#Ray::d" class="code">d</a>,
               Float tMax = <a href="../Shapes/Managing_Rounding_Error.html#Infinity" class="code">Infinity</a>, Float time = 0.f,
               const <a href="../Volume_Scattering/Media.html#Medium" class="code">Medium</a> *medium = nullptr)
           : <a href="#Ray" class="code">Ray</a>(<a href="#Ray::o" class="code">o</a>, <a href="#Ray::d" class="code">d</a>, tMax, time, medium) {
           <a href="#RayDifferential::hasDifferentials" class="code">hasDifferentials</a> = false; 
       }
       RayDifferential(const <a href="#Ray" class="code">Ray</a> &amp;ray) : <a href="#Ray" class="code">Ray</a>(ray) {
           <a href="#RayDifferential::hasDifferentials" class="code">hasDifferentials</a> = false; 
       }
       bool HasNaNs() const {
           return <a href="#Ray" class="code">Ray</a>::HasNaNs() || 
              (<a href="#RayDifferential::hasDifferentials" class="code">hasDifferentials</a> &amp;&amp; (<a href="#RayDifferential::rxOrigin" class="code">rxOrigin</a>.HasNaNs() || <a href="#RayDifferential::ryOrigin" class="code">ryOrigin</a>.HasNaNs() ||
                                    <a href="#RayDifferential::rxDirection" class="code">rxDirection</a>.HasNaNs() || <a href="#RayDifferential::ryDirection" class="code">ryDirection</a>.HasNaNs()));
       }
       void ScaleDifferentials(Float s) {
           <a href="#RayDifferential::rxOrigin" class="code">rxOrigin</a> = <a href="#Ray::o" class="code">o</a> + (<a href="#RayDifferential::rxOrigin" class="code">rxOrigin</a> - <a href="#Ray::o" class="code">o</a>) * s;
           <a href="#RayDifferential::ryOrigin" class="code">ryOrigin</a> = <a href="#Ray::o" class="code">o</a> + (<a href="#RayDifferential::ryOrigin" class="code">ryOrigin</a> - <a href="#Ray::o" class="code">o</a>) * s;
           <a href="#RayDifferential::rxDirection" class="code">rxDirection</a> = <a href="#Ray::d" class="code">d</a> + (<a href="#RayDifferential::rxDirection" class="code">rxDirection</a> - <a href="#Ray::d" class="code">d</a>) * s;
           <a href="#RayDifferential::ryDirection" class="code">ryDirection</a> = <a href="#Ray::d" class="code">d</a> + (<a href="#RayDifferential::ryDirection" class="code">ryDirection</a> - <a href="#Ray::d" class="code">d</a>) * s;
       }</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-RayDifferentialPublicData-0">RayDifferential Public Data</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-107" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-107"><i></i></a><div id="fragbit-107" class="collapse"><div class="fragmentcode">       bool hasDifferentials;
       <a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a> rxOrigin, ryOrigin;
       <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> rxDirection, ryDirection;</div></div>
};</div><p>


</p>
<p>The <tt>RayDifferential</tt> constructors mirror the <tt>Ray</tt>&rsquo;s
constructors.

</p>
<p></p>
<span class="anchor" id="fragment-RayDifferentialPublicMethods-0"></span><div class="fragmentname">&lt;&lt;RayDifferential Public Methods&gt;&gt;=&nbsp;<a href="#fragment-RayDifferentialPublicMethods-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">RayDifferential() { <a href="#RayDifferential::hasDifferentials" class="code">hasDifferentials</a> = false; }
RayDifferential(const <a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a> &amp;o, const <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> &amp;d,
        Float tMax = <a href="../Shapes/Managing_Rounding_Error.html#Infinity" class="code">Infinity</a>, Float time = 0.f,
        const <a href="../Volume_Scattering/Media.html#Medium" class="code">Medium</a> *medium = nullptr)
    : <a href="#Ray" class="code">Ray</a>(o, d, tMax, time, medium) {
    <a href="#RayDifferential::hasDifferentials" class="code">hasDifferentials</a> = false; 
}</div><p>


</p>
<p></p>
<span class="anchor" id="fragment-RayDifferentialPublicData-0"></span><div class="fragmentname">&lt;&lt;RayDifferential Public Data&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">bool <span class="anchor" id="RayDifferential::hasDifferentials"></span>hasDifferentials;
<a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a> <span class="anchor" id="RayDifferential::rxOrigin"></span>rxOrigin, <span class="anchor" id="RayDifferential::ryOrigin"></span>ryOrigin;
<a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> <span class="anchor" id="RayDifferential::rxDirection"></span>rxDirection, <span class="anchor" id="RayDifferential::ryDirection"></span>ryDirection;</div><p>


</p>
<p>There is a constructor to create <a href="#RayDifferential"><tt>RayDifferential</tt></a>s from <a href="#Ray"><tt>Ray</tt></a>s.
The constructor sets <tt>hasDifferentials</tt> to <tt>false</tt> initially because the neighboring
rays, if any, are not known.

</p>
<p></p>
<span class="anchor" id="fragment-RayDifferentialPublicMethods-1"></span><div class="fragmentname">&lt;&lt;RayDifferential Public Methods&gt;&gt;+=&nbsp;<a href="#fragment-RayDifferentialPublicMethods-0"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-RayDifferentialPublicMethods-2"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">RayDifferential(const <a href="#Ray" class="code">Ray</a> &amp;ray) : <a href="#Ray" class="code">Ray</a>(ray) {
    <a href="#RayDifferential::hasDifferentials" class="code">hasDifferentials</a> = false; 
}</div><p>


</p>
<p>

</p>
<p><a href="../Camera_Models/Camera_Model.html#Camera"><tt>Camera</tt></a> implementations in <tt>pbrt</tt> compute differentials for rays leaving
the camera under the assumption that camera rays are spaced one pixel apart.
Integrators such as the <a href="../Introduction/pbrt_System_Overview.html#SamplerIntegrator"><tt>SamplerIntegrator</tt></a> can generate multiple camera
rays per pixel, in which case the actual distance between samples is lower.
The fragment &lt;&lt;<span class="fragmentname"><a href="../Introduction/pbrt_System_Overview.html#fragment-Generatecamerarayforcurrentsample-0">Generate camera ray for current sample</a></span>&gt;&gt; encountered in
Chapter&nbsp;<a href="../Introduction.html#chap:overview">1</a> called the <tt>ScaleDifferentials()</tt> method
defined below to update differential rays for an estimated sample spacing of
<tt>s</tt>. 

</p>
<p></p>
<span class="anchor" id="fragment-RayDifferentialPublicMethods-2"></span><div class="fragmentname">&lt;&lt;RayDifferential Public Methods&gt;&gt;+=&nbsp;<a href="#fragment-RayDifferentialPublicMethods-1"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">void <span class="anchor" id="RayDifferential::ScaleDifferentials"></span>ScaleDifferentials(Float s) {
    <a href="#RayDifferential::rxOrigin" class="code">rxOrigin</a> = <a href="#Ray::o" class="code">o</a> + (<a href="#RayDifferential::rxOrigin" class="code">rxOrigin</a> - <a href="#Ray::o" class="code">o</a>) * s;
    <a href="#RayDifferential::ryOrigin" class="code">ryOrigin</a> = <a href="#Ray::o" class="code">o</a> + (<a href="#RayDifferential::ryOrigin" class="code">ryOrigin</a> - <a href="#Ray::o" class="code">o</a>) * s;
    <a href="#RayDifferential::rxDirection" class="code">rxDirection</a> = <a href="#Ray::d" class="code">d</a> + (<a href="#RayDifferential::rxDirection" class="code">rxDirection</a> - <a href="#Ray::d" class="code">d</a>) * s;
    <a href="#RayDifferential::ryDirection" class="code">ryDirection</a> = <a href="#Ray::d" class="code">d</a> + (<a href="#RayDifferential::ryDirection" class="code">ryDirection</a> - <a href="#Ray::d" class="code">d</a>) * s;
}</div><p>


</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

</div>  <!-- container-fluid -->
</div>  <!-- maincontainer -->

<nav class="navbar navbar-expand-md bg-light navbar-light">
  <div class="container-fluid-nav">
    <!--  <ul class="nav navbar-nav navbar-center"> -->
      <span class="navbar-text" style="text-align: center;">
        Thanks to ZeroSumBit and 34 others for generously supporting <i>Physically
        Based Rendering</i> online
        through <a href="https://patreon.com/pbrbook">Patreon</a>.
    </span>
  </div>
</nav>

<nav class="navbar navbar-expand-md bg-light navbar-light">
  <span class="navbar-text"><i>Physically Based Rendering: From Theory To Implementation</i>, &copy; 2004-2021 Matt Pharr, Wenzel Jakob, and Greg Humphreys under the <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/">CC BY-NC-ND 4.0</a> license. (<a href="https://github.com/mmp/pbr-book-website/">github</a>)</span>
  <div class="container">
    <ul class="nav navbar-nav ml-auto">
      <li class="nav-item">Next: <a href="../Geometry_and_Transformations/Bounding_Boxes.html">Geometry and Transformations / Bounding Boxes</a></li>
    </ul>
  </div>

</nav>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script>
  $(function () {
    $('[data-toggle="popover"]').popover()
    $('[data-toggle="tooltip"]').tooltip()
   })
</script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

<script>
// https://stackoverflow.com/a/17535094
// The function actually applying the offset
function offsetAnchor() {
  if (location.hash.length !== 0) {
    window.scrollTo(window.scrollX, window.scrollY - window.innerHeight / 8);
  }
}

// Captures click events of all <a> elements with href starting with #
$(document).on('click', 'a[href^="#"]', function(event) {
  // Click events are captured before hashchanges. Timeout
  // causes offsetAnchor to be called after the page jump.
  window.setTimeout(function() {
    offsetAnchor();
  }, 500);
});

// Set the offset when entering page with hash present in the url
window.setTimeout(offsetAnchor, 1500);
</script>

</body>
</html>
