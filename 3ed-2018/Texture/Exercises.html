
<!doctype html>
<html lang="en">
<head>

<!-- all praise to https://realfavicongenerator.net -->
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="/fonts.css">
  <link rel="stylesheet" href="/fontawesome-free-5.15.3-web/css/all.css">
  <link rel="stylesheet" href="/bootstrap.min.css">

  <script async src="https://cse.google.com/cse.js?cx=003601324460585362024:4xwpwgaitgd"></script>
  <script src="/react.min.js"></script>
  <script src="/react-dom.min.js"></script>
  <script src="/jeri.min.js"></script>
  <link rel="preload" href="/exr.worker.js" as="script" crossorigin="anonymous">

  <link rel="stylesheet" href="../pbrstyle.css">
  <script src="/3ed-2018/pbrt-display.js"></script>
        

  <title>Exercises</title>
</head>
        
<body>

<nav class="fixed-top-lg-navbar navbar navbar-expand">
  <ul class="nav navbar-nav">
    <a class="navbar-brand" href="../contents.html"><img src="../pbr.jpg" width=25 height=25></a>
    <li class="nav-item"><a class="nav-link" href="../Texture.html">Texture</a></li>
    <span class="navbar-text">/</span>
    <li class="nav-item"><a class="nav-link" href="#">Exercises</a></li>
    <span class="navbar-text">&nbsp;&nbsp;</span>
    <li class="nav-item"><a class="nav-link" href="../Texture/Further_Reading.html">(Previous: Further Reading)</a></li>
  </ul>

  <ul class="nav navbar-nav ml-auto d-none d-md-block">
        <li class="nav-item"><div class="gcse-search"></div></li>
    </ul>
  <ul class="nav navbar-nav d-block d-md-none">
        <li class="nav-item"><div class="gcse-search"></div></li>
    </ul>
  <ul class="nav navbar-nav d-block">
    <li class="nav-item"><button class="displaymode" onclick="TogglePBRTDisplayMode()"></button></li>
  </ul>
</nav>

<div class="maincontainer">
<div class="container-fluid">

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#"><i class="fas fa-link "></i></a>
</div>
<div class="col-md-10 col-lg-8">
<h2>Exercises</h2><p>


</p>
<p></p>
<ol>

 <li class="exercise"><span class="exerciseicon">&#9313;</span>
Many image file formats don&rsquo;t store floating-point color
values but instead use 8&nbsp;bits for each color component, mapping the
values to the range <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.653ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2003.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket 0 comma 1 right-bracket</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="779" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1224" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="1724" y="0"></use>
</g>
</svg>.  (For example, the TGA format that is supported
by <tt>ReadImage()</tt> is such a format.)
For images originally stored in this format,
the <a href="../Texture/Image_Texture.html#ImageTexture"><tt>ImageTexture</tt></a> uses four times more memory than strictly necessary
by using <tt>float</tt>s in <a href="../Color_and_Radiometry/RGBSpectrum_Implementation.html#RGBSpectrum"><tt>RGBSpectrum</tt></a> objects to store these colors.
Modify the image reading routines to directly return 8-bit values
when an image is read from
such a file.

Then modify the <a href="../Texture/Image_Texture.html#ImageTexture"><tt>ImageTexture</tt></a> so that it keeps the data
for such textures in an 8-bit representation, and modify the
<a href="../Texture/Image_Texture.html#MIPMap"><tt>MIPMap</tt></a> so that it can filter data stored in this format.  How much
memory is saved for image texture-heavy scenes?  How is <tt>pbrt</tt>&rsquo;s performance
affected?  Can you explain the causes of any performance differences?

 <li class="exercise"><span class="exerciseicon">&#9313;</span> For scenes with many image textures where reading them
all into memory simultaneously has a prohibitive memory cost, an effective
approach can be to allocate a fixed amount of memory for image maps (a
<em>texture cache</em>), load textures into that memory on demand, and
discard the image maps that haven&rsquo;t been accessed recently when the memory
fills up (<a href="Further_Reading.html#cite:Peachey90">Peachey 1990</a>).  To enable good performance with small texture
caches, image maps should be stored in a <em>tiled</em> format that makes it
possible to load in small square regions of the texture independently of
each other.  Tiling techniques like these are used in graphics hardware to
improve the performance of their texture memory caches (<a href="Further_Reading.html#cite:Hakura97">Hakura and Gupta 1997</a>;
Igehy et&nbsp;al.&nbsp;<a href="Further_Reading.html#cite:Igehy98">1998</a>, <a href="Further_Reading.html#cite:Igehy99tex">1999</a>).
Implement a texture cache in <tt>pbrt</tt>.
Write a conversion program that converts images in other formats to a tiled
format.  (You may want to investigate OpenEXR&rsquo;s tiled image support.)  How
small can you make the texture cache and still see good performance?

 <li class="exercise"><span class="exerciseicon">&#9313;</span> Read the papers by Manson and Schaefer (<a href="Further_Reading.html#cite:Manson2013">2013</a>, <a href="Further_Reading.html#cite:Manson2014">2014</a>) on
approximating high-quality filters with MIP maps and a small number of
bilinear samples.  Add an option to use their method for texture filtering
in place of the EWA implementation currently in <tt>pbrt</tt>.  Compare image
quality for a number of scenes that use textures.  How does running time
compare?  You may also find it useful to use a profiler to compare the
amount of time running texture filtering code for each of the two
approaches.

 <li class="exercise"><span class="exerciseicon">&#9313;</span> Improve the filtering algorithm used for resampling image
maps to initialize the MIP map levels using the Lanczos filter instead of
the box filter.  How do the sphere test images in the file
<tt>scenes/sphere-ewa-vs-trilerp.pbrt</tt> and
Figure&nbsp;<a href="../Texture/Image_Texture.html#fig:texfilt-ewa-trilerp">10.10</a> change after your improvements?



 <li class="exercise"><span class="exerciseicon">&#9313;</span> It is possible to use MIP mapping with textures that have
non-power-of-two resolutions&mdash;the details are explained by Guthe and Heckbert (<a href="Further_Reading.html#cite:Guthe05">2005</a>).  Implementing this approach can save a substantial amount of
memory: in the worst case, the resampling that <tt>pbrt</tt>&rsquo;s <a href="../Texture/Image_Texture.html#MIPMap"><tt>MIPMap</tt></a>
implementation performs can increase memory requirements by a factor of
four.  (Consider a <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.815ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 4225.9 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">513 times 513</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-35" d="M449 201c0 -127 -102 -223 -218 -223c-112 0 -181 97 -181 183c0 46 35 53 49 53c33 0 50 -25 50 -49s-17 -49 -50 -49c-11 0 -14 1 -17 2c17 -59 74 -112 147 -112c46 0 83 26 107 65c24 42 24 102 24 137c0 50 -2 89 -18 126c-8 18 -33 64 -85 64 c-81 0 -118 -54 -129 -70c-4 -6 -6 -9 -13 -9c-14 0 -14 8 -14 26v296c0 16 0 24 10 24c0 0 4 0 12 -3c47 -21 93 -28 133 -28c67 0 116 20 136 29c5 3 8 3 8 3c7 0 10 -5 10 -11c0 -13 -70 -104 -193 -104c-32 0 -65 7 -85 13v-195c36 35 79 51 127 51 c108 0 190 -100 190 -219Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-33" d="M457 171c0 -102 -91 -193 -213 -193c-109 0 -202 66 -202 157c0 44 32 58 56 58c29 0 56 -20 56 -56c0 -38 -31 -60 -66 -55c35 -59 110 -76 153 -76c44 0 113 29 113 165c0 98 -37 166 -119 166h-44c-17 0 -24 0 -24 11c0 10 7 11 15 12c7 0 31 2 39 3c25 1 59 4 89 52 c26 44 28 102 28 114c0 90 -55 112 -96 112c-36 0 -102 -13 -133 -62c15 0 62 0 62 -50c0 -29 -20 -51 -51 -51c-29 0 -51 19 -51 52c0 76 76 136 177 136c96 0 184 -56 184 -138c0 -79 -58 -149 -140 -176c104 -21 167 -99 167 -181Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-D7" d="M624 15c-7 -8 -20 -8 -28 0l-207 207l-207 -207c-8 -8 -21 -8 -28 0c-8 7 -8 20 0 28l207 207l-207 207c-8 8 -8 21 0 28c7 8 20 8 28 0l207 -207l207 207c8 8 21 8 28 0c8 -7 8 -20 0 -28l-207 -207l207 -207c8 -8 8 -21 0 -28Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-35"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="500" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-33" x="1001" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-D7" x="1723" y="0"></use>
<g transform="translate(2724,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-35"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="500" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-33" x="1001" y="0"></use>
</g>
</g>
</svg> texture that is resampled to be <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="12.14ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 5226.9 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">1024 times 1024</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-34" d="M471 165h-100v-87c0 -36 2 -47 76 -47h21v-31c-41 3 -94 3 -136 3s-94 0 -135 -3v31h21c74 0 76 11 76 47v87h-266v31l307 469c8 12 11 12 20 12c16 0 16 -6 16 -26v-455h100v-31zM300 196v373l-244 -373h244Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-D7" d="M624 15c-7 -8 -20 -8 -28 0l-207 207l-207 -207c-8 -8 -21 -8 -28 0c-8 7 -8 20 0 28l207 207l-207 207c-8 8 -8 21 0 28c7 8 20 8 28 0l207 -207l207 207c8 8 21 8 28 0c8 -7 8 -20 0 -28l-207 -207l207 -207c8 -8 8 -21 0 -28Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-31"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="500" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="1001" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-34" x="1501" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-D7" x="2224" y="0"></use>
<g transform="translate(3224,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-31"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="500" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="1001" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-34" x="1501" y="0"></use>
</g>
</g>
</svg>.)  Implement this approach in <tt>pbrt</tt>, and compare the amount of
memory used to store texture data for a variety of texture-heavy scenes.

 <li class="exercise"><span class="exerciseicon">&#9313;</span> Some of the light transport algorithms in Chapters&nbsp;<a href="../Light_Transport_I_Surface_Reflection.html#chap:light-transport">14</a>, <a href="../Light_Transport_II_Volume_Rendering.html#chap:volume-integration">15</a>, and&nbsp;<a href="../Light_Transport_III_Bidirectional_Methods.html#chap:bidir-methods">16</a>
require a large number of samples to be taken per pixel for good results.
(Examples of such algorithms include path tracing as implemented by the
<a href="../Light_Transport_I_Surface_Reflection/Path_Tracing.html#PathIntegrator"><tt>PathIntegrator</tt></a>.)  If hundreds or thousands of samples are taken in
each pixel, then the computational expense of high-quality texture
filtering isn&rsquo;t worthwhile; the high pixel sampling rate serves well to
antialias texture functions with high frequencies.  Modify the
<tt>MIPMap</tt> implementation so that it optionally just returns a
bilinearly interpolated value from the finest level of the pyramid, even if
a filter footprint is provided.  Compare rendering time and image quality
with this approach when rendering an image using many samples per pixel and
a scene that has image maps that would otherwise exhibit aliasing at
lower pixel sampling rates.

 <li class="exercise"><span class="exerciseicon">&#9313;</span> An additional advantage of properly antialiased image map
lookups is that they improve cache performance.  Consider, for example, the
situation of undersampling a high-resolution image map: nearby samples on
the screen will access widely separated parts of the image map, such that
there is low probability that texels fetched from main memory for one
texture lookup will already be in the cache for texture lookups at adjacent
pixel samples.  Modify <tt>pbrt</tt> so that it always does image texture lookups
from the finest level of the <tt>MIPMap</tt>, being careful to ensure that
the same number of texels are still being accessed.  How does performance
change?  What do cache-profiling tools report about the overall change in
effectiveness of the CPU cache?

 <li class="exercise"><span class="exerciseicon">&#9313;</span> Read Worley&rsquo;s paper that describes a new noise function with
substantially different visual characteristics than Perlin
noise (<a href="Further_Reading.html#cite:Worley96">Worley 1996</a>).  Implement this cellular noise function, and add
<a href="../Texture/Texture_Interface_and_Basic_Textures.html#Texture"><tt>Texture</tt></a>s to <tt>pbrt</tt> that are based on it.

 <li class="exercise"><span class="exerciseicon">&#9313;</span> Implement one of the improved noise functions, such as
the ones introduced by Cook and DeRose (<a href="Further_Reading.html#cite:Cook05">2005</a>), Goldberg et&nbsp;al. (<a href="Further_Reading.html#cite:Goldberg08">2008</a>), or
Lagae et&nbsp;al. (<a href="Further_Reading.html#cite:Lagae09">2009</a>).  Compare image quality and rendering time for scenes
that make substantial use of noise functions to the current implementation
in <tt>pbrt</tt>.

 <li class="exercise"><span class="exerciseicon">&#9313;</span> The implementation of the <a href="../Texture/Noise.html#DotsTexture"><tt>DotsTexture</tt></a> texture in this chapter
does not make any effort to avoid aliasing in the results that it
computes.  Modify this texture to do some form of antialiasing.  The
<a href="../Texture/Solid_and_Procedural_Texturing.html#Checkerboard2DTexture"><tt>Checkerboard2DTexture</tt></a> offers a guide as to how this might be done,
although this case is more complicated, both because the polka dots are not
present in every grid cell and because they are irregularly positioned.

At the two extremes of a filter region that is within a single cell and a
filter region that spans a large number of cells, the task is easier.  If
the filter is entirely within a single cell and is entirely inside or
outside the polka dot in that cell (if present), then it is only necessary
to evaluate one of the two subtextures as appropriate.  If the filter is
within a single cell but overlaps both the dot and the base texture, then
it is possible to compute how much of the filter area is inside the dot and
how much is outside and blend between the two.  At the other extreme, if
the filter area is extremely large, it is possible to blend between the two
textures according to the overall average of how much area is covered by
dots and how much is not.  (Note that this approach potentially makes the
same error as was made in the checkerboard, where the subtextures aren&rsquo;t
aware that part of their area is occluded by another texture.  Ignore this
issue for this exercise.)

Implement these approaches and then consider the intermediate cases, where
the filter region spans a small number of cells.  What approaches work well
for antialiasing in this case?

 <li class="exercise"><span class="exerciseicon">&#9313;</span> Write a general-purpose <a href="../Texture/Texture_Interface_and_Basic_Textures.html#Texture"><tt>Texture</tt></a> that stores a
reference to another texture and supersamples that texture when the
evaluation method is called, thus making it possible to apply supersampling
to any <a href="../Texture/Texture_Interface_and_Basic_Textures.html#Texture"><tt>Texture</tt></a>.  Use your implementation to compare the effectiveness
and quality of the built-in antialiasing done by various procedural
textures.  Also compare the run-time efficiency of texture supersampling
versus increased pixel sampling.

 <li class="exercise"><span class="exerciseicon">&#9314;</span> Modify <tt>pbrt</tt> to support a shading language to allow
user-written programs to compute texture values.  Unless you&rsquo;re also
interested in writing your own compiler, <em>OSL</em> (Gritz et&nbsp;al.&nbsp;<a href="Further_Reading.html#cite:Gritz2010">2010</a>) is
a good choice.

</ol><p>



</p>
<p>

</p>
<p> 
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

</div>  <!-- container-fluid -->
</div>  <!-- maincontainer -->

<nav class="navbar navbar-expand-md">
  <span class="navbar-text"><i>Physically Based Rendering: From Theory To Implementation</i>, &copy; 2004-2021 Matt Pharr, Wenzel Jakob, and Greg Humphreys under the <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/">CC BY-NC-ND 4.0</a> license. (<a href="https://github.com/mmp/pbr-book-website/">github</a>)</span>
  <div class="container">
    <ul class="nav navbar-nav ml-auto">
      <li class="nav-item">Next: <a href="../Volume_Scattering.html">Volume Scattering</a></li>
    </ul>
  </div>

</nav>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script>
  $(function () {
    $('[data-toggle="popover"]').popover()
    $('[data-toggle="tooltip"]').tooltip()
   })
</script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

<script>
// https://stackoverflow.com/a/17535094
// The function actually applying the offset
function offsetAnchor() {
  if (location.hash.length !== 0) {
    window.scrollTo(window.scrollX, window.scrollY - window.innerHeight / 8);
  }
}

// Captures click events of all <a> elements with href starting with #
$(document).on('click', 'a[href^="#"]', function(event) {
  // Click events are captured before hashchanges. Timeout
  // causes offsetAnchor to be called after the page jump.
  window.setTimeout(function() {
    offsetAnchor();
  }, 500);
});

// Set the offset when entering page with hash present in the url
window.setTimeout(offsetAnchor, 1500);
</script>

</body>
</html>
