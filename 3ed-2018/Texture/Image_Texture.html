
<!doctype html>
<html lang="en">
<head>

<!-- all praise to https://realfavicongenerator.net -->
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link href="https://fonts.googleapis.com/css?family=Domine|Roboto+Mono" rel="stylesheet">
  <link rel="stylesheet" href="../pbrstyle.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">

  <script async src="https://cse.google.com/cse.js?cx=003601324460585362024:4xwpwgaitgd"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.6.1/react.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.6.1/react-dom.min.js"></script>
  <script src="/jeri.min.js"></script>
  <link rel="preload" href="/exr.worker.js" as="script" crossorigin="anonymous">
        
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

  <title>Image Texture</title>
</head>
        
<body>

<nav class="fixed-top-lg-navbar navbar navbar-expand bg-light navbar-light">
  <ul class="nav navbar-nav">
    <a class="navbar-brand" href="../contents.html"><img src="../pbr.jpg" width=25 height=25></a>
    <li class="nav-item"><a class="nav-link" href="../Texture.html">Texture</a></li>
    <span class="navbar-text">/</span>
    <li class="nav-item"><a class="nav-link" href="#">Image Texture</a></li>
    <span class="navbar-text">&nbsp;&nbsp;</span>
    <li class="nav-item"><a class="nav-link" href="../Texture/Texture_Interface_and_Basic_Textures.html">(Previous: Texture Interface and Basic Textures)</a></li>
  </ul>

  <ul class="nav navbar-nav ml-auto d-none d-md-block">
        <li class="nav-item"><div class="gcse-search"></div></li>
    </ul>
  <ul class="nav navbar-nav d-block d-md-none">
        <li class="nav-item"><div class="gcse-search"></div></li>
    </ul>
</nav>

<div class="maincontainer">
<div class="container-fluid">

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#"><i class="fas fa-link "></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:texture-mapping"></span><h2>10.4 Image Texture</h2><p>



</p>
<p>The <tt>ImageTexture</tt> class stores a 2D array of point-sampled values of
a texture function.  It uses these samples to reconstruct a continuous
image function that can be evaluated at an arbitrary <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.773ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2055.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1665" y="0"></use>
</g>
</svg> position.
These sample values are often called <em>texels</em>, since they are similar
to pixels in an image but are used in the context of a texture.  Image textures are the
most widely used type of texture in computer graphics; digital photographs,
scanned artwork, images created with image-editing programs, and images
generated by renderers are all extremely useful sources of data for this
particular texture representation (Figure&nbsp;<a href="#fig:image-texture-example">10.8</a>).

</p>
<p> </p>
<span class="anchor" id="fig:image-texture-example"></span><div class="card outerfigure"><div class="card-body figure"><p>



</p>

<div class="card-img-top" style="display:block; width: 100%; padding-top: 63.924%;  position:relative;">
<div id="With_textures41" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0;"></div></div>
<script>
Jeri.renderViewer(document.getElementById('With_textures41'), {
  title: 'With_textures41', children: [
 { title: 'With textures', image: 'sm-tex.png' },  { title: 'Without textures', image: 'sm-notex.png' }]});
</script>
<button data-toggle="tooltip" data-placement="left" class="btn yojeri" title="This image is interactive. Click and drag to pan and use the mouse-wheel to zoom. After clicking on the image to select it, type '?' to see a summary of keyboard controls."><i class="fa fa-snowflake fa-border"></i></button><p>

</p>
<figcaption class="caption">Figure 10.8: An Example of Image Textures. <span class="legend"> Image textures are used
throughout the San Miguel scene to represent spatially varying surface
appearance properties. (1)&nbsp;Scene rendered with image textures. (2)&nbsp;Each
image texture has been replaced with its average value. Note how much visual
richness is lost.</span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p>The
term <em>texture map</em> is often used to refer to this type of texture, although
this usage blurs the distinction between the mapping that computes
texture coordinates and the texture function itself.  The implementation of this
texture is in the files <a href="https://github.com/mmp/pbrt-v3/tree/master/src/textures/imagemap.h"><tt>textures/imagemap.h</tt></a>
<span class="anchor" id="texturesimagemap.h"></span> and
 <a href="https://github.com/mmp/pbrt-v3/tree/master/src/textures/imagemap.cpp"><tt>textures/imagemap.cpp</tt></a>. <span class="anchor" id="texturesimagemap.cpp"></span>

</p>
<p>

</p>
<p>The <a href="#ImageTexture"><tt>ImageTexture</tt></a> class is different from other textures in the system
in that it is parameterized on both the data type of the texels it stores in
memory as well as the data type of the value that it returns.  Making this
distinction allows us to create, for example, <tt>ImageTexture</tt>s that
store <a href="../Color_and_Radiometry/RGBSpectrum_Implementation.html#RGBSpectrum"><tt>RGBSpectrum</tt></a> values in memory, but always return <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum"><tt>Spectrum</tt></a>
values.  In this way, when the system is compiled with full-spectral
rendering enabled, the memory cost to store full <a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#SampledSpectrum"><tt>SampledSpectrum</tt></a>
texels doesn&rsquo;t need to be paid for source images that only have
RGB components. 

</p>
<p></p>
<span class="anchor" id="fragment-ImageTextureDeclarations-0"></span><div class="fragmentname">&lt;&lt;ImageTexture Declarations&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">template &lt;typename Tmemory, typename Treturn&gt;
    class <span class="anchor" id="ImageTexture"></span>ImageTexture : public <a href="../Texture/Texture_Interface_and_Basic_Textures.html#Texture" class="code">Texture</a>&lt;Treturn&gt; {
public:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-ImageTexturePublicMethods-0">ImageTexture Public Methods</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1022" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1022"><i></i></a><div id="fragbit-1022" class="collapse"><div class="fragmentcode">       ImageTexture(std::unique_ptr&lt;TextureMapping2D&gt; m, const std::string &amp;filename,
           bool doTri, Float maxAniso, ImageWrap wm, Float scale, bool gamma);
       static void ClearCache() {
           textures.erase(textures.begin(), textures.end());
       }
       Treturn Evaluate(const <a href="../Geometry_and_Transformations/Interactions.html#SurfaceInteraction" class="code">SurfaceInteraction</a> &amp;si) const { 
           <a href="../Geometry_and_Transformations/Vectors.html#Vector2f" class="code">Vector2f</a> dstdx, dstdy;
           <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> st = <a href="#ImageTexture::mapping" class="code">mapping</a>-&gt;<a href="../Texture/Texture_Coordinate_Generation.html#TextureMapping2D::Map" class="code">Map</a>(si, &amp;dstdx, &amp;dstdy);
           Tmemory mem = <a href="#ImageTexture::mipmap" class="code">mipmap</a>-&gt;<a href="#MIPMap::Lookup" class="code">Lookup</a>(st, dstdx, dstdy);
           Treturn ret;
           convertOut(mem, &amp;ret);
           return ret;
       }</div></div>
private:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-ImageTexturePrivateMethods-0">ImageTexture Private Methods</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1023" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1023"><i></i></a><div id="fragbit-1023" class="collapse"><div class="fragmentcode">       static <a href="#MIPMap" class="code">MIPMap</a>&lt;Tmemory&gt; *GetTexture(const std::string &amp;filename, 
           bool doTrilinear, Float maxAniso, ImageWrap wm, Float scale, bool gamma);
       static void convertIn(const RGBSpectrum &amp;from, RGBSpectrum *to,
                             Float scale, bool gamma) { 
           for (int i = 0; i &lt; RGBSpectrum::nSamples; ++i)
               (*to)[i] = scale * (gamma ? <a href="#InverseGammaCorrect" class="code">InverseGammaCorrect</a>(from[i])
                                         : from[i]);
       }
       static void convertIn(const RGBSpectrum &amp;from, Float *to,
                             Float scale, bool gamma) { 
           *to = scale * (gamma ? <a href="#InverseGammaCorrect" class="code">InverseGammaCorrect</a>(from.<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#Spectrum::y" class="code">y</a>())
                                : from.<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#Spectrum::y" class="code">y</a>());
       }
       static void convertOut(const RGBSpectrum &amp;from, <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> *to) { 
           Float rgb[3];
           from.<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#Spectrum::ToRGB" class="code">ToRGB</a>(rgb);
           *to = <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a>::FromRGB(rgb);
       }
       static void convertOut(Float from, Float *to) { 
           *to = from;
       }</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-ImageTexturePrivateData-0">ImageTexture Private Data</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1024" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1024"><i></i></a><div id="fragbit-1024" class="collapse"><div class="fragmentcode">       std::unique_ptr&lt;TextureMapping2D&gt; mapping;
       <a href="#MIPMap" class="code">MIPMap</a>&lt;Tmemory&gt; *mipmap;
       static std::map&lt;TexInfo, std::unique_ptr&lt;<a href="#MIPMap" class="code">MIPMap</a>&lt;Tmemory&gt;&gt;&gt; textures;</div></div>
};</div><p>


</p>
<p>The caller provides the <a href="#ImageTexture"><tt>ImageTexture</tt></a> with the filename of an image
map, parameters that control the filtering of the map for antialiasing, and
parameters that make it possible to scale and gamma-correct the texture
values.  The scale parameter will be explained later in this
section, and the texture filtering parameters will be explained in
Section&nbsp;<a href="#sec:mipmap">10.4.3</a>.  The contents of the file are used to create an
instance of the <a href="#MIPMap"><tt>MIPMap</tt></a> class that stores the texels in memory and
handles the details of reconstruction and filtering to reduce aliasing.

</p>
<p>For an <a href="#ImageTexture"><tt>ImageTexture</tt></a> that stores <a href="../Color_and_Radiometry/RGBSpectrum_Implementation.html#RGBSpectrum"><tt>RGBSpectrum</tt></a> values in
memory, its <a href="#MIPMap"><tt>MIPMap</tt></a> stores the image data using
three floating-point values for each sample.  This is a somewhat
wasteful representation, since a single image map may have millions of
texels and may not need the full 32 bits of accuracy from the <tt>Float</tt>s
used to store RGB values for each of them.  Exercise&nbsp;10.1 at the end of
this chapter discusses this issue further.

</p>
<p></p>
<span class="anchor" id="fragment-ImageTextureMethodDefinitions-0"></span><div class="fragmentname">&lt;&lt;ImageTexture Method Definitions&gt;&gt;=&nbsp;<a href="#fragment-ImageTextureMethodDefinitions-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;typename Tmemory, typename Treturn&gt; 
ImageTexture&lt;Tmemory, Treturn&gt;::ImageTexture(
        std::unique_ptr&lt;TextureMapping2D&gt; <a href="#ImageTexture::mapping" class="code">mapping</a>,
        const std::string &amp;filename, bool doTrilinear, Float maxAniso,
        ImageWrap wrapMode, Float scale, bool gamma)
    : <a href="#ImageTexture::mapping" class="code">mapping</a>(std::move(<a href="#ImageTexture::mapping" class="code">mapping</a>)) {
    <a href="#ImageTexture::mipmap" class="code">mipmap</a> = <a href="#ImageTexture::GetTexture" class="code">GetTexture</a>(filename, doTrilinear, maxAniso,
                        wrapMode, scale, gamma);
}</div><p>


</p>
<p></p>
<span class="anchor" id="fragment-ImageTexturePrivateData-0"></span><div class="fragmentname">&lt;&lt;ImageTexture Private Data&gt;&gt;=&nbsp;<a href="#fragment-ImageTexturePrivateData-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">std::unique_ptr&lt;TextureMapping2D&gt; <span class="anchor" id="ImageTexture::mapping"></span>mapping;
<a href="#MIPMap" class="code">MIPMap</a>&lt;Tmemory&gt; *<span class="anchor" id="ImageTexture::mipmap"></span>mipmap;</div><p>


</p>
<p>

</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#TextureMemoryManagement"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:texture-caching"></span><span id="TextureMemoryManagement"></span><h3>10.4.1  Texture Memory Management</h3><p>



</p>
<p>Each image map may require a meaningful amount of memory, and a complex
scene may have thousands of image maps.  Because each image texture may be
reused many times within a scene, <tt>pbrt</tt> maintains a table of image maps
that have been loaded so far, so that they are only loaded into memory once
even if they are used in more than one <a href="#ImageTexture"><tt>ImageTexture</tt></a>.  The
<tt>ImageTexture</tt> constructor calls the <tt>static</tt>
<a href="#ImageTexture::GetTexture"><tt>ImageTexture::GetTexture()</tt></a> method to get a <a href="#MIPMap"><tt>MIPMap</tt></a>
representation of the desired texture.

</p>
<p>

</p>
<p>

</p>
<p>
</p>
<span class="anchor" id="fragment-ImageTextureMethodDefinitions-1"></span><div class="fragmentname">&lt;&lt;ImageTexture Method Definitions&gt;&gt;+=&nbsp;<a href="#fragment-ImageTextureMethodDefinitions-0"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">template &lt;typename Tmemory, typename Treturn&gt; <a href="#MIPMap" class="code">MIPMap</a>&lt;Tmemory&gt; *
ImageTexture&lt;Tmemory, Treturn&gt;::<span class="anchor" id="ImageTexture::GetTexture"></span>GetTexture(const std::string &amp;filename, 
        bool doTrilinear, Float maxAniso, ImageWrap wrap, Float scale,
        bool gamma) {
    &lt;&lt;<span class="fragmentname"><a href="#fragment-ReturnmonoMIPMapfromtexturecacheifpresent-0">Return <tt>MIPMap</tt> from texture cache if present</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1025" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1025"><i></i></a><div id="fragbit-1025" class="collapse"><div class="fragmentcode">       TexInfo texInfo(filename, doTrilinear, maxAniso, wrap, scale, gamma);
       if (<a href="#ImageTexture::textures" class="code">textures</a>.find(texInfo) != <a href="#ImageTexture::textures" class="code">textures</a>.end())
           return <a href="#ImageTexture::textures" class="code">textures</a>[texInfo].get();</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-CreatemonoMIPMapformonofilename-0">Create <tt>MIPMap</tt> for <tt>filename</tt></a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1026" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1026"><i></i></a><div id="fragbit-1026" class="collapse"><div class="fragmentcode">       <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> resolution;
       std::unique_ptr&lt;RGBSpectrum[]&gt; texels = <a href="../Utilities/Image_File_Input_and_Output.html#ReadImage" class="code">ReadImage</a>(filename, &amp;resolution);
       <a href="#MIPMap" class="code">MIPMap</a>&lt;Tmemory&gt; *mipmap = nullptr;
       if (texels) {
           &lt;&lt;<span class="fragmentname"><a href="#fragment-ConverttexelstotypemonoTmemoryandcreatemonoMIPMap-0">Convert texels to type <tt>Tmemory</tt> and create <tt>MIPMap</tt></a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1027" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1027"><i></i></a><div id="fragbit-1027" class="collapse"><div class="fragmentcode">              std::unique_ptr&lt;Tmemory[]&gt; convertedTexels(new Tmemory[resolution.x *
                                                                     resolution.y]);
              for (int i = 0; i &lt; resolution.x * resolution.y; ++i)
                  <a href="#ImageTexture::convertIn" class="code">convertIn</a>(texels[i], &amp;convertedTexels[i], scale, gamma);
              mipmap = new <a href="#MIPMap" class="code">MIPMap</a>&lt;Tmemory&gt;(resolution, convertedTexels.get(),
                                           doTrilinear, maxAniso, wrap);</div></div>
       } else {
           &lt;&lt;<span class="fragmentname"><a href="#fragment-Createone-valuedmonoMIPMap-0">Create one-valued <tt>MIPMap</tt></a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1028" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1028"><i></i></a><div id="fragbit-1028" class="collapse"><div class="fragmentcode">              Tmemory oneVal = scale;
              mipmap = new <a href="#MIPMap" class="code">MIPMap</a>&lt;Tmemory&gt;(<a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a>(1, 1), &amp;oneVal);</div></div>
       }
       textures[texInfo].reset(mipmap);</div></div>
    return mipmap;
}</div><p>


</p>
<p><span class="anchor" id="TexInfo"></span> <tt>TexInfo</tt> is a simple structure that holds the
image map&rsquo;s filename and filtering parameters; all of these must match for
a <a href="#MIPMap"><tt>MIPMap</tt></a> to be reused in another <a href="#ImageTexture"><tt>ImageTexture</tt></a>.  Its definition
is straightforward (its members exactly correspond to the parameters of the
<tt>GetTexture()</tt> method) and won&rsquo;t be included here.

</p>
<p></p>
<span class="anchor" id="fragment-ImageTexturePrivateData-1"></span><div class="fragmentname">&lt;&lt;ImageTexture Private Data&gt;&gt;+=&nbsp;<a href="#fragment-ImageTexturePrivateData-0"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">static std::map&lt;TexInfo, std::unique_ptr&lt;<a href="#MIPMap" class="code">MIPMap</a>&lt;Tmemory&gt;&gt;&gt; <span class="anchor" id="ImageTexture::textures"></span>textures;</div><p>


</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-ReturnmonoMIPMapfromtexturecacheifpresent-0"></span><div class="fragmentname">&lt;&lt;Return <tt>MIPMap</tt> from texture cache if present&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">TexInfo texInfo(filename, doTrilinear, maxAniso, wrap, scale, gamma);
if (<a href="#ImageTexture::textures" class="code">textures</a>.find(texInfo) != <a href="#ImageTexture::textures" class="code">textures</a>.end())
    return <a href="#ImageTexture::textures" class="code">textures</a>[texInfo].get();</div><p>


</p>
<p>If the texture hasn&rsquo;t been loaded yet, a call to <tt>ReadImage()</tt> yields
the image contents.

</p>
<p></p>
<span class="anchor" id="fragment-CreatemonoMIPMapformonofilename-0"></span><div class="fragmentname">&lt;&lt;Create <tt>MIPMap</tt> for <tt>filename</tt>&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> resolution;
std::unique_ptr&lt;RGBSpectrum[]&gt; texels = <a href="../Utilities/Image_File_Input_and_Output.html#ReadImage" class="code">ReadImage</a>(filename, &amp;resolution);
<a href="#MIPMap" class="code">MIPMap</a>&lt;Tmemory&gt; *mipmap = nullptr;
if (texels) {
    &lt;&lt;<span class="fragmentname"><a href="#fragment-ConverttexelstotypemonoTmemoryandcreatemonoMIPMap-0">Convert texels to type <tt>Tmemory</tt> and create <tt>MIPMap</tt></a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1029" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1029"><i></i></a><div id="fragbit-1029" class="collapse"><div class="fragmentcode">       std::unique_ptr&lt;Tmemory[]&gt; convertedTexels(new Tmemory[resolution.x *
                                                              resolution.y]);
       for (int i = 0; i &lt; resolution.x * resolution.y; ++i)
           <a href="#ImageTexture::convertIn" class="code">convertIn</a>(texels[i], &amp;convertedTexels[i], scale, gamma);
       mipmap = new <a href="#MIPMap" class="code">MIPMap</a>&lt;Tmemory&gt;(resolution, convertedTexels.get(),
                                    doTrilinear, maxAniso, wrap);</div></div>
} else {
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Createone-valuedmonoMIPMap-0">Create one-valued <tt>MIPMap</tt></a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1030" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1030"><i></i></a><div id="fragbit-1030" class="collapse"><div class="fragmentcode">       Tmemory oneVal = scale;
       mipmap = new <a href="#MIPMap" class="code">MIPMap</a>&lt;Tmemory&gt;(<a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a>(1, 1), &amp;oneVal);</div></div>
}
textures[texInfo].reset(mipmap);</div><p>


</p>
<p>Because <tt>ReadImage()</tt> returns an array of <a href="../Color_and_Radiometry/RGBSpectrum_Implementation.html#RGBSpectrum"><tt>RGBSpectrum</tt></a>
values for the texels, it is necessary to convert these
values to the particular type <tt>Tmemory</tt> of texel that this
<a href="#MIPMap"><tt>MIPMap</tt></a> is storing (e.g., <tt>Float</tt>) if the type of <tt>Tmemory</tt>
isn&rsquo;t <a href="../Color_and_Radiometry/RGBSpectrum_Implementation.html#RGBSpectrum"><tt>RGBSpectrum</tt></a>.  The per-texel conversion is handled by the
utility routine <a href="#ImageTexture::convertIn"><tt>ImageTexture::convertIn()</tt></a>.

</p>
<p></p>
<span class="anchor" id="fragment-ConverttexelstotypemonoTmemoryandcreatemonoMIPMap-0"></span><div class="fragmentname">&lt;&lt;Convert texels to type <tt>Tmemory</tt> and create <tt>MIPMap</tt>&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">std::unique_ptr&lt;Tmemory[]&gt; convertedTexels(new Tmemory[resolution.x *
                                                       resolution.y]);
for (int i = 0; i &lt; resolution.x * resolution.y; ++i)
    <a href="#ImageTexture::convertIn" class="code">convertIn</a>(texels[i], &amp;convertedTexels[i], scale, gamma);
mipmap = new <a href="#MIPMap" class="code">MIPMap</a>&lt;Tmemory&gt;(resolution, convertedTexels.get(),
                             doTrilinear, maxAniso, wrap);</div><p>


</p>
<p>Per-texel conversion is done using C++ function overloading.  For every
type to which we would like to be able to convert these values, a separate
<a href="#ImageTexture::convertIn"><tt>ImageTexture::convertIn()</tt></a> function must be provided.  In the loop over
texels earlier, C++&rsquo;s function overloading mechanism will select the
appropriate instance of <a href="#ImageTexture::convertIn"><tt>ImageTexture::convertIn()</tt></a> based on the
destination type.  Unfortunately, it is not possible to return the
converted value from the function, since C++ doesn&rsquo;t support overloading by
return type.

</p>
<p>In addition to converting types, these functions optionally scale and gamma
correct the texel values to map them to a desired range.  Gamma correction is
particularly important to handle carefully: computer displays generally don&rsquo;t
exhibit a linear relationship between the pixel values to be displayed and the
radiance that they emit. Thus, an artist may create a texture map where, as
seen on an LCD display, one part of the image appears twice as bright as
another.  However, the corresponding pixel values won&rsquo;t in fact have a 2:1
relationship. (Conversely, pixels whose values have a 2:1 relationship don&rsquo;t
lead to a 2:1 brightness ratio.) This discrepancy is a problem for a renderer
using such an image as a texture map, since the renderer usually expects a
linear relationship between texel values and the quantity that they represent.

</p>
<p><tt>pbrt</tt> follows the sRGB standard, which prescribes a specific transfer curve
matching the typical behavior of CRT displays. This standard is widely
supported on 2015-era devices; other (non-CRT) devices such as LCDs or inkjet
printers typically accept sRGB gamma-corrected values as input and then re-map
them internally to match the device-specific behavior.

</p>
<p>The sRGB gamma curve is a piecewise function with a linear term for low values
and a power law for medium to large values.
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="48.56ex" height="5.843ex" style="vertical-align: -2.338ex;" viewBox="0 -1508.9 20907.7 2515.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">gamma left-parenthesis x right-parenthesis equals StartLayout Enlarged left-brace 1st Row 1st Column 12.92 x comma 2nd Column x less-than-or-equal-to 0.0031308 2nd Row 1st Column left-parenthesis 1.055 right-parenthesis x Superscript 1 slash 2.4 Baseline minus 0.055 comma 2nd Column x greater-than 0.0031308 EndLayout</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D6FE" d="M543 421c0 -4 -12 -26 -19 -38c-40 -79 -104 -228 -136 -327c-4 -13 -6 -26 -8 -39c-4 -31 -14 -88 -37 -172c-11 -38 -19 -60 -32 -60c-8 0 -13 7 -13 18c0 26 30 142 52 215c7 20 12 37 12 98c0 79 -11 254 -162 254c-11 0 -120 -1 -159 -116l-4 -5c-10 0 -19 0 -19 10 c0 31 70 183 195 183c69 0 109 -49 133 -110c39 -97 40 -173 41 -204c40 101 80 201 132 296c3 7 9 7 12 7c0 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-7B" d="M425 -238c0 -7 -5 -12 -12 -12c-105 0 -196 52 -196 125v250c0 58 -55 113 -130 113c-7 0 -12 5 -12 12s5 12 12 12c75 0 130 55 130 113v250c0 73 91 125 196 125c7 0 12 -5 12 -12s-5 -12 -12 -12c-75 0 -130 -49 -130 -101v-250c0 -58 -48 -104 -115 -125 c67 -21 115 -67 115 -125v-250c0 -52 55 -101 130 -101c7 0 12 -5 12 -12Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-39" d="M457 329c0 -215 -122 -351 -251 -351c-85 0 -139 41 -139 108c0 39 30 48 46 48c22 0 46 -15 46 -46c0 -17 -8 -46 -52 -46c27 -34 81 -36 98 -36c58 0 162 46 162 280v32c-23 -58 -64 -100 -125 -100c-112 0 -200 98 -200 223c0 75 23 117 64 162c43 45 92 63 147 63 c89 0 204 -68 204 -337zM365 421c0 46 -4 109 -16 141c-17 45 -50 79 -96 79c-35 0 -73 -13 -100 -63c-21 -37 -21 -84 -21 -138c0 -49 0 -99 18 -136c31 -63 77 -63 93 -63c88 0 122 97 122 180Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2264" d="M691 75c24 -11 7 -47 -18 -36l-581 275c-17 8 -17 32 0 40l581 275c25 11 42 -25 18 -36l-548 -259zM702 -99c0 -11 -9 -20 -20 -20h-586c-11 0 -20 9 -20 20s9 20 20 20h586c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-33" d="M457 171c0 -102 -91 -193 -213 -193c-109 0 -202 66 -202 157c0 44 32 58 56 58c29 0 56 -20 56 -56c0 -38 -31 -60 -66 -55c35 -59 110 -76 153 -76c44 0 113 29 113 165c0 98 -37 166 -119 166h-44c-17 0 -24 0 -24 11c0 10 7 11 15 12c7 0 31 2 39 3c25 1 59 4 89 52 c26 44 28 102 28 114c0 90 -55 112 -96 112c-36 0 -102 -13 -133 -62c15 0 62 0 62 -50c0 -29 -20 -51 -51 -51c-29 0 -51 19 -51 52c0 76 76 136 177 136c96 0 184 -56 184 -138c0 -79 -58 -149 -140 -176c104 -21 167 -99 167 -181Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-38" d="M457 168c0 -107 -95 -190 -208 -190c-105 0 -207 67 -207 173c0 99 86 155 144 184c-25 17 -62 42 -73 54c-42 47 -44 92 -44 110c0 93 81 167 181 167c91 0 180 -57 180 -149c0 -66 -49 -118 -121 -155c64 -40 80 -50 99 -71c38 -42 49 -87 49 -123zM386 517 c0 72 -64 124 -137 124c-71 0 -136 -42 -136 -103c0 -17 4 -51 50 -81l124 -80c60 35 99 83 99 140zM407 132c0 61 -47 91 -75 110l-123 78c-85 -47 -117 -111 -117 -169c0 -83 72 -145 158 -145c82 0 157 52 157 126Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-35" d="M449 201c0 -127 -102 -223 -218 -223c-112 0 -181 97 -181 183c0 46 35 53 49 53c33 0 50 -25 50 -49s-17 -49 -50 -49c-11 0 -14 1 -17 2c17 -59 74 -112 147 -112c46 0 83 26 107 65c24 42 24 102 24 137c0 50 -2 89 -18 126c-8 18 -33 64 -85 64 c-81 0 -118 -54 -129 -70c-4 -6 -6 -9 -13 -9c-14 0 -14 8 -14 26v296c0 16 0 24 10 24c0 0 4 0 12 -3c47 -21 93 -28 133 -28c67 0 116 20 136 29c5 3 8 3 8 3c7 0 10 -5 10 -11c0 -13 -70 -104 -193 -104c-32 0 -65 7 -85 13v-195c36 35 79 51 127 51 c108 0 190 -100 190 -219Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-34" d="M471 165h-100v-87c0 -36 2 -47 76 -47h21v-31c-41 3 -94 3 -136 3s-94 0 -135 -3v31h21c74 0 76 11 76 47v87h-266v31l307 469c8 12 11 12 20 12c16 0 16 -6 16 -26v-455h100v-31zM300 196v373l-244 -373h244Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3E" d="M688 230l-581 -275c-25 -11 -42 25 -18 36l548 259l-548 259c-24 11 -7 47 18 36l581 -275c17 -8 17 -32 0 -40Z"></path>
<path stroke-width="1" id="E1-LATINMODERNSIZE5-7B" d="M608 -780c0 -11 -9 -20 -20 -20c-2 0 -3 0 -5 1c-145 37 -273 148 -273 261v526c0 99 -81 213 -195 243c-9 2 -15 10 -15 19s6 17 15 19c114 30 195 144 195 243v526c0 113 128 224 273 261c2 1 3 1 5 1c11 0 20 -9 20 -20c0 -9 -6 -17 -15 -19 c-114 -29 -195 -134 -195 -223v-526c0 -108 -96 -212 -215 -262c119 -50 215 -154 215 -262v-526c0 -89 81 -194 195 -223c9 -2 15 -10 15 -19Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D6FE" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="543" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="933" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1505" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="2172" y="0"></use>
<g transform="translate(3229,0)">
 <use xlink:href="#E1-LATINMODERNSIZE5-7B"></use>
<g transform="translate(874,0)">
<g transform="translate(-11,0)">
<g transform="translate(0,571)">
 <use xlink:href="#E1-LATINMODERNMAIN-31"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="500" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="1001" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-39" x="1279" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="1780" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="2280" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="2853" y="0"></use>
</g>
<g transform="translate(0,-623)">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
<g transform="translate(389,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-31"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="500" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="779" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-35" x="1279" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-35" x="1780" y="0"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2670" y="0"></use>
<g transform="translate(3059,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
<g transform="translate(572,362)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2F" x="500" y="0"></use>
<g transform="translate(707,0)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2E" x="500" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-34" x="779" y="0"></use>
</g>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="5566" y="0"></use>
<g transform="translate(6567,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-30"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="500" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="779" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-35" x="1279" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-35" x="1780" y="0"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="8848" y="0"></use>
</g>
</g>
<g transform="translate(10116,0)">
<g transform="translate(0,571)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2264" x="850" y="0"></use>
<g transform="translate(1906,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-30"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="500" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="779" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="1279" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-33" x="1780" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="2280" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-33" x="2781" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="3281" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-38" x="3782" y="0"></use>
</g>
</g>
<g transform="translate(0,-623)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3E" x="850" y="0"></use>
<g transform="translate(1906,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-30"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="500" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="779" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="1279" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-33" x="1780" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="2280" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-33" x="2781" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="3281" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-38" x="3782" y="0"></use>
</g>
</g>
</g>
</g>
</g>
</g>
</svg>
</div>
<p>


</p>
<p></p>
<span class="anchor" id="fragment-GlobalInlineFunctions-4"></span><div class="fragmentname">&lt;&lt;Global Inline Functions&gt;&gt;+=&nbsp;<a href="../Shapes/Managing_Rounding_Error.html#fragment-GlobalInlineFunctions-3"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-GlobalInlineFunctions-5"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">inline Float <span class="anchor" id="GammaCorrect"></span>GammaCorrect(Float value) {
    if (value &lt;= 0.0031308f)
        return 12.92f * value;
    return 1.055f * std::pow(value, (Float)(1.f / 2.4f)) - 0.055f;
}</div><p>


</p>
<p>The <a href="#GammaCorrect"><tt>GammaCorrect()</tt></a> will be used to write sRGB-compatible 8-bit image
files in the <a href="../Utilities/Image_File_Input_and_Output.html#WriteImage"><tt>WriteImage()</tt></a> function. To import textures into <tt>pbrt</tt>, we are
interested in the opposite direction: removing an existing gamma correction to
reestablish a linear relationship between brightness and pixel values.

</p>
<p></p>
<span class="anchor" id="fragment-GlobalInlineFunctions-5"></span><div class="fragmentname">&lt;&lt;Global Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-GlobalInlineFunctions-4"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="../Utilities/Main_Include_File.html#fragment-GlobalInlineFunctions-6"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">inline Float <span class="anchor" id="InverseGammaCorrect"></span>InverseGammaCorrect(Float value) {
    if (value &lt;= 0.04045f)
        return value * 1.f / 12.92f;
    return std::pow((value + 0.055f) * 1.f / 1.055f, (Float)2.4f);
}</div><p>


</p>
<p>Refer to the &ldquo;Further Reading&rdquo; section for a more detailed discussion of
gamma correction.

</p>
<p><a href="#InverseGammaCorrect"><tt>InverseGammaCorrect()</tt></a> is only applied when indicated via the <tt>gamma</tt>
argument of <tt>convertIn()</tt>. By default, this is the case when the input
image has an 8-bit color depth. 

</p>
<p></p>
<span class="anchor" id="fragment-ImageTexturePrivateMethods-0"></span><div class="fragmentname">&lt;&lt;ImageTexture Private Methods&gt;&gt;=&nbsp;<a href="#fragment-ImageTexturePrivateMethods-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">static void <span class="anchor" id="ImageTexture::convertIn"></span>convertIn(const RGBSpectrum &amp;from, RGBSpectrum *to,
                      Float scale, bool gamma) { 
    for (int i = 0; i &lt; RGBSpectrum::nSamples; ++i)
        (*to)[i] = scale * (gamma ? <a href="#InverseGammaCorrect" class="code">InverseGammaCorrect</a>(from[i])
                                  : from[i]);
}
static void convertIn(const RGBSpectrum &amp;from, Float *to,
                      Float scale, bool gamma) { 
    *to = scale * (gamma ? <a href="#InverseGammaCorrect" class="code">InverseGammaCorrect</a>(from.<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#Spectrum::y" class="code">y</a>())
                         : from.<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#Spectrum::y" class="code">y</a>());
}</div><p>


</p>
<p>If the texture file wasn&rsquo;t found or was unreadable, an image map with a single
sample with a value of one is created so that the renderer can continue to
generate an image of the scene without needing to abort execution.  The
<a href="../Utilities/Image_File_Input_and_Output.html#ReadImage"><tt>ReadImage()</tt></a> function will issue a warning message in this
case.

</p>
<p></p>
<span class="anchor" id="fragment-Createone-valuedmonoMIPMap-0"></span><div class="fragmentname">&lt;&lt;Create one-valued <tt>MIPMap</tt>&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Tmemory oneVal = scale;
mipmap = new <a href="#MIPMap" class="code">MIPMap</a>&lt;Tmemory&gt;(<a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a>(1, 1), &amp;oneVal);</div><p>


</p>
<p>After the image is rendered and the system is cleaning up, the
<tt>ClearCache()</tt> method is called to free the memory for the entries in
the texture cache.

</p>
<p></p>
<span class="anchor" id="fragment-ImageTexturePublicMethods-0"></span><div class="fragmentname">&lt;&lt;ImageTexture Public Methods&gt;&gt;=&nbsp;<a href="#fragment-ImageTexturePublicMethods-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">static void <span class="anchor" id="ImageTexture::ClearCache"></span>ClearCache() {
    textures.erase(textures.begin(), textures.end());
}</div><p>


</p>
<p>


</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#ImageTextureEvaluation"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span id="ImageTextureEvaluation"></span><h3>10.4.2  ImageTexture Evaluation</h3><p>


</p>
<p>The <a href="#ImageTexture::Evaluate"><tt>ImageTexture::Evaluate()</tt></a> routine does the usual texture
coordinate computation and then hands the image map lookup to the
<a href="#MIPMap"><tt>MIPMap</tt></a>, which does the image filtering work for antialiasing.  The
returned value is still of type <tt>Tmemory</tt>; another conversion step
similar to <a href="#ImageTexture::convertIn"><tt>ImageTexture::convertIn()</tt></a> above converts to the returned
type <tt>Treturn</tt>.

</p>
<p></p>
<span class="anchor" id="fragment-ImageTexturePublicMethods-1"></span><div class="fragmentname">&lt;&lt;ImageTexture Public Methods&gt;&gt;+=&nbsp;<a href="#fragment-ImageTexturePublicMethods-0"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">Treturn <span class="anchor" id="ImageTexture::Evaluate"></span>Evaluate(const <a href="../Geometry_and_Transformations/Interactions.html#SurfaceInteraction" class="code">SurfaceInteraction</a> &amp;si) const { 
    <a href="../Geometry_and_Transformations/Vectors.html#Vector2f" class="code">Vector2f</a> dstdx, dstdy;
    <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> st = <a href="#ImageTexture::mapping" class="code">mapping</a>-&gt;<a href="../Texture/Texture_Coordinate_Generation.html#TextureMapping2D::Map" class="code">Map</a>(si, &amp;dstdx, &amp;dstdy);
    Tmemory mem = <a href="#ImageTexture::mipmap" class="code">mipmap</a>-&gt;<a href="#MIPMap::Lookup" class="code">Lookup</a>(st, dstdx, dstdy);
    Treturn ret;
    convertOut(mem, &amp;ret);
    return ret;
}</div><p>


</p>
<p></p>
<span class="anchor" id="fragment-ImageTexturePrivateMethods-1"></span><div class="fragmentname">&lt;&lt;ImageTexture Private Methods&gt;&gt;+=&nbsp;<a href="#fragment-ImageTexturePrivateMethods-0"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">static void <span class="anchor" id="ImageTexture::convertOut"></span>convertOut(const RGBSpectrum &amp;from, <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> *to) { 
    Float rgb[3];
    from.<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#Spectrum::ToRGB" class="code">ToRGB</a>(rgb);
    *to = <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a>::FromRGB(rgb);
}
static void convertOut(Float from, Float *to) { 
    *to = from;
}</div><p>


</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#MIPMaps"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:mipmap"></span><span id="MIPMaps"></span><h3>10.4.3  MIP Maps</h3><p>



</p>
<p>As always, if the image function 
has higher frequency detail than can be represented by the texture sampling
rate, aliasing will be present in the final image.  Any frequencies higher than
the Nyquist limit must be removed by prefiltering before the function is
evaluated.  Figure&nbsp;<a href="#fig:tex-filter-large-area">10.9</a> shows the basic problem we
face: an image texture has texels that are samples of some image function at a fixed frequency.  The
filter region for the lookup is given by its <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.773ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2055.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1665" y="0"></use>
</g>
</svg> center point and offsets to the estimated
texture coordinate locations for the adjacent image samples.  Because these
offsets are estimates of the texture sampling rate, we must remove any
frequencies higher than twice the distance to the adjacent samples in order
to satisfy the Nyquist criterion.

</p>
<p> </p>
<span class="anchor" id="fig:tex-filter-large-area"></span><div class="card outerfigure"><div class="card-body figure"><p>



</p>
<div class="figure-row">
  <a href="Texture%20may%20filter%20many%20texels.svg" title=""><img src="Texture%20may%20filter%20many%20texels.svg" width=239 height=216 style="max-width: 100%;"></a>
</div>
<p>


</p>
<figcaption class="caption">Figure 10.9: <span class="legend"> Given a point at which to perform
an image map lookup (denoted by the solid point in the center) and estimates of the
texture space sampling rate (denoted by adjacent solid points), it may be
necessary to filter the contributions of a large number of texels in the
image map (denoted by open points).</span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p>The texture sampling and reconstruction process has a few key differences
from the image sampling process discussed in
Chapter&nbsp;<a href="../Sampling_and_Reconstruction.html#chap:sampling-reconstruction">7</a>.  These differences make it
possible to address the antialiasing problem with more effective and less
computationally expensive techniques.  For example, here it is inexpensive
to get the value of a sample&mdash;only an array lookup is necessary (as
opposed to having to trace a number of rays to compute radiance).  Further,
because the texture image function is fully defined by the set of samples
and there is no mystery about what its highest frequency could be, there is
no uncertainty related to the function&rsquo;s behavior between samples.  These
differences make it possible to remove detail from the texture before
sampling, thus eliminating aliasing.

</p>
<p>

</p>
<p>However, the texture sampling rate will typically change from pixel to
pixel.  The sampling rate is determined by scene
geometry and its orientation, the texture coordinate mapping function, and the
camera projection and image sampling rate. Because the texture sampling rate is not
fixed, texture filtering algorithms need to be able to filter over arbitrary
regions of texture samples efficiently.

</p>
<p>The <a href="#MIPMap"><tt>MIPMap</tt></a> class implements two methods for efficient texture filtering
with spatially varying filter widths.  The first, trilinear interpolation, is
fast and easy to implement and was widely used for texture filtering in
early graphics hardware.  The second, elliptically weighted averaging, is slower and
more complex but returns extremely high-quality results.
Figure&nbsp;<a href="#fig:texfilt-ewa-trilerp">10.10</a>
compares the result of texture filtering using trilinear interpolation and the EWA algorithm.

</p>
<p> </p>
<span class="anchor" id="fig:texfilt-ewa-trilerp"></span><div class="card outerfigure"><div class="card-body figure"><p>


</p>

<div class="card-img-top" style="display:block; width: 100%; padding-top: 102.400%;  position:relative;">
<div id="Trilinear_interpolation42" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0;"></div></div>
<script>
Jeri.renderViewer(document.getElementById('Trilinear_interpolation42'), {
  title: 'Trilinear_interpolation42', children: [
 { title: 'Trilinear interpolation', image: 'sphere-trilerp.png' },  { title: 'EWA filtering', image: 'sphere-tex-antialiased.png' }]});
</script>
<button data-toggle="tooltip" data-placement="left" class="btn yojeri" title="This image is interactive. Click and drag to pan and use the mouse-wheel to zoom. After clicking on the image to select it, type '?' to see a summary of keyboard controls."><i class="fa fa-snowflake fa-border"></i></button><p>

</p>
<figcaption class="caption">Figure 10.10: <span class="legend"> Filtering the image map properly
substantially improves the image.  (1)&nbsp;trilinear interpolation, and (2)&nbsp;the
EWA algorithm.  Both of these approaches
give a much better image than the unfiltered image map in
Figure&nbsp;<a href="../Texture.html#fig:texture-aliasing-example">10.1</a>.
Trilinear interpolation is inferior
at handling strongly anisotropic filter footprints than EWA, which is
why the edges and pole of the first sphere are a uniform gray color (the
overall average value of the texture).  With EWA, details from the image map are
visible longer in those areas before they turn to gray.</span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p>To limit the potential number of texels that need to be accessed, both of these
filtering methods use an <em>image pyramid</em> of increasingly lower resolution
prefiltered versions of the original image to accelerate their
operation.<button style="button" data-toggle="tooltip" data-placement="right" data-html="true" class="btn footnote-button" title="The name &ldquo;MIP map&rdquo; comes from the Latin <em>multum in
parvo</em>, which means &ldquo;much in little,&rdquo; a nod to the image
pyramid.">
      <sup>&dagger;</sup>
    </button>
		  The original 
image texels are at the bottom level of the pyramid,
and the image at each level is half the resolution of the previous level,
up to the top level, which has a single texel representing the average of all of
the texels in the original image.    This collection of
images needs at most <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.487ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 1501.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">1 slash 3</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-33" d="M457 171c0 -102 -91 -193 -213 -193c-109 0 -202 66 -202 157c0 44 32 58 56 58c29 0 56 -20 56 -56c0 -38 -31 -60 -66 -55c35 -59 110 -76 153 -76c44 0 113 29 113 165c0 98 -37 166 -119 166h-44c-17 0 -24 0 -24 11c0 10 7 11 15 12c7 0 31 2 39 3c25 1 59 4 89 52 c26 44 28 102 28 114c0 90 -55 112 -96 112c-36 0 -102 -13 -133 -62c15 0 62 0 62 -50c0 -29 -20 -51 -51 -51c-29 0 -51 19 -51 52c0 76 76 136 177 136c96 0 184 -56 184 -138c0 -79 -58 -149 -140 -176c104 -21 167 -99 167 -181Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="500" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-33" x="1001" y="0"></use>
</g>
</svg> more memory than storing the
most detailed level alone and can be used to quickly find filtered values over
large regions of the original image.  The basic idea behind the pyramid is
that if a large area of texels needs to be filtered a reasonable
approximation is to use a higher level of the pyramid and do the filtering
over the same area there, accessing many fewer texels. 

</p>
<p>

</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-MIPMapDeclarations-0"></span><div class="fragmentname">&lt;&lt;MIPMap Declarations&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">template &lt;typename T&gt; class <span class="anchor" id="MIPMap"></span>MIPMap {
public:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-MIPMapPublicMethods-0">MIPMap Public Methods</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1031" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1031"><i></i></a><div id="fragbit-1031" class="collapse"><div class="fragmentcode">       <a href="#MIPMap" class="code">MIPMap</a>(const <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> &amp;resolution, const T *data, bool doTri = false,
              Float maxAniso = 8.f, ImageWrap wrapMode = ImageWrap::Repeat);
       int Width() const { return resolution[0]; }
       int Height() const { return resolution[1]; }
       int Levels() const { return <a href="#MIPMap::pyramid" class="code">pyramid</a>.size(); }
       const T &amp;Texel(int level, int s, int t) const;
       T Lookup(const <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> &amp;st, Float width = 0.f) const;
       T Lookup(const <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> &amp;st, <a href="../Geometry_and_Transformations/Vectors.html#Vector2f" class="code">Vector2f</a> dstdx, <a href="../Geometry_and_Transformations/Vectors.html#Vector2f" class="code">Vector2f</a> dstdy) const;</div></div>
private:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-MIPMapPrivateMethods-0">MIPMap Private Methods</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1032" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1032"><i></i></a><div id="fragbit-1032" class="collapse"><div class="fragmentcode">       std::unique_ptr&lt;ResampleWeight[]&gt; resampleWeights(int oldRes,
               int newRes) {
           <a href="../Utilities/Communicating_with_the_User.html#Assert" class="code">Assert</a>(newRes &gt;= oldRes);
           std::unique_ptr&lt;ResampleWeight[]&gt; wt(new ResampleWeight[newRes]);
           Float filterwidth = 2.f;
           for (int i = 0; i &lt; newRes; ++i) {
               &lt;&lt;<span class="fragmentname"><a href="#fragment-Computeimageresamplingweightsformonoithtexel-0">Compute image resampling weights for <tt>i</tt>th texel</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1033" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1033"><i></i></a><div id="fragbit-1033" class="collapse"><div class="fragmentcode">                  Float center = (i + .5f) * oldRes / newRes;
                  wt[i].<a href="#ResampleWeight::firstTexel" class="code">firstTexel</a> = std::floor((center - filterwidth) + 0.5f);
                  for (int j = 0; j &lt; 4; ++j) {
                      Float pos = wt[i].<a href="#ResampleWeight::firstTexel" class="code">firstTexel</a> + j + .5f;
                      wt[i].<a href="#ResampleWeight::weight" class="code">weight</a>[j] = <a href="#Lanczos" class="code">Lanczos</a>((pos - center) / filterwidth);
                  }
                  &lt;&lt;<span class="fragmentname"><a href="#fragment-Normalizefilterweightsfortexelresampling-0">Normalize filter weights for texel resampling</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1034" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1034"><i></i></a><div id="fragbit-1034" class="collapse"><div class="fragmentcode">                     Float invSumWts = 1 / (wt[i].<a href="#ResampleWeight::weight" class="code">weight</a>[0] + wt[i].<a href="#ResampleWeight::weight" class="code">weight</a>[1] + 
                                            wt[i].<a href="#ResampleWeight::weight" class="code">weight</a>[2] + wt[i].<a href="#ResampleWeight::weight" class="code">weight</a>[3]);
                     for (int j = 0; j &lt; 4; ++j)
                         wt[i].<a href="#ResampleWeight::weight" class="code">weight</a>[j] *= invSumWts;</div></div></div></div>
           }
           return wt;
       }
       Float clamp(Float v) { return <a href="../Utilities/Main_Include_File.html#Clamp" class="code">Clamp</a>(v, 0.f, <a href="../Shapes/Managing_Rounding_Error.html#Infinity" class="code">Infinity</a>); }
       RGBSpectrum clamp(const RGBSpectrum &amp;v) { return v.<a href="../Utilities/Main_Include_File.html#Clamp" class="code">Clamp</a>(0.f, <a href="../Shapes/Managing_Rounding_Error.html#Infinity" class="code">Infinity</a>); }
       SampledSpectrum clamp(const SampledSpectrum &amp;v) { return v.<a href="../Utilities/Main_Include_File.html#Clamp" class="code">Clamp</a>(0.f, <a href="../Shapes/Managing_Rounding_Error.html#Infinity" class="code">Infinity</a>); }
       T triangle(int level, const <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> &amp;st) const;
       T EWA(int level, <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> st, <a href="../Geometry_and_Transformations/Vectors.html#Vector2f" class="code">Vector2f</a> dst0, <a href="../Geometry_and_Transformations/Vectors.html#Vector2f" class="code">Vector2f</a> dst1) const;</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-MIPMapPrivateData-0">MIPMap Private Data</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1035" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1035"><i></i></a><div id="fragbit-1035" class="collapse"><div class="fragmentcode">       const bool doTrilinear;
       const Float maxAnisotropy;
       const ImageWrap wrapMode;
       <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> resolution;
       std::vector&lt;std::unique_ptr&lt;BlockedArray&lt;T&gt;&gt;&gt; pyramid;
       static constexpr int WeightLUTSize = 128;
       static Float weightLut[WeightLUTSize];</div></div>
};</div><p>


</p>
<p>In the constructor, the <tt>MIPMap</tt> copies the image data provided by the
caller, resizes the image if necessary to ensure that its resolution is a power
of two in each direction, and initializes a lookup table used by the
elliptically weighted average filtering method in Section&nbsp;<a href="#sec:ewa">10.4.5</a>.  It
also records the desired behavior for texture coordinates that fall outside of
the legal range in the <tt>wrapMode</tt> argument.

</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-MIPMapMethodDefinitions-0"></span><div class="fragmentname">&lt;&lt;MIPMap Method Definitions&gt;&gt;=&nbsp;<a href="#fragment-MIPMapMethodDefinitions-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;typename T&gt;
<a href="#MIPMap" class="code">MIPMap</a>&lt;T&gt;::<a href="#MIPMap" class="code">MIPMap</a>(const <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> &amp;res, const T *img, bool doTrilinear,
                  Float maxAnisotropy, ImageWrap wrapMode)
    : doTrilinear(doTrilinear), maxAnisotropy(maxAnisotropy),
      wrapMode(wrapMode), resolution(res) {
    std::unique_ptr&lt;T[]&gt; resampledImage = nullptr;
    if (!<a href="../Utilities/Main_Include_File.html#IsPowerOf2" class="code">IsPowerOf2</a>(resolution[0]) || !<a href="../Utilities/Main_Include_File.html#IsPowerOf2" class="code">IsPowerOf2</a>(resolution[1])) {
        &lt;&lt;<span class="fragmentname"><a href="#fragment-Resampleimagetopower-of-tworesolution-0">Resample image to power-of-two resolution</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1036" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1036"><i></i></a><div id="fragbit-1036" class="collapse"><div class="fragmentcode">           <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> resPow2(<a href="../Utilities/Main_Include_File.html#RoundUpPow2" class="code">RoundUpPow2</a>(<a href="#MIPMap::resolution" class="code">resolution</a>[0]), <a href="../Utilities/Main_Include_File.html#RoundUpPow2" class="code">RoundUpPow2</a>(<a href="#MIPMap::resolution" class="code">resolution</a>[1]));
           &lt;&lt;<span class="fragmentname"><a href="#fragment-Resampleimageinsdirection-0">Resample image in <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 469.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">s</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
</g>
</svg> direction</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1037" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1037"><i></i></a><div id="fragbit-1037" class="collapse"><div class="fragmentcode">              std::unique_ptr&lt;ResampleWeight[]&gt; sWeights =
                  <a href="#MIPMap::resampleWeights" class="code">resampleWeights</a>(resolution[0], resPow2[0]);
              resampledImage.reset(new T[resPow2[0] * resPow2[1]]);
              &lt;&lt;<span class="fragmentname"><a href="#fragment-ApplymonosWeightstozoominsdirection-0">Apply <tt>sWeights</tt> to zoom in <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 469.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">s</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
</g>
</svg> direction</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1038" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1038"><i></i></a><div id="fragbit-1038" class="collapse"><div class="fragmentcode">                 <a href="../Utilities/Parallelism.html#ParallelFor" class="code">ParallelFor</a>(
                     [&amp;](int t) {
                         for (int s = 0; s &lt; resPow2[0]; ++s) {
                             &lt;&lt;<span class="fragmentname"><a href="#fragment-Computetexelstins-zoomedimage-0">Compute texel <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.773ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2055.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1665" y="0"></use>
</g>
</svg> in <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 469.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">s</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
</g>
</svg>-zoomed image</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1039" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1039"><i></i></a><div id="fragbit-1039" class="collapse"><div class="fragmentcode">                                resampledImage[t * resPow2[0] + s] = 0.f;
                                for (int j = 0; j &lt; 4; ++j) {
                                    int origS = sWeights[s].<a href="#ResampleWeight::firstTexel" class="code">firstTexel</a> + j;
                                    if (wrapMode == ImageWrap::Repeat) 
                                        origS = <a href="../Utilities/Main_Include_File.html#Mod" class="code">Mod</a>(origS, resolution[0]);
                                    else if (wrapMode == ImageWrap::<a href="../Utilities/Main_Include_File.html#Clamp" class="code">Clamp</a>) 
                                        origS = <a href="../Utilities/Main_Include_File.html#Clamp" class="code">Clamp</a>(origS, 0, resolution[0] - 1);
                                    if (origS &gt;= 0 &amp;&amp; origS &lt; (int)resolution[0])
                                        resampledImage[t * resPow2[0] + s] +=
                                            sWeights[s].<a href="#ResampleWeight::weight" class="code">weight</a>[j] * img[t * resolution[0] + origS];
                                }</div></div>
                         }
                     }, resolution[1], 16);</div></div></div></div>
           &lt;&lt;<span class="fragmentname">Resample image in <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.84ex" height="2.009ex" style="vertical-align: -0.338ex;" viewBox="0 -719.6 361.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">t</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
</g>
</svg> direction</span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1040" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1040"><i></i></a><div id="fragbit-1040" class="collapse"><div class="fragmentcode">              std::unique_ptr&lt;ResampleWeight[]&gt; tWeights = resampleWeights(resolution[1], resPow2[1]);
              std::vector&lt;T *&gt; resampleBufs;
              int nThreads = MaxThreadIndex();
              for (int i = 0; i &lt; nThreads; ++i)
                  resampleBufs.push_back(new T[resPow2[1]]);
              <a href="../Utilities/Parallelism.html#ParallelFor" class="code">ParallelFor</a>(
                  [&amp;](int s) {
                      T *workData = resampleBufs[threadIndex];
                      for (int t = 0; t &lt; resPow2[1]; ++t) {
                          workData[t] = 0.f;
                          for (int j = 0; j &lt; 4; ++j) {
                              int offset = tWeights[t].firstTexel + j;
                              if (wrapMode == ImageWrap::Repeat) offset = <a href="../Utilities/Main_Include_File.html#Mod" class="code">Mod</a>(offset, resolution[1]);
                              else if (wrapMode == ImageWrap::<a href="../Utilities/Main_Include_File.html#Clamp" class="code">Clamp</a>) offset = <a href="../Utilities/Main_Include_File.html#Clamp" class="code">Clamp</a>(offset, 0, (int)resolution[1]-1);
                              if (offset &gt;= 0 &amp;&amp; offset &lt; (int)resolution[1])
                                  workData[t] += tWeights[t].weight[j] *
                                      resampledImage[offset * resPow2[0] + s];
                          }
                      }
                      for (int t = 0; t &lt; resPow2[1]; ++t)
                          resampledImage[t * resPow2[0] + s] = clamp(workData[t]);
                  }, resPow2[0], 32);
              for (auto ptr : resampleBufs)
                  delete[] ptr;</div></div>
           <a href="#MIPMap::resolution" class="code">resolution</a> = resPow2;</div></div>
    }
    &lt;&lt;<span class="fragmentname"><a href="#fragment-InitializelevelsofMIPMapfromimage-0">Initialize levels of MIPMap from image</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1041" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1041"><i></i></a><div id="fragbit-1041" class="collapse"><div class="fragmentcode">       int nLevels = 1 + <a href="../Utilities/Main_Include_File.html#Log2Int" class="code">Log2Int</a>(std::max(<a href="#MIPMap::resolution" class="code">resolution</a>[0], <a href="#MIPMap::resolution" class="code">resolution</a>[1]));
       <a href="#MIPMap::pyramid" class="code">pyramid</a>.resize(nLevels);
       &lt;&lt;<span class="fragmentname"><a href="#fragment-InitializemostdetailedlevelofMIPMap-0">Initialize most detailed level of MIPMap</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1042" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1042"><i></i></a><div id="fragbit-1042" class="collapse"><div class="fragmentcode">          <a href="#MIPMap::pyramid" class="code">pyramid</a>[0].reset(new BlockedArray&lt;T&gt;(resolution[0], resolution[1],
              resampledImage ? resampledImage.get() : img));</div></div>
       for (int i = 1; i &lt; nLevels; ++i) {
           &lt;&lt;<span class="fragmentname"><a href="#fragment-InitializeithMIPMaplevelfromi-1stlevel-0">Initialize <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.802ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 345.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">i</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D456" x="0" y="0"></use>
</g>
</svg>th MIPMap level from <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.805ex" height="2.343ex" style="vertical-align: -0.505ex;" viewBox="0 -791.3 2068.9 1008.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">i minus 1</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D456" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="567" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1568" y="0"></use>
</g>
</svg>st level</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1043" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1043"><i></i></a><div id="fragbit-1043" class="collapse"><div class="fragmentcode">              int sRes = std::max(1, <a href="#MIPMap::pyramid" class="code">pyramid</a>[i - 1]-&gt;<a href="../Utilities/Memory_Management.html#BlockedArray::uSize" class="code">uSize</a>() / 2);
              int tRes = std::max(1, <a href="#MIPMap::pyramid" class="code">pyramid</a>[i - 1]-&gt;<a href="../Utilities/Memory_Management.html#BlockedArray::vSize" class="code">vSize</a>() / 2);
              <a href="#MIPMap::pyramid" class="code">pyramid</a>[i].reset(new BlockedArray&lt;T&gt;(sRes, tRes));
              &lt;&lt;<span class="fragmentname"><a href="#fragment-Filterfourtexelsfromfinerlevelofpyramid-0">Filter four texels from finer level of pyramid</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1044" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1044"><i></i></a><div id="fragbit-1044" class="collapse"><div class="fragmentcode">                 <a href="../Utilities/Parallelism.html#ParallelFor" class="code">ParallelFor</a>(
                     [&amp;](int t) {
                         for (int s = 0; s &lt; sRes; ++s)
                             (*<a href="#MIPMap::pyramid" class="code">pyramid</a>[i])(s, t) = .25f *
                                (<a href="#MIPMap::Texel" class="code">Texel</a>(i-1, 2*s, 2*t)   + <a href="#MIPMap::Texel" class="code">Texel</a>(i-1, 2*s+1, 2*t) + 
                                 <a href="#MIPMap::Texel" class="code">Texel</a>(i-1, 2*s, 2*t+1) + <a href="#MIPMap::Texel" class="code">Texel</a>(i-1, 2*s+1, 2*t+1));
                     }, tRes, 16);</div></div></div></div>
       }</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-InitializeEWAfilterweightsifneeded-0">Initialize EWA filter weights if needed</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1045" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1045"><i></i></a><div id="fragbit-1045" class="collapse"><div class="fragmentcode">       if (<a href="#MIPMap::weightLut" class="code">weightLut</a>[0] == 0.) {
           for (int i = 0; i &lt; <a href="#MIPMap::WeightLUTSize" class="code">WeightLUTSize</a>; ++i) {
               Float alpha = 2;
               Float r2 = Float(i) / Float(<a href="#MIPMap::WeightLUTSize" class="code">WeightLUTSize</a> - 1);
               <a href="#MIPMap::weightLut" class="code">weightLut</a>[i] = std::exp(-alpha * r2) - std::exp(-alpha);
           }
       }</div></div>
}</div><p>


</p>
<p></p>
<span class="anchor" id="fragment-MIPMapPrivateData-0"></span><div class="fragmentname">&lt;&lt;MIPMap Private Data&gt;&gt;=&nbsp;<a href="#fragment-MIPMapPrivateData-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">const bool <span class="anchor" id="MIPMap::doTrilinear"></span>doTrilinear;
const Float <span class="anchor" id="MIPMap::maxAnisotropy"></span>maxAnisotropy;
const ImageWrap <span class="anchor" id="MIPMap::wrapMode"></span>wrapMode;
<a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> <span class="anchor" id="MIPMap::resolution"></span>resolution;</div><p>


</p>
<p><a href="#MIPMap"><tt>MIPMap</tt></a> is a template class that is parameterized by the data type of
the image texels.  <tt>pbrt</tt> creates <a href="#MIPMap"><tt>MIPMap</tt></a>s of both <a href="../Color_and_Radiometry/RGBSpectrum_Implementation.html#RGBSpectrum"><tt>RGBSpectrum</tt></a> and
<tt>Float</tt> images; <tt>Float</tt> MIP maps are used for representing
directional distributions of intensity from goniometric light sources (Section&nbsp;<a href="../Light_Sources/Point_Lights.html#sec:gonio-lights">12.3.3</a>), for
example.  The <a href="#MIPMap"><tt>MIPMap</tt></a> implementation requires that the type <tt>T</tt>
support just a few basic operations, including addition and multiplication
by a scalar.

</p>
<p>The <a href="#ImageWrap"><tt>ImageWrap</tt></a> enumerant, passed to the <tt>MIPMap</tt> constructor,
specifies the desired behavior when the supplied
texture coordinates are not in the legal <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.653ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2003.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket 0 comma 1 right-bracket</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="779" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1224" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="1724" y="0"></use>
</g>
</svg> range.

</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-MIPMapHelperDeclarations-0"></span><div class="fragmentname">&lt;&lt;MIPMap Helper Declarations&gt;&gt;=&nbsp;<a href="#fragment-MIPMapHelperDeclarations-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">enum class <span class="anchor" id="ImageWrap"></span>ImageWrap { <span class="anchor" id="ImageWrap::Repeat"></span>Repeat, <span class="anchor" id="ImageWrap::Black"></span>Black, <span class="anchor" id="ImageWrap::Clamp"></span><a href="../Utilities/Main_Include_File.html#Clamp" class="code">Clamp</a> };</div><p>


</p>
<p>Implementation of an image pyramid is somewhat easier if the resolution of
the original image is an exact power of two in each direction; this ensures
that there is a straightforward relationship between the level of the
pyramid and the number of texels at that level.  If the user has provided
an image where the resolution in one or both of the dimensions is not a
power of two, then the <a href="#MIPMap"><tt>MIPMap</tt></a> constructor starts by resizing the
image up to the next power-of-two resolution greater than the original
resolution before constructing the pyramid.  Exercise&nbsp;10.5 at the end of
the chapter describes an approach to building image pyramids with
non-power-of-two resolutions.

</p>
<p>

</p>
<p>Image resizing here involves more application of the sampling
and reconstruction theory from Chapter&nbsp;<a href="../Sampling_and_Reconstruction.html#chap:sampling-reconstruction">7</a>: we
have an image function that has been sampled at one sampling rate, and we&rsquo;d
like to reconstruct a continuous image function from the original samples to
resample at a new set of sample positions.  Because this represents an increase
in the sampling rate from the original rate, we don&rsquo;t have to worry about
introducing aliasing due to undersampling high-frequency components in this
step; we only need to reconstruct and directly resample the new function.
Figure&nbsp;<a href="#fig:texture-magnify-resample">10.11</a> illustrates this task in&nbsp;1D.

</p>
<p>
 </p>
<span class="anchor" id="fig:texture-magnify-resample"></span><div class="card outerfigure"><div class="card-body figure"><p>



</p>
<div class="figure-row">
  <a href="tex-resample-1d-a.svg" title=""><img src="tex-resample-1d-a.svg" width=360 height=241 style="max-width: 100%;"></a>
  <a href="tex-resample-1d-b.svg" title=""><img src="tex-resample-1d-b.svg" width=360 height=241 style="max-width: 100%;"></a>
</div>
<p>


</p>
<figcaption class="caption">Figure 10.11: <span class="legend"> To increase an image&rsquo;s
resolution to be a power of two, the <a href="#MIPMap"><tt>MIPMap</tt></a> performs two 1D resampling
steps with a separable reconstruction filter.  (a)&nbsp;A 1D function
reconstructed from four samples, denoted by dots.  (b)&nbsp;To represent the same
image function with more samples, we just need to reconstruct the
continuous function and evaluate it at the new positions.</span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p>The <a href="#MIPMap"><tt>MIPMap</tt></a> uses a separable reconstruction filter for this task;
recall from Section&nbsp;<a href="../Sampling_and_Reconstruction/Image_Reconstruction.html#sec:image-reconstruction">7.8</a> that separable filters can
be written as the product of 1D filters: <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="18.348ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 7899.7 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">f left-parenthesis x comma y right-parenthesis equals f left-parenthesis x right-parenthesis f left-parenthesis y right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="552" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="942" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1514" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="1959" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2450" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="3117" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="4173" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="4726" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="5115" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="5688" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="6077" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="6630" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="7019" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="7510" y="0"></use>
</g>
</svg>.
One advantage of using a separable filter is that if we are using one to
resample an image from one resolution <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.773ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2055.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1665" y="0"></use>
</g>
</svg> to another <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.576ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2831.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s prime comma t prime right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
<g transform="translate(389,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="663" y="513"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1247" y="0"></use>
<g transform="translate(1692,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="511" y="513"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2441" y="0"></use>
</g>
</svg>, then we can
implement the resampling as two 1D resampling steps, first
resampling in <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 469.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">s</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
</g>
</svg> to create an image of resolution <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.675ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2443.3 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s prime comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
<g transform="translate(389,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="663" y="513"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1247" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1692" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2053" y="0"></use>
</g>
</svg> and then resampling
that image to create the final image of resolution <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.576ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2831.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s prime comma t prime right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
<g transform="translate(389,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="663" y="513"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1247" y="0"></use>
<g transform="translate(1692,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="511" y="513"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2441" y="0"></use>
</g>
</svg>.  Resampling the
image via two 1D steps in this manner simplifies implementation and makes the
number of texels accessed for each texel in the final image a linear function
of the filter width, rather than a quadratic one.

</p>
<p></p>
<span class="anchor" id="fragment-Resampleimagetopower-of-tworesolution-0"></span><div class="fragmentname">&lt;&lt;Resample image to power-of-two resolution&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> resPow2(<a href="../Utilities/Main_Include_File.html#RoundUpPow2" class="code">RoundUpPow2</a>(<a href="#MIPMap::resolution" class="code">resolution</a>[0]), <a href="../Utilities/Main_Include_File.html#RoundUpPow2" class="code">RoundUpPow2</a>(<a href="#MIPMap::resolution" class="code">resolution</a>[1]));
&lt;&lt;<span class="fragmentname"><a href="#fragment-Resampleimageinsdirection-0">Resample image in <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 469.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">s</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
</g>
</svg> direction</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1046" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1046"><i></i></a><div id="fragbit-1046" class="collapse"><div class="fragmentcode">   std::unique_ptr&lt;ResampleWeight[]&gt; sWeights =
       <a href="#MIPMap::resampleWeights" class="code">resampleWeights</a>(resolution[0], resPow2[0]);
   resampledImage.reset(new T[resPow2[0] * resPow2[1]]);
   &lt;&lt;<span class="fragmentname"><a href="#fragment-ApplymonosWeightstozoominsdirection-0">Apply <tt>sWeights</tt> to zoom in <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 469.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">s</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
</g>
</svg> direction</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1047" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1047"><i></i></a><div id="fragbit-1047" class="collapse"><div class="fragmentcode">      <a href="../Utilities/Parallelism.html#ParallelFor" class="code">ParallelFor</a>(
          [&amp;](int t) {
              for (int s = 0; s &lt; resPow2[0]; ++s) {
                  &lt;&lt;<span class="fragmentname"><a href="#fragment-Computetexelstins-zoomedimage-0">Compute texel <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.773ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2055.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1665" y="0"></use>
</g>
</svg> in <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 469.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">s</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
</g>
</svg>-zoomed image</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1048" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1048"><i></i></a><div id="fragbit-1048" class="collapse"><div class="fragmentcode">                     resampledImage[t * resPow2[0] + s] = 0.f;
                     for (int j = 0; j &lt; 4; ++j) {
                         int origS = sWeights[s].<a href="#ResampleWeight::firstTexel" class="code">firstTexel</a> + j;
                         if (wrapMode == ImageWrap::Repeat) 
                             origS = <a href="../Utilities/Main_Include_File.html#Mod" class="code">Mod</a>(origS, resolution[0]);
                         else if (wrapMode == ImageWrap::<a href="../Utilities/Main_Include_File.html#Clamp" class="code">Clamp</a>) 
                             origS = <a href="../Utilities/Main_Include_File.html#Clamp" class="code">Clamp</a>(origS, 0, resolution[0] - 1);
                         if (origS &gt;= 0 &amp;&amp; origS &lt; (int)resolution[0])
                             resampledImage[t * resPow2[0] + s] +=
                                 sWeights[s].<a href="#ResampleWeight::weight" class="code">weight</a>[j] * img[t * resolution[0] + origS];
                     }</div></div>
              }
          }, resolution[1], 16);</div></div></div></div>
&lt;&lt;<span class="fragmentname">Resample image in <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.84ex" height="2.009ex" style="vertical-align: -0.338ex;" viewBox="0 -719.6 361.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">t</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
</g>
</svg> direction</span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1049" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1049"><i></i></a><div id="fragbit-1049" class="collapse"><div class="fragmentcode">   std::unique_ptr&lt;ResampleWeight[]&gt; tWeights = resampleWeights(resolution[1], resPow2[1]);
   std::vector&lt;T *&gt; resampleBufs;
   int nThreads = MaxThreadIndex();
   for (int i = 0; i &lt; nThreads; ++i)
       resampleBufs.push_back(new T[resPow2[1]]);
   <a href="../Utilities/Parallelism.html#ParallelFor" class="code">ParallelFor</a>(
       [&amp;](int s) {
           T *workData = resampleBufs[threadIndex];
           for (int t = 0; t &lt; resPow2[1]; ++t) {
               workData[t] = 0.f;
               for (int j = 0; j &lt; 4; ++j) {
                   int offset = tWeights[t].firstTexel + j;
                   if (wrapMode == ImageWrap::Repeat) offset = <a href="../Utilities/Main_Include_File.html#Mod" class="code">Mod</a>(offset, resolution[1]);
                   else if (wrapMode == ImageWrap::<a href="../Utilities/Main_Include_File.html#Clamp" class="code">Clamp</a>) offset = <a href="../Utilities/Main_Include_File.html#Clamp" class="code">Clamp</a>(offset, 0, (int)resolution[1]-1);
                   if (offset &gt;= 0 &amp;&amp; offset &lt; (int)resolution[1])
                       workData[t] += tWeights[t].weight[j] *
                           resampledImage[offset * resPow2[0] + s];
               }
           }
           for (int t = 0; t &lt; resPow2[1]; ++t)
               resampledImage[t * resPow2[0] + s] = clamp(workData[t]);
       }, resPow2[0], 32);
   for (auto ptr : resampleBufs)
       delete[] ptr;</div></div>
<a href="#MIPMap::resolution" class="code">resolution</a> = resPow2;</div><p>


</p>
<p>Reconstructing the original image function and sampling it at a new texel&rsquo;s
position are mathematically equivalent to centering the reconstruction filter
kernel at the new texel&rsquo;s position and weighting the nearby texels in the
original image appropriately. 
Thus, each new texel is a weighted average of a small number of texels in the
original image.  

</p>
<p>The <a href="#MIPMap::resampleWeights"><tt>MIPMap::resampleWeights()</tt></a> method determines which original texels
contribute to each new texel and what the values are of the contribution
weights for each new texel.  It returns the values in an array of
<a href="#ResampleWeight"><tt>ResampleWeight</tt></a> structures for all of the texels in a 1D row or column
of the image.  Because this information is the same for all rows of the
image when resampling in <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 469.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">s</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
</g>
</svg> and all columns when resampling
in <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.84ex" height="2.009ex" style="vertical-align: -0.338ex;" viewBox="0 -719.6 361.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">t</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
</g>
</svg>, it&rsquo;s more efficient to compute it once for each of the two passes
and then reuse it many times for each one.  Given these weights, the image
is first magnified in the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 469.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">s</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
</g>
</svg> direction, turning the original image with
resolution <tt>resolution</tt> into an image with resolution
<tt>(resPow2[0], resolution[1])</tt>, which is stored in <tt>resampledImage</tt>. 
The implementation here allocates enough space in <tt>resampledImage</tt> to
hold the final zoomed image with resolution <tt>(resPow2[0], resPow2[1])</tt>, so two
large allocations can be avoided.

</p>
<p></p>
<span class="anchor" id="fragment-Resampleimageinsdirection-0"></span><div class="fragmentname">&lt;&lt;Resample image in <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 469.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">s</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
</g>
</svg> direction&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">std::unique_ptr&lt;ResampleWeight[]&gt; sWeights =
    <a href="#MIPMap::resampleWeights" class="code">resampleWeights</a>(resolution[0], resPow2[0]);
resampledImage.reset(new T[resPow2[0] * resPow2[1]]);
&lt;&lt;<span class="fragmentname"><a href="#fragment-ApplymonosWeightstozoominsdirection-0">Apply <tt>sWeights</tt> to zoom in <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 469.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">s</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
</g>
</svg> direction</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1050" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1050"><i></i></a><div id="fragbit-1050" class="collapse"><div class="fragmentcode">   <a href="../Utilities/Parallelism.html#ParallelFor" class="code">ParallelFor</a>(
       [&amp;](int t) {
           for (int s = 0; s &lt; resPow2[0]; ++s) {
               &lt;&lt;<span class="fragmentname"><a href="#fragment-Computetexelstins-zoomedimage-0">Compute texel <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.773ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2055.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1665" y="0"></use>
</g>
</svg> in <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 469.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">s</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
</g>
</svg>-zoomed image</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1051" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1051"><i></i></a><div id="fragbit-1051" class="collapse"><div class="fragmentcode">                  resampledImage[t * resPow2[0] + s] = 0.f;
                  for (int j = 0; j &lt; 4; ++j) {
                      int origS = sWeights[s].<a href="#ResampleWeight::firstTexel" class="code">firstTexel</a> + j;
                      if (wrapMode == ImageWrap::Repeat) 
                          origS = <a href="../Utilities/Main_Include_File.html#Mod" class="code">Mod</a>(origS, resolution[0]);
                      else if (wrapMode == ImageWrap::<a href="../Utilities/Main_Include_File.html#Clamp" class="code">Clamp</a>) 
                          origS = <a href="../Utilities/Main_Include_File.html#Clamp" class="code">Clamp</a>(origS, 0, resolution[0] - 1);
                      if (origS &gt;= 0 &amp;&amp; origS &lt; (int)resolution[0])
                          resampledImage[t * resPow2[0] + s] +=
                              sWeights[s].<a href="#ResampleWeight::weight" class="code">weight</a>[j] * img[t * resolution[0] + origS];
                  }</div></div>
           }
       }, resolution[1], 16);</div></div></div><p>


</p>
<p>For the reconstruction filter used here,  no more than four of the original
texels will contribute to each new texel after zooming, so <a href="#ResampleWeight"><tt>ResampleWeight</tt></a>
only needs to hold four weights.  Because the four texels are contiguous, we
only store the offset to the first one.

</p>
<p></p>
<span class="anchor" id="fragment-MIPMapHelperDeclarations-1"></span><div class="fragmentname">&lt;&lt;MIPMap Helper Declarations&gt;&gt;+=&nbsp;<a href="#fragment-MIPMapHelperDeclarations-0"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">struct <span class="anchor" id="ResampleWeight"></span>ResampleWeight {
    int <span class="anchor" id="ResampleWeight::firstTexel"></span>firstTexel;
    Float <span class="anchor" id="ResampleWeight::weight"></span>weight[4]; 
};</div><p>


</p>
<p></p>
<span class="anchor" id="fragment-MIPMapPrivateMethods-0"></span><div class="fragmentname">&lt;&lt;MIPMap Private Methods&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">std::unique_ptr&lt;ResampleWeight[]&gt; <span class="anchor" id="MIPMap::resampleWeights"></span>resampleWeights(int oldRes,
        int newRes) {
    <a href="../Utilities/Communicating_with_the_User.html#Assert" class="code">Assert</a>(newRes &gt;= oldRes);
    std::unique_ptr&lt;ResampleWeight[]&gt; wt(new ResampleWeight[newRes]);
    Float filterwidth = 2.f;
    for (int i = 0; i &lt; newRes; ++i) {
        &lt;&lt;<span class="fragmentname"><a href="#fragment-Computeimageresamplingweightsformonoithtexel-0">Compute image resampling weights for <tt>i</tt>th texel</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1052" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1052"><i></i></a><div id="fragbit-1052" class="collapse"><div class="fragmentcode">           Float center = (i + .5f) * oldRes / newRes;
           wt[i].<a href="#ResampleWeight::firstTexel" class="code">firstTexel</a> = std::floor((center - filterwidth) + 0.5f);
           for (int j = 0; j &lt; 4; ++j) {
               Float pos = wt[i].<a href="#ResampleWeight::firstTexel" class="code">firstTexel</a> + j + .5f;
               wt[i].<a href="#ResampleWeight::weight" class="code">weight</a>[j] = <a href="#Lanczos" class="code">Lanczos</a>((pos - center) / filterwidth);
           }
           &lt;&lt;<span class="fragmentname"><a href="#fragment-Normalizefilterweightsfortexelresampling-0">Normalize filter weights for texel resampling</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1053" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1053"><i></i></a><div id="fragbit-1053" class="collapse"><div class="fragmentcode">              Float invSumWts = 1 / (wt[i].<a href="#ResampleWeight::weight" class="code">weight</a>[0] + wt[i].<a href="#ResampleWeight::weight" class="code">weight</a>[1] + 
                                     wt[i].<a href="#ResampleWeight::weight" class="code">weight</a>[2] + wt[i].<a href="#ResampleWeight::weight" class="code">weight</a>[3]);
              for (int j = 0; j &lt; 4; ++j)
                  wt[i].<a href="#ResampleWeight::weight" class="code">weight</a>[j] *= invSumWts;</div></div></div></div>
    }
    return wt;
}</div><p>


</p>
<p>Just as it was important to distinguish between discrete and continuous
pixel coordinates in Chapter&nbsp;<a href="../Sampling_and_Reconstruction.html#chap:sampling-reconstruction">7</a>, the same
issues need to be addressed with texel coordinates here.  We will use the
same conventions as described in Section&nbsp;<a href="../Sampling_and_Reconstruction/Sampling_Theory.html#sec:pixel-concepts">7.1.7</a>.
For each new texel, this function starts by computing its 
continuous coordinates in terms of the old texel coordinates.  This value
is stored in <tt>center</tt>, because it is the center of the reconstruction filter
for the new texel.  Next, it is necessary to find the offset to the first texel
that contributes to the new texel.  This is a slightly tricky
calculation&mdash;after subtracting the filter width to find the start of the
filter&rsquo;s nonzero range, it is necessary to add an extra <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.972ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 1279.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">0.5</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-35" d="M449 201c0 -127 -102 -223 -218 -223c-112 0 -181 97 -181 183c0 46 35 53 49 53c33 0 50 -25 50 -49s-17 -49 -50 -49c-11 0 -14 1 -17 2c17 -59 74 -112 147 -112c46 0 83 26 107 65c24 42 24 102 24 137c0 50 -2 89 -18 126c-8 18 -33 64 -85 64 c-81 0 -118 -54 -129 -70c-4 -6 -6 -9 -13 -9c-14 0 -14 8 -14 26v296c0 16 0 24 10 24c0 0 4 0 12 -3c47 -21 93 -28 133 -28c67 0 116 20 136 29c5 3 8 3 8 3c7 0 10 -5 10 -11c0 -13 -70 -104 -193 -104c-32 0 -65 7 -85 13v-195c36 35 79 51 127 51 c108 0 190 -100 190 -219Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-30"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="500" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-35" x="779" y="0"></use>
</g>
</svg> offset to
the continuous coordinate before taking the floor to find the discrete
coordinate.  Figure&nbsp;<a href="#fig:resamp-half-offset">10.12</a> illustrates why this
offset is needed.

</p>
<p> </p>
<span class="anchor" id="fig:resamp-half-offset"></span><div class="card outerfigure"><div class="card-body figure"><p>



</p>
<div class="figure-row">
  <a href="Discrete%20continuous%20filter%20width.svg" title=""><img src="Discrete%20continuous%20filter%20width.svg" width=491 height=99 style="max-width: 100%;"></a>
</div>
<p>


</p>
<figcaption class="caption">Figure 10.12: <span class="legend"> The computation to find the first
texel inside a reconstruction filter&rsquo;s support is slightly tricky.
Consider a filter centered around continuous coordinate 2.75 with radius 2,
as shown here.  The filter&rsquo;s support covers the range <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.596ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 4562.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket 0.75 comma 4.75 right-bracket</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-37" d="M485 644c0 -21 0 -23 -9 -35l-135 -190c-44 -62 -58 -148 -62 -171c-8 -54 -11 -109 -11 -164v-51c0 -10 0 -55 -46 -55s-46 45 -46 55c0 102 33 241 123 376l112 158h-207c-13 0 -91 0 -98 -6c-13 -12 -22 -75 -25 -91h-25l33 206h25c4 -19 6 -32 128 -32h243Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-35" d="M449 201c0 -127 -102 -223 -218 -223c-112 0 -181 97 -181 183c0 46 35 53 49 53c33 0 50 -25 50 -49s-17 -49 -50 -49c-11 0 -14 1 -17 2c17 -59 74 -112 147 -112c46 0 83 26 107 65c24 42 24 102 24 137c0 50 -2 89 -18 126c-8 18 -33 64 -85 64 c-81 0 -118 -54 -129 -70c-4 -6 -6 -9 -13 -9c-14 0 -14 8 -14 26v296c0 16 0 24 10 24c0 0 4 0 12 -3c47 -21 93 -28 133 -28c67 0 116 20 136 29c5 3 8 3 8 3c7 0 10 -5 10 -11c0 -13 -70 -104 -193 -104c-32 0 -65 7 -85 13v-195c36 35 79 51 127 51 c108 0 190 -100 190 -219Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-34" d="M471 165h-100v-87c0 -36 2 -47 76 -47h21v-31c-41 3 -94 3 -136 3s-94 0 -135 -3v31h21c74 0 76 11 76 47v87h-266v31l307 469c8 12 11 12 20 12c16 0 16 -6 16 -26v-455h100v-31zM300 196v373l-244 -373h244Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
<g transform="translate(278,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-30"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="500" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-37" x="779" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-35" x="1279" y="0"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="2058" y="0"></use>
<g transform="translate(2503,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-34"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="500" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-37" x="779" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-35" x="1279" y="0"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="4283" y="0"></use>
</g>
</svg>,
although texel zero is outside the filter&rsquo;s support: adding <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.972ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 1279.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">0.5</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-35" d="M449 201c0 -127 -102 -223 -218 -223c-112 0 -181 97 -181 183c0 46 35 53 49 53c33 0 50 -25 50 -49s-17 -49 -50 -49c-11 0 -14 1 -17 2c17 -59 74 -112 147 -112c46 0 83 26 107 65c24 42 24 102 24 137c0 50 -2 89 -18 126c-8 18 -33 64 -85 64 c-81 0 -118 -54 -129 -70c-4 -6 -6 -9 -13 -9c-14 0 -14 8 -14 26v296c0 16 0 24 10 24c0 0 4 0 12 -3c47 -21 93 -28 133 -28c67 0 116 20 136 29c5 3 8 3 8 3c7 0 10 -5 10 -11c0 -13 -70 -104 -193 -104c-32 0 -65 7 -85 13v-195c36 35 79 51 127 51 c108 0 190 -100 190 -219Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-30"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="500" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-35" x="779" y="0"></use>
</g>
</svg> to the
lower end before taking the floor to find the discrete texel gives the
correct starting texel, number one.</span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p>

</p>
<p>Starting from this first contributing texel, this function loops over four
texels, computing each one&rsquo;s offset to the center of the filter kernel and the
corresponding filter weight.

</p>
<p></p>
<span class="anchor" id="fragment-Computeimageresamplingweightsformonoithtexel-0"></span><div class="fragmentname">&lt;&lt;Compute image resampling weights for <tt>i</tt>th texel&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Float center = (i + .5f) * oldRes / newRes;
wt[i].<a href="#ResampleWeight::firstTexel" class="code">firstTexel</a> = std::floor((center - filterwidth) + 0.5f);
for (int j = 0; j &lt; 4; ++j) {
    Float pos = wt[i].<a href="#ResampleWeight::firstTexel" class="code">firstTexel</a> + j + .5f;
    wt[i].<a href="#ResampleWeight::weight" class="code">weight</a>[j] = <a href="#Lanczos" class="code">Lanczos</a>((pos - center) / filterwidth);
}
&lt;&lt;<span class="fragmentname"><a href="#fragment-Normalizefilterweightsfortexelresampling-0">Normalize filter weights for texel resampling</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1054" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1054"><i></i></a><div id="fragbit-1054" class="collapse"><div class="fragmentcode">   Float invSumWts = 1 / (wt[i].<a href="#ResampleWeight::weight" class="code">weight</a>[0] + wt[i].<a href="#ResampleWeight::weight" class="code">weight</a>[1] + 
                          wt[i].<a href="#ResampleWeight::weight" class="code">weight</a>[2] + wt[i].<a href="#ResampleWeight::weight" class="code">weight</a>[3]);
   for (int j = 0; j &lt; 4; ++j)
       wt[i].<a href="#ResampleWeight::weight" class="code">weight</a>[j] *= invSumWts;</div></div></div><p>


</p>
<p>The reconstruction filter function used to compute the weights,
<a href="#Lanczos"><tt>Lanczos()</tt></a>, is the same as the one in <a href="../Sampling_and_Reconstruction/Image_Reconstruction.html#LanczosSincFilter::Sinc"><tt>LanczosSincFilter::Sinc()</tt></a>.

</p>
<p></p>
<span class="anchor" id="fragment-TextureDeclarations-8"></span><div class="fragmentname">&lt;&lt;Texture Declarations&gt;&gt;+=&nbsp;<a href="Texture_Interface_and_Basic_Textures.html#fragment-TextureDeclarations-7"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">Float <span class="anchor" id="Lanczos"></span>Lanczos(Float, Float tau = 2);</div><p>


</p>
<p>Depending on the filter function used, the four filter weights may not sum to
one.  Therefore, to ensure that the resampled image won&rsquo;t be any brighter or
darker than the original image, the weights are normalized here.

</p>
<p></p>
<span class="anchor" id="fragment-Normalizefilterweightsfortexelresampling-0"></span><div class="fragmentname">&lt;&lt;Normalize filter weights for texel resampling&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Float invSumWts = 1 / (wt[i].<a href="#ResampleWeight::weight" class="code">weight</a>[0] + wt[i].<a href="#ResampleWeight::weight" class="code">weight</a>[1] + 
                       wt[i].<a href="#ResampleWeight::weight" class="code">weight</a>[2] + wt[i].<a href="#ResampleWeight::weight" class="code">weight</a>[3]);
for (int j = 0; j &lt; 4; ++j)
    wt[i].<a href="#ResampleWeight::weight" class="code">weight</a>[j] *= invSumWts;</div><p>


</p>
<p>

</p>
<p>Once the weights have been computed, it&rsquo;s easy to apply them to compute the
zoomed texels.  For each of the <tt>resolution[1]</tt> horizontal scan lines
in the original image, a pass is made across the <tt>resPow2[0]</tt> texels
in the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 469.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">s</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
</g>
</svg>-zoomed image using the precomputed weights to compute their
values.  Because the computation for each texel is completely independent
of the computation for every other texel, and because this computation
requires a bit of processing, it&rsquo;s worthwhile to split the image into
sections and work on them in parallel with multiple threads.

</p>
<p></p>
<span class="anchor" id="fragment-ApplymonosWeightstozoominsdirection-0"></span><div class="fragmentname">&lt;&lt;Apply <tt>sWeights</tt> to zoom in <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 469.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">s</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
</g>
</svg> direction&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Utilities/Parallelism.html#ParallelFor" class="code">ParallelFor</a>(
    [&amp;](int t) {
        for (int s = 0; s &lt; resPow2[0]; ++s) {
            &lt;&lt;<span class="fragmentname"><a href="#fragment-Computetexelstins-zoomedimage-0">Compute texel <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.773ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2055.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1665" y="0"></use>
</g>
</svg> in <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 469.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">s</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
</g>
</svg>-zoomed image</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1055" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1055"><i></i></a><div id="fragbit-1055" class="collapse"><div class="fragmentcode">               resampledImage[t * resPow2[0] + s] = 0.f;
               for (int j = 0; j &lt; 4; ++j) {
                   int origS = sWeights[s].<a href="#ResampleWeight::firstTexel" class="code">firstTexel</a> + j;
                   if (wrapMode == ImageWrap::Repeat) 
                       origS = <a href="../Utilities/Main_Include_File.html#Mod" class="code">Mod</a>(origS, resolution[0]);
                   else if (wrapMode == ImageWrap::<a href="../Utilities/Main_Include_File.html#Clamp" class="code">Clamp</a>) 
                       origS = <a href="../Utilities/Main_Include_File.html#Clamp" class="code">Clamp</a>(origS, 0, resolution[0] - 1);
                   if (origS &gt;= 0 &amp;&amp; origS &lt; (int)resolution[0])
                       resampledImage[t * resPow2[0] + s] +=
                           sWeights[s].<a href="#ResampleWeight::weight" class="code">weight</a>[j] * img[t * resolution[0] + origS];
               }</div></div>
        }
    }, resolution[1], 16);</div><p>


</p>
<p>The <a href="#ImageWrap"><tt>ImageWrap</tt></a> parameter to the <a href="#MIPMap"><tt>MIPMap</tt></a> constructor determines
the convention to be used for out-of-bounds texel coordinates. It either
remaps them to valid values with a modulus or clamp calculation or uses a
black texel value.

</p>
<p></p>
<span class="anchor" id="fragment-Computetexelstins-zoomedimage-0"></span><div class="fragmentname">&lt;&lt;Compute texel <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.773ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2055.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1665" y="0"></use>
</g>
</svg> in <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 469.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">s</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
</g>
</svg>-zoomed image&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">resampledImage[t * resPow2[0] + s] = 0.f;
for (int j = 0; j &lt; 4; ++j) {
    int origS = sWeights[s].<a href="#ResampleWeight::firstTexel" class="code">firstTexel</a> + j;
    if (wrapMode == ImageWrap::Repeat) 
        origS = <a href="../Utilities/Main_Include_File.html#Mod" class="code">Mod</a>(origS, resolution[0]);
    else if (wrapMode == ImageWrap::<a href="../Utilities/Main_Include_File.html#Clamp" class="code">Clamp</a>) 
        origS = <a href="../Utilities/Main_Include_File.html#Clamp" class="code">Clamp</a>(origS, 0, resolution[0] - 1);
    if (origS &gt;= 0 &amp;&amp; origS &lt; (int)resolution[0])
        resampledImage[t * resPow2[0] + s] +=
            sWeights[s].<a href="#ResampleWeight::weight" class="code">weight</a>[j] * img[t * resolution[0] + origS];
}</div><p>


</p>
<p>


</p>
<p>The process for resampling in the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.84ex" height="2.009ex" style="vertical-align: -0.338ex;" viewBox="0 -719.6 361.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">t</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
</g>
</svg> direction is almost the same as for
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 469.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">s</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
</g>
</svg>, so we won&rsquo;t include the implementation here.

</p>
<p>Once we have an image with resolutions that are powers of two, the levels
of the MIP map can be initialized, starting from the bottom (finest) level.
Each higher level is found by filtering the texels from the previous level.

</p>
<p>Because image maps use a fair amount of memory, and because 8 to 20 texels are
typically used per image texture lookup to compute a filtered value, it&rsquo;s
worth carefully considering how the texels are laid out in memory, since
reducing cache misses while accessing the texture map can noticeably
improve the renderer&rsquo;s performance.  Because both of the texture
filtering methods implemented in this section access a set of texels in a
rectangular region of the image map each time a lookup is performed, the
<a href="#MIPMap"><tt>MIPMap</tt></a> uses the <a href="../Utilities/Memory_Management.html#BlockedArray"><tt>BlockedArray</tt></a> template class to store the 2D
arrays of texel values, rather than a standard C++ array.  The
<a href="../Utilities/Memory_Management.html#BlockedArray"><tt>BlockedArray</tt></a> reorders the array values in memory in a way that
improves cache coherence when the values are accessed with these kinds of
rectangular patterns; it is described in Section&nbsp;<a href="../Utilities/Memory_Management.html#sec:blocked-array">A.4.4</a> in
Appendix&nbsp;A.

</p>
<p></p>
<span class="anchor" id="fragment-InitializelevelsofMIPMapfromimage-0"></span><div class="fragmentname">&lt;&lt;Initialize levels of MIPMap from image&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">int nLevels = 1 + <a href="../Utilities/Main_Include_File.html#Log2Int" class="code">Log2Int</a>(std::max(<a href="#MIPMap::resolution" class="code">resolution</a>[0], <a href="#MIPMap::resolution" class="code">resolution</a>[1]));
<a href="#MIPMap::pyramid" class="code">pyramid</a>.resize(nLevels);
&lt;&lt;<span class="fragmentname"><a href="#fragment-InitializemostdetailedlevelofMIPMap-0">Initialize most detailed level of MIPMap</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1056" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1056"><i></i></a><div id="fragbit-1056" class="collapse"><div class="fragmentcode">   <a href="#MIPMap::pyramid" class="code">pyramid</a>[0].reset(new BlockedArray&lt;T&gt;(resolution[0], resolution[1],
       resampledImage ? resampledImage.get() : img));</div></div>
for (int i = 1; i &lt; nLevels; ++i) {
    &lt;&lt;<span class="fragmentname"><a href="#fragment-InitializeithMIPMaplevelfromi-1stlevel-0">Initialize <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.802ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 345.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">i</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D456" x="0" y="0"></use>
</g>
</svg>th MIPMap level from <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.805ex" height="2.343ex" style="vertical-align: -0.505ex;" viewBox="0 -791.3 2068.9 1008.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">i minus 1</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D456" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="567" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1568" y="0"></use>
</g>
</svg>st level</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1057" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1057"><i></i></a><div id="fragbit-1057" class="collapse"><div class="fragmentcode">       int sRes = std::max(1, <a href="#MIPMap::pyramid" class="code">pyramid</a>[i - 1]-&gt;<a href="../Utilities/Memory_Management.html#BlockedArray::uSize" class="code">uSize</a>() / 2);
       int tRes = std::max(1, <a href="#MIPMap::pyramid" class="code">pyramid</a>[i - 1]-&gt;<a href="../Utilities/Memory_Management.html#BlockedArray::vSize" class="code">vSize</a>() / 2);
       <a href="#MIPMap::pyramid" class="code">pyramid</a>[i].reset(new BlockedArray&lt;T&gt;(sRes, tRes));
       &lt;&lt;<span class="fragmentname"><a href="#fragment-Filterfourtexelsfromfinerlevelofpyramid-0">Filter four texels from finer level of pyramid</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1058" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1058"><i></i></a><div id="fragbit-1058" class="collapse"><div class="fragmentcode">          <a href="../Utilities/Parallelism.html#ParallelFor" class="code">ParallelFor</a>(
              [&amp;](int t) {
                  for (int s = 0; s &lt; sRes; ++s)
                      (*<a href="#MIPMap::pyramid" class="code">pyramid</a>[i])(s, t) = .25f *
                         (<a href="#MIPMap::Texel" class="code">Texel</a>(i-1, 2*s, 2*t)   + <a href="#MIPMap::Texel" class="code">Texel</a>(i-1, 2*s+1, 2*t) + 
                          <a href="#MIPMap::Texel" class="code">Texel</a>(i-1, 2*s, 2*t+1) + <a href="#MIPMap::Texel" class="code">Texel</a>(i-1, 2*s+1, 2*t+1));
              }, tRes, 16);</div></div></div></div>
}</div><p>


</p>
<p></p>
<span class="anchor" id="fragment-MIPMapPrivateData-1"></span><div class="fragmentname">&lt;&lt;MIPMap Private Data&gt;&gt;+=&nbsp;<a href="#fragment-MIPMapPrivateData-0"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MIPMapPrivateData-2"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">std::vector&lt;std::unique_ptr&lt;BlockedArray&lt;T&gt;&gt;&gt; <span class="anchor" id="MIPMap::pyramid"></span>pyramid;</div><p>


</p>
<p></p>
<span class="anchor" id="fragment-MIPMapPublicMethods-0"></span><div class="fragmentname">&lt;&lt;MIPMap Public Methods&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">int <span class="anchor" id="MIPMap::Width"></span>Width() const { return resolution[0]; }
int <span class="anchor" id="MIPMap::Height"></span>Height() const { return resolution[1]; }
int <span class="anchor" id="MIPMap::Levels"></span>Levels() const { return <a href="#MIPMap::pyramid" class="code">pyramid</a>.size(); }</div><p>


</p>
<p>

</p>
<p>The base level of the MIP map, which holds the original data (or the
resampled data, if it didn&rsquo;t originally have power-of-two resolutions), is
initialized by the default <a href="../Utilities/Memory_Management.html#BlockedArray"><tt>BlockedArray</tt></a> constructor.

</p>
<p></p>
<span class="anchor" id="fragment-InitializemostdetailedlevelofMIPMap-0"></span><div class="fragmentname">&lt;&lt;Initialize most detailed level of MIPMap&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="#MIPMap::pyramid" class="code">pyramid</a>[0].reset(new BlockedArray&lt;T&gt;(resolution[0], resolution[1],
    resampledImage ? resampledImage.get() : img));</div><p>


</p>
<p>Before showing how the rest of the levels are initialized, we will first
define a texel access function that will be used during that process.
<a href="#MIPMap::Texel"><tt>MIPMap::Texel()</tt></a> returns a reference to the texel value for the given
discrete integer-valued texel position.  As described earlier, if an
out-of-range texel coordinate is passed in, then based on the value of <tt>wrapMode</tt>,
this method effectively
repeats the texture over the entire 2D texture coordinate domain by taking
the modulus of the coordinate with respect

to the texture size, clamps the
coordinates to the valid range so that the border pixels are used, or
returns a black texel for out-of-bounds coordinates.

</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-MIPMapMethodDefinitions-1"></span><div class="fragmentname">&lt;&lt;MIPMap Method Definitions&gt;&gt;+=&nbsp;<a href="#fragment-MIPMapMethodDefinitions-0"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MIPMapMethodDefinitions-2"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;typename T&gt;
const T &amp;<a href="#MIPMap" class="code">MIPMap</a>&lt;T&gt;::<span class="anchor" id="MIPMap::Texel"></span>Texel(int level, int s, int t) const {
    const BlockedArray&lt;T&gt; &amp;l = *pyramid[level];
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Computetexelstaccountingforboundaryconditions-0">Compute texel <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.773ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2055.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1665" y="0"></use>
</g>
</svg> accounting for boundary conditions</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1059" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1059"><i></i></a><div id="fragbit-1059" class="collapse"><div class="fragmentcode">       switch (wrapMode) {
           case ImageWrap::Repeat:
               s = <a href="../Utilities/Main_Include_File.html#Mod" class="code">Mod</a>(s, l.<a href="../Utilities/Memory_Management.html#BlockedArray::uSize" class="code">uSize</a>());
               t = <a href="../Utilities/Main_Include_File.html#Mod" class="code">Mod</a>(t, l.<a href="../Utilities/Memory_Management.html#BlockedArray::vSize" class="code">vSize</a>());
               break;
           case ImageWrap::<a href="../Utilities/Main_Include_File.html#Clamp" class="code">Clamp</a>:
               s = <a href="../Utilities/Main_Include_File.html#Clamp" class="code">Clamp</a>(s, 0, l.<a href="../Utilities/Memory_Management.html#BlockedArray::uSize" class="code">uSize</a>() - 1);
               t = <a href="../Utilities/Main_Include_File.html#Clamp" class="code">Clamp</a>(t, 0, l.<a href="../Utilities/Memory_Management.html#BlockedArray::vSize" class="code">vSize</a>() - 1);
               break;
           case ImageWrap::Black: {
               static const T black = 0.f;
               if (s &lt; 0 || s &gt;= (int)l.<a href="../Utilities/Memory_Management.html#BlockedArray::uSize" class="code">uSize</a>() || 
                   t &lt; 0 || t &gt;= (int)l.<a href="../Utilities/Memory_Management.html#BlockedArray::vSize" class="code">vSize</a>())
                   return black;
               break;
           }
       }</div></div>
    return l(s, t);
}</div><p>


</p>
<p></p>
<span class="anchor" id="fragment-Computetexelstaccountingforboundaryconditions-0"></span><div class="fragmentname">&lt;&lt;Compute texel <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.773ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2055.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1665" y="0"></use>
</g>
</svg> accounting for boundary conditions&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">switch (wrapMode) {
    case ImageWrap::Repeat:
        s = <a href="../Utilities/Main_Include_File.html#Mod" class="code">Mod</a>(s, l.<a href="../Utilities/Memory_Management.html#BlockedArray::uSize" class="code">uSize</a>());
        t = <a href="../Utilities/Main_Include_File.html#Mod" class="code">Mod</a>(t, l.<a href="../Utilities/Memory_Management.html#BlockedArray::vSize" class="code">vSize</a>());
        break;
    case ImageWrap::<a href="../Utilities/Main_Include_File.html#Clamp" class="code">Clamp</a>:
        s = <a href="../Utilities/Main_Include_File.html#Clamp" class="code">Clamp</a>(s, 0, l.<a href="../Utilities/Memory_Management.html#BlockedArray::uSize" class="code">uSize</a>() - 1);
        t = <a href="../Utilities/Main_Include_File.html#Clamp" class="code">Clamp</a>(t, 0, l.<a href="../Utilities/Memory_Management.html#BlockedArray::vSize" class="code">vSize</a>() - 1);
        break;
    case ImageWrap::Black: {
        static const T black = 0.f;
        if (s &lt; 0 || s &gt;= (int)l.<a href="../Utilities/Memory_Management.html#BlockedArray::uSize" class="code">uSize</a>() || 
            t &lt; 0 || t &gt;= (int)l.<a href="../Utilities/Memory_Management.html#BlockedArray::vSize" class="code">vSize</a>())
            return black;
        break;
    }
}</div><p>


</p>
<p>For non-square images, the resolution in one direction must be clamped to
one for the upper levels of the image pyramid, where there is still
downsampling to do in the larger of the two resolutions.  This is handled
by the following <tt>std::max()</tt> calls:

</p>
<p></p>
<span class="anchor" id="fragment-InitializeithMIPMaplevelfromi-1stlevel-0"></span><div class="fragmentname">&lt;&lt;Initialize <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.802ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 345.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">i</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D456" x="0" y="0"></use>
</g>
</svg>th MIPMap level from <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.805ex" height="2.343ex" style="vertical-align: -0.505ex;" viewBox="0 -791.3 2068.9 1008.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">i minus 1</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D456" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="567" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1568" y="0"></use>
</g>
</svg>st level&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">int sRes = std::max(1, <a href="#MIPMap::pyramid" class="code">pyramid</a>[i - 1]-&gt;<a href="../Utilities/Memory_Management.html#BlockedArray::uSize" class="code">uSize</a>() / 2);
int tRes = std::max(1, <a href="#MIPMap::pyramid" class="code">pyramid</a>[i - 1]-&gt;<a href="../Utilities/Memory_Management.html#BlockedArray::vSize" class="code">vSize</a>() / 2);
<a href="#MIPMap::pyramid" class="code">pyramid</a>[i].reset(new BlockedArray&lt;T&gt;(sRes, tRes));
&lt;&lt;<span class="fragmentname"><a href="#fragment-Filterfourtexelsfromfinerlevelofpyramid-0">Filter four texels from finer level of pyramid</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1060" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1060"><i></i></a><div id="fragbit-1060" class="collapse"><div class="fragmentcode">   <a href="../Utilities/Parallelism.html#ParallelFor" class="code">ParallelFor</a>(
       [&amp;](int t) {
           for (int s = 0; s &lt; sRes; ++s)
               (*<a href="#MIPMap::pyramid" class="code">pyramid</a>[i])(s, t) = .25f *
                  (<a href="#MIPMap::Texel" class="code">Texel</a>(i-1, 2*s, 2*t)   + <a href="#MIPMap::Texel" class="code">Texel</a>(i-1, 2*s+1, 2*t) + 
                   <a href="#MIPMap::Texel" class="code">Texel</a>(i-1, 2*s, 2*t+1) + <a href="#MIPMap::Texel" class="code">Texel</a>(i-1, 2*s+1, 2*t+1));
       }, tRes, 16);</div></div></div><p>


</p>
<p>The <a href="#MIPMap"><tt>MIPMap</tt></a> uses a simple box filter to average four texels from the
previous level to find the value at the current texel.  Using the Lanczos
filter here would give a slightly better result for this computation,
although this modification is left for Exercise&nbsp;10.4 at the end of the
chapter.  As with resampling to power-of-two resolutions, doing this
downfiltering using multiple threads rather than with a regular <tt>for</tt>
loop is worthwhile here.

</p>
<p></p>
<span class="anchor" id="fragment-Filterfourtexelsfromfinerlevelofpyramid-0"></span><div class="fragmentname">&lt;&lt;Filter four texels from finer level of pyramid&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Utilities/Parallelism.html#ParallelFor" class="code">ParallelFor</a>(
    [&amp;](int t) {
        for (int s = 0; s &lt; sRes; ++s)
            (*<a href="#MIPMap::pyramid" class="code">pyramid</a>[i])(s, t) = .25f *
               (<a href="#MIPMap::Texel" class="code">Texel</a>(i-1, 2*s, 2*t)   + <a href="#MIPMap::Texel" class="code">Texel</a>(i-1, 2*s+1, 2*t) + 
                <a href="#MIPMap::Texel" class="code">Texel</a>(i-1, 2*s, 2*t+1) + <a href="#MIPMap::Texel" class="code">Texel</a>(i-1, 2*s+1, 2*t+1));
    }, tRes, 16);</div><p>


</p>
<p>

</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#IsotropicTriangleFilter"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span id="IsotropicTriangleFilter"></span><h3>10.4.4  Isotropic Triangle Filter</h3><p>


</p>
<p>The first of the two <a href="#MIPMap::Lookup"><tt>MIPMap::Lookup()</tt></a> methods uses a triangle filter
over the texture samples to remove high frequencies.  Although this filter
function does not give high-quality results, it can be implemented very
efficiently.  In addition to the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.773ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2055.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1665" y="0"></use>
</g>
</svg> coordinates of the evaluation point,
the caller passes this method a filter width for the lookup, giving the extent of
the region of the texture to filter across.  This method filters over a square
region in texture space, so the width should be conservatively chosen to avoid
aliasing in both the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 469.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">s</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.84ex" height="2.009ex" style="vertical-align: -0.338ex;" viewBox="0 -719.6 361.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">t</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
</g>
</svg> directions.  Filtering techniques like this one
that do not support a filter extent that is non-square or non-axis-aligned are
known as <em>isotropic</em>.  The primary disadvantage of isotropic filtering
algorithms is that textures viewed at an oblique angle will appear
blurry, since the required sampling rate along one axis will be very
different from the sampling rate along the other in this case.

</p>
<p>

</p>
<p>Because filtering over many texels for wide filter widths would be
inefficient, this method chooses a MIP map level from the pyramid such that
the filter region at that level would cover four texels at that level.
Figure&nbsp;<a href="#fig:mipmap-trilerp">10.13</a> illustrates this idea.

</p>
<p>
 </p>
<span class="anchor" id="fig:mipmap-trilerp"></span><div class="card outerfigure"><div class="card-body figure"><p>



</p>
<div class="figure-row">
  <a href="Choosing%20MIP%20level.svg" title=""><img src="Choosing%20MIP%20level.svg" width=578 height=146 style="max-width: 100%;"></a>
</div>
<p>


</p>
<figcaption class="caption">Figure 10.13: Choosing a MIP Map Level for the Triangle
Filter. <span class="legend"> The <tt>MIPMap</tt> chooses a level such that the filter
covers four texels.</span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p></p>
<span class="anchor" id="fragment-MIPMapMethodDefinitions-2"></span><div class="fragmentname">&lt;&lt;MIPMap Method Definitions&gt;&gt;+=&nbsp;<a href="#fragment-MIPMapMethodDefinitions-1"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MIPMapMethodDefinitions-3"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;typename T&gt;
T <a href="#MIPMap" class="code">MIPMap</a>&lt;T&gt;::<span class="anchor" id="MIPMap::Lookuptri"></span>Lookup(const <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> &amp;st, Float width) const {
    &lt;&lt;<span class="fragmentname"><a href="#fragment-ComputeMIPMaplevelfortrilinearfiltering-0">Compute MIPMap level for trilinear filtering</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1061" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1061"><i></i></a><div id="fragbit-1061" class="collapse"><div class="fragmentcode">       Float level = <a href="#MIPMap::Levels" class="code">Levels</a>() - 1 + <a href="../Utilities/Main_Include_File.html#Log2" class="code">Log2</a>(std::max(width, (Float)1e-8));</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-PerformtrilinearinterpolationatappropriateMIPMaplevel-0">Perform trilinear interpolation at appropriate MIPMap level</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1062" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1062"><i></i></a><div id="fragbit-1062" class="collapse"><div class="fragmentcode">       if (level &lt; 0)
           return <a href="#MIPMap::triangle" class="code">triangle</a>(0, st);
       else if (level &gt;= <a href="#MIPMap::Levels" class="code">Levels</a>() - 1)
           return <a href="#MIPMap::Texel" class="code">Texel</a>(<a href="#MIPMap::Levels" class="code">Levels</a>() - 1, 0, 0);
       else {
           int iLevel = std::floor(level);
           Float delta = level - iLevel;
           return <a href="../Utilities/Mathematical_Routines.html#Lerp" class="code">Lerp</a>(delta, <a href="#MIPMap::triangle" class="code">triangle</a>(iLevel, st), <a href="#MIPMap::triangle" class="code">triangle</a>(iLevel + 1, st));
       }</div></div>
}</div><p>


</p>
<p>Since the resolutions of the levels of the pyramid are all powers of two, the
resolution of level <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.693ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 298.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">l</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D459" d="M258 683l-144 -578c-5 -19 -6 -24 -6 -48c0 -14 0 -46 30 -46c40 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -12 -60 -30 -98c-17 -36 -42 -56 -75 -56c-47 0 -91 35 -91 92c0 16 2 23 5 34l126 500l3 20c0 8 -1 17 -49 17c-15 0 -25 0 -25 11 c0 19 11 20 19 21c26 2 99 10 122 10c13 0 13 -11 13 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D459" x="0" y="0"></use>
</g>
</svg> is <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.639ex" height="2.676ex" style="vertical-align: -0.338ex;" viewBox="0 -1006.6 4580.5 1152.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">2 Superscript normal n normal upper L normal e normal v normal e normal l normal s minus 1 minus l</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6E" d="M535 0l-112 3l-113 -3v31c67 0 78 0 78 45v233c0 57 -11 111 -74 111c-64 0 -135 -56 -135 -160v-184c0 -45 11 -45 78 -45v-31l-112 3l-113 -3v31c67 0 78 0 78 45v268c0 49 -8 56 -78 56v31l141 11v-105c28 62 75 105 148 105c58 0 91 -20 105 -37 c31 -36 31 -67 31 -153v-191c1 -30 26 -30 78 -30v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-4C" d="M582 258l-28 -258h-521v31h24c77 0 79 11 79 47v527c0 36 -2 47 -79 47h-24v31c35 -3 113 -3 152 -3c41 0 132 0 168 3v-31h-33c-95 0 -95 -14 -95 -48v-533c0 -33 2 -40 49 -40h82c176 0 190 125 201 227h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-65" d="M415 119c0 -19 -45 -130 -167 -130c-115 0 -220 97 -220 231c0 125 92 228 208 228c125 0 179 -97 179 -196c0 -21 -3 -21 -25 -21h-279c0 -36 0 -102 30 -150c23 -37 63 -67 113 -67c10 0 100 0 135 103c2 8 4 14 13 14c5 0 13 -2 13 -12zM349 252 c0 39 -10 174 -113 174c-34 0 -118 -25 -124 -174h237Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-76" d="M508 400c-66 -1 -83 -44 -92 -67l-131 -325c-4 -10 -8 -19 -21 -19s-15 5 -21 19l-144 355c-13 31 -17 37 -80 37v31c30 -2 70 -3 97 -3l109 3v-31c-18 0 -57 0 -57 -26c0 0 0 -4 6 -17l112 -279l102 255c4 11 6 15 6 24c0 19 -11 42 -48 43v31l87 -3c23 0 52 1 75 3v-31 Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6C" d="M255 0l-111 3l-111 -3v31c67 0 78 0 78 45v520c0 49 -8 56 -78 56v31l144 11v-618c0 -45 11 -45 78 -45v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-73" d="M360 128c0 -72 -46 -139 -161 -139c-21 0 -66 1 -110 43c-18 -19 -18 -21 -20 -23c-19 -19 -20 -20 -25 -20c-11 0 -11 7 -11 24v132c0 18 0 25 13 25c10 0 11 -4 14 -17c19 -85 55 -142 139 -142c78 0 113 40 113 91c0 72 -82 88 -104 92c-72 14 -100 20 -132 46 c-27 22 -43 50 -43 85c0 56 38 123 160 123c15 0 56 0 94 -28c4 3 14 12 17 16c13 12 15 12 20 12c11 0 11 -7 11 -24v-101c0 -19 0 -24 -13 -24c0 0 -11 0 -12 9c-2 31 -7 121 -117 121c-86 0 -112 -41 -112 -76c0 -58 67 -71 123 -82c42 -8 81 -16 114 -48 c12 -12 42 -42 42 -95Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D459" d="M258 683l-144 -578c-5 -19 -6 -24 -6 -48c0 -14 0 -46 30 -46c40 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -12 -60 -30 -98c-17 -36 -42 -56 -75 -56c-47 0 -91 35 -91 92c0 16 2 23 5 34l126 500l3 20c0 8 -1 17 -49 17c-15 0 -25 0 -25 11 c0 19 11 20 19 21c26 2 99 10 122 10c13 0 13 -11 13 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
<g transform="translate(500,393)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6E" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-4C" x="556" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-65" x="1182" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-76" x="1626" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-65" x="2155" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6C" x="2599" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-73" x="2878" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2212" x="3272" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="4051" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2212" x="4551" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D459" x="5330" y="0"></use>
</g>
</g>
</svg>.  Therefore, to find the
level with a texel spacing width <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.664ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 716.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">w</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D464" d="M691 372c0 -48 -32 -182 -66 -260c-26 -60 -70 -123 -145 -123c-30 0 -99 6 -125 70c-40 -70 -87 -70 -104 -70c-75 0 -142 35 -142 126c0 38 12 84 56 202c7 17 18 45 18 70c0 32 -16 33 -25 33c-35 0 -74 -31 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c49 0 82 -37 82 -82c0 -20 -6 -34 -17 -64c-47 -123 -52 -162 -52 -194c0 -17 0 -91 80 -91c39 0 69 31 92 84c-1 5 -1 7 -1 18c0 18 2 36 9 66c7 26 54 217 57 224c7 20 25 28 37 28c15 0 29 -9 29 -27c0 -6 -10 -43 -15 -65l-42 -168 c-4 -14 -11 -45 -11 -73c0 -57 27 -87 74 -87c49 0 84 35 110 88c26 51 55 149 55 183c0 48 -25 74 -36 85c-9 8 -15 14 -15 27c0 22 25 48 50 48c17 0 44 -15 44 -70Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D464" x="0" y="0"></use>
</g>
</svg> requires solving
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="16.237ex" height="5.176ex" style="vertical-align: -1.838ex;" viewBox="0 -1437.2 6991 2228.5" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">StartFraction 1 Over w EndFraction equals 2 Superscript normal n normal upper L normal e normal v normal e normal l normal s minus 1 minus l</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D464" d="M691 372c0 -48 -32 -182 -66 -260c-26 -60 -70 -123 -145 -123c-30 0 -99 6 -125 70c-40 -70 -87 -70 -104 -70c-75 0 -142 35 -142 126c0 38 12 84 56 202c7 17 18 45 18 70c0 32 -16 33 -25 33c-35 0 -74 -31 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c49 0 82 -37 82 -82c0 -20 -6 -34 -17 -64c-47 -123 -52 -162 -52 -194c0 -17 0 -91 80 -91c39 0 69 31 92 84c-1 5 -1 7 -1 18c0 18 2 36 9 66c7 26 54 217 57 224c7 20 25 28 37 28c15 0 29 -9 29 -27c0 -6 -10 -43 -15 -65l-42 -168 c-4 -14 -11 -45 -11 -73c0 -57 27 -87 74 -87c49 0 84 35 110 88c26 51 55 149 55 183c0 48 -25 74 -36 85c-9 8 -15 14 -15 27c0 22 25 48 50 48c17 0 44 -15 44 -70Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6E" d="M535 0l-112 3l-113 -3v31c67 0 78 0 78 45v233c0 57 -11 111 -74 111c-64 0 -135 -56 -135 -160v-184c0 -45 11 -45 78 -45v-31l-112 3l-113 -3v31c67 0 78 0 78 45v268c0 49 -8 56 -78 56v31l141 11v-105c28 62 75 105 148 105c58 0 91 -20 105 -37 c31 -36 31 -67 31 -153v-191c1 -30 26 -30 78 -30v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-4C" d="M582 258l-28 -258h-521v31h24c77 0 79 11 79 47v527c0 36 -2 47 -79 47h-24v31c35 -3 113 -3 152 -3c41 0 132 0 168 3v-31h-33c-95 0 -95 -14 -95 -48v-533c0 -33 2 -40 49 -40h82c176 0 190 125 201 227h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-65" d="M415 119c0 -19 -45 -130 -167 -130c-115 0 -220 97 -220 231c0 125 92 228 208 228c125 0 179 -97 179 -196c0 -21 -3 -21 -25 -21h-279c0 -36 0 -102 30 -150c23 -37 63 -67 113 -67c10 0 100 0 135 103c2 8 4 14 13 14c5 0 13 -2 13 -12zM349 252 c0 39 -10 174 -113 174c-34 0 -118 -25 -124 -174h237Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-76" d="M508 400c-66 -1 -83 -44 -92 -67l-131 -325c-4 -10 -8 -19 -21 -19s-15 5 -21 19l-144 355c-13 31 -17 37 -80 37v31c30 -2 70 -3 97 -3l109 3v-31c-18 0 -57 0 -57 -26c0 0 0 -4 6 -17l112 -279l102 255c4 11 6 15 6 24c0 19 -11 42 -48 43v31l87 -3c23 0 52 1 75 3v-31 Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6C" d="M255 0l-111 3l-111 -3v31c67 0 78 0 78 45v520c0 49 -8 56 -78 56v31l144 11v-618c0 -45 11 -45 78 -45v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-73" d="M360 128c0 -72 -46 -139 -161 -139c-21 0 -66 1 -110 43c-18 -19 -18 -21 -20 -23c-19 -19 -20 -20 -25 -20c-11 0 -11 7 -11 24v132c0 18 0 25 13 25c10 0 11 -4 14 -17c19 -85 55 -142 139 -142c78 0 113 40 113 91c0 72 -82 88 -104 92c-72 14 -100 20 -132 46 c-27 22 -43 50 -43 85c0 56 38 123 160 123c15 0 56 0 94 -28c4 3 14 12 17 16c13 12 15 12 20 12c11 0 11 -7 11 -24v-101c0 -19 0 -24 -13 -24c0 0 -11 0 -12 9c-2 31 -7 121 -117 121c-86 0 -112 -41 -112 -76c0 -58 67 -71 123 -82c42 -8 81 -16 114 -48 c12 -12 42 -42 42 -95Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D459" d="M258 683l-144 -578c-5 -19 -6 -24 -6 -48c0 -14 0 -46 30 -46c40 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -12 -60 -30 -98c-17 -36 -42 -56 -75 -56c-47 0 -91 35 -91 92c0 16 2 23 5 34l126 500l3 20c0 8 -1 17 -49 17c-15 0 -25 0 -25 11 c0 19 11 20 19 21c26 2 99 10 122 10c13 0 13 -11 13 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
<g transform="translate(120,0)">
<rect stroke="none" width="836" height="60" x="0" y="220"></rect>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="168" y="676"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D464" x="60" y="-686"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="1354" y="0"></use>
<g transform="translate(2410,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
<g transform="translate(500,412)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6E" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-4C" x="556" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-65" x="1182" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-76" x="1626" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-65" x="2155" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6C" x="2599" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-73" x="2878" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2212" x="3272" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="4051" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2212" x="4551" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D459" x="5330" y="0"></use>
</g>
</g>
</g>
</svg>
</div>
<p>

for <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.693ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 298.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">l</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D459" d="M258 683l-144 -578c-5 -19 -6 -24 -6 -48c0 -14 0 -46 30 -46c40 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -12 -60 -30 -98c-17 -36 -42 -56 -75 -56c-47 0 -91 35 -91 92c0 16 2 23 5 34l126 500l3 20c0 8 -1 17 -49 17c-15 0 -25 0 -25 11 c0 19 11 20 19 21c26 2 99 10 122 10c13 0 13 -11 13 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D459" x="0" y="0"></use>
</g>
</svg>.  In general, this will be a floating-point value between two MIP
map levels.

</p>
<p></p>
<span class="anchor" id="fragment-ComputeMIPMaplevelfortrilinearfiltering-0"></span><div class="fragmentname">&lt;&lt;Compute MIPMap level for trilinear filtering&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Float level = <a href="#MIPMap::Levels" class="code">Levels</a>() - 1 + <a href="../Utilities/Main_Include_File.html#Log2" class="code">Log2</a>(std::max(width, (Float)1e-8));</div><p>


</p>
<p>As shown by Figure&nbsp;<a href="#fig:mipmap-trilerp">10.13</a>, applying a triangle filter to
the four texels around the sample point will either filter over too small a
region or too large a region (except for very carefully selected filter
widths).  The implementation here applies the triangle filter at both of
these levels and blends between them according to how close <tt>level</tt> is
to each of them.  This helps hide the transitions from one MIP map level to
the next at nearby pixels in the final image.  While applying a triangle
filter to four texels at two levels in this manner doesn&rsquo;t give exactly the
same result as applying it to the original highest resolution texels, the
difference isn&rsquo;t too bad in practice, and the efficiency of this approach
is worth this penalty.  In any case, the elliptically weighted average
filtering in the next section should be used when texture quality is
important.

</p>
<p></p>
<span class="anchor" id="fragment-PerformtrilinearinterpolationatappropriateMIPMaplevel-0"></span><div class="fragmentname">&lt;&lt;Perform trilinear interpolation at appropriate MIPMap level&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">if (level &lt; 0)
    return <a href="#MIPMap::triangle" class="code">triangle</a>(0, st);
else if (level &gt;= <a href="#MIPMap::Levels" class="code">Levels</a>() - 1)
    return <a href="#MIPMap::Texel" class="code">Texel</a>(<a href="#MIPMap::Levels" class="code">Levels</a>() - 1, 0, 0);
else {
    int iLevel = std::floor(level);
    Float delta = level - iLevel;
    return <a href="../Utilities/Mathematical_Routines.html#Lerp" class="code">Lerp</a>(delta, <a href="#MIPMap::triangle" class="code">triangle</a>(iLevel, st), <a href="#MIPMap::triangle" class="code">triangle</a>(iLevel + 1, st));
}</div><p>


</p>
<p>


</p>
<p>Given floating-point texture coordinates in <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.707ex" height="3.009ex" style="vertical-align: -0.838ex;" viewBox="0 -934.9 2457.1 1295.7" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket 0 comma 1 right-bracket squared</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="779" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1224" y="0"></use>
<g transform="translate(1724,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="393" y="513"></use>
</g>
</g>
</svg>, the
<a href="#MIPMap::triangle"><tt>MIPMap::triangle()</tt></a> routine uses a triangle filter to interpolate
between the four texels that surround the sample point, as shown in
Figure&nbsp;<a href="#fig:texture-bilerp">10.14</a>.  This method first scales the coordinates
by the texture resolution at the given MIP map level in each direction,
turning them into continuous texel coordinates.  Because these are
continuous coordinates, but the texels in the image map are defined at
discrete texture coordinates, it&rsquo;s important to carefully convert into a
common representation.  Here, we will do all of our work in discrete
coordinates, mapping the continuous texture coordinates to discrete space.

</p>
<p></p>
<span class="anchor" id="fig:texture-bilerp"></span><div class="card outerfigure"><div class="card-body figure"><p>



</p>
<div class="figure-row">
  <a href="Triangle%20two%20lerps.svg" title=""><img src="Triangle%20two%20lerps.svg" width=475 height=361 style="max-width: 100%;"></a>
</div>
<p>


</p>
<figcaption class="caption">Figure 10.14: <span class="legend"> To compute the value of the image
texture function at an arbitrary <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.773ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2055.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1665" y="0"></use>
</g>
</svg> position, <a href="#MIPMap::triangle"><tt>MIPMap::triangle()</tt></a>
finds the four texels around <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.773ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2055.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1665" y="0"></use>
</g>
</svg> and weights them according to a
triangle filter based on their distance to <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.773ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2055.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1665" y="0"></use>
</g>
</svg>.  One way to implement
this is as a series of linear interpolations, as shown here: First, the two
texels below <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.773ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2055.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1665" y="0"></use>
</g>
</svg> are linearly interpolated to find a value at <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.096ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2194.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma 0 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1804" y="0"></use>
</g>
</svg>,
and the two texels above it are interpolated to find <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.096ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2194.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma 1 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1804" y="0"></use>
</g>
</svg>.  Then,
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.096ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2194.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma 0 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1804" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.096ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2194.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma 1 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1804" y="0"></use>
</g>
</svg> are linearly interpolated again to find the value at
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.773ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2055.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1665" y="0"></use>
</g>
</svg>.</span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p>For example, consider the 1D case with a continuous texture coordinate of
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.972ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 1279.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">2.4</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-34" d="M471 165h-100v-87c0 -36 2 -47 76 -47h21v-31c-41 3 -94 3 -136 3s-94 0 -135 -3v31h21c74 0 76 11 76 47v87h-266v31l307 469c8 12 11 12 20 12c16 0 16 -6 16 -26v-455h100v-31zM300 196v373l-244 -373h244Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-32"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="500" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-34" x="779" y="0"></use>
</g>
</svg>: this coordinate is a distance of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.972ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 1279.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">0.1</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-30"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="500" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="779" y="0"></use>
</g>
</svg> below the discrete texel
coordinate&nbsp;<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.162ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 500.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">2</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
</g>
</svg> (which corresponds to a continuous coordinate of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.972ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 1279.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">2.5</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-35" d="M449 201c0 -127 -102 -223 -218 -223c-112 0 -181 97 -181 183c0 46 35 53 49 53c33 0 50 -25 50 -49s-17 -49 -50 -49c-11 0 -14 1 -17 2c17 -59 74 -112 147 -112c46 0 83 26 107 65c24 42 24 102 24 137c0 50 -2 89 -18 126c-8 18 -33 64 -85 64 c-81 0 -118 -54 -129 -70c-4 -6 -6 -9 -13 -9c-14 0 -14 8 -14 26v296c0 16 0 24 10 24c0 0 4 0 12 -3c47 -21 93 -28 133 -28c67 0 116 20 136 29c5 3 8 3 8 3c7 0 10 -5 10 -11c0 -13 -70 -104 -193 -104c-32 0 -65 7 -85 13v-195c36 35 79 51 127 51 c108 0 190 -100 190 -219Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-32"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="500" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-35" x="779" y="0"></use>
</g>
</svg>) and is
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.972ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 1279.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">0.9</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-39" d="M457 329c0 -215 -122 -351 -251 -351c-85 0 -139 41 -139 108c0 39 30 48 46 48c22 0 46 -15 46 -46c0 -17 -8 -46 -52 -46c27 -34 81 -36 98 -36c58 0 162 46 162 280v32c-23 -58 -64 -100 -125 -100c-112 0 -200 98 -200 223c0 75 23 117 64 162c43 45 92 63 147 63 c89 0 204 -68 204 -337zM365 421c0 46 -4 109 -16 141c-17 45 -50 79 -96 79c-35 0 -73 -13 -100 -63c-21 -37 -21 -84 -21 -138c0 -49 0 -99 18 -136c31 -63 77 -63 93 -63c88 0 122 97 122 180Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-30"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="500" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-39" x="779" y="0"></use>
</g>
</svg> above the discrete coordinate&nbsp;<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.162ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 500.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">1</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="0" y="0"></use>
</g>
</svg> (continuous coordinate <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.972ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 1279.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">1.5</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-35" d="M449 201c0 -127 -102 -223 -218 -223c-112 0 -181 97 -181 183c0 46 35 53 49 53c33 0 50 -25 50 -49s-17 -49 -50 -49c-11 0 -14 1 -17 2c17 -59 74 -112 147 -112c46 0 83 26 107 65c24 42 24 102 24 137c0 50 -2 89 -18 126c-8 18 -33 64 -85 64 c-81 0 -118 -54 -129 -70c-4 -6 -6 -9 -13 -9c-14 0 -14 8 -14 26v296c0 16 0 24 10 24c0 0 4 0 12 -3c47 -21 93 -28 133 -28c67 0 116 20 136 29c5 3 8 3 8 3c7 0 10 -5 10 -11c0 -13 -70 -104 -193 -104c-32 0 -65 7 -85 13v-195c36 35 79 51 127 51 c108 0 190 -100 190 -219Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-31"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="500" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-35" x="779" y="0"></use>
</g>
</svg>).  Thus,
if we subtract <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.972ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 1279.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">0.5</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-35" d="M449 201c0 -127 -102 -223 -218 -223c-112 0 -181 97 -181 183c0 46 35 53 49 53c33 0 50 -25 50 -49s-17 -49 -50 -49c-11 0 -14 1 -17 2c17 -59 74 -112 147 -112c46 0 83 26 107 65c24 42 24 102 24 137c0 50 -2 89 -18 126c-8 18 -33 64 -85 64 c-81 0 -118 -54 -129 -70c-4 -6 -6 -9 -13 -9c-14 0 -14 8 -14 26v296c0 16 0 24 10 24c0 0 4 0 12 -3c47 -21 93 -28 133 -28c67 0 116 20 136 29c5 3 8 3 8 3c7 0 10 -5 10 -11c0 -13 -70 -104 -193 -104c-32 0 -65 7 -85 13v-195c36 35 79 51 127 51 c108 0 190 -100 190 -219Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-30"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="500" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-35" x="779" y="0"></use>
</g>
</svg> from the continuous coordinate <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.972ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 1279.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">2.4</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-34" d="M471 165h-100v-87c0 -36 2 -47 76 -47h21v-31c-41 3 -94 3 -136 3s-94 0 -135 -3v31h21c74 0 76 11 76 47v87h-266v31l307 469c8 12 11 12 20 12c16 0 16 -6 16 -26v-455h100v-31zM300 196v373l-244 -373h244Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-32"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="500" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-34" x="779" y="0"></use>
</g>
</svg>, giving <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.972ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 1279.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">1.9</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-39" d="M457 329c0 -215 -122 -351 -251 -351c-85 0 -139 41 -139 108c0 39 30 48 46 48c22 0 46 -15 46 -46c0 -17 -8 -46 -52 -46c27 -34 81 -36 98 -36c58 0 162 46 162 280v32c-23 -58 -64 -100 -125 -100c-112 0 -200 98 -200 223c0 75 23 117 64 162c43 45 92 63 147 63 c89 0 204 -68 204 -337zM365 421c0 46 -4 109 -16 141c-17 45 -50 79 -96 79c-35 0 -73 -13 -100 -63c-21 -37 -21 -84 -21 -138c0 -49 0 -99 18 -136c31 -63 77 -63 93 -63c88 0 122 97 122 180Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-31"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="500" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-39" x="779" y="0"></use>
</g>
</svg>, we can
correctly compute the correct distances to the discrete coordinates&nbsp;<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.162ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 500.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">1</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="0" y="0"></use>
</g>
</svg> and&nbsp;<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.162ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 500.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">2</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
</g>
</svg>
by subtracting coordinates.

</p>
<p>
After computing the distances in <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 469.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">s</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.84ex" height="2.009ex" style="vertical-align: -0.338ex;" viewBox="0 -719.6 361.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">t</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
</g>
</svg> to the texel at the lower left of
the given coordinates, <tt>ds</tt> and <tt>dt</tt>, <a href="#MIPMap::triangle"><tt>MIPMap::triangle()</tt></a>
determines weights for the four texels and computes the filtered value.  Recall
that the triangle filter&nbsp;is
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="27.021ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 11634.1 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">f left-parenthesis x comma y right-parenthesis equals left-parenthesis 1 minus StartAbsoluteValue x EndAbsoluteValue right-parenthesis left-parenthesis 1 minus StartAbsoluteValue y EndAbsoluteValue right-parenthesis semicolon</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-7C" d="M159 -230c0 -11 -9 -20 -20 -20s-20 9 -20 20v960c0 11 9 20 20 20s20 -9 20 -20v-960Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3B" d="M192 378c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53zM195 3c0 -116 -72 -196 -83 -196c-5 0 -10 4 -10 11c0 3 0 5 7 13c64 74 64 152 64 180c-8 -7 -19 -9 -26 -10c0 0 -3 -1 -8 -1c-36 0 -53 27 -53 53s18 53 53 53c54 0 56 -74 56 -103Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="552" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="942" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1514" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="1959" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2450" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="3117" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="4173" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="4563" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="5285" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-7C" x="6286" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="6565" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-7C" x="7137" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="7416" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="7805" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="8195" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="8917" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-7C" x="9918" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="10197" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-7C" x="10687" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="10966" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3B" x="11355" y="0"></use>
</g>
</svg>
</div>
<p>

the appropriate weights follow directly.  Notice the similarity between
this computation and <a href="../Texture/Texture_Interface_and_Basic_Textures.html#BilerpTexture::Evaluate"><tt>BilerpTexture::Evaluate()</tt></a>.

</p>
<p></p>
<span class="anchor" id="fragment-MIPMapMethodDefinitions-3"></span><div class="fragmentname">&lt;&lt;MIPMap Method Definitions&gt;&gt;+=&nbsp;<a href="#fragment-MIPMapMethodDefinitions-2"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MIPMapMethodDefinitions-4"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;typename T&gt;
T <a href="#MIPMap" class="code">MIPMap</a>&lt;T&gt;::<span class="anchor" id="MIPMap::triangle"></span>triangle(int level, const <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> &amp;st) const {
    level = <a href="../Utilities/Main_Include_File.html#Clamp" class="code">Clamp</a>(level, 0, <a href="#MIPMap::Levels" class="code">Levels</a>() - 1);
    Float s = st[0] * <a href="#MIPMap::pyramid" class="code">pyramid</a>[level]-&gt;<a href="../Utilities/Memory_Management.html#BlockedArray::uSize" class="code">uSize</a>() - 0.5f;
    Float t = st[1] * <a href="#MIPMap::pyramid" class="code">pyramid</a>[level]-&gt;<a href="../Utilities/Memory_Management.html#BlockedArray::vSize" class="code">vSize</a>() - 0.5f;
    int s0 = std::floor(s), t0 = std::floor(t);
    Float ds = s - s0, dt = t - t0;
    return (1 - ds) * (1 - dt) * <a href="#MIPMap::Texel" class="code">Texel</a>(level, s0,   t0) +
           (1 - ds) * dt       * <a href="#MIPMap::Texel" class="code">Texel</a>(level, s0,   t0+1) +
           ds       * (1 - dt) * <a href="#MIPMap::Texel" class="code">Texel</a>(level, s0+1, t0) +
           ds       * dt       * <a href="#MIPMap::Texel" class="code">Texel</a>(level, s0+1, t0+1);
}</div><p>


</p>
<p>

</p>
<p>
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#EllipticallyWeightedAverage"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:ewa"></span><span id="EllipticallyWeightedAverage"></span><h3>10.4.5  Elliptically Weighted Average<button data-toggle="tooltip" data-placement="right" class="btn difficult-button"
title="This section contains advanced content and may be skipped on a first reading.">
<i class="fas fa-exclamation-triangle midredtext"></i></button>
</h3><p>



</p>
<p>The elliptically weighted average (EWA) algorithm fits an ellipse to the
two axes in texture space given by the texture coordinate differentials and
then filters the texture with a Gaussian filter function
(Figure&nbsp;<a href="#fig:ewa-ellipse-axes">10.15</a>). It is widely
 regarded as one of the
best texture filtering algorithms in graphics and has been carefully
derived from the basic principles of sampling theory.  Unlike the triangle
filter in the previous section, it can filter over arbitrarily oriented
regions of the texture, with some flexibility of having different filter extents
in different directions.  This type of filter is known as
<em>anisotropic</em>.  This capability greatly improves the quality of its
results, since it can properly adapt to different sampling rates along the
two image axes.

</p>
<p></p>
<span class="anchor" id="fig:ewa-ellipse-axes"></span><div class="card outerfigure"><div class="card-body figure"><p>



</p>
<div class="figure-row">
  <a href="EWA%20ellipse.svg" title=""><img src="EWA%20ellipse.svg" width=239 height=216 style="max-width: 100%;"></a>
</div>
<p>


</p>
<figcaption class="caption">Figure 10.15: <span class="legend"> The EWA filter applies a Gaussian
filter to the texels in an elliptical area around the evaluation point.
The extent of the ellipse is such that its edge passes through the positions of
the adjacent texture samples as estimated by the texture coordinate partial
derivatives.</span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p>We won&rsquo;t show the full derivation of this filter here, although we do note that it is
distinguished by being a <em>unified resampling filter</em>: it simultaneously
computes the result of a Gaussian filtered texture function convolved with a
Gaussian reconstruction filter in image space.  This is in contrast to many
other texture filtering methods that ignore the effect of the image space
filter or equivalently assume that it is a box.  Even if a Gaussian isn&rsquo;t
being used for filtering the samples for the image being rendered, taking some
account of the spatial variation of the image filter improves the results,
assuming that the filter being used is somewhat similar in shape to the
Gaussian, as the Mitchell and windowed sinc filters are.

</p>
<p></p>
<span class="anchor" id="fragment-MIPMapMethodDefinitions-4"></span><div class="fragmentname">&lt;&lt;MIPMap Method Definitions&gt;&gt;+=&nbsp;<a href="#fragment-MIPMapMethodDefinitions-3"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MIPMapMethodDefinitions-5"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;typename T&gt; 
T <a href="#MIPMap" class="code">MIPMap</a>&lt;T&gt;::<span class="anchor" id="MIPMap::Lookup"></span>Lookup(const <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> &amp;st, <a href="../Geometry_and_Transformations/Vectors.html#Vector2f" class="code">Vector2f</a> dst0,
                    <a href="../Geometry_and_Transformations/Vectors.html#Vector2f" class="code">Vector2f</a> dst1) const {
    if (<a href="#MIPMap::doTrilinear" class="code">doTrilinear</a>) {
        Float width = std::max(std::max(std::abs(dst0[0]),
                                        std::abs(dst0[1])),
                               std::max(std::abs(dst1[0]),
                                        std::abs(dst1[1])));
        return Lookup(st, 2 * width);
    }
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Computeellipseminorandmajoraxes-0">Compute ellipse minor and major axes</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1063" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1063"><i></i></a><div id="fragbit-1063" class="collapse"><div class="fragmentcode">       if (dst0.LengthSquared() &lt; dst1.LengthSquared())
           std::swap(dst0, dst1);
       Float majorLength = dst0.Length();
       Float minorLength = dst1.Length();</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Clampellipseeccentricityiftoolarge-0">Clamp ellipse eccentricity if too large</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1064" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1064"><i></i></a><div id="fragbit-1064" class="collapse"><div class="fragmentcode">       if (minorLength * <a href="#MIPMap::maxAnisotropy" class="code">maxAnisotropy</a> &lt; majorLength &amp;&amp; minorLength &gt; 0) {
           Float scale = majorLength / (minorLength * <a href="#MIPMap::maxAnisotropy" class="code">maxAnisotropy</a>);
           dst1 *= scale;
           minorLength *= scale;
       }
       if (minorLength == 0)
           return <a href="#MIPMap::triangle" class="code">triangle</a>(0, st);</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-ChooselevelofdetailforEWAlookupandperformEWAfiltering-0">Choose level of detail for EWA lookup and perform EWA filtering</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1065" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1065"><i></i></a><div id="fragbit-1065" class="collapse"><div class="fragmentcode">       Float lod = std::max((Float)0, <a href="#MIPMap::Levels" class="code">Levels</a>() - (Float)1 + <a href="../Utilities/Main_Include_File.html#Log2" class="code">Log2</a>(minorLength));
       int ilod = std::floor(lod);
       return <a href="../Utilities/Mathematical_Routines.html#Lerp" class="code">Lerp</a>(lod - ilod, <a href="#MIPMap::EWA" class="code">EWA</a>(ilod, st, dst0, dst1),
                               <a href="#MIPMap::EWA" class="code">EWA</a>(ilod + 1, st, dst0, dst1));</div></div>
}</div><p>


</p>
<p>The screen space partial derivatives of the texture coordinates define the
axes of the ellipse.  The lookup method starts out by determining which of the
two axes is the major axis (the longer of the two) and which is the minor,
swapping them if needed so that <tt>dst0</tt> is the major axis.  The
length of the minor axis will be used shortly to select a MIP map level.

</p>
<p></p>
<span class="anchor" id="fragment-Computeellipseminorandmajoraxes-0"></span><div class="fragmentname">&lt;&lt;Compute ellipse minor and major axes&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">if (dst0.LengthSquared() &lt; dst1.LengthSquared())
    std::swap(dst0, dst1);
Float majorLength = dst0.Length();
Float minorLength = dst1.Length();</div><p>


</p>
<p>
Next the <em>eccentricity</em> of the ellipse is computed&mdash;the ratio of
the length of the major axis to the length of the minor axis.  A large
eccentricity indicates a very long and skinny ellipse.  Because this method
filters texels from a MIP map level chosen based on the length of the minor
axis, highly eccentric ellipses mean that a large number of texels need to be
filtered.  To avoid this expense (and to ensure that any EWA lookup takes a
bounded amount of time), the length of the minor axis may be increased to limit
the eccentricity.  The result may be an increase in blurring,
although this effect usually isn&rsquo;t noticeable in practice.

</p>
<p></p>
<span class="anchor" id="fragment-Clampellipseeccentricityiftoolarge-0"></span><div class="fragmentname">&lt;&lt;Clamp ellipse eccentricity if too large&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">if (minorLength * <a href="#MIPMap::maxAnisotropy" class="code">maxAnisotropy</a> &lt; majorLength &amp;&amp; minorLength &gt; 0) {
    Float scale = majorLength / (minorLength * <a href="#MIPMap::maxAnisotropy" class="code">maxAnisotropy</a>);
    dst1 *= scale;
    minorLength *= scale;
}
if (minorLength == 0)
    return <a href="#MIPMap::triangle" class="code">triangle</a>(0, st);</div><p>


</p>
<p>

</p>
<p>Like the triangle filter, the EWA filter uses the image pyramid to reduce
the number of texels to be filtered for a particular texture lookup, 
choosing a MIP map level based on the length of the minor axis.  Given the
limited eccentricity of the ellipse due to the clamping above, the total
number of texels used is thus bounded.  Given the length of the minor axis,
the computation to find the appropriate pyramid level is the same as was
used for the triangle filter.  Similarly, the implementation here blends
between the filtered results at the two levels around the computed level of
detail, again to reduce artifacts from transitions from one level to
another.

</p>
<p></p>
<span class="anchor" id="fragment-ChooselevelofdetailforEWAlookupandperformEWAfiltering-0"></span><div class="fragmentname">&lt;&lt;Choose level of detail for EWA lookup and perform EWA filtering&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Float lod = std::max((Float)0, <a href="#MIPMap::Levels" class="code">Levels</a>() - (Float)1 + <a href="../Utilities/Main_Include_File.html#Log2" class="code">Log2</a>(minorLength));
int ilod = std::floor(lod);
return <a href="../Utilities/Mathematical_Routines.html#Lerp" class="code">Lerp</a>(lod - ilod, <a href="#MIPMap::EWA" class="code">EWA</a>(ilod, st, dst0, dst1),
                        <a href="#MIPMap::EWA" class="code">EWA</a>(ilod + 1, st, dst0, dst1));</div><p>


</p>
<p>The <a href="#MIPMap::EWA"><tt>MIPMap::EWA()</tt></a> method actually applies the filter at a particular
level.

</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-MIPMapMethodDefinitions-5"></span><div class="fragmentname">&lt;&lt;MIPMap Method Definitions&gt;&gt;+=&nbsp;<a href="#fragment-MIPMapMethodDefinitions-4"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">template &lt;typename T&gt;
T <a href="#MIPMap" class="code">MIPMap</a>&lt;T&gt;::<span class="anchor" id="MIPMap::EWA"></span>EWA(int level, <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> st, <a href="../Geometry_and_Transformations/Vectors.html#Vector2f" class="code">Vector2f</a> dst0,
                 <a href="../Geometry_and_Transformations/Vectors.html#Vector2f" class="code">Vector2f</a> dst1) const {
    if (level &gt;= <a href="#MIPMap::Levels" class="code">Levels</a>()) return <a href="#MIPMap::Texel" class="code">Texel</a>(<a href="#MIPMap::Levels" class="code">Levels</a>() - 1, 0, 0);
    &lt;&lt;<span class="fragmentname"><a href="#fragment-ConvertEWAcoordinatestoappropriatescaleforlevel-0">Convert EWA coordinates to appropriate scale for level</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1066" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1066"><i></i></a><div id="fragbit-1066" class="collapse"><div class="fragmentcode">       st[0] = st[0] * <a href="#MIPMap::pyramid" class="code">pyramid</a>[level]-&gt;<a href="../Utilities/Memory_Management.html#BlockedArray::uSize" class="code">uSize</a>() - 0.5f;
       st[1] = st[1] * <a href="#MIPMap::pyramid" class="code">pyramid</a>[level]-&gt;<a href="../Utilities/Memory_Management.html#BlockedArray::vSize" class="code">vSize</a>() - 0.5f;
       dst0[0] *= <a href="#MIPMap::pyramid" class="code">pyramid</a>[level]-&gt;<a href="../Utilities/Memory_Management.html#BlockedArray::uSize" class="code">uSize</a>();
       dst0[1] *= <a href="#MIPMap::pyramid" class="code">pyramid</a>[level]-&gt;<a href="../Utilities/Memory_Management.html#BlockedArray::vSize" class="code">vSize</a>();
       dst1[0] *= <a href="#MIPMap::pyramid" class="code">pyramid</a>[level]-&gt;<a href="../Utilities/Memory_Management.html#BlockedArray::uSize" class="code">uSize</a>();
       dst1[1] *= <a href="#MIPMap::pyramid" class="code">pyramid</a>[level]-&gt;<a href="../Utilities/Memory_Management.html#BlockedArray::vSize" class="code">vSize</a>();</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-ComputeellipsecoefficientstoboundEWAfilterregion-0">Compute ellipse coefficients to bound EWA filter region</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1067" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1067"><i></i></a><div id="fragbit-1067" class="collapse"><div class="fragmentcode">       Float A = dst0[1] * dst0[1] + dst1[1] * dst1[1] + 1;
       Float B = -2 * (dst0[0] * dst0[1] + dst1[0] * dst1[1]);
       Float C = dst0[0] * dst0[0] + dst1[0] * dst1[0] + 1;
       Float invF = 1 / (A * C - B * B * 0.25f);
       A *= invF;
       B *= invF;
       C *= invF;</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Computetheellipsesstboundingboxintexturespace-0">Compute the ellipse&rsquo;s <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.773ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2055.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1665" y="0"></use>
</g>
</svg> bounding box in texture space</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1068" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1068"><i></i></a><div id="fragbit-1068" class="collapse"><div class="fragmentcode">       Float det = -B * B + 4 * A * C;
       Float invDet = 1 / det;
       Float uSqrt = std::sqrt(det * C), vSqrt = std::sqrt(A * det);
       int s0 = std::ceil (st[0] - 2 * invDet * uSqrt);
       int s1 = std::floor(st[0] + 2 * invDet * uSqrt);
       int t0 = std::ceil (st[1] - 2 * invDet * vSqrt);
       int t1 = std::floor(st[1] + 2 * invDet * vSqrt);</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Scanoverellipseboundandcomputequadraticequation-0">Scan over ellipse bound and compute quadratic equation</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1069" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1069"><i></i></a><div id="fragbit-1069" class="collapse"><div class="fragmentcode">       T sum(0.f);
       Float sumWts = 0;
       for (int it = t0; it &lt;= t1; ++it) {
           Float tt = it - st[1];
           for (int is = s0; is &lt;= s1; ++is) {
               Float ss = is - st[0];
               &lt;&lt;<span class="fragmentname"><a href="#fragment-Computesquaredradiusandfiltertexelifinsideellipse-0">Compute squared radius and filter texel if inside ellipse</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1070" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1070"><i></i></a><div id="fragbit-1070" class="collapse"><div class="fragmentcode">                  Float r2 = A * ss * ss + B * ss * tt + C * tt * tt;
                  if (r2 &lt; 1) {
                      int index = std::min((int)(r2 * <a href="#MIPMap::WeightLUTSize" class="code">WeightLUTSize</a>),
                                                 <a href="#MIPMap::WeightLUTSize" class="code">WeightLUTSize</a> - 1);
                      Float weight = <a href="#MIPMap::weightLut" class="code">weightLut</a>[index];
                      sum += <a href="#MIPMap::Texel" class="code">Texel</a>(level, is, it) * weight;
                      sumWts += weight;
                  }</div></div>
           }
       }
       return sum / sumWts;</div></div>
}</div><p>


</p>
<p>This method first converts from texture coordinates in <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.653ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2003.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket 0 comma 1 right-bracket</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="779" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1224" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="1724" y="0"></use>
</g>
</svg> to coordinates
and differentials in terms of the resolution of the chosen MIP map level.  It
also subtracts <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.972ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 1279.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">0.5</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-35" d="M449 201c0 -127 -102 -223 -218 -223c-112 0 -181 97 -181 183c0 46 35 53 49 53c33 0 50 -25 50 -49s-17 -49 -50 -49c-11 0 -14 1 -17 2c17 -59 74 -112 147 -112c46 0 83 26 107 65c24 42 24 102 24 137c0 50 -2 89 -18 126c-8 18 -33 64 -85 64 c-81 0 -118 -54 -129 -70c-4 -6 -6 -9 -13 -9c-14 0 -14 8 -14 26v296c0 16 0 24 10 24c0 0 4 0 12 -3c47 -21 93 -28 133 -28c67 0 116 20 136 29c5 3 8 3 8 3c7 0 10 -5 10 -11c0 -13 -70 -104 -193 -104c-32 0 -65 7 -85 13v-195c36 35 79 51 127 51 c108 0 190 -100 190 -219Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-30"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="500" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-35" x="779" y="0"></use>
</g>
</svg> from the continuous position coordinate to align the
sample point with the discrete texel coordinates, as was done in
<a href="#MIPMap::triangle"><tt>MIPMap::triangle()</tt></a>.
 
</p>
<span class="anchor" id="fragment-ConvertEWAcoordinatestoappropriatescaleforlevel-0"></span><div class="fragmentname">&lt;&lt;Convert EWA coordinates to appropriate scale for level&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">st[0] = st[0] * <a href="#MIPMap::pyramid" class="code">pyramid</a>[level]-&gt;<a href="../Utilities/Memory_Management.html#BlockedArray::uSize" class="code">uSize</a>() - 0.5f;
st[1] = st[1] * <a href="#MIPMap::pyramid" class="code">pyramid</a>[level]-&gt;<a href="../Utilities/Memory_Management.html#BlockedArray::vSize" class="code">vSize</a>() - 0.5f;
dst0[0] *= <a href="#MIPMap::pyramid" class="code">pyramid</a>[level]-&gt;<a href="../Utilities/Memory_Management.html#BlockedArray::uSize" class="code">uSize</a>();
dst0[1] *= <a href="#MIPMap::pyramid" class="code">pyramid</a>[level]-&gt;<a href="../Utilities/Memory_Management.html#BlockedArray::vSize" class="code">vSize</a>();
dst1[0] *= <a href="#MIPMap::pyramid" class="code">pyramid</a>[level]-&gt;<a href="../Utilities/Memory_Management.html#BlockedArray::uSize" class="code">uSize</a>();
dst1[1] *= <a href="#MIPMap::pyramid" class="code">pyramid</a>[level]-&gt;<a href="../Utilities/Memory_Management.html#BlockedArray::vSize" class="code">vSize</a>();</div><p>


</p>
<p>It next computes the coefficients of the implicit equation for
the ellipse with axes <tt>(ds0,dt0)</tt> and <tt>(ds1,dt1)</tt> and centered at the
origin.  Placing the ellipse at the origin rather than at <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.773ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2055.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1665" y="0"></use>
</g>
</svg> simplifies
the implicit equation and the computation of its coefficients and can be
easily corrected for when the equation is evaluated later.  The general form of
the implicit equation for all points <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.773ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2055.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1665" y="0"></use>
</g>
</svg> inside such an ellipse is
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="31.362ex" height="3.176ex" style="vertical-align: -0.838ex;" viewBox="0 -1006.6 13503 1367.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">e left-parenthesis s comma t right-parenthesis equals upper A s squared plus upper B s t plus upper C t squared less-than upper F comma</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D452" d="M430 107c0 -12 -84 -118 -227 -118c-98 0 -157 79 -157 181c0 175 151 272 262 272c69 0 107 -41 107 -85c0 -14 -5 -73 -75 -103c-50 -21 -124 -23 -153 -23h-53c-15 -61 -16 -92 -16 -104c0 -32 9 -116 87 -116c12 0 121 0 200 99c6 8 8 10 13 10c6 0 12 -7 12 -13z M382 357c0 34 -27 63 -74 63c-26 0 -129 -15 -168 -167h41c41 0 201 0 201 104Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D434" d="M721 20c0 -20 -12 -20 -18 -20c-25 0 -88 3 -113 3c-41 0 -84 -3 -125 -3c0 0 -14 0 -14 11c0 20 10 20 24 20c20 0 72 3 72 33c0 10 -14 146 -16 167h-251c-68 -116 -69 -116 -76 -128c-8 -14 -14 -25 -14 -37c0 -25 24 -33 47 -35c7 0 16 -1 16 -12 c0 -19 -13 -19 -19 -19c-32 0 -67 3 -100 3c-28 0 -59 -3 -86 -3c-8 0 -13 5 -13 11c0 19 9 19 21 20c44 3 83 17 123 84l348 584c6 10 10 17 26 17c17 0 17 -4 19 -24l61 -625c3 -29 3 -36 65 -36c13 0 23 0 23 -11zM528 262l-32 330l-197 -330h229Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D435" d="M756 545c0 -95 -105 -169 -209 -188c97 -11 155 -69 155 -141c0 -98 -118 -216 -276 -216h-357c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 10 20 29 20h336 c120 0 186 -64 186 -138zM665 549c0 44 -21 103 -109 103h-129c-43 0 -45 -3 -54 -38l-62 -248h146c122 0 208 95 208 183zM609 227c0 43 -19 117 -115 117h-189l-69 -279c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h136c118 0 207 97 207 196Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D436" d="M760 695l-63 -255c-5 -18 -5 -20 -18 -20c-4 0 -15 0 -15 10s3 11 3 51c0 116 -59 193 -161 193c-89 0 -183 -50 -244 -121c-100 -117 -121 -279 -121 -336c0 -156 106 -208 196 -208c52 0 115 17 184 73c69 58 92 129 101 158c2 8 7 10 13 10c0 0 12 0 12 -10 c0 -3 -17 -94 -110 -176c-53 -46 -129 -86 -216 -86c-153 0 -271 109 -271 274c0 232 225 453 448 453c111 0 157 -75 166 -89l70 77c11 11 12 12 15 12c9 0 11 -7 11 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3C" d="M689 -9c24 -11 7 -47 -18 -36l-581 275c-17 8 -17 32 0 40l581 275c25 11 42 -25 18 -36l-548 -259Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D439" d="M748 653l-20 -173c-2 -19 -3 -25 -14 -25c-9 0 -12 7 -12 12c0 3 0 5 2 18c3 27 3 31 3 54c0 77 -23 110 -146 110h-132c-44 0 -45 -4 -54 -39l-64 -254h91c85 0 108 18 129 96c4 16 5 21 15 21s12 -11 12 -11c0 -3 0 -5 -3 -16l-55 -217c-5 -18 -5 -21 -15 -21 c-6 0 -12 4 -12 12c0 0 1 6 3 11c7 30 7 42 7 49c0 29 -8 45 -83 45h-97l-62 -249c-4 -15 -4 -23 -4 -23c0 -13 3 -17 32 -20c25 -2 30 -2 52 -2c23 0 25 0 28 -1c0 0 6 -3 6 -11c0 -19 -12 -19 -21 -19l-149 3l-132 -3c-3 0 -15 0 -15 12c0 19 11 19 28 19c79 0 81 8 91 47 l132 529c5 18 5 20 5 24c0 18 -28 18 -65 18c-19 0 -28 0 -28 11c0 20 10 20 30 20h490c25 0 30 0 27 -27Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D452" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="466" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="856" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1325" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1770" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2132" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="2799" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D434" x="3855" y="0"></use>
<g transform="translate(4606,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="663" y="583"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="5751" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D435" x="6752" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="7512" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="7981" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="8565" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D436" x="9566" y="0"></use>
<g transform="translate(10326,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="511" y="583"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-3C" x="11419" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D439" x="12475" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="13224" y="0"></use>
</g>
</svg>
</div>
<p>

although it is more computationally efficient to divide through by
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.738ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 748.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper F</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D439" d="M748 653l-20 -173c-2 -19 -3 -25 -14 -25c-9 0 -12 7 -12 12c0 3 0 5 2 18c3 27 3 31 3 54c0 77 -23 110 -146 110h-132c-44 0 -45 -4 -54 -39l-64 -254h91c85 0 108 18 129 96c4 16 5 21 15 21s12 -11 12 -11c0 -3 0 -5 -3 -16l-55 -217c-5 -18 -5 -21 -15 -21 c-6 0 -12 4 -12 12c0 0 1 6 3 11c7 30 7 42 7 49c0 29 -8 45 -83 45h-97l-62 -249c-4 -15 -4 -23 -4 -23c0 -13 3 -17 32 -20c25 -2 30 -2 52 -2c23 0 25 0 28 -1c0 0 6 -3 6 -11c0 -19 -12 -19 -21 -19l-149 3l-132 -3c-3 0 -15 0 -15 12c0 19 11 19 28 19c79 0 81 8 91 47 l132 529c5 18 5 20 5 24c0 18 -28 18 -65 18c-19 0 -28 0 -28 11c0 20 10 20 30 20h490c25 0 30 0 27 -27Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D439" x="0" y="0"></use>
</g>
</svg> and express this&nbsp;as
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="56.052ex" height="5.343ex" style="vertical-align: -1.838ex;" viewBox="0 -1508.9 24133.2 2300.3" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">e left-parenthesis s comma t right-parenthesis equals StartFraction upper A Over upper F EndFraction s squared plus StartFraction upper B Over upper F EndFraction s t plus StartFraction upper C Over upper F EndFraction t squared equals upper A prime s squared plus upper B prime s t plus upper C prime t squared less-than 1 period</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D452" d="M430 107c0 -12 -84 -118 -227 -118c-98 0 -157 79 -157 181c0 175 151 272 262 272c69 0 107 -41 107 -85c0 -14 -5 -73 -75 -103c-50 -21 -124 -23 -153 -23h-53c-15 -61 -16 -92 -16 -104c0 -32 9 -116 87 -116c12 0 121 0 200 99c6 8 8 10 13 10c6 0 12 -7 12 -13z M382 357c0 34 -27 63 -74 63c-26 0 -129 -15 -168 -167h41c41 0 201 0 201 104Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D434" d="M721 20c0 -20 -12 -20 -18 -20c-25 0 -88 3 -113 3c-41 0 -84 -3 -125 -3c0 0 -14 0 -14 11c0 20 10 20 24 20c20 0 72 3 72 33c0 10 -14 146 -16 167h-251c-68 -116 -69 -116 -76 -128c-8 -14 -14 -25 -14 -37c0 -25 24 -33 47 -35c7 0 16 -1 16 -12 c0 -19 -13 -19 -19 -19c-32 0 -67 3 -100 3c-28 0 -59 -3 -86 -3c-8 0 -13 5 -13 11c0 19 9 19 21 20c44 3 83 17 123 84l348 584c6 10 10 17 26 17c17 0 17 -4 19 -24l61 -625c3 -29 3 -36 65 -36c13 0 23 0 23 -11zM528 262l-32 330l-197 -330h229Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D439" d="M748 653l-20 -173c-2 -19 -3 -25 -14 -25c-9 0 -12 7 -12 12c0 3 0 5 2 18c3 27 3 31 3 54c0 77 -23 110 -146 110h-132c-44 0 -45 -4 -54 -39l-64 -254h91c85 0 108 18 129 96c4 16 5 21 15 21s12 -11 12 -11c0 -3 0 -5 -3 -16l-55 -217c-5 -18 -5 -21 -15 -21 c-6 0 -12 4 -12 12c0 0 1 6 3 11c7 30 7 42 7 49c0 29 -8 45 -83 45h-97l-62 -249c-4 -15 -4 -23 -4 -23c0 -13 3 -17 32 -20c25 -2 30 -2 52 -2c23 0 25 0 28 -1c0 0 6 -3 6 -11c0 -19 -12 -19 -21 -19l-149 3l-132 -3c-3 0 -15 0 -15 12c0 19 11 19 28 19c79 0 81 8 91 47 l132 529c5 18 5 20 5 24c0 18 -28 18 -65 18c-19 0 -28 0 -28 11c0 20 10 20 30 20h490c25 0 30 0 27 -27Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D435" d="M756 545c0 -95 -105 -169 -209 -188c97 -11 155 -69 155 -141c0 -98 -118 -216 -276 -216h-357c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 10 20 29 20h336 c120 0 186 -64 186 -138zM665 549c0 44 -21 103 -109 103h-129c-43 0 -45 -3 -54 -38l-62 -248h146c122 0 208 95 208 183zM609 227c0 43 -19 117 -115 117h-189l-69 -279c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h136c118 0 207 97 207 196Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D436" d="M760 695l-63 -255c-5 -18 -5 -20 -18 -20c-4 0 -15 0 -15 10s3 11 3 51c0 116 -59 193 -161 193c-89 0 -183 -50 -244 -121c-100 -117 -121 -279 -121 -336c0 -156 106 -208 196 -208c52 0 115 17 184 73c69 58 92 129 101 158c2 8 7 10 13 10c0 0 12 0 12 -10 c0 -3 -17 -94 -110 -176c-53 -46 -129 -86 -216 -86c-153 0 -271 109 -271 274c0 232 225 453 448 453c111 0 157 -75 166 -89l70 77c11 11 12 12 15 12c9 0 11 -7 11 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3C" d="M689 -9c24 -11 7 -47 -18 -36l-581 275c-17 8 -17 32 0 40l581 275c25 11 42 -25 18 -36l-548 -259Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D452" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="466" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="856" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1325" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1770" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2132" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="2799" y="0"></use>
<g transform="translate(3577,0)">
<g transform="translate(397,0)">
<rect stroke="none" width="870" height="60" x="0" y="220"></rect>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D434" x="60" y="676"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D439" x="61" y="-701"></use>
</g>
</g>
<g transform="translate(4966,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="663" y="583"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="6111" y="0"></use>
<g transform="translate(6890,0)">
<g transform="translate(342,0)">
<rect stroke="none" width="879" height="60" x="0" y="220"></rect>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D435" x="60" y="676"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D439" x="65" y="-701"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="8232" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="8701" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="9285" y="0"></use>
<g transform="translate(10063,0)">
<g transform="translate(342,0)">
<rect stroke="none" width="880" height="60" x="0" y="220"></rect>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D436" x="60" y="676"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D439" x="66" y="-701"></use>
</g>
</g>
<g transform="translate(11406,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="511" y="583"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="12499" y="0"></use>
<g transform="translate(13555,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D434" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="1061" y="583"></use>
</g>
<g transform="translate(14694,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="663" y="583"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="15840" y="0"></use>
<g transform="translate(16840,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D435" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="1074" y="583"></use>
</g>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="17988" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="18458" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="19041" y="0"></use>
<g transform="translate(20042,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D436" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="1094" y="583"></use>
</g>
<g transform="translate(21204,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="511" y="583"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-3C" x="22297" y="0"></use>
<g transform="translate(23354,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-31"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="500" y="0"></use>
</g>
</g>
</svg>
</div>
<p>

We will not derive the equations that give the values of the coefficients,
although the interested reader can easily verify their
correctness.<button style="button" data-toggle="tooltip" data-placement="right" data-html="true" class="btn footnote-button" title="Heckbert&rsquo;s thesis has the original
derivation (Heckbert 1989, p.&nbsp;80):  A and C have an extra term of 1
added to them so the ellipse is a minimum of one texel
separation wide.  This ensures that the ellipse will not fall between
the texels when magnifying at the most detailed level.">
      <sup>&dagger;</sup>
    </button>
		

</p>
<p></p>
<span class="anchor" id="fragment-ComputeellipsecoefficientstoboundEWAfilterregion-0"></span><div class="fragmentname">&lt;&lt;Compute ellipse coefficients to bound EWA filter region&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Float A = dst0[1] * dst0[1] + dst1[1] * dst1[1] + 1;
Float B = -2 * (dst0[0] * dst0[1] + dst1[0] * dst1[1]);
Float C = dst0[0] * dst0[0] + dst1[0] * dst1[0] + 1;
Float invF = 1 / (A * C - B * B * 0.25f);
A *= invF;
B *= invF;
C *= invF;</div><p>


</p>
<p>
The next step is to find the axis-aligned bounding box in discrete integer
texel coordinates of the texels that are potentially inside the ellipse.  The
EWA algorithm loops over all of these candidate texels, filtering the
contributions of those that are in fact inside the ellipse.  The bounding box
is found by determining the minimum and maximum values that the ellipse takes in
the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 469.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">s</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.84ex" height="2.009ex" style="vertical-align: -0.338ex;" viewBox="0 -719.6 361.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">t</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
</g>
</svg> directions.  These extrema can be calculated by finding the
partial derivatives <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.061ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2609.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">partial-differential e slash partial-differential s</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2202" d="M515 457c36 -143 15 -479 -223 -479c-140 0 -212 116 -228 178c-8 31 -24 124 38 207c59 78 120 94 181 94c78 0 133 -56 158 -118c2 81 -5 132 -14 171c-33 129 -116 181 -189 181c-29 0 -98 -6 -124 -80c16 0 47 0 56 -35c6 -23 -8 -53 -41 -53c-30 0 -43 21 -46 35 c-7 28 6 158 151 158c123 0 241 -100 281 -259zM432 303c-5 20 -35 132 -144 132c-62 0 -103 -32 -128 -89c-26 -60 -16 -200 -10 -227c3 -10 29 -113 139 -113c154 0 161 225 143 297Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D452" d="M430 107c0 -12 -84 -118 -227 -118c-98 0 -157 79 -157 181c0 175 151 272 262 272c69 0 107 -41 107 -85c0 -14 -5 -73 -75 -103c-50 -21 -124 -23 -153 -23h-53c-15 -61 -16 -92 -16 -104c0 -32 9 -116 87 -116c12 0 121 0 200 99c6 8 8 10 13 10c6 0 12 -7 12 -13z M382 357c0 34 -27 63 -74 63c-26 0 -129 -15 -168 -167h41c41 0 201 0 201 104Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D452" x="586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="1053" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="1553" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="2140" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.81ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2501.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">partial-differential e slash partial-differential t</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2202" d="M515 457c36 -143 15 -479 -223 -479c-140 0 -212 116 -228 178c-8 31 -24 124 38 207c59 78 120 94 181 94c78 0 133 -56 158 -118c2 81 -5 132 -14 171c-33 129 -116 181 -189 181c-29 0 -98 -6 -124 -80c16 0 47 0 56 -35c6 -23 -8 -53 -41 -53c-30 0 -43 21 -46 35 c-7 28 6 158 151 158c123 0 241 -100 281 -259zM432 303c-5 20 -35 132 -144 132c-62 0 -103 -32 -128 -89c-26 -60 -16 -200 -10 -227c3 -10 29 -113 139 -113c154 0 161 225 143 297Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D452" d="M430 107c0 -12 -84 -118 -227 -118c-98 0 -157 79 -157 181c0 175 151 272 262 272c69 0 107 -41 107 -85c0 -14 -5 -73 -75 -103c-50 -21 -124 -23 -153 -23h-53c-15 -61 -16 -92 -16 -104c0 -32 9 -116 87 -116c12 0 121 0 200 99c6 8 8 10 13 10c6 0 12 -7 12 -13z M382 357c0 34 -27 63 -74 63c-26 0 -129 -15 -168 -167h41c41 0 201 0 201 104Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D452" x="586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="1053" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="1553" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="2140" y="0"></use>
</g>
</svg>, finding their solutions for <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.351ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 2304.1 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">s equals 0</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="747" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="1803" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.101ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 2196.1 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">t equals 0</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="639" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="1695" y="0"></use>
</g>
</svg>, and adding the offset to the
ellipse center.  For brevity, we will not include the derivation for these
expressions here.

</p>
<p></p>
<span class="anchor" id="fragment-Computetheellipsesstboundingboxintexturespace-0"></span><div class="fragmentname">&lt;&lt;Compute the ellipse&rsquo;s <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.773ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2055.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1665" y="0"></use>
</g>
</svg> bounding box in texture space&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Float det = -B * B + 4 * A * C;
Float invDet = 1 / det;
Float uSqrt = std::sqrt(det * C), vSqrt = std::sqrt(A * det);
int s0 = std::ceil (st[0] - 2 * invDet * uSqrt);
int s1 = std::floor(st[0] + 2 * invDet * uSqrt);
int t0 = std::ceil (st[1] - 2 * invDet * vSqrt);
int t1 = std::floor(st[1] + 2 * invDet * vSqrt);</div><p>


</p>
<p>
</p>
<span class="anchor" id="fig:ewa-ellipse-eval"></span><div class="card outerfigure"><div class="card-body figure"><p>



</p>
<div class="figure-row">
  <a href="EWA%20r2.svg" title=""><img src="EWA%20r2.svg" width=239 height=216 style="max-width: 100%;"></a>
</div>
<p>


</p>
<figcaption class="caption">Figure 10.16: Finding the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.103ex" height="2.509ex" style="vertical-align: -0.338ex;" viewBox="0 -934.9 905.4 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">r squared</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45F" d="M436 377c0 -36 -28 -59 -55 -59s-38 19 -38 35c0 26 22 50 52 55c0 0 -16 12 -42 12c-43 0 -72 -26 -80 -33c-24 -22 -52 -69 -56 -82l-32 -130c-4 -18 -38 -154 -40 -158c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43l58 231c13 52 16 63 16 84 c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c47 0 83 -32 91 -77c19 28 63 77 128 77c51 0 83 -30 83 -65Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45F" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="638" y="513"></use>
</g>
</svg> Ellipse Value for
the EWA Filter Table Lookup.</figcaption><p>


</p>
</div></div><p>


</p>
<p>Now that the bounding box is known, the EWA algorithm loops over the texels,
transforming each one to the coordinate system where the texture lookup
point <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.773ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2055.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1665" y="0"></use>
</g>
</svg> is at the origin with a translation.  It then evaluates the ellipse
equation to see if the texel is inside the ellipse 
(Figure&nbsp;<a href="#fig:ewa-ellipse-eval">10.16</a>) and computes the filter weight for the texel if so.
The final
filtered value returned is a weighted sum over texels <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.213ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 3536 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper T left-parenthesis s prime comma t prime right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D447" d="M704 666c0 -3 -1 -13 -2 -17l-27 -174c-2 -15 -4 -23 -15 -23c-9 0 -12 7 -12 13c0 3 2 15 3 19c4 26 8 65 8 80c0 78 -45 82 -146 82c-21 0 -54 0 -63 -2c-12 -3 -16 -9 -23 -37l-133 -531c-4 -15 -4 -21 -4 -21c0 -16 8 -19 37 -22c26 -2 39 -2 64 -2c26 0 34 0 34 -11 c0 -20 -12 -20 -22 -20c-28 0 -58 2 -87 2l-83 1l-85 -1c-27 0 -55 -2 -82 -2c-6 0 -17 0 -17 12c0 19 6 19 42 19c107 0 110 11 119 48l134 534c1 3 4 15 4 21c0 8 0 12 -28 12h-39c-148 0 -174 -18 -228 -173c-6 -16 -7 -21 -17 -21c-7 0 -12 5 -12 11c0 0 5 16 6 18 l60 176c7 19 8 20 32 20h555c17 0 27 0 27 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D447" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="704" y="0"></use>
<g transform="translate(1094,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="663" y="513"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1951" y="0"></use>
<g transform="translate(2396,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="511" y="513"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="3146" y="0"></use>
</g>
</svg> inside the
ellipse, where <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.283ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 552.5 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">f</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="0" y="0"></use>
</g>
</svg> is the Gaussian filter function:
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="28.007ex" height="6.509ex" style="vertical-align: -2.671ex;" viewBox="0 -1652.5 12058.5 2802.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">StartFraction sigma-summation f left-parenthesis s prime minus s comma t prime minus t right-parenthesis upper T left-parenthesis s prime comma t Superscript prime Baseline right-parenthesis Over sigma-summation f left-parenthesis s prime minus s comma t prime minus t right-parenthesis EndFraction period</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNOPERATORS-2211" d="M999 -1l-86 -249h-829c-18 0 -27 0 -27 11c0 4 1 6 9 16l355 439l-365 502c0 31 1 32 28 32h829l86 -234h-25c-70 187 -300 194 -414 194h-396l325 -446c6 -9 7 -10 7 -14s-2 -7 -9 -16l-347 -429h425c147 0 216 24 232 29c85 29 152 90 177 165h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D447" d="M704 666c0 -3 -1 -13 -2 -17l-27 -174c-2 -15 -4 -23 -15 -23c-9 0 -12 7 -12 13c0 3 2 15 3 19c4 26 8 65 8 80c0 78 -45 82 -146 82c-21 0 -54 0 -63 -2c-12 -3 -16 -9 -23 -37l-133 -531c-4 -15 -4 -21 -4 -21c0 -16 8 -19 37 -22c26 -2 39 -2 64 -2c26 0 34 0 34 -11 c0 -20 -12 -20 -22 -20c-28 0 -58 2 -87 2l-83 1l-85 -1c-27 0 -55 -2 -82 -2c-6 0 -17 0 -17 12c0 19 6 19 42 19c107 0 110 11 119 48l134 534c1 3 4 15 4 21c0 8 0 12 -28 12h-39c-148 0 -174 -18 -228 -173c-6 -16 -7 -21 -17 -21c-7 0 -12 5 -12 11c0 0 5 16 6 18 l60 176c7 19 8 20 32 20h555c17 0 27 0 27 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
<g transform="translate(120,0)">
<rect stroke="none" width="11539" height="60" x="0" y="220"></rect>
<g transform="translate(60,770)">
 <use xlink:href="#E1-LATINMODERNOPERATORS-2211" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="1223" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1775" y="0"></use>
<g transform="translate(2165,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="663" y="513"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="3245" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="4245" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="4715" y="0"></use>
<g transform="translate(5160,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="511" y="513"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="6132" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="7133" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="7494" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D447" x="7884" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="8588" y="0"></use>
<g transform="translate(8978,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="663" y="513"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="9835" y="0"></use>
<g transform="translate(10280,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="511" y="513"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="11030" y="0"></use>
</g>
<g transform="translate(1827,-771)">
 <use xlink:href="#E1-LATINMODERNOPERATORS-2211" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="1223" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1775" y="0"></use>
<g transform="translate(2165,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="663" y="408"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="3245" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="4245" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="4715" y="0"></use>
<g transform="translate(5160,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="511" y="408"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="6132" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="7133" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="7494" y="0"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="11779" y="0"></use>
</g>
</svg>
</div>
<p>


</p>
<p></p>
<span class="anchor" id="fragment-Scanoverellipseboundandcomputequadraticequation-0"></span><div class="fragmentname">&lt;&lt;Scan over ellipse bound and compute quadratic equation&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">T sum(0.f);
Float sumWts = 0;
for (int it = t0; it &lt;= t1; ++it) {
    Float tt = it - st[1];
    for (int is = s0; is &lt;= s1; ++is) {
        Float ss = is - st[0];
        &lt;&lt;<span class="fragmentname"><a href="#fragment-Computesquaredradiusandfiltertexelifinsideellipse-0">Compute squared radius and filter texel if inside ellipse</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1071" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1071"><i></i></a><div id="fragbit-1071" class="collapse"><div class="fragmentcode">           Float r2 = A * ss * ss + B * ss * tt + C * tt * tt;
           if (r2 &lt; 1) {
               int index = std::min((int)(r2 * <a href="#MIPMap::WeightLUTSize" class="code">WeightLUTSize</a>),
                                          <a href="#MIPMap::WeightLUTSize" class="code">WeightLUTSize</a> - 1);
               Float weight = <a href="#MIPMap::weightLut" class="code">weightLut</a>[index];
               sum += <a href="#MIPMap::Texel" class="code">Texel</a>(level, is, it) * weight;
               sumWts += weight;
           }</div></div>
    }
}
return sum / sumWts;</div><p>


</p>
<p>A nice feature of the implicit equation <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.857ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2521.7 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">e left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D452" d="M430 107c0 -12 -84 -118 -227 -118c-98 0 -157 79 -157 181c0 175 151 272 262 272c69 0 107 -41 107 -85c0 -14 -5 -73 -75 -103c-50 -21 -124 -23 -153 -23h-53c-15 -61 -16 -92 -16 -104c0 -32 9 -116 87 -116c12 0 121 0 200 99c6 8 8 10 13 10c6 0 12 -7 12 -13z M382 357c0 34 -27 63 -74 63c-26 0 -129 -15 -168 -167h41c41 0 201 0 201 104Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D452" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="466" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="856" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1325" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1770" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2132" y="0"></use>
</g>
</svg> is that its value at a
particular texel is the squared ratio of the distance from the center of
the ellipse to the texel to the distance from the center of the ellipse to
the ellipse boundary along the line through that texel
(Figure&nbsp;<a href="#fig:ewa-ellipse-eval">10.16</a>).  This value can be used to index into a
precomputed lookup table of Gaussian filter function values.

</p>
<p></p>
<span class="anchor" id="fragment-Computesquaredradiusandfiltertexelifinsideellipse-0"></span><div class="fragmentname">&lt;&lt;Compute squared radius and filter texel if inside ellipse&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Float r2 = A * ss * ss + B * ss * tt + C * tt * tt;
if (r2 &lt; 1) {
    int index = std::min((int)(r2 * <a href="#MIPMap::WeightLUTSize" class="code">WeightLUTSize</a>),
                               <a href="#MIPMap::WeightLUTSize" class="code">WeightLUTSize</a> - 1);
    Float weight = <a href="#MIPMap::weightLut" class="code">weightLut</a>[index];
    sum += <a href="#MIPMap::Texel" class="code">Texel</a>(level, is, it) * weight;
    sumWts += weight;
}</div><p>


</p>
<p>The lookup table is initialized the first time a <a href="#MIPMap"><tt>MIPMap</tt></a> is constructed.
Because it will be indexed with squared distances from the filter center <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.103ex" height="2.509ex" style="vertical-align: -0.338ex;" viewBox="0 -934.9 905.4 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">r squared</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45F" d="M436 377c0 -36 -28 -59 -55 -59s-38 19 -38 35c0 26 22 50 52 55c0 0 -16 12 -42 12c-43 0 -72 -26 -80 -33c-24 -22 -52 -69 -56 -82l-32 -130c-4 -18 -38 -154 -40 -158c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43l58 231c13 52 16 63 16 84 c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c47 0 83 -32 91 -77c19 28 63 77 128 77c51 0 83 -30 83 -65Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45F" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="638" y="513"></use>
</g>
</svg>,
each entry stores a value <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.337ex" height="2.343ex" style="vertical-align: -0.338ex;" viewBox="0 -863.1 1867.1 1008.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal e Superscript minus alpha r</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-65" d="M415 119c0 -19 -45 -130 -167 -130c-115 0 -220 97 -220 231c0 125 92 228 208 228c125 0 179 -97 179 -196c0 -21 -3 -21 -25 -21h-279c0 -36 0 -102 30 -150c23 -37 63 -67 113 -67c10 0 100 0 135 103c2 8 4 14 13 14c5 0 13 -2 13 -12zM349 252 c0 39 -10 174 -113 174c-34 0 -118 -25 -124 -174h237Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D6FC" d="M602 383c0 0 -21 -117 -115 -235c-10 -12 -10 -14 -10 -35c0 -24 0 -102 31 -102c0 0 38 0 56 49c3 7 6 10 13 10c6 0 12 -3 12 -10c0 -16 -31 -71 -84 -71c-45 0 -78 31 -91 84c-76 -61 -148 -84 -211 -84c-102 0 -162 76 -162 169c0 141 132 284 269 284 c74 0 167 -49 167 -206v-62c47 59 80 135 98 198c5 18 5 21 15 21c11 0 12 -10 12 -10zM410 99c-2 17 -2 75 -2 112c0 78 0 209 -99 209c-35 0 -89 -19 -136 -92c-32 -51 -58 -159 -58 -208c0 -64 30 -109 90 -109c40 0 117 11 205 88Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45F" d="M436 377c0 -36 -28 -59 -55 -59s-38 19 -38 35c0 26 22 50 52 55c0 0 -16 12 -42 12c-43 0 -72 -26 -80 -33c-24 -22 -52 -69 -56 -82l-32 -130c-4 -18 -38 -154 -40 -158c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43l58 231c13 52 16 63 16 84 c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c47 0 83 -32 91 -77c19 28 63 77 128 77c51 0 83 -30 83 -65Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-65" x="0" y="0"></use>
<g transform="translate(444,362)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2212" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D6FC" x="778" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45F" x="1419" y="0"></use>
</g>
</g>
</svg>, rather than <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.168ex" height="2.843ex" style="vertical-align: -0.338ex;" viewBox="0 -1078.4 2225.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal e Superscript minus alpha r squared</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-65" d="M415 119c0 -19 -45 -130 -167 -130c-115 0 -220 97 -220 231c0 125 92 228 208 228c125 0 179 -97 179 -196c0 -21 -3 -21 -25 -21h-279c0 -36 0 -102 30 -150c23 -37 63 -67 113 -67c10 0 100 0 135 103c2 8 4 14 13 14c5 0 13 -2 13 -12zM349 252 c0 39 -10 174 -113 174c-34 0 -118 -25 -124 -174h237Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D6FC" d="M602 383c0 0 -21 -117 -115 -235c-10 -12 -10 -14 -10 -35c0 -24 0 -102 31 -102c0 0 38 0 56 49c3 7 6 10 13 10c6 0 12 -3 12 -10c0 -16 -31 -71 -84 -71c-45 0 -78 31 -91 84c-76 -61 -148 -84 -211 -84c-102 0 -162 76 -162 169c0 141 132 284 269 284 c74 0 167 -49 167 -206v-62c47 59 80 135 98 198c5 18 5 21 15 21c11 0 12 -10 12 -10zM410 99c-2 17 -2 75 -2 112c0 78 0 209 -99 209c-35 0 -89 -19 -136 -92c-32 -51 -58 -159 -58 -208c0 -64 30 -109 90 -109c40 0 117 11 205 88Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45F" d="M436 377c0 -36 -28 -59 -55 -59s-38 19 -38 35c0 26 22 50 52 55c0 0 -16 12 -42 12c-43 0 -72 -26 -80 -33c-24 -22 -52 -69 -56 -82l-32 -130c-4 -18 -38 -154 -40 -158c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43l58 231c13 52 16 63 16 84 c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c47 0 83 -32 91 -77c19 28 63 77 128 77c51 0 83 -30 83 -65Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-65" x="0" y="0"></use>
<g transform="translate(444,362)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2212" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D6FC" x="778" y="0"></use>
<g transform="translate(1003,0)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45F" x="0" y="0"></use>
 <use transform="scale(0.574)" xlink:href="#E1-LATINMODERNMAIN-32" x="556" y="446"></use>
</g>
</g>
</g>
</svg>.

</p>
<p></p>
<span class="anchor" id="fragment-MIPMapPrivateData-2"></span><div class="fragmentname">&lt;&lt;MIPMap Private Data&gt;&gt;+=&nbsp;<a href="#fragment-MIPMapPrivateData-1"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">static constexpr int <span class="anchor" id="MIPMap::WeightLUTSize"></span>WeightLUTSize = 128;
static Float <span class="anchor" id="MIPMap::weightLut"></span>weightLut[WeightLUTSize];</div><p>


</p>
<p>

</p>
<p>So that the filter function goes to zero at the end of its extent rather
than having an abrupt step, <tt>std::exp(-alpha)</tt> is subtracted from the
filter values here.

</p>
<p></p>
<span class="anchor" id="fragment-InitializeEWAfilterweightsifneeded-0"></span><div class="fragmentname">&lt;&lt;Initialize EWA filter weights if needed&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">if (<a href="#MIPMap::weightLut" class="code">weightLut</a>[0] == 0.) {
    for (int i = 0; i &lt; <a href="#MIPMap::WeightLUTSize" class="code">WeightLUTSize</a>; ++i) {
        Float alpha = 2;
        Float r2 = Float(i) / Float(<a href="#MIPMap::WeightLUTSize" class="code">WeightLUTSize</a> - 1);
        <a href="#MIPMap::weightLut" class="code">weightLut</a>[i] = std::exp(-alpha * r2) - std::exp(-alpha);
    }
}</div><p>


</p>
<p>

</p>
<p>
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

</div>  <!-- container-fluid -->
</div>  <!-- maincontainer -->

<nav class="navbar navbar-expand-md bg-light navbar-light">
  <div class="container-fluid-nav">
    <!--  <ul class="nav navbar-nav navbar-center"> -->
      <span class="navbar-text" style="text-align: center;">
        Thanks to Farhan Wali and 43 others for generously supporting <i>Physically
        Based Rendering</i> online
        through <a href="https://patreon.com/pbrbook">Patreon</a>.
    </span>
  </div>
</nav>

<nav class="navbar navbar-expand-md bg-light navbar-light">
  <span class="navbar-text"><i>Physically Based Rendering: From Theory To Implementation</i>, &copy; 2004-2021 Matt Pharr, Wenzel Jakob, and Greg Humphreys under the <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/">CC BY-NC-ND 4.0</a> license. (<a href="https://github.com/mmp/pbr-book-website/">github</a>)</span>
  <div class="container">
    <ul class="nav navbar-nav ml-auto">
      <li class="nav-item">Next: <a href="../Texture/Solid_and_Procedural_Texturing.html">Texture / Solid and Procedural Texturing</a></li>
    </ul>
  </div>

</nav>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script>
  $(function () {
    $('[data-toggle="popover"]').popover()
    $('[data-toggle="tooltip"]').tooltip()
   })
</script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

<script>
// https://stackoverflow.com/a/17535094
// The function actually applying the offset
function offsetAnchor() {
  if (location.hash.length !== 0) {
    window.scrollTo(window.scrollX, window.scrollY - window.innerHeight / 8);
  }
}

// Captures click events of all <a> elements with href starting with #
$(document).on('click', 'a[href^="#"]', function(event) {
  // Click events are captured before hashchanges. Timeout
  // causes offsetAnchor to be called after the page jump.
  window.setTimeout(function() {
    offsetAnchor();
  }, 500);
});

// Set the offset when entering page with hash present in the url
window.setTimeout(offsetAnchor, 1500);
</script>

</body>
</html>
