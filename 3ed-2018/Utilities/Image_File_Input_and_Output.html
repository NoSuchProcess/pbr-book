
<!doctype html>
<html lang="en">
<head>

<!-- all praise to https://realfavicongenerator.net -->
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link href="https://fonts.googleapis.com/css?family=Domine|Roboto+Mono" rel="stylesheet">
  <link rel="stylesheet" href="../pbrstyle.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">

  <script async src="https://cse.google.com/cse.js?cx=003601324460585362024:4xwpwgaitgd"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.6.1/react.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.6.1/react-dom.min.js"></script>
  <script src="/jeri.min.js"></script>
  <link rel="preload" href="/exr.worker.js" as="script" crossorigin="anonymous">
        
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

  <title>Image File Input and Output</title>
</head>
        
<body>

<nav class="fixed-top-lg-navbar navbar navbar-expand bg-light navbar-light">
  <ul class="nav navbar-nav">
    <a class="navbar-brand" href="../contents.html"><img src="../pbr.jpg" width=25 height=25></a>
    <li class="nav-item"><a class="nav-link" href="../Utilities.html">Utilities</a></li>
    <span class="navbar-text">/</span>
    <li class="nav-item"><a class="nav-link" href="#">Image File Input and Output</a></li>
    <span class="navbar-text">&nbsp;&nbsp;</span>
    <li class="nav-item"><a class="nav-link" href="../Utilities/Main_Include_File.html">(Previous: Main Include File)</a></li>
  </ul>

  <ul class="nav navbar-nav ml-auto d-none d-md-block">
        <li class="nav-item"><div class="gcse-search"></div></li>
    </ul>
  <ul class="nav navbar-nav d-block d-md-none">
        <li class="nav-item"><div class="gcse-search"></div></li>
    </ul>
</nav>

<div class="maincontainer">
<div class="container-fluid">

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#"><i class="fas fa-link "></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:imageio"></span><h2>A.2 Image File Input and Output</h2><p>



</p>
<p>Many image file formats have been developed over the years, but for <tt>pbrt</tt>&rsquo;s
purposes we are mainly interested in those that support imagery represented
by floating-point pixel values.  In particular, the images generated by <tt>pbrt</tt> will often have a large dynamic range; such formats are crucial for being
able to store the computed radiance values directly.  Legacy image file
formats, such as those that store 8 bits of data for red, green, and blue
components to represent colors in the range <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.653ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2003.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket 0 comma 1 right-bracket</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="779" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1224" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="1724" y="0"></use>
</g>
</svg>, aren&rsquo;t a good fit for
physically based rendering needs.

</p>
<p><tt>pbrt</tt> supports two floating-point image file formats: OpenEXR and PFM.
OpenEXR is a floating-point file format originally designed at Industrial
Light and Magic for use in movie productions (<a href="Further_Reading.html#cite:Kainz04">Kainz et al. 2004</a>).  We chose
this format because it has a clean design, is easy to use, and has
first-class support for floating-point image data.  Libraries that read and
write OpenEXR images are freely available, and support for the format is
available in many other tools.

</p>
<p>PFM is a floating-point format based on an extension to the PPM file
format; it is very easily read and written, though it isn&rsquo;t as widely
supported as OpenEXR.  Unlike OpenEXR, it doesn&rsquo;t support compression, so
files may be fairly large.

</p>
<p>For convenience, <tt>pbrt</tt> also has support to read and write TGA format files
as well as support to read and write PNG images.  Neither of these is a
high-dynamic-range format like OpenEXR, but both are convenient, especially
as input formats for low-dynamic-range texture maps.

</p>
<p>

</p>
<p>The <a href="#ReadImage"><tt>ReadImage()</tt></a> function takes the filename to
read from and a pointer to a <a href="../Geometry_and_Transformations/Points.html#Point2i"><tt>Point2i</tt></a> that will be initialized with the
image resolution.  It returns a pointer to the start of a freshly allocated
array of <a href="../Color_and_Radiometry/RGBSpectrum_Implementation.html#RGBSpectrum"><tt>RGBSpectrum</tt></a> objects.  It will read the given file as an
OpenEXR, PFM, PNG, or TGA file, depending on the suffix of the filename.

</p>
<p></p>
<span class="anchor" id="fragment-ImageIODeclarations-0"></span><div class="fragmentname">&lt;&lt;ImageIO Declarations&gt;&gt;=&nbsp;<a href="#fragment-ImageIODeclarations-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">std::unique_ptr&lt;RGBSpectrum[]&gt; <span class="anchor" id="ReadImage"></span>ReadImage(const std::string &amp;name,
    <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> *resolution);</div><p>


</p>
<p><tt>ReadImage()</tt> uses <a href="../Color_and_Radiometry/RGBSpectrum_Implementation.html#RGBSpectrum"><tt>RGBSpectrum</tt></a> for the return values&mdash;not
<a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum"><tt>Spectrum</tt></a>.  The primary client of this function is the image texture
mapping code in <tt>pbrt</tt>, which stores texture maps as <a href="../Color_and_Radiometry/RGBSpectrum_Implementation.html#RGBSpectrum"><tt>RGBSpectrum</tt></a>
values, even when <tt>pbrt</tt> is compiled to do full-spectral rendering, so
returning <a href="../Color_and_Radiometry/RGBSpectrum_Implementation.html#RGBSpectrum"><tt>RGBSpectrum</tt></a> values is a natural approach.  (We also made
this decision under the expectation that the image files being read would
be in RGB or another three-channel format, so that returning RGB values
wouldn&rsquo;t discard spectral information; if calling code wants to store full
<a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum"><tt>Spectrum</tt></a> values, then it can convert from RGB to the full-spectral
representation itself.)  If <tt>pbrt</tt> was extended to support a full-spectral
input image format for textures, then a variant of this function that did
return <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum"><tt>Spectrum</tt></a> values would be advisable.

</p>
<p>The <a href="#WriteImage"><tt>WriteImage()</tt></a> function takes a filename to be written, a pointer
to the beginning of the pixel data, and information about the resolution of
the image.  The pixel data should be organized as interleaved
RGBRGB&hellip; values.  Like <tt>ReadImage()</tt>, it uses the suffix of the given
filename to determine which image format to use.

</p>
<p>With <tt>WriteImage()</tt>, it&rsquo;s possible to specify that the pixels being
written represent a sub-region of a larger image.  Some image formats
(e.g., OpenEXR) can record this information in the image file header, which
in turn makes it easy to assemble separately rendered subimages into a
single image.  The <tt>totalResolution</tt> parameter gives the
total resolution of the overall image that the given pixel values are part
of, and <tt>outputBounds</tt> gives the pixel bounding box that the given
pixels cover.  <tt>outputBounds</tt> should be within the range <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="54.29ex" height="3.343ex" style="vertical-align: -1.171ex;" viewBox="0 -934.9 23374.6 1439.2" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis 0 comma 0 right-parenthesis right-arrow left-parenthesis monospace t monospace o monospace t monospace a monospace l monospace upper R monospace e monospace s monospace o monospace l monospace u monospace t monospace i monospace o monospace n monospace period monospace x comma monospace t monospace o monospace t monospace a monospace l monospace upper R monospace e monospace s monospace o monospace l monospace u monospace t monospace i monospace o monospace n monospace period monospace y right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2192" d="M943 250c0 -6 -4 -11 -9 -13c-57 -19 -101 -59 -137 -104c-28 -36 -49 -80 -58 -127c-2 -9 -10 -16 -20 -16c-11 0 -20 9 -20 20c0 1 1 3 1 4c10 53 33 102 66 144c22 28 48 52 78 72h-766c-11 0 -20 9 -20 20s9 20 20 20h766c-30 20 -56 44 -78 72 c-33 42 -56 91 -66 144c0 1 -1 3 -1 4c0 11 9 20 20 20c10 0 18 -7 20 -16c9 -47 30 -91 58 -127c36 -45 80 -85 137 -104c5 -2 9 -7 9 -13Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D69D" d="M449 126c0 -89 -81 -132 -155 -132c-73 0 -141 36 -141 132v244h-88c-15 0 -40 0 -40 30c0 31 25 31 41 31h87v82c0 20 0 41 35 41c34 0 34 -22 34 -41v-82h164c16 0 40 0 40 -31c0 -30 -25 -30 -40 -30h-164v-238c0 -25 0 -77 77 -77c23 0 80 10 81 72c0 17 1 38 34 38 c35 0 35 -21 35 -39Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D698" d="M467 216c0 -126 -95 -222 -205 -222s-205 95 -205 222c0 125 93 224 205 224s205 -99 205 -224zM398 223c0 91 -64 156 -136 156c-71 0 -136 -65 -136 -156c0 -93 62 -168 136 -168s136 75 136 168Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D68A" d="M519 31c0 -31 -22 -31 -50 -31c-38 0 -86 1 -108 32c-47 -31 -109 -38 -146 -38c-102 0 -165 65 -165 134c0 96 123 146 300 149c0 71 -52 102 -128 102c-9 0 -22 0 -36 -1c-20 -2 -21 -3 -21 -11c-1 -37 -29 -46 -44 -46c-24 0 -45 16 -45 46c0 73 102 73 145 73 c144 0 198 -84 198 -155v-216c8 -3 18 -8 60 -8c15 0 40 0 40 -30zM350 134v84c-145 -4 -231 -41 -231 -90c0 -39 41 -73 103 -73c8 0 53 0 89 17c39 18 39 39 39 62Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D695" d="M467 30c0 -30 -25 -30 -40 -30h-329c-14 0 -40 0 -40 30c0 31 25 31 41 31h129v489h-130c-14 0 -40 0 -40 30c0 31 25 31 41 31h158c34 0 40 -10 40 -41v-509h130c16 0 40 0 40 -31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D681" d="M522 93c0 -38 -24 -104 -87 -104c-34 0 -62 16 -79 46c-19 32 -19 62 -19 127c0 42 0 64 -22 85c-32 28 -62 28 -81 28h-78v-214h25c16 0 40 0 40 -31c0 -30 -25 -30 -40 -30h-119c-15 0 -40 0 -40 30c0 31 24 31 40 31h25v489h-25c-15 0 -40 0 -40 30c0 31 24 31 40 31 h177c118 0 194 -82 194 -168c0 -41 -19 -102 -85 -139c14 -11 37 -32 49 -61c9 -23 9 -31 9 -94c0 -53 0 -99 28 -99c17 0 19 37 19 45c1 30 24 30 34 30c11 0 35 0 35 -32zM364 443c0 48 -44 107 -136 107h-72v-214h72c91 0 136 58 136 107Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D68E" d="M464 109c0 -25 -47 -115 -179 -115c-129 0 -230 101 -230 223c0 123 96 223 215 223c130 0 194 -98 194 -212c0 -37 -19 -37 -40 -37h-298c16 -86 91 -136 166 -136c28 0 82 9 104 60c7 19 15 22 33 22c6 0 35 0 35 -28zM393 251c-9 103 -71 128 -123 128 c-70 0 -129 -55 -143 -128h266Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D69C" d="M459 125c0 -48 -32 -131 -190 -131c-28 0 -81 2 -130 38c-12 -37 -28 -38 -37 -38c-30 0 -30 25 -30 41v97c0 20 0 41 35 41c26 0 30 -11 35 -29c25 -78 81 -89 128 -89c91 0 128 33 128 70c0 53 -80 66 -129 74c-92 14 -197 31 -197 123c0 36 23 118 190 118 c19 0 63 0 107 -21c2 7 6 21 30 21c30 0 30 -25 30 -41v-69c0 -20 0 -41 -35 -41c-31 0 -33 17 -34 34c-3 26 -17 56 -100 56c-95 0 -127 -31 -127 -57c0 -39 68 -51 97 -55l68 -12c32 -5 161 -26 161 -130Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D69E" d="M512 31c0 -31 -25 -31 -41 -31h-73c-18 0 -39 0 -40 32c-37 -28 -78 -38 -119 -38c-73 0 -142 24 -142 120v256h-45c-14 0 -40 0 -40 30c0 31 25 31 41 31h73c34 0 40 -10 40 -41v-270c0 -32 0 -65 79 -65c32 0 113 12 113 102v213h-45c-14 0 -40 0 -40 30 c0 31 25 31 41 31h73c34 0 40 -10 40 -41v-329h45c14 0 40 0 40 -30Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D692" d="M455 30c0 -30 -26 -30 -41 -30h-295c-15 0 -41 0 -41 30c0 31 25 31 41 31h121v309h-113c-15 0 -41 0 -41 31c0 30 26 30 41 30h142c34 0 40 -10 40 -41v-329h105c15 0 41 0 41 -31zM313 555c0 -28 -22 -50 -50 -50s-50 22 -50 50s22 50 50 50s50 -22 50 -50Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D697" d="M512 30c0 -30 -26 -30 -40 -30h-153c-14 0 -41 0 -41 30c0 31 25 31 41 31h39v227c0 60 -14 88 -67 88c-51 0 -125 -38 -125 -138v-177h44c16 0 41 0 41 -31c0 -30 -26 -30 -40 -30h-159c-14 0 -40 0 -40 30c0 31 25 31 41 31h44v309h-45c-14 0 -40 0 -40 30 c0 31 25 31 41 31h73c40 0 40 -15 40 -47c19 19 64 53 131 53c79 0 130 -43 130 -144v-232h44c16 0 41 0 41 -31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D6A1" d="M496 30c0 -30 -27 -30 -41 -30h-117c-15 0 -40 0 -40 30c0 31 22 31 50 31l-89 123l-86 -123c31 0 52 0 52 -31c0 -30 -25 -30 -40 -30h-117c-14 0 -41 0 -41 30c0 31 26 31 41 31h40l124 161l-118 148h-40c-14 0 -41 0 -41 30c0 31 26 31 41 31h117c15 0 40 0 40 -30 c0 -31 -22 -31 -48 -31l76 -101l74 101c-27 0 -49 0 -49 31c0 30 25 30 40 30h117c15 0 41 0 41 -31c0 -30 -27 -30 -41 -30h-40l-114 -148l128 -161h40c15 0 41 0 41 -31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D6A2" d="M500 400c0 -30 -25 -30 -40 -30h-30l-155 -455c-4 -11 -49 -143 -149 -143c-49 0 -83 40 -83 82c0 26 17 44 44 44c25 0 43 -18 43 -43c0 -13 -5 -22 -5 -22c15 1 51 3 80 58c13 25 38 109 38 109s0 3 -4 13l-142 357h-31c-15 0 -40 0 -40 30c0 31 24 31 40 31h117 c16 0 40 0 40 -31c0 -30 -25 -30 -40 -30h-25l93 -240c7 -19 16 -40 21 -59h1c7 31 13 49 26 86l72 213h-28c-16 0 -40 0 -40 31c0 30 25 30 40 30h117c16 0 40 0 40 -31Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="890" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="1335" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1835" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2192" x="2502" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="3781" y="0"></use>
<g transform="translate(4170,0)">
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D69D" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D698" x="525" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D69D" x="1051" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D68A" x="1576" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D695" x="2102" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D681" x="2627" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D68E" x="3153" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D69C" x="3678" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D698" x="4204" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D695" x="4729" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D69E" x="5255" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D69D" x="5780" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D692" x="6306" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D698" x="6831" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D697" x="7357" y="0"></use>
<g transform="translate(7882,0)">
<text font-family="monospace" stroke="none" transform="scale(71.759) matrix(1 0 0 -1 0 0)">.</text>
</g>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D6A1" x="8659" y="0"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="13355" y="0"></use>
<g transform="translate(13800,0)">
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D69D" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D698" x="525" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D69D" x="1051" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D68A" x="1576" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D695" x="2102" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D681" x="2627" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D68E" x="3153" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D69C" x="3678" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D698" x="4204" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D695" x="4729" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D69E" x="5255" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D69D" x="5780" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D692" x="6306" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D698" x="6831" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D697" x="7357" y="0"></use>
<g transform="translate(7882,0)">
<text font-family="monospace" stroke="none" transform="scale(71.759) matrix(1 0 0 -1 0 0)">.</text>
</g>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D6A2" x="8659" y="0"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="22985" y="0"></use>
</g>
</svg> and the number of RGB pixel values
pointed to by <tt>rgb</tt> should be equal to <tt>outputBounds.Area()</tt>.

</p>
<p>If a non-floating-point image format is being used for output,
pixel values are converted to the sRGB representation (Section
10.4.1) and clamped
to the range <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.977ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 3004.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket 0 comma 255 right-bracket</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-35" d="M449 201c0 -127 -102 -223 -218 -223c-112 0 -181 97 -181 183c0 46 35 53 49 53c33 0 50 -25 50 -49s-17 -49 -50 -49c-11 0 -14 1 -17 2c17 -59 74 -112 147 -112c46 0 83 26 107 65c24 42 24 102 24 137c0 50 -2 89 -18 126c-8 18 -33 64 -85 64 c-81 0 -118 -54 -129 -70c-4 -6 -6 -9 -13 -9c-14 0 -14 8 -14 26v296c0 16 0 24 10 24c0 0 4 0 12 -3c47 -21 93 -28 133 -28c67 0 116 20 136 29c5 3 8 3 8 3c7 0 10 -5 10 -11c0 -13 -70 -104 -193 -104c-32 0 -65 7 -85 13v-195c36 35 79 51 127 51 c108 0 190 -100 190 -219Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="779" y="0"></use>
<g transform="translate(1224,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-32"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-35" x="500" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-35" x="1001" y="0"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="2725" y="0"></use>
</g>
</svg> before being written to the file.

</p>
<p></p>
<span class="anchor" id="fragment-ImageIODeclarations-1"></span><div class="fragmentname">&lt;&lt;ImageIO Declarations&gt;&gt;+=&nbsp;<a href="#fragment-ImageIODeclarations-0"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">void <span class="anchor" id="WriteImage"></span>WriteImage(const std::string &amp;name, const Float *rgb,
    const Bounds2i &amp;outputBounds, const <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> &amp;totalResolution);</div><p>


</p>
<p>We will not show the code that interfaces with the various image-writing
libraries or the code that implements file-format-specific I/O.  This code
can be found in the file <a href="https://github.com/mmp/pbrt-v3/tree/master/src/core/imageio.cpp"><tt>core/imageio.cpp</tt></a>
and the directory <tt>ext/</tt>.<button style="button" data-toggle="tooltip" data-placement="right" data-html="true" class="btn footnote-button" title="The
TGA implementation is based on open
source TGA code by Emil Mikulic; Jiawen &ldquo;Kevin&rdquo; Chen provided the PFM
reader and writer; PNG files are handled
using the <tt>lodepng</tt> library.">
      <sup>&dagger;</sup>
    </button>
		

</p>
<p>

</p>
<p>

</p>
<p>

</p>
<p>

</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

</div>  <!-- container-fluid -->
</div>  <!-- maincontainer -->

<nav class="navbar navbar-expand-md bg-light navbar-light">
  <div class="container-fluid-nav">
    <!--  <ul class="nav navbar-nav navbar-center"> -->
      <span class="navbar-text" style="text-align: center;">
        Thanks to Farhan Wali and 43 others for generously supporting <i>Physically
        Based Rendering</i> online
        through <a href="https://patreon.com/pbrbook">Patreon</a>.
    </span>
  </div>
</nav>

<nav class="navbar navbar-expand-md bg-light navbar-light">
  <span class="navbar-text"><i>Physically Based Rendering: From Theory To Implementation</i>, &copy; 2004-2021 Matt Pharr, Wenzel Jakob, and Greg Humphreys under the <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/">CC BY-NC-ND 4.0</a> license. (<a href="https://github.com/mmp/pbr-book-website/">github</a>)</span>
  <div class="container">
    <ul class="nav navbar-nav ml-auto">
      <li class="nav-item">Next: <a href="../Utilities/Communicating_with_the_User.html">Utilities / Communicating with the User</a></li>
    </ul>
  </div>

</nav>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script>
  $(function () {
    $('[data-toggle="popover"]').popover()
    $('[data-toggle="tooltip"]').tooltip()
   })
</script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

<script>
// https://stackoverflow.com/a/17535094
// The function actually applying the offset
function offsetAnchor() {
  if (location.hash.length !== 0) {
    window.scrollTo(window.scrollX, window.scrollY - window.innerHeight / 8);
  }
}

// Captures click events of all <a> elements with href starting with #
$(document).on('click', 'a[href^="#"]', function(event) {
  // Click events are captured before hashchanges. Timeout
  // causes offsetAnchor to be called after the page jump.
  window.setTimeout(function() {
    offsetAnchor();
  }, 500);
});

// Set the offset when entering page with hash present in the url
window.setTimeout(offsetAnchor, 1500);
</script>

</body>
</html>
