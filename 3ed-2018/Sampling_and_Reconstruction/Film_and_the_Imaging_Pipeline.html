
<!doctype html>
<html lang="en">
<head>

<!-- all praise to https://realfavicongenerator.net -->
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="/fonts.css">
  <link rel="stylesheet" href="../pbrstyle.css">
  <link rel="stylesheet" href="/fontawesome-free-5.15.3-web/css/all.css">

  <script async src="https://cse.google.com/cse.js?cx=003601324460585362024:4xwpwgaitgd"></script>
  <script src="/react.min.js"></script>
  <script src="/react-dom.min.js"></script>
  <script src="/jeri.min.js"></script>
  <link rel="preload" href="/exr.worker.js" as="script" crossorigin="anonymous">
        
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="/bootstrap.min.css">

  <title>Film and the Imaging Pipeline</title>
</head>
        
<body>

<nav class="fixed-top-lg-navbar navbar navbar-expand bg-light navbar-light">
  <ul class="nav navbar-nav">
    <a class="navbar-brand" href="../contents.html"><img src="../pbr.jpg" width=25 height=25></a>
    <li class="nav-item"><a class="nav-link" href="../Sampling_and_Reconstruction.html">Sampling and Reconstruction</a></li>
    <span class="navbar-text">/</span>
    <li class="nav-item"><a class="nav-link" href="#">Film and the Imaging Pipeline</a></li>
    <span class="navbar-text">&nbsp;&nbsp;</span>
    <li class="nav-item"><a class="nav-link" href="../Sampling_and_Reconstruction/Image_Reconstruction.html">(Previous: Image Reconstruction)</a></li>
  </ul>

  <ul class="nav navbar-nav ml-auto d-none d-md-block">
        <li class="nav-item"><div class="gcse-search"></div></li>
    </ul>
  <ul class="nav navbar-nav d-block d-md-none">
        <li class="nav-item"><div class="gcse-search"></div></li>
    </ul>
</nav>

<div class="maincontainer">
<div class="container-fluid">

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#"><i class="fas fa-link "></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:image-pipeline"></span><h2>7.9 Film and the Imaging Pipeline</h2><p>



</p>
<p>The type of film or sensor in a camera has a dramatic effect on the way
that incident light is transformed into colors in an image.  In <tt>pbrt</tt>, the
<a href="#Film"><tt>Film</tt></a> class models the sensing device in the simulated camera.  After
the radiance is found for each camera ray, the <a href="#Film"><tt>Film</tt></a> implementation
determines the sample&rsquo;s contribution to the pixels around the point on the
film plane where the camera ray began and updates its representation of the
image.  When the main rendering loop exits, the <a href="#Film"><tt>Film</tt></a> writes
the final image to a file.

</p>
<p>For realistic camera models, Section&nbsp;<a href="../Camera_Models/Realistic_Cameras.html#sec:camera-measurement-equation">6.4.7</a>
introduced the measurement equation, which describes how a sensor in a
camera measures the amount of energy arriving over the sensor area over a
period of time.  For simpler camera models, we can consider the sensor to
be measuring the average radiance over a small area over some period of
time.  The effect of the choice of which measurement to take is encapsulated in
the weight for the ray returned by <a href="../Camera_Models/Camera_Model.html#Camera::GenerateRayDifferential"><tt>Camera::GenerateRayDifferential()</tt></a>.
Therefore, the <tt>Film</tt> implementation can proceed without having to
account for these variations, as long as it scales the provided radiance
values by these weights.

</p>
<p>This section introduces a single <a href="#Film"><tt>Film</tt></a> implementation that applies the
pixel reconstruction equation to compute final pixel values.  For a
physically based renderer, it&rsquo;s generally best for the resulting images to
be stored in a floating-point image format.  Doing so provides more
flexibility in how the output can be used than if a traditional image
format with 8-bit unsigned integer values is used; floating-point formats
avoid the substantial loss of information that comes from quantizing images
to 8 bits.

</p>
<p>In order to display such images on modern display devices, it is
necessary to map these floating-point pixel values to discrete values for
display.  For example, computer monitors generally expect the color of each
pixel to be described by an RGB color triple, not an arbitrary spectral
power distribution.  Spectra described by general basis function
coefficients must therefore be converted to an RGB representation before
they can be displayed.  A related problem is that displays have a
substantially smaller range of displayable radiance values than the range
present in many real-world scenes.  Therefore, pixel values must be
mapped to the displayable range in a way that causes the final displayed
image to appear as close as possible to the way it would appear on an ideal
display device without this limitation.  These issues are addressed by
research into <em>tone mapping</em>; the &ldquo;Further Reading&rdquo; section has more
information about this topic.

</p>
<p>

</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#TheFilmClass"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:film"></span><span id="TheFilmClass"></span><h3>7.9.1  The Film Class</h3><p>



</p>
<p><span class="anchor" id="film.h"></span>


</p>
<p>

</p>
<p><a href="#Film"><tt>Film</tt></a> is defined in the files
<a href="https://github.com/mmp/pbrt-v3/tree/master/src/core/film.h"><tt>core/film.h</tt></a><span class="anchor" id="corefilm.h"></span> and
<a href="https://github.com/mmp/pbrt-v3/tree/master/src/core/film.cpp"><tt>core/film.cpp</tt></a><span class="anchor" id="corefilm.cpp"></span>.

</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-FilmDeclarations-0"></span><div class="fragmentname">&lt;&lt;Film Declarations&gt;&gt;=&nbsp;<a href="#fragment-FilmDeclarations-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">class <span class="anchor" id="Film"></span>Film {
public:
    &lt;&lt;<span class="fragmentname">Film Public Methods</span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-855" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-855"><i></i></a><div id="fragbit-855" class="collapse"><div class="fragmentcode">       <a href="#Film" class="code">Film</a>(const <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> &amp;resolution, const <a href="../Geometry_and_Transformations/Bounding_Boxes.html#Bounds2f" class="code">Bounds2f</a> &amp;cropWindow,
            std::unique_ptr&lt;Filter&gt; filter,
            Float diagonal, const std::string &amp;filename, Float scale);
       Bounds2i GetSampleBounds() const;
       <a href="../Geometry_and_Transformations/Bounding_Boxes.html#Bounds2f" class="code">Bounds2f</a> GetPhysicalExtent() const;
       std::unique_ptr&lt;FilmTile&gt; GetFilmTile(const Bounds2i &amp;sampleBounds);
       void MergeFilmTile(std::unique_ptr&lt;FilmTile&gt; tile);
       void SetImage(const <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> *img) const;
       void AddSplat(const <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> &amp;p, const <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> &amp;v);
       void WriteImage(Float splatScale = 1);
       void Clear();</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-FilmPublicData-0">Film Public Data</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-856" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-856"><i></i></a><div id="fragbit-856" class="collapse"><div class="fragmentcode">       const <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> fullResolution;
       const Float diagonal;
       std::unique_ptr&lt;Filter&gt; filter;
       const std::string filename;
       Bounds2i croppedPixelBounds;</div></div>
private:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-FilmPrivateData-0">Film Private Data</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-857" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-857"><i></i></a><div id="fragbit-857" class="collapse"><div class="fragmentcode">       struct Pixel {
           Float xyz[3] = { 0, 0, 0 };
           Float filterWeightSum = 0;
           AtomicFloat splatXYZ[3];
           Float pad;
       };
       std::unique_ptr&lt;Pixel[]&gt; pixels;
       static constexpr int filterTableWidth = 16;
       Float filterTable[filterTableWidth * filterTableWidth];
       std::mutex mutex;
       const Float scale;</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-FilmPrivateMethods-0">Film Private Methods</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-858" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-858"><i></i></a><div id="fragbit-858" class="collapse"><div class="fragmentcode">       Pixel &amp;GetPixel(const <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> &amp;p) {
           int width = <a href="#Film::croppedPixelBounds" class="code">croppedPixelBounds</a>.pMax.x - <a href="#Film::croppedPixelBounds" class="code">croppedPixelBounds</a>.pMin.x;
           int offset = (p.x - <a href="#Film::croppedPixelBounds" class="code">croppedPixelBounds</a>.pMin.x) +
               (p.y - <a href="#Film::croppedPixelBounds" class="code">croppedPixelBounds</a>.pMin.y) * width;
           return pixels[offset];
       }</div></div>
};</div><p>


</p>
<p>A number of values are passed to the constructor: the overall resolution of
the image in pixels; a crop window that may specify a subset of the image
to render; the length of the diagonal of the film&rsquo;s physical area, which is
specified to the constructor in millimeters but is converted to meters
here; a filter function; the filename for the output image and parameters
that control how the image pixel values are stored in files.

</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-FilmMethodDefinitions-0"></span><div class="fragmentname">&lt;&lt;Film Method Definitions&gt;&gt;=&nbsp;<a href="#fragment-FilmMethodDefinitions-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode"><a href="#Film" class="code">Film</a>::<a href="#Film" class="code">Film</a>(const <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> &amp;resolution, const <a href="../Geometry_and_Transformations/Bounding_Boxes.html#Bounds2f" class="code">Bounds2f</a> &amp;cropWindow,
        std::unique_ptr&lt;Filter&gt; filt, Float <a href="#Film::diagonal" class="code">diagonal</a>,
        const std::string &amp;<a href="#Film::filename" class="code">filename</a>, Float <a href="#Film::scale" class="code">scale</a>)
    : <a href="#Film::fullResolution" class="code">fullResolution</a>(resolution), <a href="#Film::diagonal" class="code">diagonal</a>(<a href="#Film::diagonal" class="code">diagonal</a> * .001),
      <a href="#Film::filter" class="code">filter</a>(std::move(filt)), <a href="#Film::filename" class="code">filename</a>(<a href="#Film::filename" class="code">filename</a>), <a href="#Film::scale" class="code">scale</a>(<a href="#Film::scale" class="code">scale</a>) {
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Computefilmimagebounds-0">Compute film image bounds</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-859" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-859"><i></i></a><div id="fragbit-859" class="collapse"><div class="fragmentcode">       <a href="#Film::croppedPixelBounds" class="code">croppedPixelBounds</a> =
           Bounds2i(<a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a>(std::ceil(<a href="#Film::fullResolution" class="code">fullResolution</a>.x * cropWindow.pMin.x),
                            std::ceil(<a href="#Film::fullResolution" class="code">fullResolution</a>.y * cropWindow.pMin.y)),
                    <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a>(std::ceil(<a href="#Film::fullResolution" class="code">fullResolution</a>.x * cropWindow.pMax.x),
                            std::ceil(<a href="#Film::fullResolution" class="code">fullResolution</a>.y * cropWindow.pMax.y)));</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Allocatefilmimagestorage-0">Allocate film image storage</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-860" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-860"><i></i></a><div id="fragbit-860" class="collapse"><div class="fragmentcode">       <a href="#Film::pixels" class="code">pixels</a> = std::unique_ptr&lt;Pixel[]&gt;(new Pixel[<a href="#Film::croppedPixelBounds" class="code">croppedPixelBounds</a>.Area()]);</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Precomputefilterweighttable-0">Precompute filter weight table</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-861" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-861"><i></i></a><div id="fragbit-861" class="collapse"><div class="fragmentcode">       int offset = 0;
       for (int y = 0; y &lt; filterTableWidth; ++y) {
           for (int x = 0; x &lt; filterTableWidth; ++x, ++offset) {
               <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> p;
               p.x = (x + 0.5f) * <a href="#Film::filter" class="code">filter</a>-&gt;<a href="../Sampling_and_Reconstruction/Image_Reconstruction.html#Filter::radius" class="code">radius</a>.x / filterTableWidth;
               p.y = (y + 0.5f) * <a href="#Film::filter" class="code">filter</a>-&gt;<a href="../Sampling_and_Reconstruction/Image_Reconstruction.html#Filter::radius" class="code">radius</a>.y / filterTableWidth;
               filterTable[offset] = <a href="#Film::filter" class="code">filter</a>-&gt;<a href="../Sampling_and_Reconstruction/Image_Reconstruction.html#Filter::Evaluate" class="code">Evaluate</a>(p);
           }
       }</div></div>
}</div><p>


</p>
<p></p>
<span class="anchor" id="fragment-FilmPublicData-0"></span><div class="fragmentname">&lt;&lt;Film Public Data&gt;&gt;=&nbsp;<a href="#fragment-FilmPublicData-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">const <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> <span class="anchor" id="Film::fullResolution"></span>fullResolution;
const Float <span class="anchor" id="Film::diagonal"></span>diagonal;
std::unique_ptr&lt;Filter&gt; <span class="anchor" id="Film::filter"></span>filter;
const std::string <span class="anchor" id="Film::filename"></span>filename;</div><p>


</p>
<p>In conjunction with the overall image resolution, the crop window gives the
bounds of pixels that need to be actually stored and written out.  Crop
windows are useful for debugging or for breaking a large image into small
pieces that can be rendered on different computers and reassembled later.
The crop window is specified in NDC space, with each coordinate ranging
from&nbsp;0 to&nbsp;1 (Figure&nbsp;<a href="#fig:crop-window">7.47</a>).

</p>
<p></p>
<span class="anchor" id="fig:crop-window"></span><div class="card outerfigure"><div class="card-body figure"><p>
 


</p>
<div class="figure-row">
  <a href="Crop%20window.svg" title=""><img src="Crop%20window.svg" width=299 height=306 style="max-width: 100%;"></a>
</div>
<p>


</p>
<figcaption class="caption">Figure 7.47: <span class="legend"> The image crop window specifies a subset of the
image to be rendered.  It is given in NDC space, with coordinates ranging
from <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.168ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2225.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis 0 comma 0 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="890" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="1335" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1835" y="0"></use>
</g>
</svg> to <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.168ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2225.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis 1 comma 1 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="890" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1335" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1835" y="0"></use>
</g>
</svg>.  The <a href="#Film"><tt>Film</tt></a> class only allocates space for and
stores pixel values in the region inside the crop window.</span>
</figcaption><p>


 </p>
</div></div><p>


</p>
<p><a href="#Film::croppedPixelBounds"><tt>Film::croppedPixelBounds</tt></a> stores the pixel bounds from the upper-left
to the lower-right corners of the crop window.  Fractional pixel
coordinates are rounded up; this ensures that if an image is rendered in
pieces with abutting crop windows, each final pixel will be present in only
one of the subimages.

</p>
<p></p>
<span class="anchor" id="fragment-Computefilmimagebounds-0"></span><div class="fragmentname">&lt;&lt;Compute film image bounds&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="#Film::croppedPixelBounds" class="code">croppedPixelBounds</a> =
    Bounds2i(<a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a>(std::ceil(<a href="#Film::fullResolution" class="code">fullResolution</a>.x * cropWindow.pMin.x),
                     std::ceil(<a href="#Film::fullResolution" class="code">fullResolution</a>.y * cropWindow.pMin.y)),
             <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a>(std::ceil(<a href="#Film::fullResolution" class="code">fullResolution</a>.x * cropWindow.pMax.x),
                     std::ceil(<a href="#Film::fullResolution" class="code">fullResolution</a>.y * cropWindow.pMax.y)));</div><p>


</p>
<p></p>
<span class="anchor" id="fragment-FilmPublicData-1"></span><div class="fragmentname">&lt;&lt;Film Public Data&gt;&gt;+=&nbsp;<a href="#fragment-FilmPublicData-0"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">Bounds2i <span class="anchor" id="Film::croppedPixelBounds"></span>croppedPixelBounds;</div><p>


</p>
<p>Given the pixel resolution of the (possibly cropped) image, the constructor
allocates an array of <a href="#Pixel"><tt>Pixel</tt></a> structures, one for each pixel.  The
running weighted sums of spectral pixel contributions are represented using
XYZ colors (Section&nbsp;<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#sec:color-xyz">5.2.1</a>) and are stored in the <tt>xyz</tt>
member variable. <tt>filterWeightSum</tt> holds the sum of filter weight
values for the sample contributions to the pixel.  <tt>splatXYZ</tt> holds an
(unweighted) sum of sample splats.  The <tt>pad</tt> member is unused; its
sole purpose is to ensure that the <tt>Pixel</tt> structure is 32 bytes
in size, rather than 28 as it would be otherwise (assuming 4-byte
<tt>Float</tt>s; otherwise, it ensures a 64-byte structure).  This padding
ensures that a <a href="#Pixel"><tt>Pixel</tt></a> won&rsquo;t straddle a cache line, so that no more
than one cache miss will be incurred when a <a href="#Pixel"><tt>Pixel</tt></a> is accessed (as
long as the first <a href="#Pixel"><tt>Pixel</tt></a> in the array is allocated at the start of a
cache line).

</p>
<p></p>
<span class="anchor" id="fragment-FilmPrivateData-0"></span><div class="fragmentname">&lt;&lt;Film Private Data&gt;&gt;=&nbsp;<a href="#fragment-FilmPrivateData-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">struct <span class="anchor" id="Pixel"></span>Pixel {
    Float <span class="anchor" id="Pixel::xyz"></span>xyz[3] = { 0, 0, 0 };
    Float <span class="anchor" id="Pixel::filterWeightSum"></span>filterWeightSum = 0;
    AtomicFloat <span class="anchor" id="Pixel::splatXYZ"></span>splatXYZ[3];
    Float pad;
};
std::unique_ptr&lt;Pixel[]&gt; <span class="anchor" id="Film::pixels"></span>pixels;</div><p>


</p>
<p></p>
<span class="anchor" id="fragment-Allocatefilmimagestorage-0"></span><div class="fragmentname">&lt;&lt;Allocate film image storage&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="#Film::pixels" class="code">pixels</a> = std::unique_ptr&lt;Pixel[]&gt;(new Pixel[<a href="#Film::croppedPixelBounds" class="code">croppedPixelBounds</a>.Area()]);</div><p>


</p>
<p>Two natural alternatives to using XYZ colors to store pixel values would be
to use <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum"><tt>Spectrum</tt></a> values or to store RGB color.  Here, it isn&rsquo;t
worthwhile to store complete <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum"><tt>Spectrum</tt></a> values, even when doing full
spectral rendering.  Because the final colors written to the output file
don&rsquo;t include the full set of <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum"><tt>Spectrum</tt></a> samples, converting to a
tristimulus value here doesn&rsquo;t represent a loss of information versus
storing <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum"><tt>Spectrum</tt></a>s and converting to a tristimulus value on image
output.  Not storing complete <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum"><tt>Spectrum</tt></a> values in this case can save a
substantial amount of memory if the <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum"><tt>Spectrum</tt></a> has a large number of
samples. (If <tt>pbrt</tt> supported saving <a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#SampledSpectrum"><tt>SampledSpectrum</tt></a> values to files,
then this design choice would need to be revisited.)

</p>
<p>We have chosen to use XYZ color rather than RGB to emphasize that XYZ is a
display-independent representation of color, while RGB requires assuming a
particular set of display response curves (Section&nbsp;<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#sec:rgb-to-spd">5.2.2</a>).
(In the end, we will, however, have to convert to RGB, since few image file
formats store XYZ color.)

</p>
<p>With typical filter settings, every image sample may contribute to 16 or
more pixels in the final image.  Particularly for simple scenes, where
relatively little time is spent on ray intersection testing and shading
computations, the time spent updating the image for each sample can be
significant.  Therefore, the <a href="#Film"><tt>Film</tt></a> precomputes a table of filter
values so that we can avoid the expense of
virtual function calls to the <a href="../Sampling_and_Reconstruction/Image_Reconstruction.html#Filter::Evaluate"><tt>Filter::Evaluate()</tt></a> method as well as
the expense of evaluating the filter and can instead use values from the
table for filtering.  The error introduced by not evaluating the filter at
each sample&rsquo;s precise location isn&rsquo;t noticeable in practice.

</p>
<p>The implementation here makes the reasonable assumption that the filter is
defined such that <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="18.877ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 8127.4 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">f left-parenthesis x comma y right-parenthesis equals f left-parenthesis StartAbsoluteValue x EndAbsoluteValue comma StartAbsoluteValue y EndAbsoluteValue right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-7C" d="M159 -230c0 -11 -9 -20 -20 -20s-20 9 -20 20v960c0 11 9 20 20 20s20 -9 20 -20v-960Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="552" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="942" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1514" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="1959" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2450" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="3117" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="4173" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="4726" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-7C" x="5115" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="5394" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-7C" x="5966" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="6245" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-7C" x="6690" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="6968" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-7C" x="7459" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="7737" y="0"></use>
</g>
</svg>, so the table needs to hold values
for only the positive quadrant of filter offsets.  This assumption is true
for all of the <a href="../Sampling_and_Reconstruction/Image_Reconstruction.html#Filter"><tt>Filter</tt></a>s currently available in <tt>pbrt</tt> and is true for
most filters used in practice.  This makes the table one-fourth the size
and improves the coherence of memory accesses, leading to better cache
performance.<button style="button" data-toggle="tooltip" data-placement="right" data-html="true" class="btn footnote-button" title="The implementation here could further take advantage
  of the fact that all filters currently in <tt>pbrt</tt> are separable, only
  allocating two 1D tables.  However, to more easily allow different filter
  functions to be added, we don&rsquo;t assume separability here.">
      <sup>&dagger;</sup>
    </button>
		

</p>
<p></p>
<span class="anchor" id="fragment-Precomputefilterweighttable-0"></span><div class="fragmentname">&lt;&lt;Precompute filter weight table&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">int offset = 0;
for (int y = 0; y &lt; filterTableWidth; ++y) {
    for (int x = 0; x &lt; filterTableWidth; ++x, ++offset) {
        <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> p;
        p.x = (x + 0.5f) * <a href="#Film::filter" class="code">filter</a>-&gt;<a href="../Sampling_and_Reconstruction/Image_Reconstruction.html#Filter::radius" class="code">radius</a>.x / filterTableWidth;
        p.y = (y + 0.5f) * <a href="#Film::filter" class="code">filter</a>-&gt;<a href="../Sampling_and_Reconstruction/Image_Reconstruction.html#Filter::radius" class="code">radius</a>.y / filterTableWidth;
        filterTable[offset] = <a href="#Film::filter" class="code">filter</a>-&gt;<a href="../Sampling_and_Reconstruction/Image_Reconstruction.html#Filter::Evaluate" class="code">Evaluate</a>(p);
    }
}</div><p>


</p>
<p></p>
<span class="anchor" id="fragment-FilmPrivateData-1"></span><div class="fragmentname">&lt;&lt;Film Private Data&gt;&gt;+=&nbsp;<a href="#fragment-FilmPrivateData-0"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-FilmPrivateData-2"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">static constexpr int <span class="anchor" id="Film::filterTableWidth"></span>filterTableWidth = 16;
Float <span class="anchor" id="Film::filterTable"></span>filterTable[filterTableWidth * filterTableWidth];</div><p>


</p>
<p>The <a href="#Film"><tt>Film</tt></a> implementation is responsible for determining the range of
integer pixel values that the <a href="../Sampling_and_Reconstruction/Sampling_Interface.html#Sampler"><tt>Sampler</tt></a> is responsible for generating
samples for.  The area to be sampled is returned by the
<tt>GetSampleBounds()</tt> method.  Because the pixel reconstruction filter
generally spans a number of pixels, the <a href="../Sampling_and_Reconstruction/Sampling_Interface.html#Sampler"><tt>Sampler</tt></a> must generate image samples a
bit outside of the range of pixels that will actually be output.  This way,
even pixels at the boundary of the image will have an equal density of
samples around them in all directions and won&rsquo;t be biased with only values
from toward the interior of the image.  This detail is also important when
rendering images in pieces with crop windows, since it eliminates artifacts
at the edges of the subimages.

</p>
<p>Computing the sample bounds involves accounting for the half-pixel offsets
when converting from discrete to continuous pixel coordinates, expanding by
the filter radius, and then rounding outward.

</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-FilmMethodDefinitions-1"></span><div class="fragmentname">&lt;&lt;Film Method Definitions&gt;&gt;+=&nbsp;<a href="#fragment-FilmMethodDefinitions-0"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-FilmMethodDefinitions-2"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">Bounds2i <a href="#Film" class="code">Film</a>::<span class="anchor" id="Film::GetSampleBounds"></span>GetSampleBounds() const {
    <a href="../Geometry_and_Transformations/Bounding_Boxes.html#Bounds2f" class="code">Bounds2f</a> floatBounds(
        <a href="../Geometry_and_Transformations/Points.html#Point2::Floor" class="code">Floor</a>(<a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a>(croppedPixelBounds.pMin) + <a href="../Geometry_and_Transformations/Vectors.html#Vector2f" class="code">Vector2f</a>(0.5f, 0.5f) -
              <a href="#Film::filter" class="code">filter</a>-&gt;<a href="../Sampling_and_Reconstruction/Image_Reconstruction.html#Filter::radius" class="code">radius</a>),
        <a href="../Geometry_and_Transformations/Points.html#Point2::Ceil" class="code">Ceil</a>( <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a>(croppedPixelBounds.pMax) - <a href="../Geometry_and_Transformations/Vectors.html#Vector2f" class="code">Vector2f</a>(0.5f, 0.5f) +
              <a href="#Film::filter" class="code">filter</a>-&gt;<a href="../Sampling_and_Reconstruction/Image_Reconstruction.html#Filter::radius" class="code">radius</a>));
    return (Bounds2i)floatBounds;
}</div><p>


</p>
<p><tt>GetPhysicalExtent()</tt> returns the actual extent of the film in the
scene.  This information is specifically needed by the <a href="../Camera_Models/Realistic_Cameras.html#RealisticCamera"><tt>RealisticCamera</tt></a>.
Given the length of the film diagonal and the aspect ratio of the image, we
can compute the size of the sensor in the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 572.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">x</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.139ex" height="2.009ex" style="vertical-align: -0.671ex;" viewBox="0 -576.1 490.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">y</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="0" y="0"></use>
</g>
</svg> directions.  If we
denote the diagonal length by <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.209ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 520.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">d</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D451" d="M516 683l-144 -578c-4 -17 -6 -24 -6 -48c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293 c45 0 74 -27 92 -64l60 237l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 13 6 18 14 19c17 2 112 11 127 11c13 0 13 -11 13 -11zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37 l50 196c1 5 3 11 3 17Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D451" x="0" y="0"></use>
</g>
</svg> and the width and height of the film
sensor by <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 572.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">x</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.139ex" height="2.009ex" style="vertical-align: -0.671ex;" viewBox="0 -576.1 490.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">y</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="0" y="0"></use>
</g>
</svg>, then we know that <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="12.779ex" height="2.843ex" style="vertical-align: -0.671ex;" viewBox="0 -934.9 5502.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">x squared plus y squared equals d squared</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D451" d="M516 683l-144 -578c-4 -17 -6 -24 -6 -48c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293 c45 0 74 -27 92 -64l60 237l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 13 6 18 14 19c17 2 112 11 127 11c13 0 13 -11 13 -11zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37 l50 196c1 5 3 11 3 17Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="809" y="513"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="1248" y="0"></use>
<g transform="translate(2249,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="693" y="513"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="3471" y="0"></use>
<g transform="translate(4527,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D451" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="736" y="513"></use>
</g>
</g>
</svg>.  We can define
the aspect ratio <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.23ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 529.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">a</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="0" y="0"></use>
</g>
</svg> of the image by <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.96ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 3427.1 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">a equals y slash x</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="807" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="1863" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="2354" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="2854" y="0"></use>
</g>
</svg>, so <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.797ex" height="2.009ex" style="vertical-align: -0.671ex;" viewBox="0 -576.1 2926.6 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">y equals a x</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="768" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="1824" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="2354" y="0"></use>
</g>
</svg>, which gives
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="17.063ex" height="3.009ex" style="vertical-align: -0.838ex;" viewBox="0 -934.9 7346.6 1295.7" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">x squared plus left-parenthesis a squared x squared right-parenthesis equals d squared</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D451" d="M516 683l-144 -578c-4 -17 -6 -24 -6 -48c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293 c45 0 74 -27 92 -64l60 237l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 13 6 18 14 19c17 2 112 11 127 11c13 0 13 -11 13 -11zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37 l50 196c1 5 3 11 3 17Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="809" y="513"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="1248" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="2249" y="0"></use>
<g transform="translate(2638,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="748" y="513"></use>
</g>
<g transform="translate(3622,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="809" y="513"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="4648" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="5315" y="0"></use>
<g transform="translate(6372,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D451" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="736" y="513"></use>
</g>
</g>
</svg>.  Solving for <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 572.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">x</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
</g>
</svg> gives
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="14.522ex" height="7.676ex" style="vertical-align: -3.171ex;" viewBox="0 -1939.5 6252.4 3304.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">x equals StartRoot StartFraction d squared Over 1 plus a squared EndFraction EndRoot period</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D451" d="M516 683l-144 -578c-4 -17 -6 -24 -6 -48c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293 c45 0 74 -27 92 -64l60 237l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 13 6 18 14 19c17 2 112 11 127 11c13 0 13 -11 13 -11zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37 l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNSIZE4-221A" d="M1020 1730l-554 -2954c-5 -26 -11 -26 -42 -26l-231 1343l-68 -132s-14 12 -14 16c0 0 1 3 6 13l132 260l216 -1255h1l512 2725c3 17 6 30 22 30c12 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="850" y="0"></use>
<g transform="translate(1906,0)">
 <use xlink:href="#E1-LATINMODERNSIZE4-221A" x="0" y="12"></use>
<rect stroke="none" width="3066" height="60" x="1000" y="1703"></rect>
<g transform="translate(1000,0)">
<g transform="translate(120,0)">
<rect stroke="none" width="2826" height="60" x="0" y="220"></rect>
<g transform="translate(926,676)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D451" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="736" y="408"></use>
</g>
<g transform="translate(60,-780)">
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="722" y="0"></use>
<g transform="translate(1723,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="748" y="408"></use>
</g>
</g>
</g>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="5973" y="0"></use>
</g>
</svg>
</div>
<p>

The implementation of <tt>GetPhysicalExtent()</tt>
follows directly.  The returned extent is centered around <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.168ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2225.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis 0 comma 0 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="890" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="1335" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1835" y="0"></use>
</g>
</svg>.

</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-FilmMethodDefinitions-2"></span><div class="fragmentname">&lt;&lt;Film Method Definitions&gt;&gt;+=&nbsp;<a href="#fragment-FilmMethodDefinitions-1"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-FilmMethodDefinitions-3"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode"><a href="../Geometry_and_Transformations/Bounding_Boxes.html#Bounds2f" class="code">Bounds2f</a> <span class="anchor" id="Film::GetPhysicalExtent"></span><a href="#Film" class="code">Film</a>::GetPhysicalExtent() const {
    Float aspect = (Float)<a href="#Film::fullResolution" class="code">fullResolution</a>.y / (Float)<a href="#Film::fullResolution" class="code">fullResolution</a>.x;
    Float x = std::sqrt(<a href="#Film::diagonal" class="code">diagonal</a> * <a href="#Film::diagonal" class="code">diagonal</a> / (1 + aspect * aspect));
    Float y = aspect * x;
    return <a href="../Geometry_and_Transformations/Bounding_Boxes.html#Bounds2f" class="code">Bounds2f</a>(<a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a>(-x / 2, -y / 2), <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a>(x / 2, y / 2));
}</div><p>


</p>
<p>

</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#SupplyingPixelValuestotheFilm"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span id="SupplyingPixelValuestotheFilm"></span><h3>7.9.2  Supplying Pixel Values to the Film</h3><p>


</p>
<p>There are three ways that the sample contributions can be provided to the
film.  The first is driven by samples generated by the <a href="../Sampling_and_Reconstruction/Sampling_Interface.html#Sampler"><tt>Sampler</tt></a> over
tiles of the image. While the most straightforward interface would be to
allow renderers to provide a film pixel location and a <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum"><tt>Spectrum</tt></a> with
the contribution of the corresponding ray directly to the <tt>Film</tt>, it&rsquo;s
not easy to provide a high-performance implementation of such a method in
the presence of multi-threading, where multiple threads may end up trying
to update the same portion of the image concurrently.

</p>
<p>Therefore, <a href="#Film"><tt>Film</tt></a> defines an interface where threads can specify that
they&rsquo;re generating samples in some extent of pixels with respect to the
overall image. Given the sample bounds, <tt>GetFilmTile()</tt> in turn
returns a pointer to a <tt>FilmTile</tt> object that stores contributions for
the pixels in the corresponding region of the image.  Ownership of the
<tt>FilmTile</tt> and the data it stores is exclusive to the caller, so that
thread can provide sample values to the <tt>FilmTile</tt> without worrying
about contention with other threads.  When it has finished work on the
tile, the thread passes the completed tile back to the <tt>Film</tt>, which
safely merges it into the final image.

</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-FilmMethodDefinitions-3"></span><div class="fragmentname">&lt;&lt;Film Method Definitions&gt;&gt;+=&nbsp;<a href="#fragment-FilmMethodDefinitions-2"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-FilmMethodDefinitions-4"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">std::unique_ptr&lt;FilmTile&gt; <span class="anchor" id="Film::GetFilmTile"></span><a href="#Film" class="code">Film</a>::GetFilmTile(
        const Bounds2i &amp;sampleBounds) {
    &lt;&lt;<span class="fragmentname"><a href="#fragment-BoundimagepixelsthatsamplesinmonosampleBoundscontributeto-0">Bound image pixels that samples in <tt>sampleBounds</tt> contribute to</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-862" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-862"><i></i></a><div id="fragbit-862" class="collapse"><div class="fragmentcode">       <a href="../Geometry_and_Transformations/Vectors.html#Vector2f" class="code">Vector2f</a> halfPixel = <a href="../Geometry_and_Transformations/Vectors.html#Vector2f" class="code">Vector2f</a>(0.5f, 0.5f);
       <a href="../Geometry_and_Transformations/Bounding_Boxes.html#Bounds2f" class="code">Bounds2f</a> floatBounds = (<a href="../Geometry_and_Transformations/Bounding_Boxes.html#Bounds2f" class="code">Bounds2f</a>)sampleBounds;
       <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> p0 = (<a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a>)<a href="../Geometry_and_Transformations/Points.html#Point2::Ceil" class="code">Ceil</a>(floatBounds.pMin - halfPixel -
                                  filter-&gt;radius);
       <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> p1 = (<a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a>)<a href="../Geometry_and_Transformations/Points.html#Point2::Floor" class="code">Floor</a>(floatBounds.pMax - halfPixel +
                                   filter-&gt;radius) + <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a>(1, 1);
       Bounds2i tilePixelBounds =
           <a href="../Geometry_and_Transformations/Bounding_Boxes.html#Bounds2::Intersect" class="code">Intersect</a>(Bounds2i(p0, p1), croppedPixelBounds);</div></div>
    return std::unique_ptr&lt;FilmTile&gt;(new FilmTile(tilePixelBounds,
        filter-&gt;radius, filterTable, filterTableWidth));
}</div><p>


</p>
<p>Given a bounding box of the pixel area that samples will be generated in,
there are two steps to compute the bounding box of image pixels that the
sample values will contribute to.  First, the effects of the
discrete-to-continuous pixel coordinate transformation and the radius of
the filter must be accounted for.  Second, the resulting bound must be
clipped to the overall image pixel bounds; pixels outside the image by
definition don&rsquo;t need to be accounted for.

</p>
<p></p>
<span class="anchor" id="fragment-BoundimagepixelsthatsamplesinmonosampleBoundscontributeto-0"></span><div class="fragmentname">&lt;&lt;Bound image pixels that samples in <tt>sampleBounds</tt> contribute to&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Geometry_and_Transformations/Vectors.html#Vector2f" class="code">Vector2f</a> halfPixel = <a href="../Geometry_and_Transformations/Vectors.html#Vector2f" class="code">Vector2f</a>(0.5f, 0.5f);
<a href="../Geometry_and_Transformations/Bounding_Boxes.html#Bounds2f" class="code">Bounds2f</a> floatBounds = (<a href="../Geometry_and_Transformations/Bounding_Boxes.html#Bounds2f" class="code">Bounds2f</a>)sampleBounds;
<a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> p0 = (<a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a>)<a href="../Geometry_and_Transformations/Points.html#Point2::Ceil" class="code">Ceil</a>(floatBounds.pMin - halfPixel -
                           filter-&gt;radius);
<a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> p1 = (<a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a>)<a href="../Geometry_and_Transformations/Points.html#Point2::Floor" class="code">Floor</a>(floatBounds.pMax - halfPixel +
                            filter-&gt;radius) + <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a>(1, 1);
Bounds2i tilePixelBounds =
    <a href="../Geometry_and_Transformations/Bounding_Boxes.html#Bounds2::Intersect" class="code">Intersect</a>(Bounds2i(p0, p1), croppedPixelBounds);</div><p>


</p>
<p></p>
<span class="anchor" id="fragment-FilmDeclarations-1"></span><div class="fragmentname">&lt;&lt;Film Declarations&gt;&gt;+=&nbsp;<a href="#fragment-FilmDeclarations-0"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">class <span class="anchor" id="FilmTile"></span>FilmTile {
public:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-FilmTilePublicMethods-0">FilmTile Public Methods</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-863" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-863"><i></i></a><div id="fragbit-863" class="collapse"><div class="fragmentcode">       FilmTile(const Bounds2i &amp;<a href="#FilmTile::pixelBounds" class="code">pixelBounds</a>, const <a href="../Geometry_and_Transformations/Vectors.html#Vector2f" class="code">Vector2f</a> &amp;filterRadius,
                const Float *filterTable, int filterTableSize)
           : <a href="#FilmTile::pixelBounds" class="code">pixelBounds</a>(<a href="#FilmTile::pixelBounds" class="code">pixelBounds</a>), filterRadius(filterRadius),
             invFilterRadius(1 / filterRadius.x, 1 / filterRadius.y),
             filterTable(filterTable), filterTableSize(filterTableSize) {
           <a href="#FilmTile::pixels" class="code">pixels</a> = std::vector&lt;FilmTilePixel&gt;(std::max(0, <a href="#FilmTile::pixelBounds" class="code">pixelBounds</a>.Area()));
       }
       void AddSample(const <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> &amp;pFilm, const <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> &amp;L,
               Float sampleWeight = 1.) {
           &lt;&lt;<span class="fragmentname"><a href="#fragment-Computesamplesrasterbounds-0">Compute sample&rsquo;s raster bounds</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-864" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-864"><i></i></a><div id="fragbit-864" class="collapse"><div class="fragmentcode">              <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> pFilmDiscrete = pFilm - <a href="../Geometry_and_Transformations/Vectors.html#Vector2f" class="code">Vector2f</a>(0.5f, 0.5f);
              <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> p0 = (<a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a>)<a href="../Geometry_and_Transformations/Points.html#Point2::Ceil" class="code">Ceil</a>(pFilmDiscrete - filterRadius);
              <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> p1 = (<a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a>)<a href="../Geometry_and_Transformations/Points.html#Point2::Floor" class="code">Floor</a>(pFilmDiscrete + filterRadius) + <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a>(1, 1);
              p0 = <a href="../Geometry_and_Transformations/Points.html#Point2::Max" class="code">Max</a>(p0, pixelBounds.pMin);
              p1 = <a href="../Geometry_and_Transformations/Points.html#Point2::Min" class="code">Min</a>(p1, pixelBounds.pMax);</div></div>
           &lt;&lt;<span class="fragmentname"><a href="#fragment-Loopoverfiltersupportandaddsampletopixelarrays-0">Loop over filter support and add sample to pixel arrays</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-865" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-865"><i></i></a><div id="fragbit-865" class="collapse"><div class="fragmentcode">              &lt;&lt;<span class="fragmentname"><a href="#fragment-Precomputexandyfiltertableoffsets-0">Precompute <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 572.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">x</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.139ex" height="2.009ex" style="vertical-align: -0.671ex;" viewBox="0 -576.1 490.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">y</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="0" y="0"></use>
</g>
</svg> filter table offsets</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-866" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-866"><i></i></a><div id="fragbit-866" class="collapse"><div class="fragmentcode">                 int *ifx = <a href="../Utilities/Memory_Management.html#ALLOCA" class="code">ALLOCA</a>(int, p1.x - p0.x);
                 for (int x = p0.x; x &lt; p1.x; ++x) {
                     Float fx = std::abs((x - pFilmDiscrete.x) * 
                                         invFilterRadius.x * filterTableSize);
                     ifx[x - p0.x] = std::min((int)std::floor(fx), filterTableSize - 1);
                 }
                 int *ify = <a href="../Utilities/Memory_Management.html#ALLOCA" class="code">ALLOCA</a>(int, p1.y - p0.y);
                 for (int y = p0.y; y &lt; p1.y; ++y) {
                     Float fy = std::abs((y - pFilmDiscrete.y) * 
                                         invFilterRadius.y * filterTableSize);
                     ify[y - p0.y] = std::min((int)std::floor(fy), filterTableSize - 1);
                 }</div></div>
              for (int y = p0.y; y &lt; p1.y; ++y) {
                  for (int x = p0.x; x &lt; p1.x; ++x) {
                      &lt;&lt;<span class="fragmentname"><a href="#fragment-Evaluatefiltervalueatxypixel-0">Evaluate filter value at <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.312ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2287.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis x comma y right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="962" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="1407" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1897" y="0"></use>
</g>
</svg> pixel</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-867" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-867"><i></i></a><div id="fragbit-867" class="collapse"><div class="fragmentcode">                         int offset = ify[y - p0.y] * filterTableSize + ifx[x - p0.x];
                         Float filterWeight = filterTable[offset];</div></div>
                      &lt;&lt;<span class="fragmentname"><a href="#fragment-Updatepixelvalueswithfilteredsamplecontribution-0">Update pixel values with filtered sample contribution</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-868" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-868"><i></i></a><div id="fragbit-868" class="collapse"><div class="fragmentcode">                         FilmTilePixel &amp;pixel = <a href="#FilmTile::GetPixel" class="code">GetPixel</a>(<a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a>(x, y));
                         pixel.<a href="#FilmTilePixel::contribSum" class="code">contribSum</a> += L * sampleWeight * filterWeight;
                         pixel.<a href="#FilmTilePixel::filterWeightSum" class="code">filterWeightSum</a> += filterWeight;</div></div>
                  }
              }</div></div>
       }
       FilmTilePixel &amp;GetPixel(const <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> &amp;p) {
           int width = <a href="#FilmTile::pixelBounds" class="code">pixelBounds</a>.pMax.x - <a href="#FilmTile::pixelBounds" class="code">pixelBounds</a>.pMin.x;
           int offset = (p.x - <a href="#FilmTile::pixelBounds" class="code">pixelBounds</a>.pMin.x) +
                        (p.y - <a href="#FilmTile::pixelBounds" class="code">pixelBounds</a>.pMin.y) * width;
           return <a href="#FilmTile::pixels" class="code">pixels</a>[offset];
       }
       const FilmTilePixel &amp;GetPixel(const <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> &amp;p) const {
           int width = <a href="#FilmTile::pixelBounds" class="code">pixelBounds</a>.pMax.x - <a href="#FilmTile::pixelBounds" class="code">pixelBounds</a>.pMin.x;
           int offset = (p.x - <a href="#FilmTile::pixelBounds" class="code">pixelBounds</a>.pMin.x) +
               (p.y - <a href="#FilmTile::pixelBounds" class="code">pixelBounds</a>.pMin.y) * width;
           return <a href="#FilmTile::pixels" class="code">pixels</a>[offset];
       }
       Bounds2i GetPixelBounds() const { return <a href="#FilmTile::pixelBounds" class="code">pixelBounds</a>; }</div></div>
private:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-FilmTilePrivateData-0">FilmTile Private Data</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-869" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-869"><i></i></a><div id="fragbit-869" class="collapse"><div class="fragmentcode">       const Bounds2i pixelBounds;
       const <a href="../Geometry_and_Transformations/Vectors.html#Vector2f" class="code">Vector2f</a> filterRadius, invFilterRadius;
       const Float *filterTable;
       const int filterTableSize;
       std::vector&lt;FilmTilePixel&gt; pixels;
       friend class <a href="#Film" class="code">Film</a>;</div></div>
};</div><p>


</p>
<p>The <tt>FilmTile</tt> constructor takes a 2D bounding box that gives the
bounds of the pixels in the final image that it must provide storage for as
well as additional information about the reconstruction filter being used,
including a pointer to the filter function values tabulated in
&lt;&lt;<span class="fragmentname"><a href="#fragment-Precomputefilterweighttable-0">Precompute filter weight table</a></span>&gt;&gt;.

</p>
<p></p>
<span class="anchor" id="fragment-FilmTilePublicMethods-0"></span><div class="fragmentname">&lt;&lt;FilmTile Public Methods&gt;&gt;=&nbsp;<a href="#fragment-FilmTilePublicMethods-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">FilmTile(const Bounds2i &amp;pixelBounds, const <a href="../Geometry_and_Transformations/Vectors.html#Vector2f" class="code">Vector2f</a> &amp;filterRadius,
         const Float *filterTable, int filterTableSize)
    : pixelBounds(pixelBounds), filterRadius(filterRadius),
      invFilterRadius(1 / filterRadius.x, 1 / filterRadius.y),
      filterTable(filterTable), filterTableSize(filterTableSize) {
    pixels = std::vector&lt;FilmTilePixel&gt;(std::max(0, pixelBounds.Area()));
}</div><p>


</p>
<p></p>
<span class="anchor" id="fragment-FilmTilePrivateData-0"></span><div class="fragmentname">&lt;&lt;FilmTile Private Data&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">const Bounds2i <span class="anchor" id="FilmTile::pixelBounds"></span>pixelBounds;
const <a href="../Geometry_and_Transformations/Vectors.html#Vector2f" class="code">Vector2f</a> <span class="anchor" id="FilmTile::filterRadius"></span>filterRadius, <span class="anchor" id="FilmTile::invFilterRadius"></span>invFilterRadius;
const Float *<span class="anchor" id="FilmTile::filterTable"></span>filterTable;
const int <span class="anchor" id="FilmTile::filterTableSize"></span>filterTableSize;
std::vector&lt;FilmTilePixel&gt; <span class="anchor" id="FilmTile::pixels"></span>pixels;</div><p>


</p>
<p>For each pixel, both a sum of the weighted contributions from the pixel
samples (according to the reconstruction filter weights) and a sum of the
filter weights is maintained.

</p>
<p></p>
<span class="anchor" id="fragment-FilmTilePixelDeclarations-0"></span><div class="fragmentname">&lt;&lt;FilmTilePixel Declarations&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">struct <span class="anchor" id="FilmTilePixel"></span>FilmTilePixel {
    <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> <span class="anchor" id="FilmTilePixel::contribSum"></span>contribSum = 0.f;
    Float <span class="anchor" id="FilmTilePixel::filterWeightSum"></span>filterWeightSum = 0.f;
};</div><p>


</p>
<p>Once the radiance carried by a ray for a sample has been computed, the
<a href="../Introduction/pbrt_System_Overview.html#Integrator"><tt>Integrator</tt></a> calls <a href="#FilmTile::AddSample"><tt>FilmTile::AddSample()</tt></a>.  It takes a sample and
corresponding radiance value as well as the weight for the sample&rsquo;s
contribution originally returned by
<a href="../Camera_Models/Camera_Model.html#Camera::GenerateRayDifferential"><tt>Camera::GenerateRayDifferential()</tt></a>.  It updates the stored image using
the reconstruction filter with the pixel filtering equation.

</p>
<p></p>
<span class="anchor" id="fragment-FilmTilePublicMethods-1"></span><div class="fragmentname">&lt;&lt;FilmTile Public Methods&gt;&gt;+=&nbsp;<a href="#fragment-FilmTilePublicMethods-0"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-FilmTilePublicMethods-2"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">void <span class="anchor" id="FilmTile::AddSample"></span>AddSample(const <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> &amp;pFilm, const <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> &amp;L,
        Float sampleWeight = 1.) {
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Computesamplesrasterbounds-0">Compute sample&rsquo;s raster bounds</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-870" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-870"><i></i></a><div id="fragbit-870" class="collapse"><div class="fragmentcode">       <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> pFilmDiscrete = pFilm - <a href="../Geometry_and_Transformations/Vectors.html#Vector2f" class="code">Vector2f</a>(0.5f, 0.5f);
       <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> p0 = (<a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a>)<a href="../Geometry_and_Transformations/Points.html#Point2::Ceil" class="code">Ceil</a>(pFilmDiscrete - filterRadius);
       <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> p1 = (<a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a>)<a href="../Geometry_and_Transformations/Points.html#Point2::Floor" class="code">Floor</a>(pFilmDiscrete + filterRadius) + <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a>(1, 1);
       p0 = <a href="../Geometry_and_Transformations/Points.html#Point2::Max" class="code">Max</a>(p0, pixelBounds.pMin);
       p1 = <a href="../Geometry_and_Transformations/Points.html#Point2::Min" class="code">Min</a>(p1, pixelBounds.pMax);</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Loopoverfiltersupportandaddsampletopixelarrays-0">Loop over filter support and add sample to pixel arrays</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-871" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-871"><i></i></a><div id="fragbit-871" class="collapse"><div class="fragmentcode">       &lt;&lt;<span class="fragmentname"><a href="#fragment-Precomputexandyfiltertableoffsets-0">Precompute <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 572.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">x</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.139ex" height="2.009ex" style="vertical-align: -0.671ex;" viewBox="0 -576.1 490.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">y</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="0" y="0"></use>
</g>
</svg> filter table offsets</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-872" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-872"><i></i></a><div id="fragbit-872" class="collapse"><div class="fragmentcode">          int *ifx = <a href="../Utilities/Memory_Management.html#ALLOCA" class="code">ALLOCA</a>(int, p1.x - p0.x);
          for (int x = p0.x; x &lt; p1.x; ++x) {
              Float fx = std::abs((x - pFilmDiscrete.x) * 
                                  invFilterRadius.x * filterTableSize);
              ifx[x - p0.x] = std::min((int)std::floor(fx), filterTableSize - 1);
          }
          int *ify = <a href="../Utilities/Memory_Management.html#ALLOCA" class="code">ALLOCA</a>(int, p1.y - p0.y);
          for (int y = p0.y; y &lt; p1.y; ++y) {
              Float fy = std::abs((y - pFilmDiscrete.y) * 
                                  invFilterRadius.y * filterTableSize);
              ify[y - p0.y] = std::min((int)std::floor(fy), filterTableSize - 1);
          }</div></div>
       for (int y = p0.y; y &lt; p1.y; ++y) {
           for (int x = p0.x; x &lt; p1.x; ++x) {
               &lt;&lt;<span class="fragmentname"><a href="#fragment-Evaluatefiltervalueatxypixel-0">Evaluate filter value at <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.312ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2287.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis x comma y right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="962" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="1407" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1897" y="0"></use>
</g>
</svg> pixel</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-873" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-873"><i></i></a><div id="fragbit-873" class="collapse"><div class="fragmentcode">                  int offset = ify[y - p0.y] * filterTableSize + ifx[x - p0.x];
                  Float filterWeight = filterTable[offset];</div></div>
               &lt;&lt;<span class="fragmentname"><a href="#fragment-Updatepixelvalueswithfilteredsamplecontribution-0">Update pixel values with filtered sample contribution</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-874" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-874"><i></i></a><div id="fragbit-874" class="collapse"><div class="fragmentcode">                  FilmTilePixel &amp;pixel = <a href="#FilmTile::GetPixel" class="code">GetPixel</a>(<a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a>(x, y));
                  pixel.<a href="#FilmTilePixel::contribSum" class="code">contribSum</a> += L * sampleWeight * filterWeight;
                  pixel.<a href="#FilmTilePixel::filterWeightSum" class="code">filterWeightSum</a> += filterWeight;</div></div>
           }
       }</div></div>
}</div><p>


</p>
<p>To understand the operation of <a href="#FilmTile::AddSample"><tt>FilmTile::AddSample()</tt></a>, first recall the pixel filtering equation:
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="48.878ex" height="6.509ex" style="vertical-align: -2.671ex;" viewBox="0 -1652.5 21044.7 2802.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper I left-parenthesis x comma y right-parenthesis equals StartFraction sigma-summation Underscript i Endscripts f left-parenthesis x minus x Subscript i Baseline comma y minus y Subscript i Baseline right-parenthesis w left-parenthesis x Subscript i Baseline comma y Subscript i Baseline right-parenthesis upper L left-parenthesis x Subscript i Baseline comma y Subscript i Baseline right-parenthesis Over sigma-summation Underscript i Endscripts f left-parenthesis x minus x Subscript i Baseline comma y minus y Subscript i Baseline right-parenthesis EndFraction period</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43C" d="M497 671c0 -19 -8 -19 -32 -19c-79 0 -82 -10 -91 -46l-134 -533c-2 -7 -4 -15 -4 -23c0 -11 4 -15 25 -17c20 -2 25 -2 43 -2c22 0 30 0 30 -12c0 -19 -12 -19 -20 -19l-134 3l-131 -3c-3 0 -15 0 -15 11c0 20 9 20 32 20c79 0 82 10 91 47l135 539c2 9 2 11 2 16 c0 19 -27 19 -69 19c-19 0 -28 0 -28 11c0 20 13 20 20 20l133 -3l132 3c4 0 15 0 15 -12Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNOPERATORS-2211" d="M999 -1l-86 -249h-829c-18 0 -27 0 -27 11c0 4 1 6 9 16l355 439l-365 502c0 31 1 32 28 32h829l86 -234h-25c-70 187 -300 194 -414 194h-396l325 -446c6 -9 7 -10 7 -14s-2 -7 -9 -16l-347 -429h425c147 0 216 24 232 29c85 29 152 90 177 165h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D464" d="M691 372c0 -48 -32 -182 -66 -260c-26 -60 -70 -123 -145 -123c-30 0 -99 6 -125 70c-40 -70 -87 -70 -104 -70c-75 0 -142 35 -142 126c0 38 12 84 56 202c7 17 18 45 18 70c0 32 -16 33 -25 33c-35 0 -74 -31 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c49 0 82 -37 82 -82c0 -20 -6 -34 -17 -64c-47 -123 -52 -162 -52 -194c0 -17 0 -91 80 -91c39 0 69 31 92 84c-1 5 -1 7 -1 18c0 18 2 36 9 66c7 26 54 217 57 224c7 20 25 28 37 28c15 0 29 -9 29 -27c0 -6 -10 -43 -15 -65l-42 -168 c-4 -14 -11 -45 -11 -73c0 -57 27 -87 74 -87c49 0 84 35 110 88c26 51 55 149 55 183c0 48 -25 74 -36 85c-9 8 -15 14 -15 27c0 22 25 48 50 48c17 0 44 -15 44 -70Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43F" d="M643 247c0 0 0 -3 -4 -14l-79 -216c-6 -17 -7 -17 -31 -17h-463c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 12 20 19 20l133 -3l148 3c5 0 16 0 16 -12 c0 -19 -8 -19 -38 -19c-94 0 -97 -11 -106 -47l-135 -540c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h94c173 0 217 114 251 206c7 16 8 21 17 21s12 -7 12 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43C" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="497" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="887" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1459" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="1904" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2395" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="3062" y="0"></use>
<g transform="translate(3840,0)">
<g transform="translate(397,0)">
<rect stroke="none" width="16407" height="60" x="0" y="220"></rect>
<g transform="translate(59,814)">
 <use xlink:href="#E1-LATINMODERNOPERATORS-2211" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1494" y="-405"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="1567" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="2119" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="2509" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="3304" y="0"></use>
<g transform="translate(4304,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="809" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="5221" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="5666" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="6379" y="0"></use>
<g transform="translate(7380,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="693" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="8215" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D464" x="8771" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="9487" y="0"></use>
<g transform="translate(9877,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="809" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="10794" y="0"></use>
<g transform="translate(11239,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="693" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="12074" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="12630" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="13311" y="0"></use>
<g transform="translate(13701,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="809" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="14618" y="0"></use>
<g transform="translate(15063,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="693" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="15898" y="0"></use>
</g>
<g transform="translate(3901,-771)">
 <use xlink:href="#E1-LATINMODERNOPERATORS-2211" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1494" y="-405"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="1567" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="2119" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="2509" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="3304" y="0"></use>
<g transform="translate(4304,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="809" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="5221" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="5666" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="6379" y="0"></use>
<g transform="translate(7380,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="693" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="8215" y="0"></use>
</g>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="20766" y="0"></use>
</g>
</svg>
</div>
<p>

It computes each pixel&rsquo;s value <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.468ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2784.7 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper I left-parenthesis x comma y right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43C" d="M497 671c0 -19 -8 -19 -32 -19c-79 0 -82 -10 -91 -46l-134 -533c-2 -7 -4 -15 -4 -23c0 -11 4 -15 25 -17c20 -2 25 -2 43 -2c22 0 30 0 30 -12c0 -19 -12 -19 -20 -19l-134 3l-131 -3c-3 0 -15 0 -15 11c0 20 9 20 32 20c79 0 82 10 91 47l135 539c2 9 2 11 2 16 c0 19 -27 19 -69 19c-19 0 -28 0 -28 11c0 20 13 20 20 20l133 -3l132 3c4 0 15 0 15 -12Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43C" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="497" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="887" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1459" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="1904" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2395" y="0"></use>
</g>
</svg> as the weighted sum of nearby
samples&rsquo; radiance values, using both a filter function&nbsp;<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.283ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 552.5 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">f</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="0" y="0"></use>
</g>
</svg> and the sample
weight returned by the <tt>Camera</tt> <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.576ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 3692.3 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">w left-parenthesis x Subscript i Baseline comma y Subscript i Baseline right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D464" d="M691 372c0 -48 -32 -182 -66 -260c-26 -60 -70 -123 -145 -123c-30 0 -99 6 -125 70c-40 -70 -87 -70 -104 -70c-75 0 -142 35 -142 126c0 38 12 84 56 202c7 17 18 45 18 70c0 32 -16 33 -25 33c-35 0 -74 -31 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c49 0 82 -37 82 -82c0 -20 -6 -34 -17 -64c-47 -123 -52 -162 -52 -194c0 -17 0 -91 80 -91c39 0 69 31 92 84c-1 5 -1 7 -1 18c0 18 2 36 9 66c7 26 54 217 57 224c7 20 25 28 37 28c15 0 29 -9 29 -27c0 -6 -10 -43 -15 -65l-42 -168 c-4 -14 -11 -45 -11 -73c0 -57 27 -87 74 -87c49 0 84 35 110 88c26 51 55 149 55 183c0 48 -25 74 -36 85c-9 8 -15 14 -15 27c0 22 25 48 50 48c17 0 44 -15 44 -70Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D464" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="716" y="0"></use>
<g transform="translate(1106,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="809" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="2022" y="0"></use>
<g transform="translate(2467,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="693" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="3302" y="0"></use>
</g>
</svg> to compute the
contribution of the radiance value to the final pixel value.  Because all
of the <a href="../Sampling_and_Reconstruction/Image_Reconstruction.html#Filter"><tt>Filter</tt></a>s in <tt>pbrt</tt> have finite extent, this method starts by
computing which pixels will be affected by the current sample.  Then,
turning the pixel filtering equation inside out, it updates two running
sums for each pixel <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.312ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2287.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis x comma y right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="962" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="1407" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1897" y="0"></use>
</g>
</svg> that is affected by the sample.  One sum
accumulates the numerator of the pixel filtering equation, and the other
accumulates the denominator.  At the end of rendering, 
the final pixel values are computed by performing the division.

</p>
<p>

</p>
<p>To find which pixels a sample potentially contributes to,
<a href="#FilmTile::AddSample"><tt>FilmTile::AddSample()</tt></a> converts the continuous sample coordinates to
discrete coordinates by subtracting <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.972ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 1279.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">0.5</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-35" d="M449 201c0 -127 -102 -223 -218 -223c-112 0 -181 97 -181 183c0 46 35 53 49 53c33 0 50 -25 50 -49s-17 -49 -50 -49c-11 0 -14 1 -17 2c17 -59 74 -112 147 -112c46 0 83 26 107 65c24 42 24 102 24 137c0 50 -2 89 -18 126c-8 18 -33 64 -85 64 c-81 0 -118 -54 -129 -70c-4 -6 -6 -9 -13 -9c-14 0 -14 8 -14 26v296c0 16 0 24 10 24c0 0 4 0 12 -3c47 -21 93 -28 133 -28c67 0 116 20 136 29c5 3 8 3 8 3c7 0 10 -5 10 -11c0 -13 -70 -104 -193 -104c-32 0 -65 7 -85 13v-195c36 35 79 51 127 51 c108 0 190 -100 190 -219Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-30"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="500" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-35" x="779" y="0"></use>
</g>
</svg> from&nbsp;<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 572.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">x</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
</g>
</svg> and&nbsp;<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.139ex" height="2.009ex" style="vertical-align: -0.671ex;" viewBox="0 -576.1 490.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">y</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="0" y="0"></use>
</g>
</svg>.  It then
offsets this value by the filter radius in each direction
(Figure&nbsp;<a href="#fig:sample-raster-extent">7.48</a>), transforms it to the tile
coordinate space, and takes the ceiling of the minimum coordinates and the
floor of the maximum, since pixels outside the bound of the extent are
unaffected by the sample.  Finally, the pixel bounds are
clipped to the bounds of the pixels in the tile.  While the sample may
theoretically contribute to pixels outside the tile, any such pixels must
be outside the image extent.

</p>
<p></p>
<span class="anchor" id="fig:sample-raster-extent"></span><div class="card outerfigure"><div class="card-body figure"><p>



</p>
<div class="figure-row">
  <a href="Sample%20pixel%20contributions.svg" title=""><img src="Sample%20pixel%20contributions.svg" width=312 height=261 style="max-width: 100%;"></a>
</div>
<p>


</p>
<figcaption class="caption">Figure 7.48: <span class="legend"> Given an image sample at some
position on the image plane (solid dot), it is necessary to determine which
pixel values (empty dots) are affected by the sample&rsquo;s contribution.  This
is done by taking the offsets in the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 572.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">x</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.139ex" height="2.009ex" style="vertical-align: -0.671ex;" viewBox="0 -576.1 490.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">y</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="0" y="0"></use>
</g>
</svg> directions according to
the pixel reconstruction filter&rsquo;s radius (solid lines) and finding the
pixels inside this region.</span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p></p>
<span class="anchor" id="fragment-Computesamplesrasterbounds-0"></span><div class="fragmentname">&lt;&lt;Compute sample&rsquo;s raster bounds&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> pFilmDiscrete = pFilm - <a href="../Geometry_and_Transformations/Vectors.html#Vector2f" class="code">Vector2f</a>(0.5f, 0.5f);
<a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> p0 = (<a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a>)<a href="../Geometry_and_Transformations/Points.html#Point2::Ceil" class="code">Ceil</a>(pFilmDiscrete - filterRadius);
<a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> p1 = (<a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a>)<a href="../Geometry_and_Transformations/Points.html#Point2::Floor" class="code">Floor</a>(pFilmDiscrete + filterRadius) + <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a>(1, 1);
p0 = <a href="../Geometry_and_Transformations/Points.html#Point2::Max" class="code">Max</a>(p0, pixelBounds.pMin);
p1 = <a href="../Geometry_and_Transformations/Points.html#Point2::Min" class="code">Min</a>(p1, pixelBounds.pMax);</div><p>


</p>
<p>Given the bounds of pixels that are affected by this sample, it&rsquo;s now
possible to loop over all of those pixels and accumulate the filtered
sample weights at each of them.

</p>
<p></p>
<span class="anchor" id="fragment-Loopoverfiltersupportandaddsampletopixelarrays-0"></span><div class="fragmentname">&lt;&lt;Loop over filter support and add sample to pixel arrays&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">&lt;&lt;<span class="fragmentname"><a href="#fragment-Precomputexandyfiltertableoffsets-0">Precompute <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 572.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">x</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.139ex" height="2.009ex" style="vertical-align: -0.671ex;" viewBox="0 -576.1 490.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">y</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="0" y="0"></use>
</g>
</svg> filter table offsets</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-875" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-875"><i></i></a><div id="fragbit-875" class="collapse"><div class="fragmentcode">   int *ifx = <a href="../Utilities/Memory_Management.html#ALLOCA" class="code">ALLOCA</a>(int, p1.x - p0.x);
   for (int x = p0.x; x &lt; p1.x; ++x) {
       Float fx = std::abs((x - pFilmDiscrete.x) * 
                           invFilterRadius.x * filterTableSize);
       ifx[x - p0.x] = std::min((int)std::floor(fx), filterTableSize - 1);
   }
   int *ify = <a href="../Utilities/Memory_Management.html#ALLOCA" class="code">ALLOCA</a>(int, p1.y - p0.y);
   for (int y = p0.y; y &lt; p1.y; ++y) {
       Float fy = std::abs((y - pFilmDiscrete.y) * 
                           invFilterRadius.y * filterTableSize);
       ify[y - p0.y] = std::min((int)std::floor(fy), filterTableSize - 1);
   }</div></div>
for (int y = p0.y; y &lt; p1.y; ++y) {
    for (int x = p0.x; x &lt; p1.x; ++x) {
        &lt;&lt;<span class="fragmentname"><a href="#fragment-Evaluatefiltervalueatxypixel-0">Evaluate filter value at <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.312ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2287.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis x comma y right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="962" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="1407" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1897" y="0"></use>
</g>
</svg> pixel</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-876" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-876"><i></i></a><div id="fragbit-876" class="collapse"><div class="fragmentcode">           int offset = ify[y - p0.y] * filterTableSize + ifx[x - p0.x];
           Float filterWeight = filterTable[offset];</div></div>
        &lt;&lt;<span class="fragmentname"><a href="#fragment-Updatepixelvalueswithfilteredsamplecontribution-0">Update pixel values with filtered sample contribution</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-877" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-877"><i></i></a><div id="fragbit-877" class="collapse"><div class="fragmentcode">           FilmTilePixel &amp;pixel = <a href="#FilmTile::GetPixel" class="code">GetPixel</a>(<a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a>(x, y));
           pixel.<a href="#FilmTilePixel::contribSum" class="code">contribSum</a> += L * sampleWeight * filterWeight;
           pixel.<a href="#FilmTilePixel::filterWeightSum" class="code">filterWeightSum</a> += filterWeight;</div></div>
    }
}</div><p>


</p>
<p>Each discrete integer pixel <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.312ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2287.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis x comma y right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="962" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="1407" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1897" y="0"></use>
</g>
</svg> has an instance of the filter function
centered around it.  To compute the filter weight for a particular sample,
it&rsquo;s necessary to find the offset from the pixel to the sample&rsquo;s
position in discrete coordinates and evaluate the filter function.  If we
were evaluating the filter explicitly, the appropriate computation would&nbsp;be
</p>
<div class="fragmentcode">    filterWeight = filter-&gt;Evaluate(Point2i(x - pFilmDiscrete.x,
                                            y - pFilmDiscrete.y));</div><p>

Instead, the implementation retrieves the appropriate filter weight from the table.

</p>
<p>To find the filter weight for a pixel <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.115ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 3063.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis x prime comma y prime right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
<g transform="translate(389,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="809" y="513"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1350" y="0"></use>
<g transform="translate(1795,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="693" y="513"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2673" y="0"></use>
</g>
</svg> given the sample position
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.312ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2287.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis x comma y right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="962" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="1407" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1897" y="0"></use>
</g>
</svg>, this routine computes the offset <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="15.265ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 6572.3 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis x prime minus x comma y prime minus y right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
<g transform="translate(389,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="809" y="513"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="1572" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="2573" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="3145" y="0"></use>
<g transform="translate(3590,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="693" y="513"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="4691" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="5692" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="6182" y="0"></use>
</g>
</svg> and converts it
into coordinates for the filter weights lookup table.  This can be done
directly by dividing each component of the sample offset by the filter
radius in that direction, giving a value between&nbsp;0 and&nbsp;1, and then
multiplying by the table size.  This process can be further optimized by
noting that along each row of pixels in the&nbsp;<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 572.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">x</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
</g>
</svg> direction, the difference
in&nbsp;<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.139ex" height="2.009ex" style="vertical-align: -0.671ex;" viewBox="0 -576.1 490.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">y</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="0" y="0"></use>
</g>
</svg>, and thus the&nbsp;<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.139ex" height="2.009ex" style="vertical-align: -0.671ex;" viewBox="0 -576.1 490.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">y</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="0" y="0"></use>
</g>
</svg> offset into the filter table, is constant.
Analogously, for each column of pixels, the&nbsp;<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 572.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">x</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
</g>
</svg> offset is constant.
Therefore, before looping over the pixels here it&rsquo;s possible to precompute
these indices and store them in two 1D arrays, saving repeated work in the
loop.

</p>
<p></p>
<span class="anchor" id="fragment-Precomputexandyfiltertableoffsets-0"></span><div class="fragmentname">&lt;&lt;Precompute <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 572.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">x</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.139ex" height="2.009ex" style="vertical-align: -0.671ex;" viewBox="0 -576.1 490.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">y</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="0" y="0"></use>
</g>
</svg> filter table offsets&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">int *ifx = <a href="../Utilities/Memory_Management.html#ALLOCA" class="code">ALLOCA</a>(int, p1.x - p0.x);
for (int x = p0.x; x &lt; p1.x; ++x) {
    Float fx = std::abs((x - pFilmDiscrete.x) * 
                        invFilterRadius.x * filterTableSize);
    ifx[x - p0.x] = std::min((int)std::floor(fx), filterTableSize - 1);
}
int *ify = <a href="../Utilities/Memory_Management.html#ALLOCA" class="code">ALLOCA</a>(int, p1.y - p0.y);
for (int y = p0.y; y &lt; p1.y; ++y) {
    Float fy = std::abs((y - pFilmDiscrete.y) * 
                        invFilterRadius.y * filterTableSize);
    ify[y - p0.y] = std::min((int)std::floor(fy), filterTableSize - 1);
}</div><p>


</p>
<p>Now at each pixel, the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 572.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">x</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.139ex" height="2.009ex" style="vertical-align: -0.671ex;" viewBox="0 -576.1 490.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">y</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="0" y="0"></use>
</g>
</svg> offsets into the filter table can be
found for the pixel, leading to the offset into the array and thus the
filter value.

</p>
<p></p>
<span class="anchor" id="fragment-Evaluatefiltervalueatxypixel-0"></span><div class="fragmentname">&lt;&lt;Evaluate filter value at <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.312ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2287.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis x comma y right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="962" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="1407" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1897" y="0"></use>
</g>
</svg> pixel&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">int offset = ify[y - p0.y] * filterTableSize + ifx[x - p0.x];
Float filterWeight = filterTable[offset];</div><p>


</p>
<p>

</p>
<p>For each affected pixel, we can now add its weighted spectral contribution
and the filter weight to the appropriate value in the <tt>pixels</tt> array.

</p>
<p></p>
<span class="anchor" id="fragment-Updatepixelvalueswithfilteredsamplecontribution-0"></span><div class="fragmentname">&lt;&lt;Update pixel values with filtered sample contribution&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">FilmTilePixel &amp;pixel = <a href="#FilmTile::GetPixel" class="code">GetPixel</a>(<a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a>(x, y));
pixel.<a href="#FilmTilePixel::contribSum" class="code">contribSum</a> += L * sampleWeight * filterWeight;
pixel.<a href="#FilmTilePixel::filterWeightSum" class="code">filterWeightSum</a> += filterWeight;</div><p>


</p>
<p>The <tt>GetPixel()</tt> method takes pixel coordinates with respect to the
overall image and converts them to coordinates in the film tile before
indexing into the <tt>pixels</tt> array.  In addition to the version here,
there is also a <tt>const</tt> variant of the method that returns a
<tt>const FilmTilePixel &amp;</tt>.

</p>
<p></p>
<span class="anchor" id="fragment-FilmTilePublicMethods-2"></span><div class="fragmentname">&lt;&lt;FilmTile Public Methods&gt;&gt;+=&nbsp;<a href="#fragment-FilmTilePublicMethods-1"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-FilmTilePublicMethods-3"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">FilmTilePixel &amp;<span class="anchor" id="FilmTile::GetPixel"></span>GetPixel(const <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> &amp;p) {
    int width = <a href="#FilmTile::pixelBounds" class="code">pixelBounds</a>.pMax.x - <a href="#FilmTile::pixelBounds" class="code">pixelBounds</a>.pMin.x;
    int offset = (p.x - <a href="#FilmTile::pixelBounds" class="code">pixelBounds</a>.pMin.x) +
                 (p.y - <a href="#FilmTile::pixelBounds" class="code">pixelBounds</a>.pMin.y) * width;
    return <a href="#FilmTile::pixels" class="code">pixels</a>[offset];
}</div><p>


</p>
<p>

</p>
<p>Rendering threads present <a href="#FilmTile"><tt>FilmTile</tt></a>s to be merged into the image
stored by <tt>Film</tt> using the <tt>MergeFilmTile()</tt> method.  Its
implementation starts by acquiring a lock to a mutex in order to ensure
that multiple threads aren&rsquo;t simultaneously modifying image pixel values.
Note that because <tt>MergeFilmTile()</tt> takes a <tt>std::unique_ptr</tt> to
the tile, ownership of the tile&rsquo;s memory is transferred when this method is
called.  Calling code should therefore no longer attempt to add
contributions to a tile after calling this method.  Storage for the
<tt>FilmTile</tt> is freed automatically at the end of the execution of
<tt>MergeFilmTile()</tt> when the <tt>tile</tt> parameter goes out of scope.

</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-FilmMethodDefinitions-4"></span><div class="fragmentname">&lt;&lt;Film Method Definitions&gt;&gt;+=&nbsp;<a href="#fragment-FilmMethodDefinitions-3"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-FilmMethodDefinitions-5"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">void <span class="anchor" id="Film::MergeFilmTile"></span><a href="#Film" class="code">Film</a>::MergeFilmTile(std::unique_ptr&lt;FilmTile&gt; tile) {
    std::lock_guard&lt;std::<a href="#Film::mutex" class="code">mutex</a>&gt; lock(<a href="#Film::mutex" class="code">mutex</a>);
    for (<a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> pixel : tile-&gt;<a href="#FilmTile::GetPixelBounds" class="code">GetPixelBounds</a>()) {
        &lt;&lt;<span class="fragmentname"><a href="#fragment-MergemonopixelintouseFilm::pixels-0">Merge <tt>pixel</tt> into <a href="#Film::pixels"><tt>Film::pixels</tt></a></a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-878" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-878"><i></i></a><div id="fragbit-878" class="collapse"><div class="fragmentcode">           const FilmTilePixel &amp;tilePixel = tile-&gt;<a href="#Film::GetPixel" class="code">GetPixel</a>(pixel);
           Pixel &amp;mergePixel = <a href="#Film::GetPixel" class="code">GetPixel</a>(pixel);
           Float <a href="#Pixel::xyz" class="code">xyz</a>[3];
           tilePixel.<a href="#FilmTilePixel::contribSum" class="code">contribSum</a>.<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#Spectrum::ToXYZ" class="code">ToXYZ</a>(<a href="#Pixel::xyz" class="code">xyz</a>);
           for (int i = 0; i &lt; 3; ++i)
               mergePixel.<a href="#Pixel::xyz" class="code">xyz</a>[i] += <a href="#Pixel::xyz" class="code">xyz</a>[i];
           mergePixel.<a href="#FilmTilePixel::filterWeightSum" class="code">filterWeightSum</a> += tilePixel.<a href="#FilmTilePixel::filterWeightSum" class="code">filterWeightSum</a>;</div></div>
    }
}</div><p>


</p>
<p></p>
<span class="anchor" id="fragment-FilmPrivateData-2"></span><div class="fragmentname">&lt;&lt;Film Private Data&gt;&gt;+=&nbsp;<a href="#fragment-FilmPrivateData-1"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-FilmPrivateData-3"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">std::mutex <span class="anchor" id="Film::mutex"></span>mutex;</div><p>


</p>
<p>When merging a tile&rsquo;s contributions in the final image, it&rsquo;s necessary for
calling code to be able to find the bound of pixels that the tile has
contributions for.

</p>
<p></p>
<span class="anchor" id="fragment-FilmTilePublicMethods-3"></span><div class="fragmentname">&lt;&lt;FilmTile Public Methods&gt;&gt;+=&nbsp;<a href="#fragment-FilmTilePublicMethods-2"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">Bounds2i <span class="anchor" id="FilmTile::GetPixelBounds"></span>GetPixelBounds() const { return <a href="#FilmTile::pixelBounds" class="code">pixelBounds</a>; }</div><p>


</p>
<p>For each pixel in the tile, it&rsquo;s just necessary to merge its contribution into
the values stored in <a href="#Film::pixels"><tt>Film::pixels</tt></a>. 

</p>
<p></p>
<span class="anchor" id="fragment-MergemonopixelintouseFilm::pixels-0"></span><div class="fragmentname">&lt;&lt;Merge <tt>pixel</tt> into <a href="#Film::pixels"><tt>Film::pixels</tt></a>&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">const FilmTilePixel &amp;tilePixel = tile-&gt;<a href="#Film::GetPixel" class="code">GetPixel</a>(pixel);
Pixel &amp;mergePixel = <a href="#Film::GetPixel" class="code">GetPixel</a>(pixel);
Float <a href="#Pixel::xyz" class="code">xyz</a>[3];
tilePixel.<a href="#FilmTilePixel::contribSum" class="code">contribSum</a>.<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#Spectrum::ToXYZ" class="code">ToXYZ</a>(<a href="#Pixel::xyz" class="code">xyz</a>);
for (int i = 0; i &lt; 3; ++i)
    mergePixel.<a href="#Pixel::xyz" class="code">xyz</a>[i] += <a href="#Pixel::xyz" class="code">xyz</a>[i];
mergePixel.<a href="#FilmTilePixel::filterWeightSum" class="code">filterWeightSum</a> += tilePixel.<a href="#FilmTilePixel::filterWeightSum" class="code">filterWeightSum</a>;</div><p>


</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-FilmPrivateMethods-0"></span><div class="fragmentname">&lt;&lt;Film Private Methods&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Pixel &amp;<span class="anchor" id="Film::GetPixel"></span>GetPixel(const <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> &amp;p) {
    int width = <a href="#Film::croppedPixelBounds" class="code">croppedPixelBounds</a>.pMax.x - <a href="#Film::croppedPixelBounds" class="code">croppedPixelBounds</a>.pMin.x;
    int offset = (p.x - <a href="#Film::croppedPixelBounds" class="code">croppedPixelBounds</a>.pMin.x) +
        (p.y - <a href="#Film::croppedPixelBounds" class="code">croppedPixelBounds</a>.pMin.y) * width;
    return pixels[offset];
}</div><p>


</p>
<p>It&rsquo;s also useful for some <a href="../Introduction/pbrt_System_Overview.html#Integrator"><tt>Integrator</tt></a> implementations to be able to
just provide values for all of the pixels in the entire image all at once.
The <tt>SetImage()</tt> method allows this mode of operation.  Note that
the number of elements in the array pointed to by the <tt>image</tt> parameter
should be equal to <tt>croppedPixelBounds.Area()</tt>.  The implementation of
<tt>SetImage()</tt> is a straightforward matter of copying the given values
after converting them to XYZ color.

</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-FilmMethodDefinitions-5"></span><div class="fragmentname">&lt;&lt;Film Method Definitions&gt;&gt;+=&nbsp;<a href="#fragment-FilmMethodDefinitions-4"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-FilmMethodDefinitions-6"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">void <span class="anchor" id="Film::SetImage"></span><a href="#Film" class="code">Film</a>::SetImage(const <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> *img) const {
    int nPixels = <a href="#Film::croppedPixelBounds" class="code">croppedPixelBounds</a>.Area();
    for (int i = 0; i &lt; nPixels; ++i) {
        Pixel &amp;p = <a href="#Film::pixels" class="code">pixels</a>[i];
        img[i].<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#Spectrum::ToXYZ" class="code">ToXYZ</a>(p.<a href="#Pixel::xyz" class="code">xyz</a>);
        p.<a href="#Pixel::filterWeightSum" class="code">filterWeightSum</a> = 1;
        p.<a href="#Pixel::splatXYZ" class="code">splatXYZ</a>[0] = p.<a href="#Pixel::splatXYZ" class="code">splatXYZ</a>[1] = p.<a href="#Pixel::splatXYZ" class="code">splatXYZ</a>[2] = 0;
    }
}</div><p>


</p>
<p>Some light transport algorithms (notably bidirectional path tracing, which
is introduced in Section&nbsp;<a href="../Light_Transport_III_Bidirectional_Methods/Bidirectional_Path_Tracing.html#sec:bidir-path-tracing">16.3</a>) require the ability
to &ldquo;splat&rdquo; contributions to arbitrary pixels.  Rather than computing the
final pixel value as a weighted average of contributing splats, splats are
simply summed. Generally, the more splats that are around a given pixel, the
brighter the pixel will be.  The <a href="#Pixel::splatXYZ"><tt>Pixel::splatXYZ</tt></a> member variable is
declared to be of <a href="../Utilities/Parallelism.html#AtomicFloat"><tt>AtomicFloat</tt></a> type, which allows multiple threads to
concurrently update pixel values via the <tt>AddSplat()</tt> method without
additional synchronization.

</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-FilmMethodDefinitions-6"></span><div class="fragmentname">&lt;&lt;Film Method Definitions&gt;&gt;+=&nbsp;<a href="#fragment-FilmMethodDefinitions-5"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-FilmMethodDefinitions-7"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">void <span class="anchor" id="Film::AddSplat"></span><a href="#Film" class="code">Film</a>::AddSplat(const <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> &amp;p, const <a href="../Color_and_Radiometry/Spectral_Representation.html#Spectrum" class="code">Spectrum</a> &amp;v) {
    if (!<a href="../Geometry_and_Transformations/Bounding_Boxes.html#Bounds2::InsideExclusive" class="code">InsideExclusive</a>((<a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a>)p, <a href="#Film::croppedPixelBounds" class="code">croppedPixelBounds</a>))
        return;
    Float xyz[3];
    v.<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#Spectrum::ToXYZ" class="code">ToXYZ</a>(xyz);
    Pixel &amp;pixel = <a href="#Film::GetPixel" class="code">GetPixel</a>((<a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a>)p);
    for (int i = 0; i &lt; 3; ++i)
        pixel.<a href="#Pixel::splatXYZ" class="code">splatXYZ</a>[i].<a href="../Utilities/Parallelism.html#AtomicFloat::Add" class="code">Add</a>(xyz[i]);
}</div><p>


</p>
<p>

</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#ImageOutput"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="ex:sampling-exercise-scrambledradical"></span><span id="ImageOutput"></span><h3>7.9.3  Image Output</h3><p>


</p>
<p>After the main rendering loop exits, the <tt>Integrator</tt>&rsquo;s
<tt>Render()</tt> method generally calls the <a href="#Film::WriteImage"><tt>Film::WriteImage()</tt></a> method,
which directs the film to do the processing necessary to generate the final
image and store it in a file. This method takes a scale factor that is
applied to the samples provided to the <tt>AddSplat()</tt> method.  (See the
end of Section&nbsp;<a href="../Light_Transport_III_Bidirectional_Methods/Metropolis_Light_Transport.html#sec:mlt-integrator">16.4.5</a> for further discussion of this
scale factor&rsquo;s use with the <a href="../Light_Transport_III_Bidirectional_Methods/Metropolis_Light_Transport.html#MLTIntegrator"><tt>MLTIntegrator</tt></a>.)

</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-FilmMethodDefinitions-7"></span><div class="fragmentname">&lt;&lt;Film Method Definitions&gt;&gt;+=&nbsp;<a href="#fragment-FilmMethodDefinitions-6"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">void <a href="#Film" class="code">Film</a>::<span class="anchor" id="Film::WriteImage"></span>WriteImage(Float splatScale) {
    &lt;&lt;<span class="fragmentname"><a href="#fragment-ConvertimagetoRGBandcomputefinalpixelvalues-0">Convert image to RGB and compute final pixel values</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-879" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-879"><i></i></a><div id="fragbit-879" class="collapse"><div class="fragmentcode">       std::unique_ptr&lt;Float[]&gt; rgb(new Float[3 * <a href="#Film::croppedPixelBounds" class="code">croppedPixelBounds</a>.Area()]);
       int offset = 0;
       for (<a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> p : <a href="#Film::croppedPixelBounds" class="code">croppedPixelBounds</a>) {
           &lt;&lt;<span class="fragmentname"><a href="#fragment-ConvertpixelXYZcolortoRGB-0">Convert pixel XYZ color to RGB</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-880" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-880"><i></i></a><div id="fragbit-880" class="collapse"><div class="fragmentcode">              Pixel &amp;pixel = <a href="#Film::GetPixel" class="code">GetPixel</a>(p);
              <a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#XYZToRGB" class="code">XYZToRGB</a>(pixel.<a href="#Pixel::xyz" class="code">xyz</a>, &amp;rgb[3 * offset]);</div></div>
           &lt;&lt;<span class="fragmentname"><a href="#fragment-Normalizepixelwithweightsum-0">Normalize pixel with weight sum</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-881" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-881"><i></i></a><div id="fragbit-881" class="collapse"><div class="fragmentcode">              Float <a href="#Pixel::filterWeightSum" class="code">filterWeightSum</a> = pixel.<a href="#Pixel::filterWeightSum" class="code">filterWeightSum</a>;
              if (<a href="#Pixel::filterWeightSum" class="code">filterWeightSum</a> != 0) {
                  Float invWt = (Float)1 / <a href="#Pixel::filterWeightSum" class="code">filterWeightSum</a>;
                  rgb[3 * offset  ] = std::max((Float)0, rgb[3 * offset    ] * invWt);
                  rgb[3 * offset+1] = std::max((Float)0, rgb[3 * offset + 1] * invWt);
                  rgb[3 * offset+2] = std::max((Float)0, rgb[3 * offset + 2] * invWt);
              }</div></div>
           &lt;&lt;<span class="fragmentname"><a href="#fragment-Addsplatvalueatpixel-0">Add splat value at pixel</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-882" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-882"><i></i></a><div id="fragbit-882" class="collapse"><div class="fragmentcode">              Float splatRGB[3];
              Float <a href="#Pixel::splatXYZ" class="code">splatXYZ</a>[3] = { pixel.<a href="#Pixel::splatXYZ" class="code">splatXYZ</a>[0], pixel.<a href="#Pixel::splatXYZ" class="code">splatXYZ</a>[1],
                                    pixel.<a href="#Pixel::splatXYZ" class="code">splatXYZ</a>[2] };
              <a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#XYZToRGB" class="code">XYZToRGB</a>(<a href="#Pixel::splatXYZ" class="code">splatXYZ</a>, splatRGB);
              rgb[3 * offset    ] += splatScale * splatRGB[0];
              rgb[3 * offset + 1] += splatScale * splatRGB[1];
              rgb[3 * offset + 2] += splatScale * splatRGB[2];</div></div>
           &lt;&lt;<span class="fragmentname"><a href="#fragment-Scalepixelvaluebymonoscale-0">Scale pixel value by <tt>scale</tt></a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-883" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-883"><i></i></a><div id="fragbit-883" class="collapse"><div class="fragmentcode">              rgb[3 * offset    ] *= <a href="#Film::scale" class="code">scale</a>;
              rgb[3 * offset + 1] *= <a href="#Film::scale" class="code">scale</a>;
              rgb[3 * offset + 2] *= <a href="#Film::scale" class="code">scale</a>;</div></div>
           ++offset;
       }</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-WriteRGBimage-0">Write RGB image</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-884" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-884"><i></i></a><div id="fragbit-884" class="collapse"><div class="fragmentcode">       ::<a href="../Utilities/Image_File_Input_and_Output.html#WriteImage" class="code">WriteImage</a>(<a href="#Film::filename" class="code">filename</a>, &amp;rgb[0], croppedPixelBounds, <a href="#Film::fullResolution" class="code">fullResolution</a>);</div></div>
}</div><p>


</p>
<p>This method starts by allocating an array to store the final RGB pixel
values.  It then loops over all of the pixels in the image to fill in this
array.

</p>
<p></p>
<span class="anchor" id="fragment-ConvertimagetoRGBandcomputefinalpixelvalues-0"></span><div class="fragmentname">&lt;&lt;Convert image to RGB and compute final pixel values&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">std::unique_ptr&lt;Float[]&gt; rgb(new Float[3 * <a href="#Film::croppedPixelBounds" class="code">croppedPixelBounds</a>.Area()]);
int offset = 0;
for (<a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> p : <a href="#Film::croppedPixelBounds" class="code">croppedPixelBounds</a>) {
    &lt;&lt;<span class="fragmentname"><a href="#fragment-ConvertpixelXYZcolortoRGB-0">Convert pixel XYZ color to RGB</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-885" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-885"><i></i></a><div id="fragbit-885" class="collapse"><div class="fragmentcode">       Pixel &amp;pixel = <a href="#Film::GetPixel" class="code">GetPixel</a>(p);
       <a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#XYZToRGB" class="code">XYZToRGB</a>(pixel.<a href="#Pixel::xyz" class="code">xyz</a>, &amp;rgb[3 * offset]);</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Normalizepixelwithweightsum-0">Normalize pixel with weight sum</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-886" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-886"><i></i></a><div id="fragbit-886" class="collapse"><div class="fragmentcode">       Float <a href="#Pixel::filterWeightSum" class="code">filterWeightSum</a> = pixel.<a href="#Pixel::filterWeightSum" class="code">filterWeightSum</a>;
       if (<a href="#Pixel::filterWeightSum" class="code">filterWeightSum</a> != 0) {
           Float invWt = (Float)1 / <a href="#Pixel::filterWeightSum" class="code">filterWeightSum</a>;
           rgb[3 * offset  ] = std::max((Float)0, rgb[3 * offset    ] * invWt);
           rgb[3 * offset+1] = std::max((Float)0, rgb[3 * offset + 1] * invWt);
           rgb[3 * offset+2] = std::max((Float)0, rgb[3 * offset + 2] * invWt);
       }</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Addsplatvalueatpixel-0">Add splat value at pixel</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-887" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-887"><i></i></a><div id="fragbit-887" class="collapse"><div class="fragmentcode">       Float splatRGB[3];
       Float <a href="#Pixel::splatXYZ" class="code">splatXYZ</a>[3] = { pixel.<a href="#Pixel::splatXYZ" class="code">splatXYZ</a>[0], pixel.<a href="#Pixel::splatXYZ" class="code">splatXYZ</a>[1],
                             pixel.<a href="#Pixel::splatXYZ" class="code">splatXYZ</a>[2] };
       <a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#XYZToRGB" class="code">XYZToRGB</a>(<a href="#Pixel::splatXYZ" class="code">splatXYZ</a>, splatRGB);
       rgb[3 * offset    ] += splatScale * splatRGB[0];
       rgb[3 * offset + 1] += splatScale * splatRGB[1];
       rgb[3 * offset + 2] += splatScale * splatRGB[2];</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Scalepixelvaluebymonoscale-0">Scale pixel value by <tt>scale</tt></a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-888" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-888"><i></i></a><div id="fragbit-888" class="collapse"><div class="fragmentcode">       rgb[3 * offset    ] *= <a href="#Film::scale" class="code">scale</a>;
       rgb[3 * offset + 1] *= <a href="#Film::scale" class="code">scale</a>;
       rgb[3 * offset + 2] *= <a href="#Film::scale" class="code">scale</a>;</div></div>
    ++offset;
}</div><p>


</p>
<p>Given information about the response characteristics of the display device
being used, the pixel values can be converted to device-dependent RGB values
from the device-independent XYZ tristimulus values.  This conversion is
another change of spectral basis, where the new basis is determined by the
spectral response curves of the red, green, and blue elements of the
display device.  Here, weights to convert from XYZ to the device RGB based
on the sRGB primaries are used;  sRGB is a standardized color space that is
supported by virtually all 2015-era displays and printers.

</p>
<p></p>
<span class="anchor" id="fragment-ConvertpixelXYZcolortoRGB-0"></span><div class="fragmentname">&lt;&lt;Convert pixel XYZ color to RGB&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Pixel &amp;pixel = <a href="#Film::GetPixel" class="code">GetPixel</a>(p);
<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#XYZToRGB" class="code">XYZToRGB</a>(pixel.<a href="#Pixel::xyz" class="code">xyz</a>, &amp;rgb[3 * offset]);</div><p>


</p>
<p>As the RGB output values are being initialized, their final values from the
pixel filtering equation are computed by dividing each pixel sample value
by <a href="#Pixel::filterWeightSum"><tt>Pixel::filterWeightSum</tt></a>.  This conversion can lead to RGB values
where some components are negative; these are <em>out-of-gamut</em> colors
that can&rsquo;t be represented with the chosen display primaries.  Various
approaches have been suggested to deal with this issue, ranging from
clamping to&nbsp;0, offsetting all components to lie within the gamut, or
even performing a global optimization based on all of the pixels in the
image.  Reconstructed pixels may also end up with negative values due to
negative lobes in the reconstruction filter function.  Color components are
clamped to&nbsp;0 here to handle both of these cases.

</p>
<p></p>
<span class="anchor" id="fragment-Normalizepixelwithweightsum-0"></span><div class="fragmentname">&lt;&lt;Normalize pixel with weight sum&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Float <a href="#Pixel::filterWeightSum" class="code">filterWeightSum</a> = pixel.<a href="#Pixel::filterWeightSum" class="code">filterWeightSum</a>;
if (<a href="#Pixel::filterWeightSum" class="code">filterWeightSum</a> != 0) {
    Float invWt = (Float)1 / <a href="#Pixel::filterWeightSum" class="code">filterWeightSum</a>;
    rgb[3 * offset  ] = std::max((Float)0, rgb[3 * offset    ] * invWt);
    rgb[3 * offset+1] = std::max((Float)0, rgb[3 * offset + 1] * invWt);
    rgb[3 * offset+2] = std::max((Float)0, rgb[3 * offset + 2] * invWt);
}</div><p>


</p>
<p>It&rsquo;s also necessary to add in the contributions of splatted values for this
pixel to the final value.

</p>
<p></p>
<span class="anchor" id="fragment-Addsplatvalueatpixel-0"></span><div class="fragmentname">&lt;&lt;Add splat value at pixel&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Float splatRGB[3];
Float <a href="#Pixel::splatXYZ" class="code">splatXYZ</a>[3] = { pixel.<a href="#Pixel::splatXYZ" class="code">splatXYZ</a>[0], pixel.<a href="#Pixel::splatXYZ" class="code">splatXYZ</a>[1],
                      pixel.<a href="#Pixel::splatXYZ" class="code">splatXYZ</a>[2] };
<a href="../Color_and_Radiometry/The_SampledSpectrum_Class.html#XYZToRGB" class="code">XYZToRGB</a>(<a href="#Pixel::splatXYZ" class="code">splatXYZ</a>, splatRGB);
rgb[3 * offset    ] += splatScale * splatRGB[0];
rgb[3 * offset + 1] += splatScale * splatRGB[1];
rgb[3 * offset + 2] += splatScale * splatRGB[2];</div><p>


</p>
<p>The final pixel value is scaled by a user-supplied factor (or by&nbsp;1, if
none was specified); this can be useful when writing images to 8-bit
integer image formats to make the most of the limited dynamic range.

</p>
<p></p>
<span class="anchor" id="fragment-Scalepixelvaluebymonoscale-0"></span><div class="fragmentname">&lt;&lt;Scale pixel value by <tt>scale</tt>&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">rgb[3 * offset    ] *= <a href="#Film::scale" class="code">scale</a>;
rgb[3 * offset + 1] *= <a href="#Film::scale" class="code">scale</a>;
rgb[3 * offset + 2] *= <a href="#Film::scale" class="code">scale</a>;</div><p>


</p>
<p></p>
<span class="anchor" id="fragment-FilmPrivateData-3"></span><div class="fragmentname">&lt;&lt;Film Private Data&gt;&gt;+=&nbsp;<a href="#fragment-FilmPrivateData-2"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">const Float <span class="anchor" id="Film::scale"></span>scale;</div><p>


</p>
<p>The <a href="../Utilities/Image_File_Input_and_Output.html#WriteImage"><tt>WriteImage()</tt></a> function, defined in Section&nbsp;<a href="../Utilities/Image_File_Input_and_Output.html#sec:imageio">A.2</a>,
handles the details of writing the image to a file.  If writing to an 8-bit
integer format, it applies gamma correction to the floating-point pixel
values according to the sRGB standard before converting them to
integers.  (See the &ldquo;Further Reading&rdquo; section at the end of Chapter&nbsp;<a href="../Texture.html#chap:texture">10</a>
for more information about gamma correction.)

</p>
<p></p>
<span class="anchor" id="fragment-WriteRGBimage-0"></span><div class="fragmentname">&lt;&lt;Write RGB image&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">::<a href="../Utilities/Image_File_Input_and_Output.html#WriteImage" class="code">WriteImage</a>(<a href="#Film::filename" class="code">filename</a>, &amp;rgb[0], croppedPixelBounds, <a href="#Film::fullResolution" class="code">fullResolution</a>);</div><p>


</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

</div>  <!-- container-fluid -->
</div>  <!-- maincontainer -->

<nav class="navbar navbar-expand-md bg-light navbar-light">
  <div class="container-fluid-nav">
    <!--  <ul class="nav navbar-nav navbar-center"> -->
      <span class="navbar-text" style="text-align: center;">
        Thanks to Joakim Dahl and 34 others for generously supporting <i>Physically
        Based Rendering</i> online
        through <a href="https://patreon.com/pbrbook">Patreon</a>.
    </span>
  </div>
</nav>

<nav class="navbar navbar-expand-md bg-light navbar-light">
  <span class="navbar-text"><i>Physically Based Rendering: From Theory To Implementation</i>, &copy; 2004-2021 Matt Pharr, Wenzel Jakob, and Greg Humphreys under the <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/">CC BY-NC-ND 4.0</a> license. (<a href="https://github.com/mmp/pbr-book-website/">github</a>)</span>
  <div class="container">
    <ul class="nav navbar-nav ml-auto">
      <li class="nav-item">Next: <a href="../Sampling_and_Reconstruction/Further_Reading.html">Sampling and Reconstruction / Further Reading</a></li>
    </ul>
  </div>

</nav>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script>
  $(function () {
    $('[data-toggle="popover"]').popover()
    $('[data-toggle="tooltip"]').tooltip()
   })
</script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

<script>
// https://stackoverflow.com/a/17535094
// The function actually applying the offset
function offsetAnchor() {
  if (location.hash.length !== 0) {
    window.scrollTo(window.scrollX, window.scrollY - window.innerHeight / 8);
  }
}

// Captures click events of all <a> elements with href starting with #
$(document).on('click', 'a[href^="#"]', function(event) {
  // Click events are captured before hashchanges. Timeout
  // causes offsetAnchor to be called after the page jump.
  window.setTimeout(function() {
    offsetAnchor();
  }, 500);
});

// Set the offset when entering page with hash present in the url
window.setTimeout(offsetAnchor, 1500);
</script>

</body>
</html>
